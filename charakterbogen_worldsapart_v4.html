<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worlds Apart - Charakterbogen</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/rift.css">
    <style>
        :root {
            /* Dark Theme */
            --bg-darkest: #0a0a0c;
            --bg-dark: #111114;
            --bg-card: #18181b;
            --bg-card-hover: #1f1f23;
            --bg-elevated: #252529;
            --bg-input: #1e1e22;
            
            /* Gold Accent */
            --accent-gold: #c9a227;
            --accent-gold-light: #e8c547;
            --accent-gold-dim: rgba(201, 162, 39, 0.15);
            --accent-gold-glow: rgba(201, 162, 39, 0.4);
            
            /* Secondary Colors */
            --accent-red: #dc2626;
            --accent-red-dim: rgba(220, 38, 38, 0.15);
            --accent-blue: #3b82f6;
            --accent-blue-dim: rgba(59, 130, 246, 0.15);
            --accent-purple: #8b5cf6;
            --accent-purple-dim: rgba(139, 92, 246, 0.15);
            --accent-green: #22c55e;
            
            /* Text */
            --text-primary: #f0f0f2;
            --text-secondary: #a1a1aa;
            --text-muted: #6b7280;
            --text-gold: #d4a825;
            
            /* Borders */
            --border-subtle: rgba(255, 255, 255, 0.05);
            --border-default: rgba(255, 255, 255, 0.1);
            --border-gold: rgba(201, 162, 39, 0.3);
            
            /* Spacing */
            --gap-xs: 4px;
            --gap-sm: 8px;
            --gap-md: 12px;
            --gap-lg: 16px;
            --gap-xl: 24px;
            
            /* Radius */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-darkest);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
            font-size: 14px;
        }

        /* ===== LAYOUT ===== */
        .sheet-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--gap-lg);
            display: flex;
            flex-direction: column;
            gap: var(--gap-lg);
        }

        /* ===== CARDS ===== */
        .card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-subtle);
            overflow: hidden;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: var(--gap-sm);
            padding: var(--gap-md) var(--gap-lg);
            border-bottom: 1px solid var(--border-subtle);
            background: rgba(0, 0, 0, 0.2);
        }

        .card-header-icon {
            width: 18px;
            height: 18px;
            opacity: 0.6;
        }

        .card-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
        }

        .card-collapse {
            margin-left: auto;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
        }

        .card-body {
            padding: var(--gap-lg);
        }

        /* ===== CHARACTER CARD - FULL WIDTH ===== */
        .character-card {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: var(--gap-xl);
            padding: var(--gap-lg);
        }

        .character-left {
            display: flex;
            flex-direction: column;
            gap: var(--gap-md);
        }

        .portrait {
            width: 160px;
            height: 200px;
            border-radius: var(--radius-md);
            background: var(--bg-elevated);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: all 0.2s;
        }

        .portrait:hover {
            opacity: 0.9;
        }

        .portrait img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .portrait-placeholder {
            color: var(--text-muted);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .crew-row {
            display: flex;
            align-items: center;
            gap: var(--gap-sm);
        }

        .crew-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            background: var(--bg-elevated);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            overflow: hidden;
        }

        .crew-icon img {
            width: 24px;
            height: 24px;
        }

        .crew-input {
            flex: 1;
            background: transparent;
            border: none;
            font-size: 13px;
            color: var(--text-muted);
            outline: none;
        }

        .crew-input::placeholder {
            color: var(--text-muted);
        }

        .character-right {
            display: flex;
            flex-direction: column;
            gap: var(--gap-md);
        }

        .character-fields-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--gap-md) var(--gap-xl);
        }

        .field-group {
            display: flex;
            flex-direction: column;
            gap: var(--gap-xs);
        }

        .field-group.full-width {
            grid-column: 1 / -1;
        }

        .field-label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
        }

        .field-input {
            background: var(--bg-input);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            padding: var(--gap-sm) var(--gap-md);
            font-size: 14px;
            color: var(--text-primary);
            outline: none;
            transition: border-color 0.2s;
        }

        .field-input:focus {
            border-color: var(--accent-gold);
        }

        .field-input::placeholder {
            color: var(--text-muted);
        }

        .field-input.name-input {
            font-size: 20px;
            font-weight: 600;
            padding: var(--gap-md);
        }

        .field-textarea {
            background: var(--bg-input);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            padding: var(--gap-sm) var(--gap-md);
            font-size: 13px;
            color: var(--text-primary);
            outline: none;
            resize: vertical;
            min-height: 60px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .field-textarea:focus {
            border-color: var(--accent-gold);
        }

        .field-textarea::placeholder {
            color: var(--text-muted);
        }

        /* ===== ATTRIBUTES ROW ===== */
        .attributes-row {
            display: flex;
            align-items: center;
            gap: var(--gap-lg);
            padding: var(--gap-lg);
        }

        .attributes-container {
            display: flex;
            gap: var(--gap-md);
            flex: 1;
            justify-content: center;
        }

        .attribute-circle {
            position: relative;
            width: 72px;
            height: 72px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .attribute-circle:hover {
            transform: scale(1.08);
        }

        .attribute-ring {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                var(--accent-gold) 0deg,
                var(--accent-gold) calc(var(--fill, 0) * 36deg),
                var(--bg-elevated) calc(var(--fill, 0) * 36deg),
                var(--bg-elevated) 360deg
            );
            padding: 3px;
            box-shadow: 0 0 15px var(--accent-gold-dim);
            transition: box-shadow 0.2s;
        }

        .attribute-circle:hover .attribute-ring {
            box-shadow: 0 0 25px var(--accent-gold-glow);
        }

        .attribute-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: var(--bg-card);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .attribute-value {
            background: transparent;
            border: none;
            width: 36px;
            text-align: center;
            font-size: 22px;
            font-weight: 800;
            color: var(--text-primary);
            outline: none;
        }

        .attribute-abbr {
            font-size: 9px;
            font-weight: 700;
            color: var(--accent-gold);
            letter-spacing: 1px;
            margin-top: -2px;
        }

        .attribute-name {
            position: absolute;
            bottom: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 9px;
            color: var(--text-muted);
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }

        .attr-points-badge {
            font-size: 12px;
            font-weight: 600;
            color: var(--accent-gold);
            padding: 6px 14px;
            background: var(--accent-gold-dim);
            border: 1px solid var(--border-gold);
            border-radius: 20px;
        }

        /* ===== MAIN GRID ===== */
        .main-grid {
            display: grid;
            grid-template-columns: 280px 1fr 280px;
            gap: var(--gap-lg);
        }

        .column {
            display: flex;
            flex-direction: column;
            gap: var(--gap-lg);
        }

        /* ===== STATUS SECTION ===== */
        .status-grid {
            display: flex;
            flex-direction: column;
            gap: var(--gap-md);
        }

        .status-box {
            background: var(--bg-elevated);
            border-radius: var(--radius-md);
            padding: var(--gap-md);
            border: 1px solid var(--border-subtle);
        }

        .status-box.health { border-left: 3px solid var(--accent-red); }
        .status-box.moral { border-left: 3px solid var(--accent-blue); }
        .status-box.resonanz { border-left: 3px solid var(--accent-purple); }

        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--gap-sm);
        }

        .status-label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
        }

        .status-formula {
            font-size: 9px;
            color: var(--text-muted);
            font-style: italic;
        }

        .status-value {
            display: flex;
            align-items: baseline;
            gap: 4px;
        }

        .status-current {
            font-size: 28px;
            font-weight: 700;
            background: transparent;
            border: none;
            color: var(--text-primary);
            width: 55px;
            text-align: left;
            outline: none;
        }

        .status-separator {
            color: var(--text-muted);
            font-size: 16px;
        }

        .status-max {
            font-size: 14px;
            color: var(--text-muted);
        }

        .status-bar {
            height: 6px;
            background: var(--bg-input);
            border-radius: 3px;
            margin-top: var(--gap-sm);
            overflow: hidden;
        }

        .status-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .status-bar-fill.health { background: linear-gradient(90deg, #991b1b, #ef4444); }
        .status-bar-fill.moral { background: linear-gradient(90deg, #1d4ed8, #60a5fa); }
        .status-bar-fill.resonanz { background: linear-gradient(90deg, #6d28d9, #a78bfa); }

        /* ===== FOKUS - PROMINENT ===== */
        .fokus-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-gold);
            overflow: hidden;
        }

        .fokus-card .card-header {
            background: linear-gradient(90deg, var(--accent-gold-dim), transparent);
            border-bottom: 1px solid var(--border-gold);
        }

        .fokus-main {
            display: flex;
            gap: var(--gap-xl);
            padding: var(--gap-xl);
            align-items: flex-start;
            cursor: pointer;
        }

        .fokus-icon-large {
            width: 80px;
            height: 80px;
            border-radius: var(--radius-lg);
            background: var(--bg-elevated);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--border-gold);
            transition: all 0.2s;
            box-shadow: 0 0 20px var(--accent-gold-dim);
            flex-shrink: 0;
        }

        .fokus-icon-large:hover {
            border-color: var(--accent-gold);
            box-shadow: 0 0 30px var(--accent-gold-glow);
        }

        .fokus-icon-large img {
            width: 50px;
            height: 50px;
        }

        .fokus-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: var(--gap-sm);
        }

        .fokus-name-large {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .fokus-attr-large {
            font-size: 13px;
            color: var(--accent-gold);
            font-weight: 500;
        }

        .fokus-dice-inline {
            display: inline-flex;
            align-items: center;
            gap: var(--gap-sm);
            background: var(--bg-elevated);
            padding: var(--gap-sm) var(--gap-md);
            border-radius: var(--radius-md);
            margin-top: var(--gap-xs);
            width: fit-content;
        }

        .fokus-dice-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .fokus-dice-value {
            font-size: 16px;
            font-weight: 700;
            color: var(--accent-gold);
        }

        /* Fokus Abilities - Prominent with descriptions */
        .fokus-abilities-section {
            padding: 0 var(--gap-xl) var(--gap-xl);
        }

        .fokus-abilities-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--gap-md);
        }

        .fokus-ability-card {
            background: var(--bg-elevated);
            border-radius: var(--radius-md);
            padding: var(--gap-md);
            border: 1px solid var(--border-subtle);
            cursor: pointer;
            transition: all 0.2s;
        }

        .fokus-ability-card:hover {
            border-color: var(--accent-gold);
            background: var(--bg-card-hover);
        }

        .fokus-ability-card.empty {
            border-style: dashed;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 80px;
        }

        .fokus-ability-card.empty span {
            color: var(--text-muted);
            font-size: 13px;
        }

        .fokus-ability-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--gap-xs);
        }

        .fokus-ability-type {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--accent-gold);
            margin-bottom: var(--gap-xs);
        }

        .fokus-ability-desc {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* ===== SKILLS ===== */
        .skills-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-subtle);
            overflow: hidden;
        }

        .skills-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--gap-md) var(--gap-lg);
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid var(--border-subtle);
        }

        .skills-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
        }

        .skills-points {
            font-size: 11px;
            color: var(--text-muted);
        }

        /* Prominent Category Tabs */
        .skill-category-tabs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            background: var(--bg-dark);
        }

        .skill-category-tab {
            padding: var(--gap-lg) var(--gap-md);
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            text-align: center;
        }

        .skill-category-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: transparent;
            transition: background 0.2s;
        }

        .skill-category-tab:hover {
            background: var(--bg-elevated);
        }

        .skill-category-tab.active {
            background: var(--bg-card);
        }

        .skill-category-tab.active::after {
            background: var(--accent-gold);
        }

        .skill-category-name {
            font-size: 13px;
            font-weight: 700;
            color: var(--text-muted);
            letter-spacing: 2px;
            text-transform: uppercase;
            transition: color 0.2s;
        }

        .skill-category-tab.active .skill-category-name {
            color: var(--accent-gold);
        }

        .skill-category-attrs {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 4px;
            opacity: 0.7;
        }

        .skill-category-tab.active .skill-category-attrs {
            opacity: 1;
        }

        /* Skills List */
        .skill-panel {
            display: none;
        }

        .skill-panel.active {
            display: block;
        }

        .skills-list-header {
            display: grid;
            grid-template-columns: 28px 1fr 60px 50px;
            gap: var(--gap-sm);
            padding: var(--gap-sm) var(--gap-lg);
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            background: var(--bg-elevated);
            border-bottom: 1px solid var(--border-subtle);
        }

        .skill-row {
            display: grid;
            grid-template-columns: 28px 1fr 60px 50px;
            gap: var(--gap-sm);
            padding: var(--gap-sm) var(--gap-lg);
            align-items: center;
            border-bottom: 1px solid var(--border-subtle);
            transition: background 0.15s;
        }

        .skill-row:hover {
            background: var(--bg-elevated);
        }

        .skill-prof {
            width: 18px;
            height: 18px;
            border: 2px solid var(--text-muted);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.15s;
            margin: 0 auto;
        }

        .skill-prof:hover {
            border-color: var(--accent-gold);
        }

        .skill-prof.active {
            background: var(--accent-gold);
            border-color: var(--accent-gold);
        }

        .skill-name-input {
            background: transparent;
            border: none;
            font-size: 13px;
            color: var(--text-primary);
            outline: none;
        }

        .skill-value-input {
            background: var(--bg-input);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            padding: 6px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            text-align: center;
            outline: none;
            width: 100%;
        }

        .skill-value-input:focus {
            border-color: var(--accent-gold);
        }

        .skill-bonus {
            font-size: 13px;
            font-weight: 700;
            color: var(--accent-gold);
            text-align: center;
        }

        .skill-class-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--gap-md) var(--gap-lg);
            background: var(--bg-elevated);
            border-top: 1px solid var(--border-subtle);
        }

        .skill-class-label {
            font-size: 10px;
            color: var(--text-muted);
        }

        .skill-class-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .skill-class-bonus {
            color: var(--accent-gold);
            font-weight: 600;
            font-size: 14px;
        }

        .add-skill-btn {
            width: calc(100% - var(--gap-lg) * 2);
            padding: var(--gap-sm);
            background: transparent;
            border: 1px dashed var(--border-default);
            border-radius: var(--radius-sm);
            color: var(--text-muted);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.15s;
            margin: var(--gap-sm) var(--gap-lg);
        }

        .add-skill-btn:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        /* ===== SECOND CHANCE ===== */
        .dice-row {
            display: flex;
            justify-content: center;
            gap: var(--gap-md);
        }

        .dice-check {
            width: 48px;
            height: 48px;
            background: var(--bg-elevated);
            border: 2px solid var(--border-default);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dice-check:hover {
            border-color: var(--accent-gold);
            box-shadow: 0 0 15px var(--accent-gold-dim);
        }

        .dice-check.used {
            background: var(--accent-gold-dim);
            border-color: var(--accent-gold);
            opacity: 0.3;
        }

        .dice-check svg {
            width: 28px;
            height: 28px;
            fill: var(--text-secondary);
        }

        /* ===== TEXTAREA FIELDS ===== */
        .textarea-field {
            width: 100%;
            min-height: 80px;
            background: var(--bg-input);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            padding: var(--gap-md);
            font-size: 13px;
            color: var(--text-primary);
            resize: vertical;
            outline: none;
            font-family: inherit;
            line-height: 1.5;
        }

        .textarea-field:focus {
            border-color: var(--accent-gold);
        }

        /* Currency */
        .currency-row {
            display: flex;
            align-items: center;
            gap: var(--gap-sm);
            margin-bottom: var(--gap-md);
        }

        .currency-icon {
            width: 24px;
            height: 24px;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.15s;
        }

        .currency-icon:hover {
            opacity: 1;
        }

        .currency-input {
            flex: 1;
            background: var(--bg-input);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            padding: 8px var(--gap-md);
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-gold);
            outline: none;
        }

        .currency-input:focus {
            border-color: var(--accent-gold);
        }

        /* ===== ACTION BUTTONS ===== */
        .action-buttons {
            display: flex;
            gap: var(--gap-sm);
            margin-top: var(--gap-md);
        }

        .action-btn {
            flex: 1;
            padding: 8px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            color: var(--text-muted);
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .action-btn:hover {
            background: var(--bg-card-hover);
            color: var(--text-secondary);
            border-color: var(--accent-gold);
        }

        .action-btn.danger:hover {
            background: var(--accent-red-dim);
            border-color: var(--accent-red);
            color: var(--accent-red);
        }

        .action-btn svg {
            width: 14px;
            height: 14px;
        }

        /* ===== POPUP OVERLAY ===== */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.25s ease;
        }

        .popup-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .popup {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            border: 1px solid var(--border-gold);
            width: 90%;
            max-width: 650px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            transform: scale(0.95) translateY(20px);
            transition: transform 0.25s ease;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);
        }

        .popup-overlay.active .popup {
            transform: scale(1) translateY(0);
        }

        .popup-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--gap-lg) var(--gap-xl);
            border-bottom: 1px solid var(--border-subtle);
        }

        .popup-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-gold);
        }

        .popup-close {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--bg-elevated);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .popup-close:hover {
            background: var(--accent-red);
            color: white;
        }

        .popup-body {
            flex: 1;
            overflow-y: auto;
            padding: var(--gap-xl);
        }

        .popup-footer {
            padding: var(--gap-lg) var(--gap-xl);
            border-top: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Fokus Selection */
        .fokus-type-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--gap-sm);
            margin-bottom: var(--gap-xl);
        }

        .fokus-type-btn {
            aspect-ratio: 1;
            background: var(--bg-elevated);
            border: 2px solid var(--border-subtle);
            border-radius: var(--radius-md);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: var(--gap-xs);
            cursor: pointer;
            transition: all 0.2s;
            padding: var(--gap-sm);
        }

        .fokus-type-btn:hover {
            border-color: var(--accent-gold);
            background: var(--bg-card-hover);
        }

        .fokus-type-btn.active {
            border-color: var(--accent-gold);
            background: var(--accent-gold-dim);
            box-shadow: 0 0 20px var(--accent-gold-dim);
        }

        .fokus-type-btn img {
            width: 40px;
            height: 40px;
        }

        .fokus-type-btn span {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .fokus-type-btn.active span {
            color: var(--accent-gold);
        }

        .fokus-section-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-gold);
            margin: var(--gap-md) 0 var(--gap-sm);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .fokus-ability-grid {
            display: grid;
            gap: var(--gap-sm);
        }

        .fokus-ability-option {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            padding: var(--gap-md);
            cursor: pointer;
            transition: all 0.15s;
        }

        .fokus-ability-option:hover:not(.disabled) {
            border-color: var(--accent-gold);
            background: var(--bg-card-hover);
        }

        .fokus-ability-option.selected {
            border-color: var(--accent-gold);
            background: var(--accent-gold-dim);
        }

        .fokus-ability-option.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .fokus-ability-option-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .fokus-ability-option-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .popup-btn {
            padding: 10px 24px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
        }

        .popup-btn-primary {
            background: var(--accent-gold);
            color: var(--bg-darkest);
        }

        .popup-btn-primary:hover:not(:disabled) {
            background: var(--accent-gold-light);
        }

        .popup-btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .popup-info {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* ===== SAVE INDICATOR ===== */
        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--accent-green);
            color: white;
            padding: 10px 20px;
            border-radius: var(--radius-md);
            font-size: 13px;
            font-weight: 500;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .save-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* ===== HIDDEN ===== */
        .hidden-input {
            display: none;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1100px) {
            .main-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .column.center-column {
                grid-column: 1 / -1;
                grid-row: 1;
            }
        }

        @media (max-width: 900px) {
            .character-card {
                grid-template-columns: 1fr;
            }
            
            .character-left {
                flex-direction: row;
                align-items: flex-start;
                gap: var(--gap-lg);
            }
            
            .portrait {
                width: 120px;
                height: 150px;
            }
            
            .attributes-container {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .fokus-abilities-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 700px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .skill-category-tabs {
                grid-template-columns: 1fr;
            }
            
            .skill-category-tab {
                padding: var(--gap-md);
            }
            
            .character-left {
                flex-direction: column;
            }
            
            .portrait {
                width: 100%;
                max-width: 200px;
                height: 220px;
                margin: 0 auto;
            }
        }
    </style>
</head>
<body>
    <div class="sheet-container">
        <!-- CHARACTER CARD - FULL WIDTH -->
        <div class="card">
            <div class="card-header">
                <svg class="card-header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
                <span class="card-title">Charakter</span>
                <button class="card-collapse">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"/>
                    </svg>
                </button>
            </div>
            <div class="character-card">
                <div class="character-left">
                    <div class="portrait" onclick="document.getElementById('portrait-upload').click()">
                        <span class="portrait-placeholder" id="portrait-placeholder">Portrait</span>
                        <img id="portrait-img" style="display: none;">
                    </div>
                    <div class="crew-row">
                        <div class="crew-icon" onclick="document.getElementById('jolly-upload').click()">
                            <img src="assets/icons/icon_skull.png" alt="Crew" id="crew-icon-img">
                        </div>
                        <input type="text" class="crew-input" id="char-crew" placeholder="Name der Crew...">
                    </div>
                </div>
                <div class="character-right">
                    <div class="character-fields-grid">
                        <div class="field-group">
                            <label class="field-label">Name</label>
                            <input type="text" class="field-input name-input" id="char-name" placeholder="Charaktername">
                        </div>
                        <div class="field-group">
                            <label class="field-label">Geschlecht</label>
                            <input type="text" class="field-input" id="char-gender" placeholder="z.B. Männlich, Weiblich...">
                        </div>
                        <div class="field-group">
                            <label class="field-label">Alter</label>
                            <input type="text" class="field-input" id="char-age" placeholder="z.B. 25 Jahre">
                        </div>
                        <div class="field-group">
                            <label class="field-label">Rolle in der Crew</label>
                            <input type="text" class="field-input" id="char-role" placeholder="z.B. Kapitän, Navigator...">
                        </div>
                        <div class="field-group full-width">
                            <label class="field-label">Aussehen</label>
                            <textarea class="field-textarea" id="char-appearance" placeholder="z.B. 1.80m, athletisch, blaue Augen..."></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ATTRIBUTES ROW -->
        <div class="card">
            <div class="card-header">
                <svg class="card-header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                </svg>
                <span class="card-title">Attribute</span>
            </div>
            <div class="attributes-row">
                <div class="attributes-container">
                    <div class="attribute-circle" title="Kraft - Feuer, Blitz">
                        <div class="attribute-ring" id="ring-power" style="--fill: 0;">
                            <div class="attribute-inner">
                                <input type="number" class="attribute-value" id="attr-power" value="0" min="0" max="10">
                                <div class="attribute-abbr">KRF</div>
                            </div>
                        </div>
                        <div class="attribute-name">Kraft</div>
                    </div>
                    <div class="attribute-circle" title="Geschick - Wasser, Wind">
                        <div class="attribute-ring" id="ring-agility" style="--fill: 0;">
                            <div class="attribute-inner">
                                <input type="number" class="attribute-value" id="attr-agility" value="0" min="0" max="10">
                                <div class="attribute-abbr">GES</div>
                            </div>
                        </div>
                        <div class="attribute-name">Geschick</div>
                    </div>
                    <div class="attribute-circle" title="Zähigkeit - Erde">
                        <div class="attribute-ring" id="ring-endurance" style="--fill: 0;">
                            <div class="attribute-inner">
                                <input type="number" class="attribute-value" id="attr-endurance" value="0" min="0" max="10">
                                <div class="attribute-abbr">ZÄH</div>
                            </div>
                        </div>
                        <div class="attribute-name">Zähigkeit</div>
                    </div>
                    <div class="attribute-circle" title="Verstand - Raum">
                        <div class="attribute-ring" id="ring-mind" style="--fill: 0;">
                            <div class="attribute-inner">
                                <input type="number" class="attribute-value" id="attr-mind" value="0" min="0" max="10">
                                <div class="attribute-abbr">VER</div>
                            </div>
                        </div>
                        <div class="attribute-name">Verstand</div>
                    </div>
                    <div class="attribute-circle" title="Präsenz - Illusion">
                        <div class="attribute-ring" id="ring-presence" style="--fill: 0;">
                            <div class="attribute-inner">
                                <input type="number" class="attribute-value" id="attr-presence" value="0" min="0" max="10">
                                <div class="attribute-abbr">PRÄ</div>
                            </div>
                        </div>
                        <div class="attribute-name">Präsenz</div>
                    </div>
                </div>
                <div class="attr-points-badge" id="attr-points">10 / 10</div>
            </div>
        </div>

        <!-- MAIN GRID -->
        <div class="main-grid">
            <!-- LEFT COLUMN -->
            <div class="column">
                <!-- Status -->
                <div class="card">
                    <div class="card-header">
                        <svg class="card-header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                        </svg>
                        <span class="card-title">Status</span>
                    </div>
                    <div class="card-body">
                        <div class="status-grid">
                            <div class="status-box health">
                                <div class="status-header">
                                    <span class="status-label">Leben</span>
                                </div>
                                <div class="status-value">
                                    <input type="number" class="status-current" id="health-current" value="100" min="0">
                                    <span class="status-separator">/</span>
                                    <span class="status-max">100</span>
                                </div>
                                <div class="status-bar">
                                    <div class="status-bar-fill health" id="health-bar" style="width: 100%"></div>
                                </div>
                            </div>
                            <div class="status-box moral">
                                <div class="status-header">
                                    <span class="status-label">Moral</span>
                                </div>
                                <div class="status-value">
                                    <input type="number" class="status-current" id="moral-current" value="100" min="0">
                                    <span class="status-separator">/</span>
                                    <span class="status-max">100</span>
                                </div>
                                <div class="status-bar">
                                    <div class="status-bar-fill moral" id="moral-bar" style="width: 100%"></div>
                                </div>
                            </div>
                            <div class="status-box resonanz">
                                <div class="status-header">
                                    <span class="status-label">Resonanz</span>
                                    <span class="status-formula">10 + KRF × PRÄ</span>
                                </div>
                                <div class="status-value">
                                    <span class="status-current" id="resonanz-display" style="width: auto; pointer-events: none;">10</span>
                                    <span class="status-separator">%</span>
                                </div>
                                <div class="status-bar">
                                    <div class="status-bar-fill resonanz" id="resonanz-bar" style="width: 10%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Second Chance -->
                <div class="card">
                    <div class="card-header">
                        <svg class="card-header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="2" width="20" height="20" rx="2"/>
                            <circle cx="8" cy="8" r="1.5" fill="currentColor"/>
                            <circle cx="16" cy="16" r="1.5" fill="currentColor"/>
                        </svg>
                        <span class="card-title">Zweite Chance</span>
                    </div>
                    <div class="card-body">
                        <div class="dice-row">
                            <div class="dice-check" id="dice-1" onclick="toggleDice(0)">
                                <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                            </div>
                            <div class="dice-check" id="dice-2" onclick="toggleDice(1)">
                                <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                            </div>
                            <div class="dice-check" id="dice-3" onclick="toggleDice(2)">
                                <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Inventar -->
                <div class="card">
                    <div class="card-header">
                        <svg class="card-header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                            <line x1="3" y1="6" x2="21" y2="6"/>
                            <path d="M16 10a4 4 0 0 1-8 0"/>
                        </svg>
                        <span class="card-title">Inventar</span>
                    </div>
                    <div class="card-body">
                        <div class="currency-row">
                            <img src="assets/icons/icon_dollar.png" alt="Currency" class="currency-icon" id="currency-icon" onclick="rotateCurrency()">
                            <input type="text" class="currency-input" id="char-currency" placeholder="0">
                        </div>
                        <textarea class="textarea-field" id="char-inventory" placeholder="Gegenstände, Ausrüstung..." style="min-height: 120px;"></textarea>
                    </div>
                </div>
            </div>

            <!-- CENTER COLUMN: Fokus + Skills -->
            <div class="column center-column">
                <!-- FOKUS -->
                <div class="fokus-card">
                    <div class="card-header">
                        <svg class="card-header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <circle cx="12" cy="12" r="6"/>
                            <circle cx="12" cy="12" r="2"/>
                        </svg>
                        <span class="card-title">Fokus</span>
                    </div>
                    <div class="fokus-main" onclick="openFokusPopup()">
                        <div class="fokus-icon-large" id="fokus-icon">
                            <span style="color: var(--text-muted); font-size: 32px;">?</span>
                        </div>
                        <div class="fokus-info">
                            <div class="fokus-name-large" id="fokus-name">Kein Fokus gewählt</div>
                            <div class="fokus-attr-large" id="fokus-attr">Klicke um einen Fokus zu wählen</div>
                            <div class="fokus-dice-inline" id="fokus-dice-inline" style="display: none;">
                                <span class="fokus-dice-label">Würfel:</span>
                                <span class="fokus-dice-value" id="fokus-formula">W20 + 0</span>
                            </div>
                        </div>
                    </div>
                    <div class="fokus-abilities-section" id="fokus-abilities-section">
                        <div class="fokus-abilities-grid" id="fokus-abilities-grid">
                            <div class="fokus-ability-card empty" onclick="openFokusPopup()">
                                <span>Fähigkeit 1 wählen...</span>
                            </div>
                            <div class="fokus-ability-card empty" onclick="openFokusPopup()">
                                <span>Fähigkeit 2 wählen...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Skills -->
                <div class="skills-card">
                    <div class="skills-header">
                        <span class="skills-title">Fähigkeiten</span>
                        <span class="skills-points" id="skills-points">0 / 500</span>
                    </div>
                    
                    <div class="skill-category-tabs">
                        <button class="skill-category-tab active" data-category="handeln" onclick="switchSkillTab('handeln')">
                            <div class="skill-category-name">Handeln</div>
                            <div class="skill-category-attrs">KRF + GES + ZÄH</div>
                        </button>
                        <button class="skill-category-tab" data-category="wissen" onclick="switchSkillTab('wissen')">
                            <div class="skill-category-name">Wissen</div>
                            <div class="skill-category-attrs">VER + ZÄH</div>
                        </button>
                        <button class="skill-category-tab" data-category="soziales" onclick="switchSkillTab('soziales')">
                            <div class="skill-category-name">Soziales</div>
                            <div class="skill-category-attrs">PRÄ + VER</div>
                        </button>
                    </div>
                    
                    <div class="skill-panel active" id="panel-handeln">
                        <div class="skills-list-header">
                            <span></span>
                            <span>Fähigkeit</span>
                            <span>Punkte</span>
                            <span>Bonus</span>
                        </div>
                        <div class="skills-list" id="skills-handeln"></div>
                        <button class="add-skill-btn" onclick="addSkill('handeln')">+ Fähigkeit hinzufügen</button>
                        <div class="skill-class-footer">
                            <span class="skill-class-label">Klassen-Fallback (W100)</span>
                            <div>
                                <span class="skill-class-value" id="handeln-total">0</span>
                                <span class="skill-class-bonus" id="handeln-bonus">+0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="skill-panel" id="panel-wissen">
                        <div class="skills-list-header">
                            <span></span>
                            <span>Fähigkeit</span>
                            <span>Punkte</span>
                            <span>Bonus</span>
                        </div>
                        <div class="skills-list" id="skills-wissen"></div>
                        <button class="add-skill-btn" onclick="addSkill('wissen')">+ Fähigkeit hinzufügen</button>
                        <div class="skill-class-footer">
                            <span class="skill-class-label">Klassen-Fallback (W100)</span>
                            <div>
                                <span class="skill-class-value" id="wissen-total">0</span>
                                <span class="skill-class-bonus" id="wissen-bonus">+0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="skill-panel" id="panel-soziales">
                        <div class="skills-list-header">
                            <span></span>
                            <span>Fähigkeit</span>
                            <span>Punkte</span>
                            <span>Bonus</span>
                        </div>
                        <div class="skills-list" id="skills-soziales"></div>
                        <button class="add-skill-btn" onclick="addSkill('soziales')">+ Fähigkeit hinzufügen</button>
                        <div class="skill-class-footer">
                            <span class="skill-class-label">Klassen-Fallback (W100)</span>
                            <div>
                                <span class="skill-class-value" id="soziales-total">0</span>
                                <span class="skill-class-bonus" id="soziales-bonus">+0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN -->
            <div class="column">
                <!-- Actions -->
                <div class="card">
                    <div class="card-header">
                        <svg class="card-header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        </svg>
                        <span class="card-title">Aktionen</span>
                    </div>
                    <div class="card-body">
                        <div class="action-buttons" style="flex-direction: column;">
                            <button class="action-btn" onclick="exportCharacter()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Charakter exportieren
                            </button>
                            <button class="action-btn" onclick="document.getElementById('import-file').click()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="17 8 12 3 7 8"/>
                                    <line x1="12" y1="3" x2="12" y2="15"/>
                                </svg>
                                Charakter importieren
                            </button>
                            <button class="action-btn danger" onclick="resetCharacter()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"/>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                                Charakter zurücksetzen
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Notizen -->
                <div class="card">
                    <div class="card-header">
                        <svg class="card-header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        <span class="card-title">Notizen</span>
                    </div>
                    <div class="card-body">
                        <textarea class="textarea-field" id="char-notes" placeholder="Persönliche Notizen..." style="min-height: 200px;"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fokus Popup -->
    <div class="popup-overlay" id="fokus-popup">
        <div class="popup">
            <div class="popup-header">
                <span class="popup-title">Fokus wählen</span>
                <button class="popup-close" onclick="closeFokusPopup()">×</button>
            </div>
            <div class="popup-body">
                <div class="fokus-type-grid" id="fokus-type-grid"></div>
                <div id="fokus-abilities-container"></div>
            </div>
            <div class="popup-footer">
                <span class="popup-info" id="fokus-selection-info">Wähle einen Fokus-Typ</span>
                <button class="popup-btn popup-btn-primary" id="fokus-confirm-btn" onclick="confirmFokusSelection()" disabled>Bestätigen</button>
            </div>
        </div>
    </div>

    <!-- Hidden Inputs -->
    <input type="file" id="portrait-upload" class="hidden-input" accept="image/*" onchange="uploadPortrait(event)">
    <input type="file" id="jolly-upload" class="hidden-input" accept="image/*" onchange="uploadJolly(event)">
    <input type="file" id="import-file" class="hidden-input" accept=".json" onchange="importCharacter(event)">

    <!-- Save Indicator -->
    <div class="save-indicator" id="save-indicator">✓ Gespeichert</div>

    <script>
        // ===== CONSTANTS =====
        const STORAGE_KEY = 'worldsapart_character_v4';
        const ATTR_TOTAL = 10;
        const SKILL_TOTAL = 500;
        const ATTRIBUTES = ['power', 'agility', 'endurance', 'mind', 'presence'];
        const CURRENCY_TYPES = ['dollar', 'euro', 'yen', 'berry'];
        
        const CLASS_ATTRIBUTE_MAP = {
            handeln: ['power', 'agility', 'endurance'],
            wissen: ['mind', 'endurance'],
            soziales: ['presence', 'mind']
        };
        
        const FOKUS_DATA = {
            fire: { name: 'Feuer', icon: 'icon_focus_fire.png', attr: 'KRF', attacks: [
                { name: 'Feuerstoß', desc: 'Schleudere einen Feuerball auf ein Ziel' },
                { name: 'Flammenwall', desc: 'Erschaffe eine Barriere aus Feuer' }
            ], defenses: [
                { name: 'Hitzeschild', desc: 'Reduziere eingehenden Schaden' },
                { name: 'Feuerresistenz', desc: 'Immunität gegen Feuerschaden' }
            ]},
            lightning: { name: 'Blitz', icon: 'icon_focus_lightning.png', attr: 'KRF', attacks: [
                { name: 'Blitzschlag', desc: 'Ein schneller Blitz trifft ein Ziel' },
                { name: 'Kettenblitz', desc: 'Springt zwischen mehreren Zielen' }
            ], defenses: [
                { name: 'Statisches Feld', desc: 'Verlangsame angreifende Feinde' },
                { name: 'Blitzreflexe', desc: 'Bonus auf Initiative' }
            ]},
            water: { name: 'Wasser', icon: 'icon_focus_water.png', attr: 'GES', attacks: [
                { name: 'Wasserpeitsche', desc: 'Ein präziser Wasserangriff' },
                { name: 'Flutwelle', desc: 'Trifft alle Feinde in einem Bereich' }
            ], defenses: [
                { name: 'Wasserschild', desc: 'Absorbiere Schaden' },
                { name: 'Nebelform', desc: 'Werde schwerer zu treffen' }
            ]},
            wind: { name: 'Wind', icon: 'icon_focus_wind.png', attr: 'GES', attacks: [
                { name: 'Windstoß', desc: 'Drücke Feinde zurück' },
                { name: 'Tornado', desc: 'Wirble Feinde durch die Luft' }
            ], defenses: [
                { name: 'Windbarriere', desc: 'Projektile werden abgelenkt' },
                { name: 'Schwebend', desc: 'Ignoriere schwieriges Terrain' }
            ]},
            earth: { name: 'Erde', icon: 'icon_focus_earth.png', attr: 'ZÄH', attacks: [
                { name: 'Steinwurf', desc: 'Schleudere einen Felsbrocken' },
                { name: 'Erdbeben', desc: 'Erschüttere den Boden' }
            ], defenses: [
                { name: 'Steinrüstung', desc: 'Erhöhe deine Rüstung' },
                { name: 'Erdverbunden', desc: 'Kannst nicht umgeworfen werden' }
            ]},
            room: { name: 'Raum', icon: 'icon_focus_room.png', attr: 'VER', attacks: [
                { name: 'Telekinese', desc: 'Bewege Objekte mit deinem Geist' },
                { name: 'Raumriss', desc: 'Öffne eine Dimension des Schadens' }
            ], defenses: [
                { name: 'Phasenverschiebung', desc: 'Weiche einem Angriff aus' },
                { name: 'Dimensionsanker', desc: 'Verhindere Teleportation' }
            ]},
            illusion: { name: 'Illusion', icon: 'icon_focus_illusion.png', attr: 'PRÄ', attacks: [
                { name: 'Phantomklinge', desc: 'Ein illusionärer Angriff' },
                { name: 'Alptraum', desc: 'Verursache psychischen Schaden' }
            ], defenses: [
                { name: 'Spiegelbild', desc: 'Erschaffe Duplikate von dir' },
                { name: 'Unsichtbarkeit', desc: 'Verschwinde vor den Augen der Feinde' }
            ]},
            none: { name: 'Ohne Fokus', icon: 'icon_nofocus.png', attr: '', attacks: [], defenses: [] }
        };
        
        const FOKUS_ATTRIBUTE_MAP = {
            fire: 'power',
            lightning: 'power',
            water: 'agility',
            wind: 'agility',
            earth: 'endurance',
            room: 'mind',
            illusion: 'presence'
        };

        // ===== STATE =====
        let characterData = {};
        let currencyIndex = 0;
        let selectedFokusType = null;
        let selectedFokusAbilities = [];
        let saveTimeout = null;

        // ===== INIT =====
        function getDefaultCharacter() {
            return {
                name: '',
                age: '',
                gender: '',
                role: '',
                crew: '',
                portrait: null,
                jollyRoger: null,
                attributes: { power: 0, agility: 0, endurance: 0, mind: 0, presence: 0 },
                health: { current: 100, max: 100 },
                moral: { current: 100, max: 100 },
                secondChance: [false, false, false],
                skills: { handeln: [], wissen: [], soziales: [] },
                fokus: { type: null, abilities: [] },
                appearance: '',
                inventory: '',
                currency: '',
                currencyType: 'dollar',
                notes: ''
            };
        }

        function init() {
            loadCharacter();
            populateFields();
            initializeSkills();
            updateAllCalculations();
        }

        function loadCharacter() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    characterData = { ...getDefaultCharacter(), ...JSON.parse(saved) };
                } catch(e) {
                    characterData = getDefaultCharacter();
                }
            } else {
                characterData = getDefaultCharacter();
            }
        }

        function saveCharacter() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(characterData));
        }

        function autoSave() {
            if (saveTimeout) clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                saveCharacter();
                showSaveIndicator();
            }, 500);
        }

        function showSaveIndicator() {
            const indicator = document.getElementById('save-indicator');
            indicator.classList.add('show');
            setTimeout(() => indicator.classList.remove('show'), 1500);
        }

        function populateFields() {
            document.getElementById('char-name').value = characterData.name || '';
            document.getElementById('char-age').value = characterData.age || '';
            document.getElementById('char-gender').value = characterData.gender || '';
            document.getElementById('char-role').value = characterData.role || '';
            document.getElementById('char-crew').value = characterData.crew || '';
            document.getElementById('char-appearance').value = characterData.appearance || '';
            document.getElementById('char-inventory').value = characterData.inventory || '';
            document.getElementById('char-currency').value = characterData.currency || '';
            document.getElementById('char-notes').value = characterData.notes || '';
            
            ATTRIBUTES.forEach(attr => {
                document.getElementById(`attr-${attr}`).value = characterData.attributes[attr] || 0;
            });
            
            document.getElementById('health-current').value = characterData.health.current;
            document.getElementById('moral-current').value = characterData.moral.current;
            
            characterData.secondChance.forEach((used, i) => {
                if (used) document.getElementById(`dice-${i+1}`).classList.add('used');
            });
            
            if (characterData.portrait) {
                document.getElementById('portrait-img').src = characterData.portrait;
                document.getElementById('portrait-img').style.display = 'block';
                document.getElementById('portrait-placeholder').style.display = 'none';
            }
            
            if (characterData.jollyRoger) {
                document.getElementById('crew-icon-img').src = characterData.jollyRoger;
            }
            
            updateFokusDisplay();
            
            if (characterData.currencyType) {
                currencyIndex = CURRENCY_TYPES.indexOf(characterData.currencyType);
                if (currencyIndex === -1) currencyIndex = 0;
                document.getElementById('currency-icon').src = `assets/icons/icon_${CURRENCY_TYPES[currencyIndex]}.png`;
            }
        }

        // ===== EVENT LISTENERS =====
        document.addEventListener('DOMContentLoaded', init);
        
        ['char-name', 'char-age', 'char-gender', 'char-role', 'char-crew', 'char-appearance', 'char-inventory', 'char-currency', 'char-notes'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                const key = id.replace('char-', '');
                characterData[key] = e.target.value;
                autoSave();
            });
        });
        
        ATTRIBUTES.forEach(attr => {
            document.getElementById(`attr-${attr}`).addEventListener('input', (e) => {
                let value = parseInt(e.target.value) || 0;
                value = Math.max(0, Math.min(10, value));
                e.target.value = value;
                characterData.attributes[attr] = value;
                updateAllCalculations();
                autoSave();
            });
        });
        
        document.getElementById('health-current').addEventListener('input', (e) => {
            let value = parseInt(e.target.value) || 0;
            value = Math.max(0, Math.min(100, value));
            e.target.value = value;
            characterData.health.current = value;
            updateStatBars();
            autoSave();
        });
        
        document.getElementById('moral-current').addEventListener('input', (e) => {
            let value = parseInt(e.target.value) || 0;
            value = Math.max(0, Math.min(100, value));
            e.target.value = value;
            characterData.moral.current = value;
            updateStatBars();
            autoSave();
        });

        // ===== CALCULATIONS =====
        function updateAllCalculations() {
            updateAttributePoints();
            updateAttributeRings();
            updateResonanz();
            updateStatBars();
            updateSkillBonuses();
            updateFokusDice();
        }
        
        function updateAttributePoints() {
            let total = 0;
            ATTRIBUTES.forEach(attr => {
                total += characterData.attributes[attr] || 0;
            });
            const remaining = ATTR_TOTAL - total;
            document.getElementById('attr-points').textContent = `${remaining} / ${ATTR_TOTAL}`;
            document.getElementById('attr-points').style.color = remaining < 0 ? 'var(--accent-red)' : 'var(--accent-gold)';
        }
        
        function updateAttributeRings() {
            ATTRIBUTES.forEach(attr => {
                const value = characterData.attributes[attr] || 0;
                const ring = document.getElementById(`ring-${attr}`);
                if (ring) {
                    ring.style.setProperty('--fill', value);
                }
            });
        }
        
        function updateResonanz() {
            const krf = characterData.attributes.power || 0;
            const pra = characterData.attributes.presence || 0;
            const resonanz = 10 + (krf * pra);
            document.getElementById('resonanz-display').textContent = resonanz;
            document.getElementById('resonanz-bar').style.width = `${Math.min(resonanz, 100)}%`;
        }
        
        function updateStatBars() {
            const healthPercent = (characterData.health.current / 100) * 100;
            const moralPercent = (characterData.moral.current / 100) * 100;
            document.getElementById('health-bar').style.width = `${healthPercent}%`;
            document.getElementById('moral-bar').style.width = `${moralPercent}%`;
        }
        
        function calculateClassBonus(category) {
            const attrs = CLASS_ATTRIBUTE_MAP[category] || [];
            return attrs.reduce((sum, attr) => sum + (characterData.attributes[attr] || 0), 0);
        }
        
        function updateSkillBonuses() {
            let totalSpent = 0;
            
            ['handeln', 'wissen', 'soziales'].forEach(category => {
                const skills = characterData.skills[category] || [];
                const categorySpent = skills.reduce((sum, s) => sum + (parseInt(s.value) || 0), 0);
                totalSpent += categorySpent;
                
                const classBase = Math.floor(categorySpent / 10);
                const classBonus = calculateClassBonus(category);
                const classTotal = Math.min(classBase + classBonus, 95);
                
                document.getElementById(`${category}-total`).textContent = classTotal;
                document.getElementById(`${category}-bonus`).textContent = `+${classBonus}`;
                
                document.querySelectorAll(`#skills-${category} .skill-bonus`).forEach(el => {
                    el.textContent = `+${classBonus}`;
                });
            });
            
            document.getElementById('skills-points').textContent = `${totalSpent} / ${SKILL_TOTAL}`;
            document.getElementById('skills-points').style.color = totalSpent > SKILL_TOTAL ? 'var(--accent-red)' : 'var(--text-muted)';
        }

        // ===== SKILLS =====
        function initializeSkills() {
            ['handeln', 'wissen', 'soziales'].forEach(category => {
                renderSkills(category);
            });
        }
        
        function renderSkills(category) {
            const container = document.getElementById(`skills-${category}`);
            const skills = characterData.skills[category] || [];
            const bonus = calculateClassBonus(category);
            
            container.innerHTML = skills.map((skill, index) => `
                <div class="skill-row">
                    <div class="skill-prof ${skill.proficient ? 'active' : ''}" onclick="toggleSkillProf('${category}', ${index})"></div>
                    <input type="text" class="skill-name-input" value="${skill.name}" 
                           placeholder="Fähigkeit..." 
                           onchange="updateSkillName('${category}', ${index}, this.value)">
                    <input type="number" class="skill-value-input" value="${skill.value}" min="0" max="100"
                           onchange="updateSkillValue('${category}', ${index}, this.value)">
                    <span class="skill-bonus">+${bonus}</span>
                </div>
            `).join('');
        }
        
        function toggleSkillProf(category, index) {
            characterData.skills[category][index].proficient = !characterData.skills[category][index].proficient;
            renderSkills(category);
            autoSave();
        }
        
        function addSkill(category) {
            characterData.skills[category].push({ name: '', value: 0, proficient: false });
            renderSkills(category);
            autoSave();
        }
        
        function updateSkillName(category, index, value) {
            characterData.skills[category][index].name = value;
            autoSave();
        }
        
        function updateSkillValue(category, index, value) {
            characterData.skills[category][index].value = parseInt(value) || 0;
            updateSkillBonuses();
            autoSave();
        }
        
        function switchSkillTab(category) {
            document.querySelectorAll('.skill-category-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.skill-panel').forEach(p => p.classList.remove('active'));
            
            document.querySelector(`.skill-category-tab[data-category="${category}"]`).classList.add('active');
            document.getElementById(`panel-${category}`).classList.add('active');
        }

        // ===== FOKUS =====
        function updateFokusDisplay() {
            const fokusType = characterData.fokus?.type;
            const iconEl = document.getElementById('fokus-icon');
            const nameEl = document.getElementById('fokus-name');
            const attrEl = document.getElementById('fokus-attr');
            const diceInline = document.getElementById('fokus-dice-inline');
            const abilitiesGrid = document.getElementById('fokus-abilities-grid');
            
            if (fokusType && fokusType !== 'none' && FOKUS_DATA[fokusType]) {
                const data = FOKUS_DATA[fokusType];
                iconEl.innerHTML = `<img src="assets/icons/${data.icon}" alt="${data.name}">`;
                nameEl.textContent = data.name;
                attrEl.textContent = `Basiert auf ${data.attr}`;
                diceInline.style.display = 'inline-flex';
                updateFokusDice();
                
                // Show abilities with descriptions
                const abilities = characterData.fokus.abilities || [];
                const allAbilities = [...data.attacks, ...data.defenses];
                
                if (abilities.length > 0) {
                    abilitiesGrid.innerHTML = abilities.map(abilityName => {
                        const abilityData = allAbilities.find(a => a.name === abilityName);
                        const isAttack = data.attacks.some(a => a.name === abilityName);
                        return `
                            <div class="fokus-ability-card" onclick="openFokusPopup()">
                                <div class="fokus-ability-type">${isAttack ? '⚔️ Angriff' : '🛡️ Verteidigung'}</div>
                                <div class="fokus-ability-name">${abilityName}</div>
                                <div class="fokus-ability-desc">${abilityData?.desc || ''}</div>
                            </div>
                        `;
                    }).join('');
                    
                    // Fill remaining slots
                    if (abilities.length < 2) {
                        abilitiesGrid.innerHTML += `
                            <div class="fokus-ability-card empty" onclick="openFokusPopup()">
                                <span>Weitere Fähigkeit wählen...</span>
                            </div>
                        `;
                    }
                } else {
                    abilitiesGrid.innerHTML = `
                        <div class="fokus-ability-card empty" onclick="openFokusPopup()">
                            <span>Fähigkeit 1 wählen...</span>
                        </div>
                        <div class="fokus-ability-card empty" onclick="openFokusPopup()">
                            <span>Fähigkeit 2 wählen...</span>
                        </div>
                    `;
                }
            } else if (fokusType === 'none') {
                iconEl.innerHTML = `<img src="assets/icons/icon_nofocus.png" alt="Ohne Fokus" style="opacity: 0.5;">`;
                nameEl.textContent = 'Ohne Fokus';
                attrEl.textContent = 'Keine magischen Fähigkeiten';
                diceInline.style.display = 'none';
                abilitiesGrid.innerHTML = '';
                document.getElementById('fokus-abilities-section').style.display = 'none';
            } else {
                iconEl.innerHTML = '<span style="color: var(--text-muted); font-size: 32px;">?</span>';
                nameEl.textContent = 'Kein Fokus gewählt';
                attrEl.textContent = 'Klicke um einen Fokus zu wählen';
                diceInline.style.display = 'none';
                abilitiesGrid.innerHTML = `
                    <div class="fokus-ability-card empty" onclick="openFokusPopup()">
                        <span>Fähigkeit 1 wählen...</span>
                    </div>
                    <div class="fokus-ability-card empty" onclick="openFokusPopup()">
                        <span>Fähigkeit 2 wählen...</span>
                    </div>
                `;
            }
            
            // Show/hide abilities section
            if (fokusType !== 'none') {
                document.getElementById('fokus-abilities-section').style.display = 'block';
            }
        }
        
        function updateFokusDice() {
            const fokusType = characterData.fokus?.type;
            if (!fokusType || fokusType === 'none') return;
            
            const attr = FOKUS_ATTRIBUTE_MAP[fokusType];
            const attrValue = characterData.attributes[attr] || 0;
            document.getElementById('fokus-formula').textContent = `W20 + ${attrValue}`;
        }
        
        function openFokusPopup() {
            selectedFokusType = characterData.fokus?.type || null;
            selectedFokusAbilities = [...(characterData.fokus?.abilities || [])];
            
            renderFokusTypeGrid();
            renderFokusAbilities();
            updateFokusPopupInfo();
            
            document.getElementById('fokus-popup').classList.add('active');
        }
        
        function closeFokusPopup() {
            document.getElementById('fokus-popup').classList.remove('active');
        }
        
        function renderFokusTypeGrid() {
            const container = document.getElementById('fokus-type-grid');
            container.innerHTML = Object.entries(FOKUS_DATA).map(([key, data]) => `
                <button class="fokus-type-btn ${selectedFokusType === key ? 'active' : ''}" 
                        onclick="selectFokusType('${key}')">
                    <img src="assets/icons/${data.icon}" alt="${data.name}">
                    <span>${data.name}</span>
                </button>
            `).join('');
        }
        
        function selectFokusType(type) {
            if (selectedFokusType !== type) {
                selectedFokusType = type;
                selectedFokusAbilities = [];
            }
            renderFokusTypeGrid();
            renderFokusAbilities();
            updateFokusPopupInfo();
        }
        
        function renderFokusAbilities() {
            const container = document.getElementById('fokus-abilities-container');
            
            if (!selectedFokusType || selectedFokusType === 'none') {
                container.innerHTML = selectedFokusType === 'none' 
                    ? '<p style="color: var(--text-muted); text-align: center; padding: 20px;">Du hast dich entschieden, keinen Fokus zu verwenden.</p>'
                    : '';
                return;
            }
            
            const data = FOKUS_DATA[selectedFokusType];
            const maxAbilities = 2;
            
            container.innerHTML = `
                <div class="fokus-section-title">⚔️ Angriffe</div>
                <div class="fokus-ability-grid">
                    ${data.attacks.map(ability => {
                        const isSelected = selectedFokusAbilities.includes(ability.name);
                        const isDisabled = !isSelected && selectedFokusAbilities.length >= maxAbilities;
                        return `
                            <div class="fokus-ability-option ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}"
                                 onclick="toggleFokusAbility('${ability.name}', ${isDisabled})">
                                <div class="fokus-ability-option-name">${ability.name}</div>
                                <div class="fokus-ability-option-desc">${ability.desc}</div>
                            </div>
                        `;
                    }).join('')}
                </div>
                
                <div class="fokus-section-title">🛡️ Verteidigung</div>
                <div class="fokus-ability-grid">
                    ${data.defenses.map(ability => {
                        const isSelected = selectedFokusAbilities.includes(ability.name);
                        const isDisabled = !isSelected && selectedFokusAbilities.length >= maxAbilities;
                        return `
                            <div class="fokus-ability-option ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}"
                                 onclick="toggleFokusAbility('${ability.name}', ${isDisabled})">
                                <div class="fokus-ability-option-name">${ability.name}</div>
                                <div class="fokus-ability-option-desc">${ability.desc}</div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }
        
        function toggleFokusAbility(name, isDisabled) {
            if (isDisabled) return;
            
            const index = selectedFokusAbilities.indexOf(name);
            if (index > -1) {
                selectedFokusAbilities.splice(index, 1);
            } else if (selectedFokusAbilities.length < 2) {
                selectedFokusAbilities.push(name);
            }
            
            renderFokusAbilities();
            updateFokusPopupInfo();
        }
        
        function updateFokusPopupInfo() {
            const info = document.getElementById('fokus-selection-info');
            const btn = document.getElementById('fokus-confirm-btn');
            
            if (!selectedFokusType) {
                info.textContent = 'Wähle einen Fokus-Typ';
                btn.disabled = true;
            } else if (selectedFokusType === 'none') {
                info.textContent = 'Ohne Fokus spielen';
                btn.disabled = false;
            } else {
                info.textContent = `${selectedFokusAbilities.length} / 2 Fähigkeiten gewählt`;
                btn.disabled = selectedFokusAbilities.length === 0;
            }
        }
        
        function confirmFokusSelection() {
            characterData.fokus = {
                type: selectedFokusType,
                abilities: selectedFokusType === 'none' ? [] : selectedFokusAbilities
            };
            
            updateFokusDisplay();
            closeFokusPopup();
            autoSave();
        }

        // ===== SECOND CHANCE =====
        function toggleDice(index) {
            characterData.secondChance[index] = !characterData.secondChance[index];
            document.getElementById(`dice-${index+1}`).classList.toggle('used');
            autoSave();
        }

        // ===== CURRENCY =====
        function rotateCurrency() {
            currencyIndex = (currencyIndex + 1) % CURRENCY_TYPES.length;
            characterData.currencyType = CURRENCY_TYPES[currencyIndex];
            document.getElementById('currency-icon').src = `assets/icons/icon_${CURRENCY_TYPES[currencyIndex]}.png`;
            autoSave();
        }

        // ===== FILE UPLOADS =====
        function uploadPortrait(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                characterData.portrait = e.target.result;
                document.getElementById('portrait-img').src = e.target.result;
                document.getElementById('portrait-img').style.display = 'block';
                document.getElementById('portrait-placeholder').style.display = 'none';
                autoSave();
            };
            reader.readAsDataURL(file);
        }
        
        function uploadJolly(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                characterData.jollyRoger = e.target.result;
                document.getElementById('crew-icon-img').src = e.target.result;
                autoSave();
            };
            reader.readAsDataURL(file);
        }

        // ===== EXPORT / IMPORT / RESET =====
        function exportCharacter() {
            const dataStr = JSON.stringify(characterData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `${characterData.name || 'charakter'}_worldsapart.json`;
            a.click();
            
            URL.revokeObjectURL(url);
        }
        
        function importCharacter(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);
                    characterData = { ...getDefaultCharacter(), ...imported };
                    saveCharacter();
                    populateFields();
                    initializeSkills();
                    updateAllCalculations();
                    showSaveIndicator();
                } catch(err) {
                    alert('Fehler beim Import: Ungültiges Dateiformat');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }
        
        function resetCharacter() {
            if (confirm('Charakter wirklich zurücksetzen? Alle Daten gehen verloren!')) {
                localStorage.removeItem(STORAGE_KEY);
                characterData = getDefaultCharacter();
                populateFields();
                initializeSkills();
                updateAllCalculations();
                
                document.getElementById('portrait-img').style.display = 'none';
                document.getElementById('portrait-placeholder').style.display = 'block';
                
                document.querySelectorAll('.dice-check').forEach(d => d.classList.remove('used'));
            }
        }
    </script>
<script src="assets/js/nav.js"></script>
</body>
</html>
