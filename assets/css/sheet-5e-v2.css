/**
 * RIFT — D&D 5e Character Sheet v2 Styles
 * Design System: Dark Royal Gold (v2 tokens)
 * Font Stack: Cinzel (display), Inter (body/shell)
 * 
 * Uses compatibility layer to map --md-* → v2 gold palette.
 * This allows the existing HTML to work without changes.
 */

/* ═══════════════════════════════════════════
   V2 DESIGN TOKEN COMPATIBILITY LAYER
   Maps Material Design variables → RIFT v2 Gold palette
   ═══════════════════════════════════════════ */

:root {
    /* --- v2 Core Tokens --- */
    --bg-dark:          #161616;
    --bg-panel:         #1c1c1c;
    --bg-card:          #1e1e1e;
    --bg-slot:          #262626;
    --bg-slot-hover:    #303030;
    --bg-input:         #262626;
    --border:           rgba(255, 255, 255, 0.08);
    --border-light:     rgba(255, 255, 255, 0.14);
    --border-card:      rgba(255, 255, 255, 0.06);
    --text:             #dedede;
    --text-dim:         #888888;
    --text-bright:      #f0f0f0;
    --gold:             #d4a844;
    --gold-dim:         #8a6e2e;
    --gold-glow:        rgba(212, 168, 68, 0.3);
    --gold-subtle:      rgba(212, 168, 68, 0.04);
    --gold-hover:       rgba(212, 168, 68, 0.08);
    --hp-green:         #27ae60;
    --rage-red:         #c0392b;
    --xp-blue:          #2980b9;
    --mana-purple:      #8e44ad;
    --shadow-sm:        0 2px 8px rgba(0, 0, 0, 0.3);
    --shadow-md:        0 4px 16px rgba(0, 0, 0, 0.4);
    --shadow-lg:        0 8px 32px rgba(0, 0, 0, 0.5);

    /* --- Material Design → v2 Gold Mapping --- */
    --md-primary:                   #d4a844;
    --md-primary-rgb:               212, 168, 68;
    --md-on-primary:                #1a1610;
    --md-primary-container:         rgba(212, 168, 68, 0.15);
    --md-on-primary-container:      #d4a844;
    --md-secondary-container:       rgba(212, 168, 68, 0.10);
    --md-on-secondary-container:    #c8a84a;
    --md-tertiary:                  #8a6e2e;
    --md-on-tertiary:               #fff;
    --md-tertiary-container:        rgba(138, 110, 46, 0.15);
    --md-on-tertiary-container:     #c8a84a;
    --md-surface-container:         #1e1e1e;
    --md-surface-container-high:    #262626;
    --md-surface-container-highest: #333333;
    --md-on-surface:                #dedede;
    --md-on-surface-variant:        #888888;
    --md-outline:                   rgba(255, 255, 255, 0.14);
    --md-outline-variant:           rgba(255, 255, 255, 0.08);
    --md-error:                     #c0392b;
    --md-on-error:                  #fff;
    --md-error-container:           rgba(192, 57, 43, 0.15);
    --md-on-error-container:        #e74c3c;
    --bg:                           #161616;
    --md-on-background:             #dedede;
}

/* --- AC Shield rotating border animation --- */
@property --angle {
    syntax: '<angle>';
    initial-value: 0deg;
    inherits: false;
}

@keyframes rotate-border {
    to { --angle: 360deg; }
}

/* ═══════════════════════════════════════════
   BASE SHEET STYLES (extracted from inline)
   ═══════════════════════════════════════════ */

.text-area,
.field-input,
.phys-input {
    transition: box-shadow 0.3s ease;
}

.text-area:hover,
.field-input:hover,
.phys-input:hover {
    box-shadow: 0 0 0 2px rgba(255,255,255,0.12);
}

/* AC-Shield uses ::after because ::before is used for the inner static border */
.ac-shield::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 12px 12px 50% 50% / 12px 12px 30% 30%;
    padding: 2px;
    background: conic-gradient(
        from var(--angle),
        transparent 40%,
        rgba(212, 168, 68, 0.06) 55%,
        rgba(212, 168, 68, 0.18) 65%,
        rgba(212, 168, 68, 0.06) 75%,
        transparent 90%
    );
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    z-index: 0;
}

.ac-shield:hover::after {
    opacity: 1;
    animation: rotate-border 4s linear infinite;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg, #161616);
    color: var(--md-on-background, #dedede);
    min-height: 100vh;
    line-height: 1.4;
}

/* Fix: Keine Sidebar bei unified layout */
.main {
    margin-left: 0 !important;
}

/* Fix: Rote Linie oben entfernen */
html, body {
    border: none !important;
}
.topnav, #topnav-placeholder {
    border-top: none !important;
}

.sheet {
    max-width: 1400px;
    margin: 0 auto;
    padding: 24px;
    padding-bottom: 40px;
}

@media (max-width: 600px) {
    .sheet {
        padding: 16px;
        padding-bottom: 40px;
    }
}

/* ===== SECTION STYLING (1:1 wie Worlds Apart) ===== */
.section {
    background: #111;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.06);
    margin-bottom: 24px;
    overflow: hidden;
}

.section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    background: #0a0a0a;
    cursor: pointer;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
}

.section-title {
    font-family: 'Cinzel', serif;
    font-size: 16px;
    font-weight: 700;
    
    text-transform: uppercase;
    letter-spacing: 1px;
    color: rgba(255, 255, 255, 0.5);
    display: flex;
    align-items: center;
    gap: 8px;
}

.section-title svg {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
    fill: currentColor;
    opacity: 0.5;
}

.section-toggle {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(255, 255, 255, 0.4);
    transition: transform 0.2s;
}

.section.collapsed .section-toggle {
    transform: rotate(-90deg);
}

.section-content {
    padding: 16px;
}

@media (max-width: 600px) {
    .section-content {
        padding: 16px;
    }
}

.section.collapsed .section-content {
    display: none;
}

/* ===== HEADER SECTION ===== */
.header-section {
    background: #111;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.06);
    padding: 16px;
    margin-bottom: 24px;
}

/* Desktop Layout */
.header-layout {
    display: flex;
    gap: 20px;
    align-items: flex-start;
}

.header-right {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 12px;
}


.portrait-box {
    width: 120px;
    height: 205px;
    min-width: 120px;
    flex-shrink: 0;
    border-radius: 12px;
    background: var(--md-surface-container-high);
    overflow: hidden;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.portrait-box:hover .portrait-overlay {
    opacity: 1;
}

.portrait-box svg {
    width: 48px;
    height: 48px;
    color: var(--md-on-surface-variant);
    opacity: 0.3;
}

.portrait-box img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.portrait-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    opacity: 0;
    transition: opacity 0.2s;
}

.portrait-overlay-btn {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s;
}

.portrait-overlay-btn:hover {
    transform: scale(1.1);
}

.portrait-overlay-btn img {
    width: 16px;
    height: 16px;
    object-fit: contain;
}

.portrait-overlay-btn.change {
    background: var(--md-primary);
}

.portrait-overlay-btn.delete {
    background: var(--md-error);
}

.portrait-overlay-btn.gallery {
    background: #444;
}

.portrait-overlay-btn.gallery:hover {
    background: #555;
}

/* Portrait Gallery Modal */
.portrait-gallery-modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
}

.portrait-gallery-modal.active {
    opacity: 1;
    pointer-events: auto;
}

.portrait-gallery-content {
    background: #1a1a1a;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.1);
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.portrait-gallery-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid rgba(255,255,255,0.08);
}

.portrait-gallery-title {
    font-size: 18px;
    font-weight: 600;
    color: #fff;
}

.portrait-gallery-close {
    width: 32px;
    height: 32px;
    border: none;
    background: rgba(255,255,255,0.1);
    border-radius: 8px;
    color: #888;
    cursor: pointer;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.portrait-gallery-close:hover {
    background: rgba(255,255,255,0.15);
    color: #fff;
}

.portrait-gallery-body {
    padding: 20px;
    overflow-y: auto;
}

.portrait-gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
    gap: 12px;
}

.portrait-gallery-item {
    aspect-ratio: 1;
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
    border: 2px solid transparent;
    transition: all 0.2s;
}

.portrait-gallery-item:hover {
    border-color: var(--md-primary, var(--md-primary));
    transform: scale(1.05);
}

.portrait-gallery-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.header-info {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.char-name-input {
    width: 100%;
    font-size: 28px;
    font-weight: 700;
    background: transparent;
    border: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--md-on-surface);
    padding: 0 0 8px 0;
}

.char-name-input:focus {
    outline: none;
}

.char-name-input::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.3;
}

.header-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.header-stats {
    display: flex;
    gap: 8px;
    flex-wrap: nowrap;
}

.header-stats .stat-box {
    width: 140px;
    height: 95px;
    min-width: 100px;
    flex: 1 1 140px;
}

.meta-chip {
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--md-surface-container-high);
    padding: 10px 16px;
    border-radius: 100px;
    font-size: 13px;
    min-height: 40px;
}

.meta-chip label {
    font-size: 10px;
    text-transform: uppercase;
    color: var(--md-primary);
    font-weight: 600;
    white-space: nowrap;
}

.meta-chip input {
    background: transparent;
    border: none;
    color: var(--md-on-surface);
    font-size: 13px;
    font-weight: 500;
    width: 90px;
    padding: 0;
    min-height: 24px;
}

.meta-chip input::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.3;
}

.meta-chip input:focus {
    outline: none;
}

.meta-chip input[type="number"] {
    width: 45px;
    text-align: center;
}

.meta-chip select {
    background: transparent;
    border: none;
    color: var(--md-on-surface);
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    padding: 0;
    min-height: 24px;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
}

.meta-chip select:focus {
    outline: none;
}

.meta-chip select option {
    background: var(--md-surface-container);
    color: var(--md-on-surface);
}

.meta-chip .custom-input {
    width: 80px;
    margin-left: 6px;
    padding-left: 6px;
    border-left: 1px solid var(--md-outline-variant);
}

@media (max-width: 600px) {
    .header-meta {
        gap: 6px;
    }
    .meta-chip {
        padding: 8px 12px;
        font-size: 12px;
        min-height: 36px;
    }
    .meta-chip label {
        font-size: 9px;
    }
    .meta-chip input,
    .meta-chip select {
        font-size: 12px;
        width: 70px;
    }
    .meta-chip input[type="number"] {
        width: 40px;
    }
}

.subclass-chip {
    transition: opacity 0.2s, transform 0.2s;
}

.subclass-chip select {
    min-width: 100px;
}

@media (max-width: 800px) {
    .header-layout {
        gap: 16px;
    }
    
    .portrait-box {
        width: 140px;
        height: 140px;
    }
    
    .header-stats {
        flex-wrap: wrap;
    }
    
    .header-stats .stat-box {
        min-width: 90px;
    }
}

@media (max-width: 550px) {
    /* Hauptcontainer: column statt row */
    .header-layout {
        flex-direction: column;
        align-items: center;
    }
    
    /* Portrait: zentriert, quadratisch */
    .portrait-box {
        width: 140px !important;
        height: 140px !important;
        margin-bottom: 8px;
    }
    
    /* Rechte Spalte: volle Breite, zentriert */
    .header-right {
        width: 100%;
        align-items: center;
    }
    
    /* Charaktername: zentriert, größer */
    .char-name-input {
        text-align: center;
        font-size: 24px !important;
    }
    
    /* Meta Chips: 2-Spalten Grid */
    .header-meta {
        display: grid !important;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        width: 100%;
    }
    
    /* Alle Meta-Chips: Box-Style */
    .header-meta .meta-chip {
        width: 100%;
        border-radius: 12px;
        padding: 12px 14px;
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
        box-sizing: border-box;
    }
    
    .header-meta .meta-chip label {
        font-size: 10px;
    }
    
    .header-meta .meta-chip input,
    .header-meta .meta-chip select {
        width: 100%;
        font-size: 14px;
    }
    
    /* Reihenfolge: Species/Class, Background/Subclass, Level/XP */
    .header-meta .meta-chip:nth-child(1) { order: 1; } /* Species */
    .header-meta .meta-chip:nth-child(2) { order: 2; } /* Class */
    .header-meta .meta-chip:nth-child(3) { order: 5; } /* Level */
    .header-meta .meta-chip:nth-child(4) { order: 6; } /* XP */
    .header-meta .meta-chip:nth-child(5) { order: 3; } /* Background */
    .header-meta .meta-chip:nth-child(6) { order: 4; } /* Subclass */
    
    /* Level und XP: kompakte Pill-Form */
    .header-meta .meta-chip:nth-child(3),
    .header-meta .meta-chip:nth-child(4) {
        flex-direction: row;
        align-items: center;
        padding: 10px 16px;
        border-radius: 100px;
        gap: 8px;
        width: auto;
    }
    
    .header-meta .meta-chip:nth-child(3) input,
    .header-meta .meta-chip:nth-child(4) input {
        width: 40px;
        text-align: center;
    }
    
    /* Stats: 2-Spalten Grid */
    .header-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        width: 100%;
    }
    
    .header-stats .stat-box {
        min-width: unset;
        flex: unset;
    }
}

.stat-box {
    background: var(--md-surface-container-high);
    border-radius: 12px;
    padding: 12px 10px;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}

.stat-label {
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    color: var(--md-on-surface-variant);
    font-weight: 600;
}

.stat-value {
    font-size: 18px;
    font-weight: 700;
    background: var(--md-surface-container);
    border: none;
    border-radius: 8px;
    color: var(--md-on-surface);
    width: 100%;
    max-width: 80px;
    text-align: center;
    padding: 8px 4px;
}

.stat-value.stat-computed {
    background: transparent;
    display: block;
    margin: 0 auto;
}

.stat-value:focus {
    outline: 2px solid var(--md-primary);
}

.stat-value::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.3;
}

.stat-hint {
    font-size: 8px;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    color: var(--md-primary);
    opacity: 0.7;
    margin-top: 2px;
}

.heroic-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 3px solid var(--md-outline-variant);
    background: transparent;
    cursor: pointer;
    margin: 8px auto 0 auto;
    transition: all 0.2s;
}

.heroic-btn:hover,
.heroic-btn:active {
    border-color: var(--md-primary);
    transform: scale(1.1);
}

.heroic-btn.active {
    background: var(--md-primary);
    border-color: var(--md-primary);
    animation: heroic-pulse 3s ease-in-out infinite;
}

/* ===== ABILITIES GRID ===== */
.abilities-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
    grid-template-rows: auto auto;
    gap: 12px;
}

.ability-card {
    background: var(--md-surface-container-high);
    border-radius: 12px;
    padding: 12px;
}

/* STR in erste Spalte, erste Reihe */
.ability-card[data-ability="str"] {
    grid-column: 1;
    grid-row: 1;
}

/* CON in erste Spalte, zweite Reihe */
.ability-card[data-ability="con"] {
    grid-column: 1;
    grid-row: 2;
}

/* WIS, CHA, INT, DEX in Spalten 2-5, spannen beide Reihen */
.ability-card[data-ability="wis"] {
    grid-column: 2;
    grid-row: 1 / 3;
}
.ability-card[data-ability="cha"] {
    grid-column: 3;
    grid-row: 1 / 3;
}
.ability-card[data-ability="int"] {
    grid-column: 4;
    grid-row: 1 / 3;
}
.ability-card[data-ability="dex"] {
    grid-column: 5;
    grid-row: 1 / 3;
}

@media (max-width: 1100px) {
    .abilities-grid {
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: auto;
    }
    .ability-card[data-ability="str"],
    .ability-card[data-ability="con"],
    .ability-card[data-ability="wis"],
    .ability-card[data-ability="cha"],
    .ability-card[data-ability="int"],
    .ability-card[data-ability="dex"] {
        grid-column: auto;
        grid-row: auto;
    }
}

@media (max-width: 700px) {
    .abilities-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 480px) {
    .abilities-grid {
        grid-template-columns: 1fr;
    }
}

.ability-top {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--md-outline-variant);
}

.ability-name {
    font-size: 10px;
    font-weight: 600;
    color: var(--md-on-surface-variant);
    text-transform: uppercase;
    margin-bottom: 8px;
    text-align: center;
}

.ability-mod-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
}

.ability-mod {
    width: 56px;
    height: 56px;
    background: var(--md-primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2;
    flex-shrink: 0;
    position: relative;
}

.ability-mod-value {
    font-size: 24px;
    font-weight: 700;
    color: var(--md-on-primary);
    text-align: center;
}

.ability-score-box {
    background: var(--md-surface-container);
    border-radius: 0 8px 8px 0;
    padding: 6px 10px 6px 22px;
    margin-left: -16px;
    display: flex;
    align-items: center;
    gap: 6px;
    z-index: 1;
}

.ability-score-input {
    font-size: 14px;
    font-weight: 600;
    background: var(--md-surface-container-high);
    border: none;
    border-radius: 4px;
    color: var(--md-on-surface);
    width: 32px;
    text-align: center;
    padding: 4px 2px;
    cursor: text;
}

.ability-score-input:focus {
    outline: 2px solid var(--md-primary);
}

.ability-score-input::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.4;
}

.ability-score-label {
    font-size: 7px;
    color: var(--md-on-surface-variant);
    text-transform: uppercase;
    opacity: 0.7;
}

.save-row {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px;
    margin: 0 -12px 8px -12px;
    min-height: 36px;
    background: rgba(0, 0, 0, 0.1);
    border-radius: 0;
}

.prof-check {
    width: 18px;
    height: 18px;
    cursor: pointer;
    appearance: none;
    -webkit-appearance: none;
    background: var(--md-surface-container);
    border: 2px solid var(--md-outline-variant);
    border-radius: 4px;
    flex-shrink: 0;
}

.prof-check:checked {
    background: var(--md-primary);
    border-color: var(--md-primary);
}

.prof-check:checked::after {
    content: '✓';
    color: var(--md-on-primary);
    font-size: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.prof-check:hover {
    border-color: var(--md-primary);
}

.save-val {
    font-size: 13px;
    font-weight: 600;
    width: 36px;
    text-align: center;
    background: var(--md-surface-container);
    border: none;
    border-radius: 6px;
    color: var(--md-on-surface);
    min-height: 26px;
    padding: 4px 2px;
}

.save-val.save-computed {
    background: transparent;
    display: inline-block;
    line-height: 26px;
}

.save-val:focus {
    outline: 2px solid var(--md-primary);
}

.save-val::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.3;
}

.save-label {
    font-size: 11px;
    color: var(--md-on-surface-variant);
    white-space: nowrap;
}

.skills-list {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.skill-item {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 4px 0;
    min-height: 32px;
}

.skill-item input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
    appearance: none;
    -webkit-appearance: none;
    background: var(--md-surface-container);
    border: 2px solid var(--md-outline-variant);
    border-radius: 4px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 9px;
    font-weight: 700;
    color: var(--md-on-surface-variant);
    opacity: 0.4;
}

/* Proficiency Checkbox - shows P */
.skill-item input[type="checkbox"].prof-check-skill::after {
    content: 'P';
}

.skill-item input[type="checkbox"].prof-check-skill:checked {
    background: var(--md-primary);
    border-color: var(--md-primary);
    color: var(--md-on-primary);
    opacity: 0.7;
}

.skill-item input[type="checkbox"]:hover {
    border-color: var(--md-primary);
    opacity: 0.6;
}

/* Expertise Checkbox - shows E, also purple */
.skill-item .expertise-check {
    margin-left: -2px;
}

.skill-item .expertise-check::after {
    content: 'E';
}

.skill-item .expertise-check:checked {
    background: var(--md-primary);
    border-color: var(--md-primary);
    color: var(--md-on-primary);
    opacity: 1;
}

.skill-item .expertise-check:disabled {
    opacity: 0.2;
    cursor: not-allowed;
}

.skill-item .expertise-check:disabled:hover {
    border-color: var(--md-outline-variant);
    opacity: 0.2;
}

.skill-val {
    font-size: 12px;
    font-weight: 600;
    width: 32px;
    text-align: center;
    background: var(--md-surface-container);
    border: none;
    border-radius: 6px;
    color: var(--md-on-surface);
    min-height: 22px;
    padding: 3px 2px;
}

.skill-val.skill-computed {
    background: transparent;
    display: inline-block;
    line-height: 22px;
}

.skill-val:focus {
    outline: 2px solid var(--md-primary);
}

.skill-val::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.3;
}

.skill-name {
    font-size: 11px;
    color: var(--md-on-surface-variant);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* ===== COMBAT SECTION ===== */
.armor-hp-layout {
    display: grid;
    grid-template-columns: 140px 1fr 1fr 1fr;
    grid-template-rows: 1fr 1fr;
    gap: 12px;
}

/* Shield Shape for AC - spans 2 rows */
.ac-shield {
    grid-row: 1 / 3;
    position: relative;
    background: var(--md-surface-container-high);
    border-radius: 12px 12px 50% 50% / 12px 12px 30% 30%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 16px 12px 28px;
}

.ac-shield::before {
    content: '';
    position: absolute;
    inset: 4px;
    border-radius: 10px 10px 50% 50% / 10px 10px 28% 28%;
    border: 2px solid var(--md-outline-variant);
    pointer-events: none;
}

.ac-shield-label {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    color: var(--md-on-surface-variant);
    letter-spacing: 1px;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
}

.ac-shield-value {
    font-size: 48px;
    font-weight: 700;
    background: transparent;
    border: none;
    width: 90px;
    text-align: center;
    color: var(--md-on-surface);
    line-height: 1;
}

.ac-shield-value:focus {
    outline: none;
}

.ac-shield-value::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.4;
}

.ac-shield-sub {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-top: 12px;
    background: var(--md-surface-container);
    padding: 4px 10px;
    border-radius: 20px;
}

.ac-shield-sub-label {
    font-size: 9px;
    text-transform: uppercase;
    color: var(--md-on-surface-variant);
    font-weight: 600;
}

.ac-shield-sub-input {
    font-size: 16px;
    font-weight: 700;
    background: transparent;
    border: none;
    width: 32px;
    text-align: center;
    color: var(--md-on-surface);
}

.ac-shield-sub-input:focus {
    outline: none;
}

/* Armor Stat Boxes - fill the grid */
.armor-stat-box {
    background: var(--md-surface-container-high);
    border-radius: 12px;
    padding: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.armor-stat-label {
    font-size: 9px;
    font-weight: 600;
    text-transform: uppercase;
    color: var(--md-on-surface-variant);
    margin-bottom: 8px;
    letter-spacing: 0.5px;
}

.armor-stat-value {
    font-size: 28px;
    font-weight: 700;
    background: var(--md-surface-container);
    border: none;
    border-radius: 8px;
    width: 100%;
    max-width: 100px;
    text-align: center;
    padding: 8px;
    color: var(--md-on-surface);
}

.armor-stat-value:focus {
    outline: 2px solid var(--md-primary);
}

.armor-stat-value::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.3;
}

.armor-stat-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.armor-stat-input {
    font-size: 20px;
    font-weight: 600;
    background: var(--md-surface-container);
    border: none;
    border-radius: 6px;
    width: 50px;
    text-align: center;
    padding: 8px;
    color: var(--md-on-surface);
}

.armor-stat-input:focus {
    outline: 2px solid var(--md-primary);
}

.armor-stat-slash {
    color: var(--md-on-surface-variant);
    font-size: 18px;
}

/* Death Saves */
.death-saves-box {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.death-row-box {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.death-row-box .death-label {
    font-size: 11px;
    font-weight: 600;
    color: var(--md-on-surface-variant);
    width: 14px;
}

/* Exhaustion */
.exhaustion-box {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.exhaustion-input-box {
    font-size: 20px;
    font-weight: 600;
    background: var(--md-surface-container);
    border: none;
    border-radius: 6px;
    width: 50px;
    text-align: center;
    padding: 8px;
    color: var(--md-on-surface);
}

.exhaustion-input-box:focus {
    outline: 2px solid var(--md-primary);
}

.exhaustion-penalty-box {
    font-size: 18px;
    font-weight: 700;
    color: var(--md-error);
}

.armor-stat-hint {
    font-size: 8px;
    color: var(--md-on-surface-variant);
    margin-top: 6px;
    text-transform: uppercase;
}

@media (max-width: 800px) {
    .armor-hp-layout {
        grid-template-columns: 120px 1fr 1fr;
        grid-template-rows: auto auto auto;
    }
    
    .ac-shield {
        grid-row: 1 / 3;
    }
}

@media (max-width: 550px) {
    .armor-hp-layout {
        grid-template-columns: 1fr 1fr;
        grid-template-rows: auto;
        gap: 10px;
    }
    
    .ac-shield {
        grid-column: 1 / 3;
        grid-row: auto;
        max-width: 140px;
        margin: 0 auto;
        padding: 12px 10px 20px;
    }
    
    .ac-shield-value {
        font-size: 36px;
    }
}

.defenses-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-top: 16px;
    width: 100%;
}

@media (max-width: 600px) {
    .defenses-row {
        grid-template-columns: 1fr;
    }
}

.defense-item {
    background: var(--md-surface-container-high);
    border-radius: 10px;
    padding: 12px;
}

.defense-item input {
    width: 100%;
    box-sizing: border-box;
    background: var(--md-surface-container);
    border: none;
    border-radius: 8px;
    padding: 10px 12px;
    font-size: 14px;
    color: var(--md-on-surface);
    margin-top: 6px;
}

.defense-item input:focus {
    outline: 2px solid var(--md-primary);
}

.defense-item input::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.3;
}

.defense-label {
    font-size: 10px;
    text-transform: uppercase;
    color: var(--md-on-surface-variant);
    font-weight: 600;
    margin-bottom: 6px;
}

.ac-block {
    background: var(--md-surface-container-high);
    border-radius: 12px;
    padding: 16px;
    text-align: center;
}

.ac-main {
    margin-bottom: 12px;
}

.ac-value {
    font-size: 36px;
    font-weight: 700;
    background: var(--md-surface-container);
    border: none;
    border-radius: 10px;
    color: var(--md-on-surface);
    width: 80px;
    text-align: center;
    padding: 8px;
}

.ac-value:focus {
    outline: 2px solid var(--md-primary);
}

.ac-value::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.3;
}

.ac-label {
    font-size: 10px;
    text-transform: uppercase;
    color: var(--md-on-surface-variant);
    font-weight: 600;
    margin-top: 8px;
}

.shield-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding-top: 12px;
}

.shield-input {
    width: 40px;
    font-size: 16px;
    font-weight: 600;
    text-align: center;
    background: var(--md-surface-container);
    border: none;
    border-radius: 6px;
    padding: 6px;
    color: var(--md-on-surface);
}

.shield-input:focus {
    outline: 2px solid var(--md-primary);
}

.hp-block {
    background: var(--md-surface-container-high);
    border-radius: 12px;
    padding: 16px;
}

.hp-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
}

.hp-item {
    text-align: center;
}

.hp-input {
    font-size: 24px;
    font-weight: 700;
    background: var(--md-surface-container);
    border: none;
    border-radius: 8px;
    width: 100%;
    text-align: center;
    padding: 10px;
    color: var(--md-on-surface);
}

.hp-input:focus {
    outline: 2px solid var(--md-primary);
}

.hp-input::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.3;
}

.hp-label {
    font-size: 10px;
    text-transform: uppercase;
    color: var(--md-on-surface-variant);
    font-weight: 600;
    margin-top: 6px;
}

.dice-death-block {
    background: var(--md-surface-container-high);
    border-radius: 12px;
    padding: 12px;
}

.dice-section {
    margin-bottom: 12px;
}

.mini-label {
    font-size: 11px;
    text-transform: uppercase;
    color: var(--md-on-surface-variant);
    font-weight: 600;
    margin-bottom: 8px;
}

.dice-inputs {
    display: flex;
    align-items: center;
    gap: 4px;
}

.dice-inputs span {
    color: var(--md-on-surface-variant);
    font-size: 14px;
}

.dice-input {
    width: 40px;
    height: 32px;
    background: var(--md-surface-container);
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    text-align: center;
    color: var(--md-on-surface);
}

.dice-input:focus {
    outline: 2px solid var(--md-primary);
}

.dice-input::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.3;
}

.death-section {
    padding-top: 14px;
    
}

.death-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
}

.death-label {
    font-size: 11px;
    color: var(--md-on-surface-variant);
}

.death-pips {
    display: flex;
    gap: 4px;
}

.death-pip {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 2px solid var(--md-outline-variant);
    background: transparent;
    cursor: pointer;
    transition: all 0.15s;
}

.death-pip:hover,
.death-pip:active {
    border-color: var(--md-primary);
    transform: scale(1.1);
}

.death-pip.success.active {
    background: #4caf50;
    border-color: #4caf50;
}

.death-pip.fail.active {
    background: #f44336;
    border-color: #f44336;
}

.exhaustion-section {
    padding-top: 14px;
    
    margin-top: 8px;
}

.exhaustion-row {
    display: flex;
    align-items: center;
    gap: 10px;
}

.exhaustion-input {
    width: 50px;
    height: 36px;
    background: var(--md-surface-container);
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 700;
    text-align: center;
    color: var(--md-on-surface);
}

.exhaustion-input:focus {
    outline: 2px solid var(--md-primary);
}

.exhaustion-penalty {
    font-size: 18px;
    font-weight: 700;
    color: var(--md-error);
    min-width: 40px;
}

.exhaustion-hint {
    font-size: 9px;
    color: var(--md-on-surface-variant);
    margin-top: 4px;
}

/* ===== WEAPONS TABLE ===== */
.weapons-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.weapon-row {
    display: grid;
    grid-template-columns: 2fr 80px 1fr 1fr 40px;
    gap: 10px;
    align-items: center;
}

@media (max-width: 600px) {
    .weapon-row {
        grid-template-columns: 1fr 1fr;
    }
    .weapon-row > *:nth-child(5) {
        grid-column: 2;
        justify-self: end;
    }
}

.weapon-input {
    background: var(--md-surface-container-high);
    border: none;
    border-radius: 8px;
    padding: 10px 12px;
    font-size: 13px;
    color: var(--md-on-surface);
}

.weapon-input:focus {
    outline: 2px solid var(--md-primary);
}

.weapon-delete {
    width: 44px;
    height: 44px;
    border-radius: 8px;
    background: transparent;
    border: none;
    color: var(--md-error);
    cursor: pointer;
    font-size: 20px;
    opacity: 0.3;
    display: flex;
    align-items: center;
    justify-content: center;
}

.weapon-delete:hover,
.weapon-delete:active {
    opacity: 1;
    background: var(--md-error-container);
}

/* ===== CLASS RESOURCES ===== */
.resources-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.resource-row {
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--md-surface-container-high);
    border-radius: 10px;
    padding: 10px 12px;
}

.resource-name {
    flex: 1;
    min-width: 100px;
    background: transparent;
    border: none;
    color: var(--md-on-surface);
    font-size: 14px;
    font-weight: 500;
}

.resource-name::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.3;
}

.resource-name:focus {
    outline: none;
}

.resource-tracker {
    display: flex;
    align-items: center;
    gap: 4px;
}

.resource-input {
    width: 40px;
    height: 32px;
    background: var(--md-surface-container);
    border: none;
    border-radius: 6px;
    text-align: center;
    font-size: 14px;
    font-weight: 600;
    color: var(--md-on-surface);
}

.resource-input:focus {
    outline: 2px solid var(--md-primary);
}

.resource-slash {
    color: var(--md-on-surface-variant);
    font-size: 14px;
}

.resource-delete {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: none;
    background: transparent;
    color: var(--md-error);
    cursor: pointer;
    opacity: 0.3;
    display: flex;
    align-items: center;
    justify-content: center;
}

.resource-delete:hover {
    opacity: 1;
    background: var(--md-error-container);
}

.add-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 10px 16px;
    min-height: 40px;
    background: var(--md-surface-container);
    border: 1px solid var(--md-outline-variant);
    border-radius: 8px;
    color: var(--md-on-surface-variant);
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    margin-top: 8px;
    transition: all 0.2s;
}

.add-btn svg {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
}

.add-btn:hover {
    border-color: var(--md-primary);
    color: var(--md-primary);
    background: var(--md-surface-container-high);
}

.add-btn:active {
    transform: scale(0.98);
}

/* Dashed variant for "Add Custom" buttons */
.add-btn.dashed {
    border-style: dashed;
    border-width: 2px;
    background: transparent;
}

/* Compact variant - smaller, less prominent */
.add-btn.compact {
    flex: 0 0 auto;
    min-width: auto;
    padding: 8px 12px;
    font-size: 12px;
}

/* ===== LARGE TEXT AREAS ===== */
.text-area {
    width: 100%;
    min-height: 120px;
    background: var(--md-surface-container-high);
    border: none;
    border-radius: 10px;
    padding: 14px;
    font-size: 13px;
    color: var(--md-on-surface);
    resize: vertical;
    font-family: inherit;
    line-height: 1.6;
    box-sizing: border-box;
}

.text-area:focus {
    outline: 2px solid var(--md-primary);
    outline-offset: -2px;
}

.text-area::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.3;
}

/* ===== TRAINING CHECKBOXES ===== */
.training-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
}

@media (max-width: 500px) {
    .training-grid {
        grid-template-columns: 1fr;
    }
}

.training-group {
    background: var(--md-surface-container-high);
    border-radius: 10px;
    padding: 14px;
}

.training-label {
    font-size: 11px;
    text-transform: uppercase;
    color: var(--md-on-surface-variant);
    font-weight: 600;
    margin-bottom: 10px;
}

.training-checks {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
}

.training-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: var(--md-on-surface);
    cursor: pointer;
}

.training-item input {
    width: 20px;
    height: 20px;
    cursor: pointer;
    /* Custom checkbox styling */
    appearance: none;
    -webkit-appearance: none;
    background: var(--md-surface-container);
    border: 2px solid var(--md-outline-variant);
    border-radius: 4px;
    flex-shrink: 0;
}

.training-item input:checked {
    background: var(--md-primary);
    border-color: var(--md-primary);
}

.training-item input:checked::after {
    content: '✓';
    color: var(--md-on-primary);
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.training-item input:hover {
    border-color: var(--md-primary);
}

/* ===== SPELLCASTING ===== */
.spell-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-bottom: 16px;
}

@media (max-width: 600px) {
    .spell-stats {
        grid-template-columns: repeat(2, 1fr);
    }
}

.spell-stat {
    background: var(--md-surface-container-high);
    border-radius: 10px;
    padding: 12px;
    text-align: center;
}

.spell-stat-label {
    font-size: 9px;
    text-transform: uppercase;
    color: var(--md-on-surface-variant);
    font-weight: 600;
    margin-bottom: 6px;
}

.spell-stat-select {
    font-size: 16px;
    font-weight: 700;
    background: var(--md-surface-container);
    border: none;
    border-radius: 6px;
    color: var(--md-on-surface);
    padding: 8px 12px;
    text-align: center;
    cursor: pointer;
}

.spell-stat-select:focus {
    outline: 2px solid var(--md-primary);
}

.spell-stat-value {
    font-size: 22px;
    font-weight: 700;
    color: var(--md-on-surface);
    display: block;
}

.spell-stat-input {
    font-size: 18px;
    font-weight: 700;
    background: transparent;
    border: none;
    color: var(--md-on-surface);
    width: 100%;
    text-align: center;
}

.spell-stat-input:focus {
    outline: none;
}

.spell-stat-input::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.3;
}

.pact-slots-section {
    background: var(--md-surface-container-high);
    border-radius: 10px;
    padding: 12px 14px;
    margin-bottom: 16px;
    transition: opacity 0.3s;
}

.pact-slots-section.dimmed {
    opacity: 0.35;
}

.pact-slots-row {
    display: flex;
    gap: 12px;
    margin-top: 8px;
}

.pact-slot-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}

.pact-label {
    font-size: 10px;
    text-transform: uppercase;
    color: var(--md-on-surface-variant);
}

.pact-input {
    width: 50px;
    height: 36px;
    background: var(--md-surface-container);
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    text-align: center;
    color: var(--md-on-surface);
}

.pact-input:focus {
    outline: 2px solid var(--md-primary);
}

.pact-hint {
    font-size: 9px;
    color: var(--md-on-surface-variant);
    margin-top: 6px;
}

.slots-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 16px;
}

@media (max-width: 600px) {
    .slots-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

.slot-card {
    background: var(--md-surface-container-high);
    border-radius: 10px;
    padding: 12px;
    transition: opacity 0.2s;
}

.slot-card.slot-empty {
    opacity: 0.4;
}

.slot-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.slot-level {
    font-size: 13px;
    font-weight: 700;
    color: var(--md-on-surface);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.slot-total-edit {
    display: flex;
    align-items: center;
    gap: 4px;
}

.slot-total-label {
    font-size: 10px;
    color: var(--md-on-surface-variant);
    text-transform: uppercase;
}

.slot-total-input {
    width: 36px;
    height: 26px;
    background: var(--md-surface-container);
    border: 1px solid var(--md-outline-variant);
    border-radius: 6px;
    padding: 4px;
    text-align: center;
    font-size: 13px;
    font-weight: 600;
    color: var(--md-on-surface);
}

.slot-total-input:focus {
    outline: none;
    border-color: var(--md-primary);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--md-primary) 30%, transparent);
}

.slot-pips {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    min-height: 32px;
}

.slot-pip {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: 2px solid var(--md-outline-variant);
    background: transparent;
    cursor: pointer;
    transition: all 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 4px;
}

.slot-pip svg {
    width: 100%;
    height: 100%;
}

.slot-pip:hover {
    transform: scale(1.1);
    border-color: var(--md-primary);
}

.slot-pip.available {
    border-color: var(--md-primary);
    color: var(--md-primary);
}

.slot-pip.available:hover {
    background: color-mix(in srgb, var(--md-primary) 15%, transparent);
}

.slot-pip.expended {
    border-color: var(--md-outline);
    background: var(--md-surface-container);
    color: var(--md-outline);
}

.slot-pip.expended:hover {
    border-color: var(--md-primary);
    color: var(--md-primary);
}

.slot-status {
    margin-top: 8px;
    font-size: 11px;
    color: var(--md-on-surface-variant);
    display: flex;
    align-items: center;
    gap: 4px;
}

.slot-available {
    font-weight: 700;
    color: var(--md-primary);
    font-size: 14px;
}

.slot-max {
    font-weight: 600;
    color: var(--md-on-surface);
}

.slot-avail-label {
    margin-left: 4px;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.slot-restore-btn {
    background: transparent;
    border: none;
    color: var(--md-primary);
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
}

.slot-restore-btn:hover {
    background: color-mix(in srgb, var(--md-primary) 15%, transparent);
}

.slot-restore-btn:active {
    transform: scale(0.95);
}

/* Legacy compatibility */
.slot-counts {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: var(--md-on-surface-variant);
}

.slot-num {
    width: 44px;
    height: 32px;
    background: var(--md-surface-container);
    border: none;
    border-radius: 6px;
    padding: 6px 8px;
    text-align: center;
    font-size: 14px;
    font-weight: 600;
    color: var(--md-on-surface);
}

.slot-num:focus {
    outline: none;
    border-color: var(--md-primary);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--md-primary) 30%, transparent);
}

/* Spells Table */
.spells-list,
.cantrips-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

/* Cantrips Section */
.cantrips-section {
    margin-bottom: 20px;
    padding: 12px;
    background: var(--md-surface-container);
    border-radius: 12px;
}

.at-will-badge {
    display: inline-flex;
    align-items: center;
    padding: 2px 8px;
    background: var(--md-tertiary);
    color: var(--md-on-tertiary);
    border-radius: 10px;
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.spell-level-hint {
    font-size: 11px;
    font-weight: 400;
    color: var(--md-on-surface-variant);
    opacity: 0.7;
}

/* Cantrip Row - simplified version */
.cantrip-row {
    display: grid;
    grid-template-columns: 28px minmax(150px, 1fr) 72px 58px 72px minmax(100px, 150px) 70px 32px;
    gap: 8px;
    align-items: center;
    background: var(--md-surface-container-high);
    border-radius: 8px;
    padding: 6px 10px;
    min-height: 38px;
}

@media (max-width: 900px) {
    .cantrip-row {
        grid-template-columns: 24px 1fr 1fr 28px;
        grid-template-rows: auto auto;
        gap: 6px;
        padding: 8px;
    }
    .cantrip-row .spell-school-icon { grid-column: 1; grid-row: 1; }
    .cantrip-row .spell-name-display { grid-column: 2 / 4; grid-row: 1; }
    .cantrip-row .spell-delete-btn { grid-column: 4; grid-row: 1; }
    .cantrip-row .spell-time-badge { grid-column: 1 / 2; grid-row: 2; }
    .cantrip-row .spell-components { grid-column: 2; grid-row: 2; }
    .cantrip-row .spell-effect-summary { grid-column: 3 / 5; grid-row: 2; }
}

.spell-row {
    display: grid;
    grid-template-columns: 36px 28px minmax(180px, 1fr) 72px 58px 72px minmax(140px, 180px) 90px 32px;
    gap: 8px;
    align-items: center;
    background: var(--md-surface-container-high);
    border-radius: 10px;
    padding: 8px 12px;
    min-height: 44px;
}

@media (max-width: 1200px) {
    .spell-row {
        grid-template-columns: 32px 24px minmax(140px, 1fr) 64px 52px 64px minmax(100px, 140px) 80px 28px;
        gap: 6px;
        padding: 6px 10px;
    }
}

@media (max-width: 900px) {
    .spell-row {
        display: grid;
        grid-template-columns: 32px 24px 1fr 28px;
        grid-template-rows: auto auto auto;
        gap: 6px;
        padding: 10px;
    }
    .spell-row .spell-level-badge { grid-column: 1; grid-row: 1; }
    .spell-row .spell-school-icon { grid-column: 2; grid-row: 1; }
    .spell-row .spell-name-display { grid-column: 3; grid-row: 1; }
    .spell-row .spell-delete-btn { grid-column: 4; grid-row: 1; }
    .spell-row .spell-time-badge { grid-column: 1 / 2; grid-row: 2; }
    .spell-row .spell-components { grid-column: 2; grid-row: 2; }
    .spell-row .spell-category { grid-column: 3; grid-row: 2; justify-self: start; }
    .spell-row .spell-effect-summary { grid-column: 1 / 4; grid-row: 3; }
    .spell-row .spell-flags { grid-column: 4; grid-row: 2 / 4; align-self: center; flex-direction: column; }
}

/* Spell Level Badge */
.spell-level-badge {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    background: var(--md-primary);
    color: var(--md-on-primary);
    border-radius: 6px;
    font-size: 13px;
    font-weight: 700;
    flex-shrink: 0;
}

.spell-level-badge.cantrip {
    background: var(--md-tertiary);
    color: var(--md-on-tertiary);
}

/* Spell School Icon */
.spell-school-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    flex-shrink: 0;
}

.spell-school-icon svg {
    width: 20px;
    height: 20px;
}

/* Spell Name */
.spell-name-display {
    font-size: 13px;
    font-weight: 600;
    color: var(--md-on-surface);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    cursor: pointer;
    padding: 4px 6px;
    border-radius: 4px;
    transition: background 0.15s;
}

.spell-name-display:hover {
    background: var(--md-surface-container);
}

/* Casting Time Badge */
.spell-time-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 4px 8px;
    background: var(--md-surface-container);
    border-radius: 6px;
    font-size: 10px;
    font-weight: 600;
    color: var(--md-on-surface-variant);
    white-space: nowrap;
    width: 100%;
    box-sizing: border-box;
}

.spell-time-badge.action { background: #2e7d32; color: #fff; }
.spell-time-badge.bonus { background: #f57c00; color: #fff; }
.spell-time-badge.reaction { background: #7b1fa2; color: #fff; }
.spell-time-badge.ritual { background: #1565c0; color: #fff; }

/* Components Display */
.spell-components {
    display: flex;
    gap: 2px;
    align-items: center;
    justify-content: center;
}

.spell-comp {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 18px;
    height: 18px;
    background: var(--md-surface-container);
    border-radius: 4px;
    font-size: 10px;
    font-weight: 700;
    color: var(--md-on-surface-variant);
    opacity: 0.4;
}

.spell-comp.active {
    background: var(--md-secondary-container);
    color: var(--md-on-secondary-container);
    opacity: 1;
}

/* Effect Category */
.spell-category {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 4px 10px;
    background: var(--md-tertiary-container);
    color: var(--md-on-tertiary-container);
    border-radius: 10px;
    font-size: 9px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    white-space: nowrap;
    width: 100%;
    box-sizing: border-box;
}

.spell-category.damage { background: #c62828; color: #fff; }
.spell-category.control { background: #6a1b9a; color: #fff; }
.spell-category.buff { background: #2e7d32; color: #fff; }
.spell-category.debuff { background: #d84315; color: #fff; }
.spell-category.utility { background: #0277bd; color: #fff; }
.spell-category.healing { background: #00897b; color: #fff; }
.spell-category.summon { background: #5d4037; color: #fff; }
.spell-category.teleport { background: #4527a0; color: #fff; }

/* Effect Summary */
.spell-effect-summary {
    font-size: 11px;
    color: var(--md-on-surface-variant);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    padding: 4px 8px;
    background: var(--md-surface-container);
    border-radius: 4px;
}

/* Mechanical Flags */
.spell-flags {
    display: flex;
    gap: 4px;
    align-items: center;
    justify-content: flex-end;
    flex-wrap: nowrap;
}

.spell-flag {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: var(--md-surface-container);
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.15s;
    flex-shrink: 0;
}

.spell-flag:hover {
    background: var(--md-surface-container-highest);
}

.spell-flag.active {
    background: var(--md-primary);
    color: var(--md-on-primary);
}

.spell-flag.conc-active {
    background: #e65100;
    color: #fff;
    animation: pulse-conc 2s infinite;
}

.spell-flag svg {
    width: 14px;
    height: 14px;
}

/* Delete Button */
.spell-delete-btn {
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    border-radius: 6px;
    color: var(--md-on-surface-variant);
    cursor: pointer;
    font-size: 16px;
    opacity: 0.5;
    transition: all 0.15s;
    flex-shrink: 0;
}

.spell-delete-btn:hover {
    background: var(--md-error-container);
    color: var(--md-on-error-container);
    opacity: 1;
}

.spell-cast-toast {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: linear-gradient(135deg, var(--md-primary), var(--md-tertiary));
    color: #fff;
    padding: 12px 24px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 14px;
    font-weight: 500;
    z-index: 9999;
    opacity: 0;
    transition: all 0.3s ease;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}

.spell-cast-toast.active {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
}

.spell-cast-icon {
    font-size: 20px;
}

.spell-cast-level {
    opacity: 0.8;
    font-size: 12px;
}

.spell-input {
    background: var(--md-surface-container);
    border: none;
    border-radius: 6px;
    padding: 8px 10px;
    font-size: 12px;
    color: var(--md-on-surface);
    min-width: 0; /* Prevent overflow */
}

.spell-input:focus {
    outline: 2px solid var(--md-primary);
}

.spell-time-select {
    cursor: pointer;
}

.spell-time-select option {
    background: var(--md-surface-container);
    color: var(--md-on-surface);
}

/* Legacy spell-check (kept for compatibility) */
.spell-check {
    display: none;
}

.spell-input {
    background: var(--md-surface-container);
    border: none;
    border-radius: 6px;
    padding: 8px 10px;
    font-size: 12px;
    color: var(--md-on-surface);
    min-width: 0;
}

.spell-input:focus {
    outline: 2px solid var(--md-primary);
}

/* ===== NARRATIVE / EQUIPMENT ===== */
.narrative-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    align-items: start;
}

.narrative-grid > div,
.equip-col {
    display: flex;
    flex-direction: column;
    gap: 14px;
}

.physical-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    background: var(--md-surface-container-high);
    border-radius: 10px;
    padding: 12px;
    box-sizing: border-box;
}

@media (max-width: 500px) {
    .physical-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

.phys-input {
    background: var(--md-surface-container);
    border: none;
    border-radius: 8px;
    padding: 10px 12px;
    font-size: 13px;
    color: var(--md-on-surface);
    box-sizing: border-box;
}

.phys-input.phys-dimmed {
    opacity: 0.5;
}

.phys-input.phys-dimmed:focus {
    opacity: 1;
}

.phys-input::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.3;
}

.phys-input:focus {
    outline: 2px solid var(--md-primary);
    outline-offset: -2px;
}

.equip-area {
    min-height: 150px;
    height: 150px;
    white-space: pre-wrap;
    line-height: 1.8;
}

@media (max-width: 600px) {
    .narrative-grid {
        grid-template-columns: 1fr;
    }
}

.coins-row {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 20px;
    align-items: center;
}

.coin {
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--md-surface-container-high);
    padding: 10px 14px;
    border-radius: 12px;
}

/* GP hervorgehoben */
.coin.coin-primary {
    background: var(--md-surface-container-highest);
    padding: 12px 16px;
}

.coin.coin-primary .coin-input {
    width: 70px;
    height: 40px;
    font-size: 16px;
}

.coin-label {
    font-size: 12px;
    font-weight: 700;
    color: var(--md-on-surface-variant);
}

/* Coin Colors */
.coin-cp .coin-label { color: #B87333; }
.coin-sp .coin-label { color: #C0C0C0; }
.coin-ep .coin-label { color: #B8B08D; }
.coin-gp .coin-label { color: #e2c984; font-size: 14px; }
.coin-pp .coin-label { color: #C9CED6; }

.coin-input {
    width: 60px;
    height: 36px;
    background: var(--md-surface-container);
    border: none;
    border-radius: 8px;
    padding: 8px;
    font-size: 14px;
    font-weight: 600;
    color: var(--md-on-surface);
    text-align: center;
}

.coin-input:focus {
    outline: 2px solid var(--md-primary);
}

.coin-input::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.3;
}

.field-group {
    margin-bottom: 14px;
}

.field-label {
    font-size: 11px;
    text-transform: uppercase;
    color: var(--md-on-surface-variant);
    font-weight: 600;
    margin-bottom: 6px;
}

.field-input {
    width: 100%;
    background: var(--md-surface-container-high);
    border: none;
    border-radius: 8px;
    padding: 10px 12px;
    font-size: 13px;
    color: var(--md-on-surface);
    box-sizing: border-box;
}

.field-input:focus {
    outline: 2px solid var(--md-primary);
    outline-offset: -2px;
}

.field-input::placeholder {
    color: var(--md-on-surface-variant);
    opacity: 0.3;
}

/* Magic Item Attunement */
.attunement-slots {
    display: flex;
    gap: 10px;
    margin-top: 8px;
    background: var(--md-surface-container-high);
    border-radius: 10px;
    padding: 12px;
    min-height: 60px;
    align-items: center;
    box-sizing: border-box;
}

.attunement-slot {
    width: 36px;
    height: 36px;
    min-width: 36px;
    min-height: 36px;
    border-radius: 8px;
    border: 2px solid #666;
    background: #1a1a1a;
    cursor: pointer;
    transition: all 0.15s;
    display: inline-block;
    flex-shrink: 0;
}

.attunement-slot:hover,
.attunement-slot:active {
    border-color: var(--md-primary);
    transform: scale(1.05);
}

.attunement-slot.active {
    background: var(--md-tertiary);
    border-color: var(--md-tertiary);
}

/* ===== QUICK REFERENCE ===== */
.reference-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
}

@media (max-width: 600px) {
    .reference-grid {
        grid-template-columns: 1fr;
    }
}

.ref-card {
    background: var(--md-surface-container-high);
    border-radius: 12px;
    padding: 16px;
}

.ref-title {
    font-size: 12px;
    font-weight: 600;
    color: var(--md-primary);
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

.ref-formula {
    font-size: 14px;
    font-weight: 500;
    color: var(--md-on-surface);
    margin-bottom: 10px;
    padding: 6px 10px;
    background: var(--md-surface-container);
    border-radius: 6px;
    display: inline-block;
}

.ref-table {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.ref-table span {
    font-size: 11px;
    color: var(--md-on-surface-variant);
    background: var(--md-surface-container);
    padding: 4px 8px;
    border-radius: 4px;
}

.ref-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.ref-list div {
    font-size: 12px;
    color: var(--md-on-surface-variant);
}

.ref-label {
    font-weight: 600;
    color: var(--md-on-surface);
}

/* ===== MANAGE SECTION ===== */
.manage-btns {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
}

.manage-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 14px 24px;
    min-height: 48px;
    background: var(--md-primary);
    color: var(--md-on-primary);
    border: none;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.manage-btn:hover,
.manage-btn:active {
    background: #c49a38;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

.manage-btn svg {
    width: 20px;
    height: 20px;
}

.manage-btn.danger {
    background: #d32f2f;
    color: white;
}

.manage-btn.danger:hover,
.manage-btn.danger:active {
    background: #b71c1c;
}

@media (max-width: 600px) {
    .manage-btns {
        gap: 8px;
    }
    .manage-btn {
        flex: 1 1 calc(50% - 8px);
        min-width: 140px;
        justify-content: center;
        padding: 12px 16px;
    }
}

/* ===== RULES NOTICE ===== */
.rules-notice {
    background: var(--md-surface-container);
    border: none;
    border-radius: 12px;
    padding: 16px 20px;
}

.rules-notice p {
    font-size: 13px;
    line-height: 1.6;
    color: var(--md-on-surface-variant);
    margin: 0 0 12px 0;
}

.rules-notice p:last-child {
    margin-bottom: 0;
}

.rules-notice a {
    color: var(--md-primary);
    text-decoration: none;
}

.rules-notice a:hover {
    text-decoration: underline;
}

/* ===== CROP MODAL ===== */
.crop-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.9);
    z-index: 10000;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.crop-overlay.active {
    display: flex;
}

.crop-modal {
    background: var(--md-surface-container);
    border-radius: 16px;
    max-width: 450px;
    width: 100%;
    overflow: hidden;
}

.crop-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    
}

.crop-title {
    font-weight: 600;
    font-size: 16px;
}

.crop-close {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: transparent;
    border: none;
    color: var(--md-on-surface-variant);
    font-size: 20px;
    cursor: pointer;
}

.crop-body {
    padding: 16px;
    max-height: 50vh;
    overflow: hidden;
}

.crop-body img {
    max-width: 100%;
}

.crop-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    padding: 16px 20px;
    
}

.crop-btn {
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 14px;
    cursor: pointer;
}

.crop-btn-cancel {
    background: var(--md-surface-container-high);
    border: none;
    color: var(--md-on-surface);
}

.crop-btn-ok {
    background: var(--md-primary);
    border: none;
    color: var(--md-on-primary);
}

/* GM Player Bar - nicht fixed, scrollt mit */
.player-bar {
    background: var(--md-surface-container);
    border-radius: 16px;
    padding: 12px 20px;
    margin-bottom: 24px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    display: flex;
    align-items: center;
    gap: 12px;
}

.gm-banner {
    background: color-mix(in srgb, var(--md-primary) 10%, var(--md-surface-container));
    border: 1px solid var(--md-primary);
    border-radius: 12px;
    padding: 12px 20px;
    margin-bottom: 24px;
    font-size: 13px;
    color: var(--md-on-surface);
    display: flex;
    align-items: center;
    gap: 10px;
}

.gm-banner svg {
    width: 18px;
    height: 18px;
    color: var(--md-primary);
}

@media (max-width: 600px) {
    .player-bar {
        padding: 8px 12px;
    }
}

.player-bar-label {
    font-size: 12px;
    color: var(--md-on-surface-variant);
    font-weight: 500;
    white-space: nowrap;
}

.player-tab {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 14px;
    background: var(--md-surface-container-high);
    border: 2px solid transparent;
    border-radius: 100px;
    font-size: 13px;
    font-weight: 500;
    color: var(--md-on-surface);
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.2s;
}

.player-tab:hover {
    background: var(--md-surface-container-highest);
}

.player-tab.active {
    border-color: var(--md-primary);
    background: color-mix(in srgb, var(--md-primary) 15%, var(--md-surface-container));
}

.player-tab.own {
    font-style: italic;
}

.player-tab-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
}

@media print {
    body { background: white !important; color: black !important; }
    .nav-container, .fly-btn-container, .player-bar, .gm-banner, .section:last-child { display: none !important; }
    .section.collapsed .section-content { display: block !important; }
}

/* ===== TOOLTIP SYSTEM ===== */
.help-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.15);
    color: rgba(255, 255, 255, 0.7);
    font-size: 9px;
    font-weight: 700;
    cursor: help;
    margin-left: 4px;
    transition: all 0.2s ease;
    vertical-align: middle;
    flex-shrink: 0;
}
.help-icon:hover {
    background: var(--md-primary, var(--md-primary));
    color: #fff;
}

/* Hide help icons when disabled */
body.hide-help-icons .help-icon {
    display: none !important;
}

.tooltip-popup {
    position: fixed;
    z-index: 9999;
    background: var(--md-surface-container-high);
    border: 1px solid var(--md-outline-variant);
    border-radius: 12px;
    padding: 14px 16px;
    max-width: 320px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    opacity: 0;
    visibility: hidden;
    transform: translateY(8px);
    transition: all 0.2s ease;
}
.tooltip-popup.visible {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}
.tooltip-popup h4 {
    font-size: 13px;
    font-weight: 700;
    color: var(--md-primary);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
.tooltip-popup p {
    font-size: 13px;
    line-height: 1.5;
    color: var(--md-on-surface);
    margin: 0;
}
.tooltip-popup .tip-example {
    margin-top: 10px;
    padding: 10px;
    background: var(--md-surface-container);
    border-radius: 8px;
    font-size: 12px;
    color: var(--md-on-surface-variant);
}
.tooltip-popup .tip-example strong {
    color: var(--md-primary);
}

/* ===== CHARACTER WIZARD ===== */
.wizard-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.85);
    z-index: 10001;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
}
.wizard-overlay.active {
    display: flex;
}
.wizard-modal {
    background: var(--md-surface-container);
    border-radius: 20px;
    max-width: 600px;
    width: 100%;
    max-height: 85vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}
.wizard-header {
    padding: 24px 28px 20px;
    border-bottom: 1px solid var(--md-outline-variant);
}
.wizard-header h2 {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 8px;
}
.wizard-progress {
    display: flex;
    gap: 8px;
}
.wizard-progress-step {
    flex: 1;
    height: 4px;
    border-radius: 2px;
    background: var(--md-surface-container-highest);
    transition: background 0.3s ease;
}
.wizard-progress-step.done {
    background: var(--md-primary);
}
.wizard-progress-step.active {
    background: linear-gradient(90deg, var(--md-primary), var(--md-surface-container-highest));
}
.wizard-body {
    flex: 1;
    overflow-y: auto;
    padding: 24px 28px;
}
.wizard-step {
    display: none;
}
.wizard-step.active {
    display: block;
    animation: fadeIn 0.3s ease;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateX(20px); }
    to { opacity: 1; transform: translateX(0); }
}
.wizard-step h3 {
    font-size: 18px;
    margin-bottom: 8px;
}
.wizard-step p {
    color: var(--md-on-surface-variant);
    margin-bottom: 20px;
    line-height: 1.5;
}
.wizard-options {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 12px;
}
.wizard-option {
    background: var(--md-surface-container-high);
    border: 2px solid transparent;
    border-radius: 12px;
    padding: 16px;
    cursor: pointer;
    transition: all 0.2s ease;
    text-align: center;
}
.wizard-option:hover {
    border-color: var(--md-outline);
    transform: translateY(-2px);
}
.wizard-option.selected {
    border-color: var(--md-primary);
    background: color-mix(in srgb, var(--md-primary) 10%, var(--md-surface-container-high));
}
.wizard-option-icon {
    font-size: 32px;
    margin-bottom: 8px;
}
.wizard-option-name {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 4px;
}
.wizard-option-desc {
    font-size: 11px;
    color: var(--md-on-surface-variant);
}
.wizard-input-group {
    margin-bottom: 20px;
}
.wizard-input-group label {
    display: block;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    color: var(--md-on-surface-variant);
    margin-bottom: 8px;
}
.wizard-input-group input,
.wizard-input-group select {
    width: 100%;
    background: var(--md-surface-container-high);
    border: 1px solid var(--md-outline-variant);
    border-radius: 10px;
    padding: 14px 16px;
    font-size: 15px;
    color: var(--md-on-surface);
}
.wizard-input-group input:focus,
.wizard-input-group select:focus {
    outline: none;
    border-color: var(--md-primary);
}
.wizard-ability-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
}
.wizard-ability-item {
    background: var(--md-surface-container-high);
    border-radius: 10px;
    padding: 12px;
    text-align: center;
}
.wizard-ability-item label {
    font-size: 11px;
    font-weight: 600;
    color: var(--md-on-surface-variant);
    display: block;
    margin-bottom: 6px;
}
.wizard-ability-item input {
    width: 60px;
    background: var(--md-surface-container);
    border: 1px solid var(--md-outline-variant);
    border-radius: 8px;
    padding: 10px;
    font-size: 18px;
    font-weight: 700;
    text-align: center;
    color: var(--md-on-surface);
}
.wizard-footer {
    padding: 20px 28px;
    border-top: 1px solid var(--md-outline-variant);
    display: flex;
    justify-content: space-between;
    gap: 12px;
}
.wizard-btn {
    padding: 12px 28px;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
}
.wizard-btn-back {
    background: var(--md-surface-container-high);
    color: var(--md-on-surface);
}
.wizard-btn-back:hover {
    background: var(--md-surface-container-highest);
}
.wizard-btn-next {
    background: var(--md-primary);
    color: var(--md-on-primary);
    margin-left: auto;
}
.wizard-btn-next:hover {
    filter: brightness(1.1);
}
.wizard-btn-next:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
.wizard-close {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--md-surface-container-high);
    border: none;
    color: var(--md-on-surface);
    font-size: 20px;
    cursor: pointer;
}

/* ===== QUICK START TEMPLATES ===== */
.quickstart-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(135deg, var(--md-primary), color-mix(in srgb, var(--md-primary) 70%, purple));
    color: var(--md-on-primary);
    border: none;
    border-radius: 10px;
    padding: 12px 20px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
}
.quickstart-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(var(--md-primary-rgb), 0.4);
}
.quickstart-btn svg {
    width: 18px;
    height: 18px;
}

.template-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 16px;
    margin-top: 20px;
}
.template-card {
    background: var(--md-surface-container-high);
    border: 2px solid transparent;
    border-radius: 14px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
}
.template-card:hover {
    border-color: var(--md-outline);
    transform: translateY(-3px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.2);
}
.template-card.selected {
    border-color: var(--md-primary);
}
/* GM-only Templates - grüner Rahmen */
.template-card.gm-only {
    border-color: #4caf50;
    background: linear-gradient(135deg, var(--md-surface-container-high) 0%, rgba(76, 175, 80, 0.08) 100%);
}
.template-card.gm-only:hover {
    border-color: #66bb6a;
    box-shadow: 0 8px 24px rgba(76, 175, 80, 0.3);
}
.template-card.gm-only.selected {
    border-color: #81c784;
    box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.3);
}
.gm-badge {
    position: absolute;
    top: 8px;
    right: 8px;
    background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
    color: white;
    font-size: 9px;
    font-weight: 700;
    padding: 3px 8px;
    border-radius: 6px;
    letter-spacing: 0.5px;
    box-shadow: 0 2px 6px rgba(76, 175, 80, 0.4);
}
.template-portrait {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: var(--md-surface-container);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    margin-bottom: 12px;
}
.template-name {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 4px;
}
.template-info {
    font-size: 12px;
    color: var(--md-on-surface-variant);
    margin-bottom: 12px;
}
.template-desc {
    font-size: 12px;
    color: var(--md-on-surface-variant);
    line-height: 1.5;
}

/* ===== RULES REFERENCE POPUP ===== */
.rules-popup {
    position: fixed;
    z-index: 10000;
    background: var(--md-surface-container);
    border: 1px solid var(--md-outline-variant);
    border-radius: 16px;
    width: 380px;
    max-height: 450px;
    overflow: hidden;
    box-shadow: 0 12px 48px rgba(0,0,0,0.5);
    opacity: 0;
    visibility: hidden;
    transform: scale(0.95);
    transition: all 0.2s ease;
}
.rules-popup.visible {
    opacity: 1;
    visibility: visible;
    transform: scale(1);
}
.rules-popup-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    background: var(--md-surface-container-high);
    border-bottom: 1px solid var(--md-outline-variant);
}
.rules-popup-header h3 {
    font-size: 15px;
    font-weight: 700;
}
.rules-popup-close {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: transparent;
    border: none;
    color: var(--md-on-surface-variant);
    font-size: 18px;
    cursor: pointer;
}
.rules-popup-close:hover {
    background: var(--md-surface-container-highest);
}
.rules-popup-body {
    padding: 20px;
    max-height: 350px;
    overflow-y: auto;
}
.rules-popup-body p {
    font-size: 13px;
    line-height: 1.6;
    color: var(--md-on-surface);
    margin-bottom: 12px;
}
.rules-popup-body p:last-child {
    margin-bottom: 0;
}
.rules-popup-body strong {
    color: var(--md-primary);
}
.rules-popup-example {
    background: var(--md-surface-container-high);
    border-radius: 10px;
    padding: 14px;
    margin-top: 12px;
}
.rules-popup-example h4 {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    color: var(--md-on-surface-variant);
    margin-bottom: 8px;
}
.rules-link {
    color: var(--md-primary);
    text-decoration: underline;
    cursor: pointer;
    font-size: inherit;
}
.rules-link:hover {
    text-decoration: none;
}

/* New Character Buttons Row */
.new-char-actions {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}
.new-char-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: var(--md-surface-container-high);
    color: var(--md-on-surface);
    border: 1px solid var(--md-outline-variant);
    border-radius: 10px;
    padding: 10px 18px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}
.new-char-btn:hover {
    background: var(--md-surface-container-highest);
    border-color: var(--md-outline);
}
.new-char-btn svg {
    width: 18px;
    height: 18px;
}
.new-char-btn.primary {
    background: var(--md-primary);
    color: var(--md-on-primary);
    border-color: var(--md-primary);
}
.new-char-btn.primary:hover {
    filter: brightness(1.1);
}

.section-hide-btn {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: transparent;
    border: 1px solid var(--md-outline-variant);
    color: var(--md-on-surface-variant);
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    line-height: 1;
}
.section-hide-btn:hover {
    background: var(--md-error-container);
    border-color: var(--md-error);
    color: var(--md-on-error-container);
}

/* Settings Options */
.settings-option {
    display: flex;
    align-items: flex-start;
    gap: 14px;
    padding: 16px 0;
    border-bottom: 1px solid var(--md-outline-variant);
}
.settings-option:last-child {
    border-bottom: none;
}
.settings-option-text {
    flex: 1;
}
.settings-option-title {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 4px;
}
.settings-option-desc {
    font-size: 12px;
    color: var(--md-on-surface-variant);
    line-height: 1.4;
}
.settings-toggle {
    position: relative;
    width: 48px;
    height: 26px;
    flex-shrink: 0;
}
.settings-toggle input {
    opacity: 0;
    width: 0;
    height: 0;
}
.settings-toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--md-surface-container-highest);
    transition: 0.3s;
    border-radius: 26px;
}
.settings-toggle-slider::before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 3px;
    bottom: 3px;
    background: var(--md-on-surface-variant);
    transition: 0.3s;
    border-radius: 50%;
}
.settings-toggle input:checked + .settings-toggle-slider {
    background: var(--md-primary);
}
.settings-toggle input:checked + .settings-toggle-slider::before {
    transform: translateX(22px);
    background: var(--md-on-primary);
}

/* ===== VETERAN FEATURES ===== */

/* Rest Buttons */
.rest-buttons {
    display: flex;
    gap: 10px;
    margin-top: 16px;
    flex-wrap: wrap;
}
.rest-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    border-radius: 10px;
    border: 1px solid var(--md-outline-variant);
    background: var(--md-surface-container-high);
    color: var(--md-on-surface);
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}
.rest-btn:hover {
    background: var(--md-surface-container-highest);
    border-color: var(--md-primary);
}
.rest-btn svg {
    width: 18px;
    height: 18px;
}
.rest-btn.short-rest {
    border-color: var(--md-tertiary);
}
.rest-btn.short-rest:hover {
    background: color-mix(in srgb, var(--md-tertiary) 15%, var(--md-surface-container));
}
.rest-btn.long-rest {
    border-color: var(--md-primary);
}
.rest-btn.long-rest:hover {
    background: color-mix(in srgb, var(--md-primary) 15%, var(--md-surface-container));
}

/* Conditions Tracker */
.conditions-section {
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--md-outline-variant);
}
.conditions-label {
    font-size: 11px;
    text-transform: uppercase;
    color: var(--md-on-surface-variant);
    font-weight: 600;
    margin-bottom: 10px;
}
.conditions-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}
.condition-chip {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 16px;
    background: var(--md-surface-container-high);
    border: 1px solid transparent;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    user-select: none;
}
.condition-chip:hover {
    border-color: var(--md-outline);
}
.condition-chip.active {
    background: var(--md-error-container);
    border-color: var(--md-error);
    color: var(--md-on-error-container);
}
.condition-chip .condition-icon {
    font-size: 14px;
}

/* Action Buttons (Worlds Apart Style) */
.action-buttons {
    display: flex;
    gap: 8px;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid rgba(255, 255, 255, 0.06);
}

.action-btn {
    flex: 1;
    padding: 8px;
    background: #0a0a0a;
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 6px;
    color: rgba(255, 255, 255, 0.5);
    font-size: 10px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
}

.action-btn:hover {
    background: #252525;
    color: rgba(255, 255, 255, 0.7);
}

.action-btn.danger:hover {
    background: rgba(255, 70, 85, 0.12);
    border-color: var(--md-primary);
    color: var(--md-primary);
}

.action-btn.primary {
    background: rgba(255, 193, 7, 0.12);
    border-color: #FFC107;
    color: #FFC107;
}

.action-btn.primary:hover {
    background: #FFC107;
    color: #121212;
}

.action-btn.primary.active {
    background: #FFC107;
    color: #121212;
    cursor: default;
}

.action-btn svg {
    width: 12px;
    height: 12px;
}

/* GM Coins Box */
.gm-coins-box {
    margin-top: 12px;
    padding: 12px;
    background: rgba(212, 168, 68, 0.08);
    border: 1px solid rgba(212, 168, 68, 0.2);
    border-radius: 8px;
}

.gm-coins-box .coins-row {
    opacity: 0.8;
}

.gm-coins-box .coin-input {
    cursor: default;
}

.gm-coins-hint {
    font-size: 10px;
    color: rgba(212, 168, 68, 0.7);
    margin-top: 8px;
    text-align: center;
}

/* Concentration Active Indicator */
.spell-row.concentrating {
    background: color-mix(in srgb, var(--md-tertiary) 15%, var(--md-surface-container-high));
    border: 1px solid var(--md-tertiary);
}
.concentration-banner {
    display: none;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    background: color-mix(in srgb, var(--md-tertiary) 20%, var(--md-surface-container));
    border: 1px solid var(--md-tertiary);
    border-radius: 10px;
    margin-bottom: 12px;
    font-size: 13px;
}
.concentration-banner.visible {
    display: flex;
}
.concentration-banner .conc-icon {
    font-size: 18px;
}
.concentration-banner .conc-spell {
    font-weight: 600;
    color: var(--md-tertiary);
}
.concentration-banner .conc-break {
    margin-left: auto;
    padding: 4px 10px;
    border-radius: 6px;
    background: var(--md-error);
    color: var(--md-on-error);
    border: none;
    font-size: 11px;
    cursor: pointer;
}

/* Multiclass Support */
.multiclass-section {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid var(--md-outline-variant);
}
.multiclass-row {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-bottom: 8px;
}
.multiclass-row select,
.multiclass-row input {
    background: var(--md-surface-container-high);
    border: 1px solid var(--md-outline-variant);
    border-radius: 8px;
    padding: 8px 10px;
    font-size: 13px;
    color: var(--md-on-surface);
}
.multiclass-row select {
    flex: 2;
}
.multiclass-row input[type="number"] {
    width: 60px;
    text-align: center;
}
.multiclass-remove {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--md-surface-container-highest);
    border: none;
    color: var(--md-on-surface-variant);
    cursor: pointer;
    font-size: 16px;
}
.multiclass-remove:hover {
    background: var(--md-error-container);
    color: var(--md-error);
}
.add-multiclass-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 8px;
    background: transparent;
    border: 1px dashed var(--md-outline-variant);
    color: var(--md-on-surface-variant);
    font-size: 12px;
    cursor: pointer;
}
.add-multiclass-btn:hover {
    border-color: var(--md-primary);
    color: var(--md-primary);
}

/* Dice Roll Clickable */
.rollable {
    cursor: pointer;
    transition: all 0.15s ease;
    position: relative;
}
.rollable:hover {
    color: var(--md-primary);
    text-shadow: 0 0 8px rgba(var(--md-primary-rgb), 0.5);
}
.rollable::after {
    content: '🎲';
    position: absolute;
    right: -20px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 12px;
    opacity: 0;
    transition: opacity 0.2s ease;
}
.rollable:hover::after {
    opacity: 0.7;
}

.rollable-field {
    cursor: pointer !important;
}
.rollable-field:hover {
    background: color-mix(in srgb, var(--md-primary) 10%, var(--md-surface-container-high)) !important;
    border-color: var(--md-primary) !important;
}

/* Clickable computed values */
.stat-computed.clickable,
.skill-computed.clickable,
.save-computed.clickable {
    cursor: pointer;
    border-radius: 4px;
    padding: 2px 4px;
    margin: -2px -4px;
    transition: all 0.15s ease;
}
.stat-computed.clickable:hover,
.skill-computed.clickable:hover,
.save-computed.clickable:hover {
    background: var(--md-primary);
    color: var(--md-on-primary);
}

/* Rest Effect Overlay */
.rest-effect-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 10000;
    pointer-events: none;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
}
.rest-effect-overlay.active {
    animation: restEffectFade 2s ease-out forwards;
}
.rest-effect-overlay.short-rest {
    background: radial-gradient(circle, rgba(255,200,50,0.4) 0%, rgba(255,150,0,0.1) 50%, transparent 70%);
}
.rest-effect-overlay.long-rest {
    background: radial-gradient(circle, rgba(100,150,255,0.4) 0%, rgba(50,50,150,0.2) 50%, transparent 70%);
}
.rest-effect-icon {
    font-size: 120px;
    animation: restIconPulse 2s ease-out forwards;
    filter: drop-shadow(0 0 30px currentColor);
}
.rest-effect-overlay.short-rest .rest-effect-icon {
    color: #ffcc00;
    text-shadow: 0 0 40px #ff9900, 0 0 80px #ff6600;
}
.rest-effect-overlay.long-rest .rest-effect-icon {
    color: #aaccff;
    text-shadow: 0 0 40px #6699ff, 0 0 80px #3366cc;
}
.rest-effect-text {
    position: absolute;
    bottom: 35%;
    font-size: 28px;
    font-weight: 700;
    letter-spacing: 4px;
    text-transform: uppercase;
    animation: restTextSlide 2s ease-out forwards;
}
.rest-effect-overlay.short-rest .rest-effect-text {
    color: #ffdd44;
    text-shadow: 0 0 20px #ff9900;
}
.rest-effect-overlay.long-rest .rest-effect-text {
    color: #aaddff;
    text-shadow: 0 0 20px #6699ff;
}
@keyframes restEffectFade {
    0% { opacity: 0; }
    15% { opacity: 1; }
    70% { opacity: 1; }
    100% { opacity: 0; }
}
@keyframes restIconPulse {
    0% { transform: scale(0.5); opacity: 0; }
    20% { transform: scale(1.2); opacity: 1; }
    40% { transform: scale(1); }
    70% { transform: scale(1.1); opacity: 1; }
    100% { transform: scale(1.5); opacity: 0; }
}
@keyframes restTextSlide {
    0% { transform: translateY(20px); opacity: 0; }
    20% { transform: translateY(0); opacity: 1; }
    70% { transform: translateY(0); opacity: 1; }
    100% { transform: translateY(-20px); opacity: 0; }
}

/* ===== INTEGRATED DICE ROLLER POPUP ===== */
.dice-popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(4px);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease;
}
.dice-popup-overlay.active {
    opacity: 1;
    pointer-events: auto;
}
.dice-popup {
    background: var(--md-surface-container);
    border-radius: 20px;
    padding: 24px;
    min-width: 320px;
    max-width: 400px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    transform: scale(0.9) translateY(20px);
    transition: transform 0.3s ease;
    border: 1px solid var(--md-outline-variant);
}
.dice-popup-overlay.active .dice-popup {
    transform: scale(1) translateY(0);
}
.dice-popup-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}
.dice-popup-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--md-on-surface);
    display: flex;
    align-items: center;
    gap: 8px;
}
.dice-popup-title .roll-type {
    color: var(--md-primary);
}
.dice-popup-close {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: none;
    background: var(--md-surface-container-highest);
    color: var(--md-on-surface-variant);
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}
.dice-popup-close:hover {
    background: var(--md-error-container);
    color: var(--md-error);
}

/* Dice Display */
.dice-display-area {
    background: var(--md-surface-container-high);
    border-radius: 16px;
    padding: 24px;
    text-align: center;
    margin-bottom: 16px;
    position: relative;
    overflow: hidden;
}
.dice-formula {
    font-size: 14px;
    color: var(--md-on-surface-variant);
    margin-bottom: 12px;
    font-family: 'JetBrains Mono', monospace;
}
.dice-result {
    font-size: 64px;
    font-weight: 800;
    color: var(--md-on-surface);
    line-height: 1;
    margin-bottom: 8px;
    transition: all 0.3s ease;
}
.dice-result.rolling {
    animation: diceRoll 0.1s infinite;
}
.dice-result.crit {
    color: #ffd700;
    text-shadow: 0 0 30px rgba(255,215,0,0.8);
}
.dice-result.fail {
    color: #ff4444;
    text-shadow: 0 0 30px rgba(255,68,68,0.8);
}
.dice-breakdown {
    font-size: 13px;
    color: var(--md-on-surface-variant);
    font-family: 'JetBrains Mono', monospace;
}
.dice-breakdown .roll-value {
    color: var(--md-tertiary);
    font-weight: 600;
}
.dice-breakdown .mod-value {
    color: var(--md-primary);
}

@keyframes diceRoll {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

/* Vorteil/Nachteil Toggle */
.dice-adv-row {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
}
.dice-adv-btn {
    flex: 1;
    padding: 10px;
    border-radius: 10px;
    border: 1px solid var(--md-outline-variant);
    background: var(--md-surface-container-high);
    color: var(--md-on-surface);
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}
.dice-adv-btn:hover {
    border-color: var(--md-primary);
}
.dice-adv-btn.active {
    background: var(--md-primary);
    color: var(--md-on-primary);
    border-color: var(--md-primary);
}
.dice-adv-btn.adv.active {
    background: #22aa44;
    border-color: #22aa44;
}
.dice-adv-btn.dis.active {
    background: #cc4444;
    border-color: #cc4444;
}

/* Roll Button */
.dice-roll-btn {
    width: 100%;
    padding: 14px;
    border-radius: 12px;
    border: none;
    background: linear-gradient(135deg, var(--md-primary), var(--md-tertiary));
    color: white;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: all 0.2s ease;
}
.dice-roll-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(var(--md-primary-rgb), 0.4);
}
.dice-roll-btn:active {
    transform: translateY(0);
}
.dice-roll-btn svg {
    width: 20px;
    height: 20px;
}

/* Confetti for crits */
.dice-confetti {
    position: absolute;
    width: 10px;
    height: 10px;
    border-radius: 2px;
    animation: confettiFall 2s ease-out forwards;
}
@keyframes confettiFall {
    0% { transform: translateY(-20px) rotate(0deg); opacity: 1; }
    100% { transform: translateY(200px) rotate(720deg); opacity: 0; }
}

/* ===== WEAPON/CANTRIP PICKER ===== */
.weapon-add-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-top: 12px;
}

.weapon-add-buttons .add-btn {
    margin-top: 0;
    flex: 1;
    min-width: 120px;
}

/* Compact buttons don't grow */
.weapon-add-buttons .add-btn.compact {
    flex: 0 0 auto;
    min-width: auto;
}

/* Primary picker buttons with icons */
.add-btn.picker-btn {
    background: var(--md-primary-container);
    color: var(--md-on-primary-container);
    border: 1px solid var(--md-primary);
    font-weight: 600;
}

.add-btn.picker-btn:hover {
    background: var(--md-primary);
    color: var(--md-on-primary);
}

/* Secondary/tertiary picker buttons */
.add-btn.picker-btn.secondary {
    background: var(--md-tertiary-container);
    color: var(--md-on-tertiary-container);
    border-color: var(--md-tertiary);
}

.add-btn.picker-btn.secondary:hover {
    background: var(--md-tertiary);
    color: var(--md-on-tertiary);
}

.picker-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(4px);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease;
}
.picker-overlay.active {
    opacity: 1;
    pointer-events: auto;
}
.picker-modal {
    background: var(--md-surface-container);
    border-radius: 20px;
    width: 90%;
    max-width: 600px;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    transform: scale(0.9) translateY(20px);
    transition: transform 0.3s ease;
    border: 1px solid var(--md-outline-variant);
}
.picker-overlay.active .picker-modal {
    transform: scale(1) translateY(0);
}
.picker-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    border-bottom: 1px solid var(--md-outline-variant);
}
.picker-header h2 {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
}
.picker-close {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: none;
    background: var(--md-surface-container-highest);
    color: var(--md-on-surface-variant);
    font-size: 22px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}
.picker-close:hover {
    background: var(--md-error-container);
    color: var(--md-error);
}
.picker-search {
    padding: 16px 24px;
    border-bottom: 1px solid var(--md-outline-variant);
}
.picker-search input {
    width: 100%;
    padding: 12px 16px;
    border-radius: 12px;
    border: 1px solid var(--md-outline-variant);
    background: var(--md-surface-container-high);
    color: var(--md-on-surface);
    font-size: 14px;
    box-sizing: border-box;
}
.picker-search input:focus {
    outline: none;
    border-color: var(--md-primary);
}
.picker-filters {
    display: flex;
    gap: 8px;
    margin-top: 12px;
    flex-wrap: wrap;
}
.picker-filter-btn {
    padding: 6px 12px;
    border-radius: 16px;
    border: 1px solid var(--md-outline-variant);
    background: transparent;
    color: var(--md-on-surface-variant);
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
}
.picker-filter-btn:hover,
.picker-filter-btn.active {
    background: var(--md-primary);
    color: var(--md-on-primary);
    border-color: var(--md-primary);
}
.picker-list {
    flex: 1;
    overflow-y: auto;
    padding: 12px;
}
.picker-item {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.15s ease;
    margin-bottom: 4px;
}
.picker-item:hover {
    background: var(--md-surface-container-high);
}
.picker-item-icon {
    font-size: 24px;
    margin-right: 14px;
    width: 32px;
    text-align: center;
}
.picker-svg-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    margin-right: 14px;
}
.picker-svg-icon svg {
    width: 24px;
    height: 24px;
}
.picker-item-info {
    flex: 1;
}
.picker-item-name {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 2px;
}
.picker-item-details {
    font-size: 12px;
    color: var(--md-on-surface-variant);
}
.picker-item-tags {
    display: flex;
    gap: 6px;
    margin-left: auto;
    flex-wrap: wrap;
    justify-content: flex-end;
}
.picker-tag {
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 10px;
    font-weight: 600;
    background: var(--md-surface-container-highest);
    color: var(--md-on-surface-variant);
}
.picker-tag.damage {
    color: #fff;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}
.picker-tag.type, .picker-tag.school {
    background: transparent;
    border: 1.5px solid;
}
.picker-tag.conc {
    background: #ffcc00;
    color: #333;
    font-weight: 700;
}
.picker-tag.ritual {
    background: #cc88ff;
    color: #fff;
}
.picker-category {
    font-size: 11px;
    text-transform: uppercase;
    font-weight: 600;
    color: var(--md-primary);
    padding: 12px 16px 6px;
    letter-spacing: 1px;
}

/* ===== LANGUAGE TOGGLE ===== */
.lang-toggle {
    position: absolute;
    left: 50%;
    transform: translateX(calc(-50% + 140px));
    display: flex;
    gap: 2px;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 6px;
    padding: 2px;
    z-index: 10;
}

.lang-btn {
    padding: 4px 10px;
    border: none;
    background: transparent;
    color: rgba(255, 255, 255, 0.5);
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    border-radius: 4px;
    transition: all 0.2s ease;
}

.lang-btn:hover {
    color: rgba(255, 255, 255, 0.8);
}

.lang-btn.active {
    background: var(--md-primary);
    color: #fff;
}

@media (max-width: 600px) {
    .lang-toggle {
        transform: translateX(calc(-50% + 120px));
    }
    .lang-btn {
        padding: 4px 8px;
        font-size: 11px;
    }
}
    </style>
    <style>
body:not(.auth-ready) .app { opacity: 0; pointer-events: none; }
body:not(.auth-ready) .sheet-container { opacity: 0; pointer-events: none; }
body:not(.auth-ready) main { opacity: 0; pointer-events: none; }
body.auth-ready .app { opacity: 1; transition: opacity 0.15s ease; }
body.auth-ready .sheet-container { opacity: 1; transition: opacity 0.15s ease; }
body.auth-ready main { opacity: 1; transition: opacity 0.15s ease; }



/* ═══════════════════════════════════════════════════════════════
   V2 VISUAL OVERRIDES — Worlds Apart "Dark Royal Gold" Style
   
   Font rules (from WA analysis):
     Cinzel:  ONLY section headers, char name, big display numbers
     Inter:   ALL labels, body text, inputs, buttons
   
   Background hierarchy:
     Page:    #161616  (--bg-dark)
     Cards:   #1e1e1e  (--bg-card)  + 2px border-light frame
     Slots:   #262626  (--bg-slot)  + 1px border
     Inputs:  #262626  (--bg-input) + 1px border
   ═══════════════════════════════════════════════════════════════ */


/* ─────────────────────────────────────────────
   BODY & BASE
   ───────────────────────────────────────────── */

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif !important;
    background: #161616 !important;
}


/* ─────────────────────────────────────────────
   SECTIONS = WA .card FRAME
   2px border, inner double-line, sharp corners
   ───────────────────────────────────────────── */

.section {
    position: relative;
    background: #1e1e1e;
    border: 2px solid rgba(255, 255, 255, 0.14) !important;
    border-radius: 0 !important;
    margin-bottom: 16px;
    overflow: visible;
    box-shadow: none !important;
}

/* Inner double-frame (WA regal frame) */
.section::before {
    content: '';
    position: absolute;
    inset: 3px;
    border: 1px solid rgba(255, 255, 255, 0.04);
    pointer-events: none;
    z-index: 1;
}

/* WA card-corner ornaments (SVG injected via JS) */
.card-corner {
    position: absolute;
    width: 28px;
    height: 28px;
    color: #8a6e2e;
    z-index: 2;
    pointer-events: none;
}

.card-corner svg {
    width: 100%;
    height: 100%;
}

.cc-tl { top: -2px; left: -2px; }
.cc-tr { top: -2px; right: -2px; transform: scaleX(-1); }
.cc-bl { bottom: -2px; left: -2px; transform: scaleY(-1); }
.cc-br { bottom: -2px; right: -2px; transform: scale(-1); }

.section-content {
    position: relative;
    z-index: 2;
}

/* ─── Section Header: WA .card-header style ─── */

.section-header {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px !important;
    height: 45px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    background: transparent !important;
    z-index: 2;
}

/* Gold gradient accent under header (WA signature) */
.section-header::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 15%;
    right: 15%;
    height: 1px;
    background: linear-gradient(90deg, transparent, #8a6e2e, transparent);
}

/* Section title: Cinzel uppercase (ONLY place for Cinzel headers) */
.section-title {
    font-family: 'Cinzel', serif !important;
    font-size: 11px !important;
    font-weight: 700 !important;
    font-style: normal !important;
    text-transform: uppercase;
    letter-spacing: 2px !important;
    color: #888 !important;
}

.section-title svg {
    width: 16px;
    height: 16px;
    opacity: 0.5;
}

.section-toggle {
    color: rgba(255, 255, 255, 0.25);
}


/* ─────────────────────────────────────────────
   HEADER SECTION (character info card)
   Same WA card frame
   ───────────────────────────────────────────── */

.header-section {
    position: relative;
    background: #1e1e1e !important;
    border: 2px solid rgba(255, 255, 255, 0.14) !important;
    border-radius: 0 !important;
    overflow: visible;
}

.header-section::before {
    content: '';
    position: absolute;
    inset: 3px;
    border: 1px solid rgba(255, 255, 255, 0.04);
    pointer-events: none;
    z-index: 1;
}

.header-section::after {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    width: 20px;
    height: 20px;
    border-top: 2px solid #8a6e2e;
    border-left: 2px solid #8a6e2e;
    pointer-events: none;
    z-index: 3;
}

.header-layout,
.header-info,
.header-right,
.header-stats,
.header-meta {
    position: relative;
    z-index: 2;
}


/* ─────────────────────────────────────────────
   CHARACTER NAME — Cinzel (one of the few places)
   ───────────────────────────────────────────── */

.char-name-input {
    font-family: 'Cinzel', serif !important;
    font-size: 24px !important;
    font-weight: 700;
    color: #f0f0f0 !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
}

.char-name-input:focus {
    border-bottom-color: #8a6e2e !important;
}

.char-name-input::placeholder {
    color: #888;
    opacity: 0.5;
}


/* ─────────────────────────────────────────────
   PORTRAIT
   ───────────────────────────────────────────── */

.portrait-box {
    border: 2px solid rgba(255, 255, 255, 0.08) !important;
    border-radius: 4px !important;
    background: #262626 !important;
}

.portrait-box:hover {
    border-color: #8a6e2e !important;
}


/* ─────────────────────────────────────────────
   META CHIPS — Inter labels (NOT Cinzel!)
   ───────────────────────────────────────────── */

.meta-chip {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
}

.meta-chip label {
    font-family: 'Inter', sans-serif !important;
    font-size: 9px !important;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #8a6e2e !important;
}

.meta-chip input,
.meta-chip select {
    font-family: 'Inter', sans-serif !important;
    color: #dedede;
}


/* ─────────────────────────────────────────────
   STAT BOXES (Initiative, Speed, Passive, etc.)
   ───────────────────────────────────────────── */

.stat-box {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 4px !important;
}

.stat-label {
    font-family: 'Inter', sans-serif !important;
    font-size: 9px !important;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #888 !important;
}

.stat-value {
    background: #1e1e1e !important;
    border-radius: 4px !important;
    font-family: 'Inter', sans-serif;
}

/* Computed display values: Cinzel for big numbers */
.stat-value.stat-computed {
    font-family: 'Cinzel', serif;
    font-weight: 700;
}

.stat-hint {
    font-family: 'Inter', sans-serif !important;
    font-size: 8px !important;
    color: #8a6e2e !important;
}

/* Heroic Inspiration: Gold */
.heroic-btn {
    border-color: rgba(255, 255, 255, 0.08) !important;
}
.heroic-btn:hover {
    border-color: #d4a844 !important;
}
.heroic-btn.active {
    background: #d4a844 !important;
    border-color: #d4a844 !important;
}

@keyframes heroic-pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(212, 168, 68, 0.4); }
    50% { box-shadow: 0 0 12px 4px rgba(212, 168, 68, 0.25); }
}


/* ─────────────────────────────────────────────
   ABILITY CARDS
   ───────────────────────────────────────────── */

.ability-card {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08) !important;
    border-radius: 4px !important;
}

/* Ability name label — Inter, NOT Cinzel */
.ability-name {
    font-family: 'Inter', sans-serif !important;
    font-size: 10px !important;
    font-weight: 600;
    letter-spacing: 0.5px;
    color: #888 !important;
}

/* Mod circle: Gold gradient */
.ability-mod {
    background: linear-gradient(145deg, #c49a38, #d4a844) !important;
    box-shadow: 0 2px 8px rgba(212, 168, 68, 0.2);
}

.ability-mod-value {
    font-family: 'Cinzel', serif !important;
    color: #1a1610 !important;
}

.ability-score-box {
    background: #1e1e1e !important;
}

.ability-score-input {
    background: #262626 !important;
    font-family: 'Inter', sans-serif;
}

.ability-score-label {
    font-family: 'Inter', sans-serif !important;
    font-size: 7px;
    letter-spacing: 0.3px;
}

/* Save rows */
.save-row {
    background: rgba(0, 0, 0, 0.15) !important;
}

.save-label {
    font-family: 'Inter', sans-serif !important;
}

.save-val {
    background: #262626 !important;
    font-family: 'Inter', sans-serif;
}

/* Proficiency checkboxes: Gold */
.prof-check:checked,
.skill-item input[type="checkbox"].prof-check-skill:checked,
.skill-item .expertise-check:checked {
    background: #d4a844 !important;
    border-color: #d4a844 !important;
}

.prof-check:hover,
.skill-item input[type="checkbox"]:hover {
    border-color: #8a6e2e !important;
}

/* Skill items */
.skill-name {
    font-family: 'Inter', sans-serif !important;
    font-size: 11px;
}

.skill-val {
    background: #262626 !important;
    font-family: 'Inter', sans-serif;
}


/* ─────────────────────────────────────────────
   COMBAT / ARMOR
   ───────────────────────────────────────────── */

.ac-shield {
    background: linear-gradient(180deg, #262626, #1e1e1e) !important;
    border: 1px solid rgba(255, 255, 255, 0.14);
}

.ac-shield::before {
    border-color: #8a6e2e !important;
    opacity: 0.4 !important;
}

.ac-shield-value {
    font-family: 'Cinzel', serif !important;
    color: #f0f0f0 !important;
}

.ac-shield-label {
    font-family: 'Inter', sans-serif !important;
    font-size: 9px !important;
    font-weight: 700;
    letter-spacing: 1px;
    color: #8a6e2e !important;
}

.armor-stat-box {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 4px !important;
}

.armor-stat-label {
    font-family: 'Inter', sans-serif !important;
    font-size: 9px !important;
    font-weight: 600;
    letter-spacing: 0.5px;
    color: #888 !important;
    text-transform: uppercase;
}

.armor-stat-value {
    background: #1e1e1e !important;
    font-family: 'Cinzel', serif;
    border-radius: 4px !important;
}

.armor-stat-input {
    background: #1e1e1e !important;
    font-family: 'Inter', sans-serif;
    border-radius: 4px !important;
}

.armor-stat-slash {
    color: #888;
}

/* Death pips */
.death-pip {
    border-color: rgba(255, 255, 255, 0.08) !important;
}
.death-pip:hover {
    border-color: #d4a844 !important;
}
.death-pip.success.active { background: #27ae60; border-color: #27ae60; }
.death-pip.fail.active { background: #c0392b; border-color: #c0392b; }

/* Mini/death/exhaustion labels */
.mini-label,
.death-label {
    font-family: 'Inter', sans-serif !important;
}

.exhaustion-input,
.exhaustion-input-box {
    background: #1e1e1e !important;
    font-family: 'Inter', sans-serif;
    border-radius: 4px !important;
}

.exhaustion-penalty,
.exhaustion-penalty-box {
    color: #c0392b !important;
}

/* Dice input */
.dice-death-block {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 4px !important;
}

.dice-input {
    background: #1e1e1e !important;
    font-family: 'Inter', sans-serif;
    border-radius: 4px !important;
}

/* HP block */
.hp-block,
.ac-block {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 4px !important;
}

.hp-label {
    font-family: 'Inter', sans-serif !important;
    font-size: 9px !important;
    font-weight: 600;
    letter-spacing: 0.5px;
    color: #888 !important;
}

.hp-input {
    background: #1e1e1e !important;
    font-family: 'Cinzel', serif;
    border-radius: 4px !important;
}

/* Defenses */
.defenses-row .defense-item {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 4px !important;
}

.defense-label {
    font-family: 'Inter', sans-serif !important;
    font-size: 9px !important;
    font-weight: 600;
    letter-spacing: 0.5px;
    color: #888 !important;
    text-transform: uppercase;
}

.defense-item input {
    background: #1e1e1e !important;
    border: 1px solid rgba(255, 255, 255, 0.08) !important;
    border-radius: 4px !important;
    font-family: 'Inter', sans-serif;
}


/* ─────────────────────────────────────────────
   REST BUTTONS & CONDITIONS
   ───────────────────────────────────────────── */

.rest-btn {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.14) !important;
    border-radius: 4px !important;
    font-family: 'Inter', sans-serif !important;
}

.rest-btn.short-rest {
    border-color: #2980b9 !important;
}
.rest-btn.long-rest {
    border-color: #8a6e2e !important;
}

.conditions-label {
    font-family: 'Inter', sans-serif !important;
    font-size: 10px !important;
    font-weight: 600;
    letter-spacing: 0.5px;
    color: #888 !important;
}

.condition-chip {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08) !important;
    border-radius: 4px !important;
    font-family: 'Inter', sans-serif;
}

.condition-chip.active {
    background: rgba(192, 57, 43, 0.1) !important;
    border-color: #c0392b !important;
}


/* ─────────────────────────────────────────────
   WEAPONS
   ───────────────────────────────────────────── */

.weapon-input {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08) !important;
    border-radius: 4px !important;
    font-family: 'Inter', sans-serif !important;
}

.weapon-input:focus {
    border-color: #8a6e2e !important;
    outline: none !important;
}


/* ─────────────────────────────────────────────
   CLASS RESOURCES
   ───────────────────────────────────────────── */

.resource-row {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 4px !important;
}

.resource-name {
    font-family: 'Inter', sans-serif !important;
}

.resource-input {
    background: #1e1e1e !important;
    font-family: 'Inter', sans-serif;
    border-radius: 4px !important;
}


/* ─────────────────────────────────────────────
   ADD BUTTONS
   ───────────────────────────────────────────── */

.add-btn {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.14) !important;
    border-radius: 4px !important;
    font-family: 'Inter', sans-serif !important;
    font-size: 11px;
    color: #888 !important;
}

.add-btn:hover {
    border-color: #8a6e2e !important;
    color: #d4a844 !important;
    background: rgba(212, 168, 68, 0.04) !important;
}

.add-btn.picker-btn {
    background: rgba(212, 168, 68, 0.04) !important;
    color: #d4a844 !important;
    border: 1px solid #8a6e2e !important;
}

.add-btn.picker-btn:hover {
    background: rgba(212, 168, 68, 0.08) !important;
    border-color: #d4a844 !important;
}

.add-btn.dashed {
    background: transparent !important;
    border-style: dashed !important;
}


/* ─────────────────────────────────────────────
   TEXT AREAS & FIELD INPUTS
   ───────────────────────────────────────────── */

.text-area {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08) !important;
    border-radius: 4px !important;
    font-family: 'Inter', sans-serif !important;
}

.text-area:focus {
    border-color: #8a6e2e !important;
    outline: none !important;
}

.field-label {
    font-family: 'Inter', sans-serif !important;
    font-size: 10px !important;
    font-weight: 600;
    letter-spacing: 0.5px;
    color: #888 !important;
}

.field-input {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08) !important;
    border-radius: 4px !important;
    font-family: 'Inter', sans-serif !important;
}

.field-input:focus {
    border-color: #8a6e2e !important;
    outline: none !important;
}


/* ─────────────────────────────────────────────
   TRAINING
   ───────────────────────────────────────────── */

.training-group {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 4px !important;
}

.training-label {
    font-family: 'Inter', sans-serif !important;
    font-size: 10px !important;
    font-weight: 600;
    letter-spacing: 0.5px;
    color: #888 !important;
}

.training-item {
    font-family: 'Inter', sans-serif !important;
}

.training-item input:checked {
    background: #d4a844 !important;
    border-color: #d4a844 !important;
}


/* ─────────────────────────────────────────────
   SPELLCASTING
   ───────────────────────────────────────────── */

.spell-stat {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 4px !important;
}

.spell-stat-label {
    font-family: 'Inter', sans-serif !important;
    font-size: 9px !important;
    font-weight: 600;
    letter-spacing: 0.5px;
    color: #888 !important;
}

.spell-stat-value {
    font-family: 'Cinzel', serif;
}

.spell-stat-select {
    background: #1e1e1e !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    font-family: 'Inter', sans-serif;
    border-radius: 4px !important;
}

/* Slot cards */
.slot-card {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 4px !important;
}

.slot-level {
    font-family: 'Inter', sans-serif !important;
    font-size: 12px !important;
    font-weight: 700;
    letter-spacing: 0.5px;
}

.slot-pip.available {
    border-color: #d4a844 !important;
    color: #d4a844 !important;
}

.slot-available {
    color: #d4a844 !important;
}

.slot-total-input {
    background: #1e1e1e !important;
    border-radius: 4px !important;
}

/* Pact Slots */
.pact-slots-section {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 4px !important;
}

.pact-label {
    font-family: 'Inter', sans-serif !important;
}

.pact-input {
    background: #1e1e1e !important;
    border-radius: 4px !important;
}

/* Spell rows */
.spell-level-badge {
    font-family: 'Cinzel', serif;
    background: #d4a844 !important;
    color: #1a1610 !important;
    border-radius: 4px !important;
}

.spell-level-badge.cantrip {
    background: #8a6e2e !important;
    color: #f0f0f0 !important;
}

.spell-name-display {
    font-family: 'Inter', sans-serif !important;
}

.spell-input {
    font-family: 'Inter', sans-serif !important;
    border-radius: 4px !important;
}

/* Concentration */
.concentration-banner {
    background: rgba(212, 168, 68, 0.06) !important;
    border: 1px solid rgba(212, 168, 68, 0.2) !important;
    border-radius: 4px !important;
}

.concentration-banner .conc-spell {
    color: #d4a844 !important;
}

.spell-cast-toast {
    background: linear-gradient(135deg, #c49a38, #d4a844) !important;
    color: #1a1610 !important;
    border-radius: 4px !important;
}


/* ─────────────────────────────────────────────
   EQUIPMENT / NOTES / COINS
   ───────────────────────────────────────────── */

.physical-grid {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 4px !important;
}

.phys-input {
    background: #1e1e1e !important;
    border: 1px solid rgba(255, 255, 255, 0.08) !important;
    border-radius: 4px !important;
    font-family: 'Inter', sans-serif !important;
}

.phys-input:focus {
    border-color: #8a6e2e !important;
    outline: none !important;
}

.coin {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 4px !important;
}

.coin.coin-primary {
    border-color: rgba(212, 168, 68, 0.15);
}

.coin-input {
    background: #1e1e1e !important;
    font-family: 'Inter', sans-serif;
    border-radius: 4px !important;
}

.coin-label {
    font-family: 'Inter', sans-serif !important;
}

.attunement-slots {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 4px !important;
}

.attunement-slot {
    border-color: rgba(255, 255, 255, 0.14) !important;
    background: #1e1e1e !important;
    border-radius: 6px !important;
}

.attunement-slot.active {
    background: #8a6e2e !important;
    border-color: #d4a844 !important;
}


/* ─────────────────────────────────────────────
   REFERENCE CARDS
   ───────────────────────────────────────────── */

.ref-card {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 4px !important;
}

.ref-title {
    color: #d4a844 !important;
    font-family: 'Inter', sans-serif !important;
    font-size: 11px !important;
    font-weight: 700;
    letter-spacing: 0.5px;
}

.ref-formula {
    background: #1e1e1e !important;
    font-family: 'Inter', sans-serif;
    border-radius: 4px !important;
}

.ref-table span {
    background: #1e1e1e !important;
    font-family: 'Inter', sans-serif;
}


/* ─────────────────────────────────────────────
   MANAGE BUTTONS
   ───────────────────────────────────────────── */

.manage-btn {
    background: #d4a844 !important;
    color: #1a1610 !important;
    border-radius: 4px !important;
    font-family: 'Inter', sans-serif !important;
    font-size: 13px !important;
    font-weight: 600;
}

.manage-btn:hover {
    background: #c49a38 !important;
    transform: translateY(-1px);
}

.manage-btn.danger {
    background: #c0392b !important;
    color: #fff !important;
}


/* ─────────────────────────────────────────────
   RULES NOTICE
   ───────────────────────────────────────────── */

.rules-notice {
    background: #262626 !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 4px !important;
}

.rules-notice a,
.rules-link {
    color: #d4a844 !important;
}


/* ─────────────────────────────────────────────
   TOOLTIP / HELP
   ───────────────────────────────────────────── */

.tooltip-popup {
    border-radius: 4px !important;
    font-family: 'Inter', sans-serif;
}

.tooltip-popup h4 {
    font-family: 'Inter', sans-serif;
    color: #d4a844 !important;
}

.help-icon:hover {
    background: #d4a844 !important;
}


/* ─────────────────────────────────────────────
   WIZARD & PICKER MODALS
   ───────────────────────────────────────────── */

.wizard-modal,
.picker-modal {
    background: #1e1e1e !important;
    border: 1px solid rgba(255, 255, 255, 0.14) !important;
    border-radius: 8px !important;
}

.wizard-header h2 {
    font-family: 'Inter', sans-serif;
}

.wizard-btn {
    font-family: 'Inter', sans-serif !important;
    border-radius: 4px !important;
}

.wizard-btn-next {
    background: #d4a844 !important;
    color: #1a1610 !important;
}

.wizard-btn-next:hover {
    background: #c49a38 !important;
}

.wizard-option {
    border-radius: 4px !important;
    font-family: 'Inter', sans-serif;
}

.wizard-option.selected {
    border-color: #d4a844 !important;
    background: rgba(212, 168, 68, 0.04) !important;
}

.wizard-progress-step.done {
    background: #d4a844 !important;
}

.wizard-input-group label {
    font-family: 'Inter', sans-serif !important;
}

.wizard-input-group input,
.wizard-input-group select {
    font-family: 'Inter', sans-serif !important;
    border-radius: 4px !important;
}

.quickstart-btn {
    background: linear-gradient(135deg, #d4a844, #c49a38) !important;
    color: #1a1610 !important;
    border-radius: 4px !important;
    font-family: 'Inter', sans-serif !important;
}

.template-card {
    border-radius: 4px !important;
}

.template-card:hover {
    border-color: #d4a844 !important;
}

.picker-header h2 {
    font-family: 'Inter', sans-serif;
}

.picker-close {
    border-radius: 4px !important;
}

.picker-search input {
    font-family: 'Inter', sans-serif !important;
    border-radius: 4px !important;
}

.picker-filter-btn {
    font-family: 'Inter', sans-serif;
    border-radius: 4px !important;
}

.picker-filter-btn:hover,
.picker-filter-btn.active {
    background: #d4a844 !important;
    color: #1a1610 !important;
    border-color: #d4a844 !important;
}

.picker-item-name {
    font-family: 'Inter', sans-serif;
}

.picker-item-details {
    font-family: 'Inter', sans-serif;
}


/* ─────────────────────────────────────────────
   MULTICLASS
   ───────────────────────────────────────────── */

.multiclass-row select,
.multiclass-row input {
    font-family: 'Inter', sans-serif !important;
    border-radius: 4px !important;
}


/* ─────────────────────────────────────────────
   CLICKABLE VALUES — Gold hover
   ───────────────────────────────────────────── */

.stat-computed.clickable:hover,
.skill-computed.clickable:hover,
.save-computed.clickable:hover {
    background: #d4a844 !important;
    color: #1a1610 !important;
}


/* ─────────────────────────────────────────────
   FOCUS STATES — Gold ring globally
   ───────────────────────────────────────────── */

.armor-stat-value:focus,
.armor-stat-input:focus,
.exhaustion-input:focus,
.exhaustion-input-box:focus,
.dice-input:focus,
.resource-input:focus,
.pact-input:focus,
.slot-total-input:focus,
.spell-stat-select:focus,
.spell-input:focus,
.ability-score-input:focus,
.stat-value:focus,
.skill-val:focus,
.save-val:focus,
.coin-input:focus,
.shield-input:focus,
.hp-input:focus {
    outline: none !important;
    border-color: #8a6e2e !important;
    box-shadow: 0 0 0 1px rgba(212, 168, 68, 0.15) !important;
}


/* ─────────────────────────────────────────────
   GM ELEMENTS
   ───────────────────────────────────────────── */

.gm-banner {
    border-color: #d4a844 !important;
    border-radius: 4px !important;
}

.gm-coins-box {
    background: rgba(212, 168, 68, 0.04) !important;
    border-color: rgba(212, 168, 68, 0.15) !important;
    border-radius: 4px !important;
}

.gm-coins-hint {
    color: rgba(212, 168, 68, 0.5) !important;
}

.player-bar {
    border-radius: 4px !important;
}

.player-tab {
    border-radius: 4px !important;
    font-family: 'Inter', sans-serif;
}


/* ─────────────────────────────────────────────
   SETTINGS
   ───────────────────────────────────────────── */

.settings-option-title {
    font-family: 'Inter', sans-serif;
}

.settings-option-desc {
    font-family: 'Inter', sans-serif;
}

.settings-toggle input:checked + .settings-toggle-slider {
    background: #d4a844 !important;
}


/* ─────────────────────────────────────────────
   MISC REMAINING RADIUS FIXES
   ───────────────────────────────────────────── */

.crop-modal {
    border-radius: 8px !important;
}

.portrait-gallery-content {
    border-radius: 8px !important;
}

.portrait-gallery-item {
    border-radius: 4px !important;
}

.portrait-gallery-item:hover {
    border-color: #d4a844 !important;
}

.rules-popup {
    border-radius: 8px !important;
}

.new-char-btn {
    border-radius: 4px !important;
    font-family: 'Inter', sans-serif !important;
}

.new-char-btn.primary {
    background: #d4a844 !important;
    color: #1a1610 !important;
    border-color: #d4a844 !important;
}

.section-hide-btn {
    font-family: 'Inter', sans-serif;
}

.action-btn {
    font-family: 'Inter', sans-serif !important;
}


/* ─────────────────────────────────────────────
   SCROLLBAR
   ───────────────────────────────────────────── */

::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(212, 168, 68, 0.12); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: rgba(212, 168, 68, 0.25); }


/* ─────────────────────────────────────────────
   PRINT
   ───────────────────────────────────────────── */

@media print {
    .section::before,
    .section::after,
    .header-section::before,
    .header-section::after,
    .section-header::after { display: none; }
}


/* ═══════════════════════════════════════════════════════════════
   QoL FEATURES — Combat Mode, Spell Cards, HP Flash, Rest Summary
   ═══════════════════════════════════════════════════════════════ */


/* ─── COMBAT MODE TOGGLE ─────────────────── */

.qol-combat-toggle {
    position: fixed;
    bottom: calc(var(--dock-height, 72px) + 12px);
    right: 16px;
    z-index: 999;
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 14px;
    background: #262626;
    border: 1px solid rgba(255, 255, 255, 0.14);
    border-radius: 4px;
    color: #888;
    cursor: pointer;
    font-family: 'Inter', sans-serif;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.3px;
    transition: all 0.15s ease;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.4);
}

.qol-combat-toggle svg {
    flex-shrink: 0;
}

.qol-combat-toggle:hover {
    border-color: #8a6e2e;
    color: #d4a844;
}

.qol-combat-toggle.active {
    background: #d4a844;
    border-color: #d4a844;
    color: #1a1610;
}

.qol-combat-toggle.active:hover {
    background: #c49a38;
}


/* ─── COMBAT MODE: Hide non-combat ───────── */

body.combat-mode .section[data-section="start"],
body.combat-mode .section[data-section="abilities"],
body.combat-mode .section[data-section="features"],
body.combat-mode .section[data-section="training"],
body.combat-mode .section[data-section="species"],
body.combat-mode .section[data-section="equipment"],
body.combat-mode .section[data-section="reference"],
body.combat-mode .section[data-section="rules"] {
    display: none !important;
}

body.combat-mode .header-section .portrait-box {
    display: none;
}

/* Gold line at top in combat mode */
body.combat-mode::after {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, #d4a844, transparent);
    z-index: 9999;
    pointer-events: none;
    animation: combatPulse 3s ease-in-out infinite;
}

@keyframes combatPulse {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 1; }
}


/* ─── INLINE SPELL CARDS ─────────────────── */

.spell-card-inline {
    background: #1e1e1e;
    border: 1px solid rgba(212, 168, 68, 0.12);
    border-top: none;
    border-radius: 0 0 4px 4px;
    padding: 0 16px;
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transition: max-height 0.3s ease, opacity 0.2s ease, padding 0.3s ease;
}

.spell-card-inline.open {
    max-height: 500px;
    opacity: 1;
    padding: 14px 16px;
}

.spell-card-inline.closing {
    max-height: 0 !important;
    opacity: 0 !important;
    padding: 0 16px !important;
}

.spell-row.spell-card-open {
    border-color: rgba(212, 168, 68, 0.15) !important;
    background: rgba(212, 168, 68, 0.02) !important;
}

.sc-head {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
}

.sc-name {
    font-family: 'Cinzel', serif;
    font-size: 15px;
    font-weight: 700;
    color: #f0f0f0;
}

.sc-sub {
    font-family: 'Inter', sans-serif;
    font-size: 10px;
    color: #8a6e2e;
    margin-top: 2px;
}

.sc-close {
    background: none;
    border: none;
    color: #666;
    cursor: pointer;
    padding: 2px;
    transition: color 0.15s;
    flex-shrink: 0;
}

.sc-close:hover {
    color: #d4a844;
}

.sc-meta {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    padding: 10px 12px;
    background: #262626;
    border: 1px solid rgba(255, 255, 255, 0.04);
    border-radius: 4px;
    margin-bottom: 10px;
}

.sc-ml {
    display: block;
    font-family: 'Inter', sans-serif;
    font-size: 8px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #555;
    margin-bottom: 2px;
}

.sc-mv {
    font-family: 'Inter', sans-serif;
    font-size: 11px;
    color: #ccc;
}

.sc-desc {
    font-family: 'Inter', sans-serif;
    font-size: 12px;
    line-height: 1.6;
    color: #aaa;
}

.sc-higher {
    margin-top: 8px;
    padding: 8px 12px;
    background: rgba(212, 168, 68, 0.03);
    border: 1px solid rgba(212, 168, 68, 0.08);
    border-radius: 4px;
    font-family: 'Inter', sans-serif;
    font-size: 11px;
    line-height: 1.5;
    color: #aaa;
}

.sc-hl {
    display: block;
    font-weight: 700;
    color: #d4a844;
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 3px;
}


/* ─── HP FLASH ───────────────────────────── */

@keyframes hpFlashDamage {
    0% { box-shadow: inset 0 0 0 0 rgba(192, 57, 43, 0); }
    30% { box-shadow: inset 0 0 20px 2px rgba(192, 57, 43, 0.3); }
    100% { box-shadow: inset 0 0 0 0 rgba(192, 57, 43, 0); }
}

@keyframes hpFlashHeal {
    0% { box-shadow: inset 0 0 0 0 rgba(39, 174, 96, 0); }
    30% { box-shadow: inset 0 0 20px 2px rgba(39, 174, 96, 0.3); }
    100% { box-shadow: inset 0 0 0 0 rgba(39, 174, 96, 0); }
}

.hp-flash-damage { animation: hpFlashDamage 0.6s ease-out !important; }
.hp-flash-heal { animation: hpFlashHeal 0.6s ease-out !important; }


/* ─── REST SUMMARY POPUP ─────────────────── */

.qol-rest-summary {
    position: fixed;
    bottom: calc(var(--dock-height, 72px) + 12px);
    left: 50%;
    transform: translateX(-50%) translateY(10px);
    z-index: 10000;
    background: #1e1e1e;
    border: 1px solid rgba(212, 168, 68, 0.15);
    border-radius: 4px;
    padding: 12px 16px;
    min-width: 220px;
    max-width: 340px;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.5);
    opacity: 0;
    transition: all 0.3s ease;
    pointer-events: none;
}

.qol-rest-summary.visible {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
}

.qol-rs-head {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #d4a844;
    font-family: 'Inter', sans-serif;
    font-size: 12px;
    font-weight: 700;
    margin-bottom: 8px;
    padding-bottom: 6px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
}

.qol-rs-head svg {
    color: #d4a844;
    flex-shrink: 0;
}

.qol-rs-item {
    font-family: 'Inter', sans-serif;
    font-size: 11px;
    color: #ccc;
    padding: 3px 0;
    padding-left: 12px;
    position: relative;
}

.qol-rs-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 4px;
    background: #27ae60;
    border-radius: 50%;
}


/* ─── MOBILE ─────────────────────────────── */

@media (max-width: 768px) {
    .qol-combat-toggle {
        bottom: calc(var(--dock-height, 72px) + 8px);
        right: 10px;
        padding: 6px 10px;
        font-size: 10px;
    }

    .sc-meta {
        grid-template-columns: 1fr 1fr;
    }
}
