<!DOCTYPE html>
<html lang="de">
<head>
    <link rel="icon" type="image/svg+xml" href="/assets/icons/icon_rift_r.svg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="view-transition" content="same-origin">
    <meta name="description" content="RIFT - Real-time Interactive Fiction Tabletop">
    <meta name="theme-color" content="#0a0a0c">
    <title>RIFT — Tabletop Companion</title>
    
    <link rel="stylesheet" href="assets/css/core.css">
    <link rel="stylesheet" href="assets/css/login.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="assets/js/firebase-config.js"></script>
    <script src="assets/js/room-service.js"></script>
    <script src="assets/js/user-service.js"></script>
    <script src="assets/js/pro-status.js"></script>
</head>
<body>

    <!-- ============================================================
         WELCOME — Scrollable Landing Page
         ============================================================ -->
    <div id="step-welcome" class="login-step active">

        <!-- Background Canvas -->
        <div class="bg">
            <div class="bg__gradient bg__gradient--1"></div>
            <div class="bg__gradient bg__gradient--2"></div>
            <div class="bg__gradient bg__gradient--3"></div>
            <div class="bg__noise"></div>
        </div>

        <!-- Top Navigation -->
        <nav class="nav">
            <div class="nav__left">
                <img src="assets/img/logo_rift.png" alt="RIFT" class="nav__logo">
            </div>
            <div class="nav__right">
                <a href="about.html" class="nav__link" data-i18n="nav.about">Über RIFT</a>
                <div class="lang-toggle">
                    <button class="lang-toggle__btn active" data-lang="de">DE</button>
                    <button class="lang-toggle__btn" data-lang="en">EN</button>
                </div>
            </div>
        </nav>

        <!-- SECTION 1: Hero -->
        <section class="hero">
            <div class="hero__content" data-reveal>
                <div class="hero__badge" data-i18n="hero.badge">Kostenlos & Open Source</div>
                <h1 class="hero__h1">
                    <span class="hero__h1-line" data-i18n="hero.line1">Pen & Paper.</span>
                    <span class="hero__h1-line hero__h1-line--accent" data-i18n="hero.line2">Ohne Grenzen.</span>
                </h1>
                <p class="hero__sub" data-i18n="hero.sub">RIFT ist dein digitaler Spieltisch — mit 3D-Würfeln, Echtzeit-Synchronisation, Charakterbögen für jedes Regelwerk und allem was deine Runde braucht. Direkt im Browser, kein Download nötig.</p>
                
                <div class="hero__cta">
                    <button id="btn-create-room" class="cta cta--primary">
                        <span class="cta__icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        </span>
                        <span class="cta__text">
                            <span class="cta__title" data-i18n="cta.create">Raum erstellen</span>
                            <span class="cta__desc" data-i18n="cta.create.desc">Als Spielleiter starten</span>
                        </span>
                    </button>
                    <button id="btn-join-room" class="cta cta--secondary">
                        <span class="cta__icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
                        </span>
                        <span class="cta__text">
                            <span class="cta__title" data-i18n="cta.join">Raum beitreten</span>
                            <span class="cta__desc" data-i18n="cta.join.desc">Mit Code einsteigen</span>
                        </span>
                    </button>
                </div>

                <button id="btn-solo-mode" class="hero__solo">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    <span data-i18n="cta.solo">Solo Modus — Direkt zu deinen Charakteren</span>
                    <svg class="hero__solo-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
                </button>
            </div>
            
            <div class="hero__scroll">
                <span data-i18n="hero.scroll">Mehr erfahren</span>
                <div class="hero__scroll-line"></div>
            </div>
        </section>

        <!-- SECTION 2: Features -->
        <section class="features">
            <div class="features__inner">
                <div class="section-header" data-reveal>
                    <span class="section-header__tag" data-i18n="features.tag">Features</span>
                    <h2 class="section-header__title" data-i18n="features.title">Alles für deine Runde</h2>
                    <p class="section-header__sub" data-i18n="features.sub">Kein Tab-Wechsel, kein App-Chaos. Alles an einem Ort.</p>
                </div>

                <div class="feature-grid">
                    <div class="feature-card" data-reveal data-delay="0">
                        <div class="feature-card__icon feature-card__icon--red">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="2" width="20" height="20" rx="4"/><circle cx="8" cy="8" r="1.5" fill="currentColor" stroke="none"/><circle cx="16" cy="16" r="1.5" fill="currentColor" stroke="none"/><circle cx="16" cy="8" r="1.5" fill="currentColor" stroke="none"/><circle cx="8" cy="16" r="1.5" fill="currentColor" stroke="none"/><circle cx="12" cy="12" r="1.5" fill="currentColor" stroke="none"/></svg>
                        </div>
                        <h3 class="feature-card__title" data-i18n="f.dice.title">3D Würfel-Engine</h3>
                        <p class="feature-card__desc" data-i18n="f.dice.desc">Physik-basierte Würfel mit echten Animationen. W4 bis W100, Modifikatoren, History — alles synchron für jeden Spieler.</p>
                    </div>

                    <div class="feature-card" data-reveal data-delay="1">
                        <div class="feature-card__icon feature-card__icon--purple">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                        </div>
                        <h3 class="feature-card__title" data-i18n="f.sheets.title">Digitale Charakterbögen</h3>
                        <p class="feature-card__desc" data-i18n="f.sheets.desc">Vier Regelwerke, automatische Berechnungen, PDF-Export. Erstelle, bearbeite und verwalte alle deine Charaktere.</p>
                    </div>

                    <div class="feature-card" data-reveal data-delay="2">
                        <div class="feature-card__icon feature-card__icon--blue">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                        </div>
                        <h3 class="feature-card__title" data-i18n="f.mp.title">Echtzeit Multiplayer</h3>
                        <p class="feature-card__desc" data-i18n="f.mp.desc">GM-Kontrollzentrum, Spielerverwaltung, Session-Management. Jeder sieht alles live — egal wo er sitzt.</p>
                    </div>

                    <div class="feature-card" data-reveal data-delay="3">
                        <div class="feature-card__icon feature-card__icon--amber">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>
                        </div>
                        <h3 class="feature-card__title" data-i18n="f.maps.title">Karten & Whiteboard</h3>
                        <p class="feature-card__desc" data-i18n="f.maps.desc">Battle Maps hochladen, Tokens setzen, live auf dem Whiteboard zeichnen. Kollaborativ in Echtzeit.</p>
                    </div>

                    <div class="feature-card" data-reveal data-delay="4">
                        <div class="feature-card__icon feature-card__icon--green">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                        </div>
                        <h3 class="feature-card__title" data-i18n="f.chat.title">Chat & Medien</h3>
                        <p class="feature-card__desc" data-i18n="f.chat.desc">Text, Bilder, GIFs, YouTube-Embeds, Flüsternachrichten. Alles was eine Session lebendig macht.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: Systems -->
        <section class="systems">
            <div class="systems__inner" data-reveal>
                <span class="section-header__tag" data-i18n="systems.tag">Regelwerke</span>
                <h2 class="section-header__title section-header__title--sm" data-i18n="systems.title">Spiele was du willst</h2>
                <div class="systems__grid">
                    <div class="system-badge">
                        <img src="assets/icons/icon_5e2024.png" alt="D&D 5e" class="system-badge__icon">
                        <span class="system-badge__name">D&D 5e</span>
                        <span class="system-badge__sub">2024</span>
                    </div>
                    <div class="system-badge">
                        <img src="assets/icons/icon_worldsapart.png" alt="Worlds Apart" class="system-badge__icon">
                        <span class="system-badge__name">Worlds Apart</span>
                    </div>
                    <div class="system-badge">
                        <img src="assets/icons/icon_htbah.png" alt="HTBAH" class="system-badge__icon">
                        <span class="system-badge__name">How To Be A Hero</span>
                    </div>
                    <div class="system-badge">
                        <img src="assets/icons/icon_character.png" alt="Cyberpunk" class="system-badge__icon">
                        <span class="system-badge__name">Cyberpunk RED</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 4: Final CTA -->
        <section class="final-cta">
            <div class="final-cta__inner" data-reveal>
                <h2 class="final-cta__title" data-i18n="final.title">Bereit für dein nächstes Abenteuer?</h2>
                <p class="final-cta__sub" data-i18n="final.sub">Keine Registrierung nötig. Raum erstellen, Code teilen, losspielen.</p>
                <div class="final-cta__buttons">
                    <button class="cta cta--primary cta--lg" onclick="document.getElementById('btn-create-room').click()">
                        <span class="cta__icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></span>
                        <span class="cta__title" data-i18n="cta.create">Raum erstellen</span>
                    </button>
                    <button class="cta cta--ghost cta--lg" onclick="document.getElementById('btn-join-room').click()">
                        <span class="cta__title" data-i18n="cta.join">Raum beitreten</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="site-footer">
            <div class="site-footer__inner">
                <div class="site-footer__links">
                    <a href="about.html" data-i18n="nav.about">Über RIFT</a>
                    <a href="privacy.html" data-i18n="nav.privacy">Datenschutz</a>
                    <a href="imprint.html" data-i18n="nav.imprint">Impressum</a>
                </div>
                <span class="site-footer__copy">© 2025 RIFT</span>
            </div>
        </footer>

        <!-- Sticky CTA Bar (appears on scroll) -->
        <div class="sticky-bar" id="stickyBar">
            <button class="sticky-bar__btn sticky-bar__btn--primary" onclick="document.getElementById('btn-create-room').click()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                <span data-i18n="cta.create">Raum erstellen</span>
            </button>
            <button class="sticky-bar__btn sticky-bar__btn--secondary" onclick="document.getElementById('btn-join-room').click()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
                <span data-i18n="cta.join">Beitreten</span>
            </button>
        </div>
    </div>

    <!-- Resume Session Banner -->
    <div class="resume-banner" id="resumeBanner">
        <div class="resume-banner__icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        </div>
        <div class="resume-banner__text">
            <div class="resume-banner__title" data-i18n="resume.title">Letzte Session gefunden</div>
            <div class="resume-banner__subtitle" id="resumeInfo">Raum: XXX-XXX</div>
        </div>
        <div class="resume-banner__actions">
            <button class="resume-banner__btn resume-banner__btn--secondary" id="btnResumeDismiss" data-i18n="resume.dismiss">Verwerfen</button>
            <button class="resume-banner__btn resume-banner__btn--primary" id="btnResumeJoin" data-i18n="resume.continue">Fortsetzen</button>
        </div>
    </div>

    <!-- ============================================================
         MODAL STEPS (Create / Join / Solo / Setup)
         ============================================================ -->

    <!-- STEP: Create Room -->
    <div id="step-create" class="login-step login-modal">
        <div class="login-modal__backdrop"></div>
        <div class="login-modal__card">
            <button class="btn-back"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg><span data-i18n="nav.back">Zurück</span></button>
            
            <div class="modal-icon modal-icon--red">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            </div>
            <h2 class="modal-title" data-i18n="create.title">Dein Raum</h2>
            <p class="modal-sub" data-i18n="create.subtitle">Teile diesen Code mit deinen Mitspielern</p>
            
            <div class="code-display">
                <div class="code-display__label" data-i18n="create.code">Raum-Code</div>
                <div class="code-display__value" id="generated-code">---</div>
                <div class="code-display__copy">
                    <button id="btn-copy-code" class="btn btn--glass btn--full">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                        <span data-i18n="create.copy">Code kopieren</span>
                    </button>
                </div>
                <p class="code-display__hint">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                    <span data-i18n="create.hint">Der Raum bleibt bestehen bis er gelöscht wird</span>
                </p>
            </div>

            <div class="qr-section">
                <button class="qr-toggle" id="btnToggleQR">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                    <span data-i18n="create.qr">QR-Code anzeigen</span>
                </button>
                <div class="qr-display" id="qrDisplay">
                    <div class="qr-display__code" id="qrCode"></div>
                    <div class="qr-display__hint" data-i18n="create.qr.hint">Scanne diesen Code mit deinem Handy</div>
                </div>
            </div>

            <div class="modal-actions">
                <button id="btn-continue-setup" class="btn btn--primary btn--large btn--full">
                    <span data-i18n="nav.continue">Weiter</span>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- STEP: Join Room -->
    <div id="step-join" class="login-step login-modal">
        <div class="login-modal__backdrop"></div>
        <div class="login-modal__card">
            <button class="btn-back"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg><span data-i18n="nav.back">Zurück</span></button>
            
            <div class="modal-icon modal-icon--indigo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
            </div>
            <h2 class="modal-title" data-i18n="join.title">Beitreten</h2>
            <p class="modal-sub" data-i18n="join.subtitle">Gib den Raum-Code deines Spielleiters ein</p>
            
            <div class="form-group">
                <label class="form-label" data-i18n="join.code">Raum-Code</label>
                <input type="text" id="room-code-input" class="form-input form-input--code" placeholder="XXX-XXX" maxlength="7" autocomplete="off" spellcheck="false">
                <p class="form-error" id="code-error" data-i18n="join.error">Raum nicht gefunden</p>
            </div>
            
            <div class="modal-actions">
                <button id="btn-check-code" class="btn btn--primary btn--large btn--full" disabled>
                    <span data-i18n="join.check">Code prüfen</span>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- STEP: Solo Mode -->
    <div id="step-solo" class="login-step login-modal">
        <div class="login-modal__backdrop"></div>
        <div class="login-modal__card">
            <button class="btn-back"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg><span data-i18n="nav.back">Zurück</span></button>
            
            <div class="modal-icon modal-icon--violet">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            </div>
            <h2 class="modal-title" data-i18n="solo.title">Solo Modus</h2>
            <p class="modal-sub" data-i18n="solo.subtitle">Wähle ein Regelwerk für deinen Charakter</p>
            
            <div class="ruleset-grid">
                <a href="sheet.html?system=5e2024&solo=true" class="ruleset-option">
                    <img src="assets/icons/icon_5e2024.png" alt="D&D 5e" class="ruleset-option__icon">
                    <div><div class="ruleset-option__title">D&D 5e (2024)</div><div class="ruleset-option__sub">Dungeons & Dragons</div></div>
                </a>
                <a href="sheet.html?system=worldsapart&solo=true" class="ruleset-option">
                    <img src="assets/icons/icon_worldsapart.png" alt="Worlds Apart" class="ruleset-option__icon">
                    <div><div class="ruleset-option__title">Worlds Apart</div><div class="ruleset-option__sub">Sci-Fi Adventure</div></div>
                </a>
                <a href="sheet.html?system=htbah&solo=true" class="ruleset-option">
                    <img src="assets/icons/icon_htbah.png" alt="HTBAH" class="ruleset-option__icon">
                    <div><div class="ruleset-option__title">How To Be A Hero</div><div class="ruleset-option__sub">Universelles System</div></div>
                </a>
                <a href="sheet.html?system=cyberpunk&solo=true" class="ruleset-option">
                    <img src="assets/icons/icon_character.png" alt="Cyberpunk" class="ruleset-option__icon">
                    <div><div class="ruleset-option__title">Cyberpunk Red</div><div class="ruleset-option__sub">Night City</div></div>
                </a>
            </div>
        </div>
    </div>

    <!-- STEP: Profile Setup -->
    <div id="step-setup" class="login-step login-modal">
        <div class="login-modal__backdrop"></div>
        <div class="login-modal__card login-modal__card--tall">
            <button class="btn-back" id="btn-back-to-room"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg><span data-i18n="nav.back">Zurück</span></button>
            
            <div class="modal-icon modal-icon--green">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            </div>
            <h2 class="modal-title" data-i18n="profile.title">Dein Profil</h2>
            <p class="modal-sub" data-i18n="profile.subtitle">Wie möchtest du genannt werden?</p>
            
            <!-- OAuth -->
            <div class="oauth-section">
                <button id="btn-google-login" class="btn btn--oauth btn--google">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    <span data-i18n="profile.google">Mit Google anmelden</span>
                </button>
                <button id="btn-rift-account" class="btn btn--oauth btn--rift">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                    <span>RIFT Account</span>
                </button>
            </div>

            <!-- RIFT Account Form -->
            <div id="rift-account-form" class="rift-account-form" style="display:none;">
                <div class="rift-account-tabs">
                    <button class="rift-account-tab active" data-tab="login">Anmelden</button>
                    <button class="rift-account-tab" data-tab="register">Registrieren</button>
                </div>
                <div class="rift-account-content" id="rift-login-form">
                    <div class="form-group"><label class="form-label">E-Mail</label><input type="email" id="rift-login-email" class="form-input" placeholder="deine@email.de" autocomplete="email"></div>
                    <div class="form-group"><label class="form-label">Passwort</label><input type="password" id="rift-login-password" class="form-input" placeholder="••••••••" autocomplete="current-password"></div>
                    <p class="form-error" id="rift-login-error" style="display:none;"></p>
                    <button id="btn-rift-login-submit" class="btn btn--primary btn--full" style="margin-top:8px;">Anmelden</button>
                </div>
                <div class="rift-account-content" id="rift-register-form" style="display:none;">
                    <div class="form-group"><label class="form-label">E-Mail</label><input type="email" id="rift-register-email" class="form-input" placeholder="deine@email.de" autocomplete="email"></div>
                    <div class="form-group"><label class="form-label">Passwort</label><input type="password" id="rift-register-password" class="form-input" placeholder="Mind. 6 Zeichen" autocomplete="new-password"></div>
                    <div class="form-group"><label class="form-label">Passwort bestätigen</label><input type="password" id="rift-register-password2" class="form-input" placeholder="Wiederholen" autocomplete="new-password"></div>
                    <p class="form-error" id="rift-register-error" style="display:none;"></p>
                    <button id="btn-rift-register-submit" class="btn btn--primary btn--full" style="margin-top:8px;">Account erstellen</button>
                </div>
                <button id="btn-rift-account-cancel" class="btn btn--ghost btn--small btn--full" style="margin-top:10px;">Abbrechen</button>
            </div>

            <div class="oauth-divider"><span data-i18n="profile.or">oder als Gast</span></div>

            <div class="form-group">
                <label class="form-label" data-i18n="profile.name">Spielername</label>
                <div class="input-group">
                    <input type="text" id="username-input" class="form-input" placeholder="Dein Name" maxlength="30" autocomplete="off">
                    <button id="btn-random-name" class="btn btn--glass btn--icon" title="Zufällig">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><circle cx="12" cy="12" r="2"/></svg>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" data-i18n="profile.color">Farbe wählen</label>
                <div class="color-palette" id="color-palette"></div>
            </div>

            <div class="preview-section">
                <div id="avatar-preview" class="avatar-preview">?</div>
                <div class="preview-info"><div class="preview-label" data-i18n="profile.preview">Vorschau</div><div id="name-preview" class="preview-name">Spieler</div></div>
                <div class="preview-badge" data-i18n="profile.ready">Bereit!</div>
            </div>

            <div class="modal-actions">
                <button id="btn-enter-room" class="btn btn--primary btn--large btn--full">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
                    <span data-i18n="profile.enter">Raum betreten</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ============================================================
         SCRIPTS
         ============================================================ -->
    <script src="assets/js/auth.js"></script>
    <script>
        // i18n
        const i18n = {
            de: {
                'nav.about': 'Über RIFT', 'nav.privacy': 'Datenschutz', 'nav.imprint': 'Impressum',
                'hero.badge': 'Kostenlos & Open Source',
                'hero.line1': 'Pen & Paper.', 'hero.line2': 'Ohne Grenzen.',
                'hero.sub': 'RIFT ist dein digitaler Spieltisch — mit 3D-Würfeln, Echtzeit-Synchronisation, Charakterbögen für jedes Regelwerk und allem was deine Runde braucht. Direkt im Browser, kein Download nötig.',
                'hero.scroll': 'Mehr erfahren',
                'cta.create': 'Raum erstellen', 'cta.create.desc': 'Als Spielleiter starten',
                'cta.join': 'Raum beitreten', 'cta.join.desc': 'Mit Code einsteigen',
                'cta.solo': 'Solo Modus — Direkt zu deinen Charakteren',
                'features.tag': 'Features', 'features.title': 'Alles für deine Runde',
                'features.sub': 'Kein Tab-Wechsel, kein App-Chaos. Alles an einem Ort.',
                'f.dice.title': '3D Würfel-Engine', 'f.dice.desc': 'Physik-basierte Würfel mit echten Animationen. W4 bis W100, Modifikatoren, History — alles synchron für jeden Spieler.',
                'f.sheets.title': 'Digitale Charakterbögen', 'f.sheets.desc': 'Vier Regelwerke, automatische Berechnungen, PDF-Export. Erstelle, bearbeite und verwalte alle deine Charaktere.',
                'f.mp.title': 'Echtzeit Multiplayer', 'f.mp.desc': 'GM-Kontrollzentrum, Spielerverwaltung, Session-Management. Jeder sieht alles live — egal wo er sitzt.',
                'f.maps.title': 'Karten & Whiteboard', 'f.maps.desc': 'Battle Maps hochladen, Tokens setzen, live auf dem Whiteboard zeichnen. Kollaborativ in Echtzeit.',
                'f.chat.title': 'Chat & Medien', 'f.chat.desc': 'Text, Bilder, GIFs, YouTube-Embeds, Flüsternachrichten. Alles was eine Session lebendig macht.',
                'systems.tag': 'Regelwerke', 'systems.title': 'Spiele was du willst',
                'final.title': 'Bereit für dein nächstes Abenteuer?',
                'final.sub': 'Keine Registrierung nötig. Raum erstellen, Code teilen, losspielen.',
                'nav.back': 'Zurück', 'nav.continue': 'Weiter',
                'create.title': 'Dein Raum', 'create.subtitle': 'Teile diesen Code mit deinen Mitspielern',
                'create.code': 'Raum-Code', 'create.copy': 'Code kopieren',
                'create.hint': 'Der Raum bleibt bestehen bis er gelöscht wird',
                'create.qr': 'QR-Code anzeigen', 'create.qr.hint': 'Scanne diesen Code mit deinem Handy',
                'join.title': 'Beitreten', 'join.subtitle': 'Gib den Raum-Code deines Spielleiters ein',
                'join.code': 'Raum-Code', 'join.check': 'Code prüfen', 'join.error': 'Raum nicht gefunden',
                'solo.title': 'Solo Modus', 'solo.subtitle': 'Wähle ein Regelwerk für deinen Charakter',
                'profile.title': 'Dein Profil', 'profile.subtitle': 'Wie möchtest du genannt werden?',
                'profile.google': 'Mit Google anmelden', 'profile.or': 'oder als Gast',
                'profile.name': 'Spielername', 'profile.color': 'Farbe wählen',
                'profile.preview': 'Vorschau', 'profile.ready': 'Bereit!', 'profile.enter': 'Raum betreten',
                'resume.title': 'Letzte Session gefunden', 'resume.dismiss': 'Verwerfen', 'resume.continue': 'Fortsetzen'
            },
            en: {
                'nav.about': 'About RIFT', 'nav.privacy': 'Privacy', 'nav.imprint': 'Imprint',
                'hero.badge': 'Free & Open Source',
                'hero.line1': 'Pen & Paper.', 'hero.line2': 'Without Limits.',
                'hero.sub': 'RIFT is your digital game table — with 3D dice, real-time sync, character sheets for every ruleset and everything your party needs. Right in your browser, no download required.',
                'hero.scroll': 'Learn more',
                'cta.create': 'Create Room', 'cta.create.desc': 'Start as game master',
                'cta.join': 'Join Room', 'cta.join.desc': 'Enter with room code',
                'cta.solo': 'Solo Mode — Go to your characters',
                'features.tag': 'Features', 'features.title': 'Everything for your party',
                'features.sub': 'No tab-switching, no app chaos. Everything in one place.',
                'f.dice.title': '3D Dice Engine', 'f.dice.desc': 'Physics-based dice with real animations. D4 to D100, modifiers, history — all synced for every player.',
                'f.sheets.title': 'Digital Character Sheets', 'f.sheets.desc': 'Four rulesets, auto-calculations, PDF export. Create, edit and manage all your characters.',
                'f.mp.title': 'Real-time Multiplayer', 'f.mp.desc': 'GM control center, player management, session tools. Everyone sees everything live — wherever they are.',
                'f.maps.title': 'Maps & Whiteboard', 'f.maps.desc': 'Upload battle maps, place tokens, draw on the whiteboard live. Collaborative in real-time.',
                'f.chat.title': 'Chat & Media', 'f.chat.desc': 'Text, images, GIFs, YouTube embeds, whisper messages. Everything to make sessions come alive.',
                'systems.tag': 'Rulesets', 'systems.title': 'Play what you want',
                'final.title': 'Ready for your next adventure?',
                'final.sub': 'No registration needed. Create a room, share the code, start playing.',
                'nav.back': 'Back', 'nav.continue': 'Continue',
                'create.title': 'Your Room', 'create.subtitle': 'Share this code with your players',
                'create.code': 'Room Code', 'create.copy': 'Copy code',
                'create.hint': 'Room persists until deleted',
                'create.qr': 'Show QR Code', 'create.qr.hint': 'Scan this code with your phone',
                'join.title': 'Join', 'join.subtitle': 'Enter your game master\'s room code',
                'join.code': 'Room Code', 'join.check': 'Check code', 'join.error': 'Room not found',
                'solo.title': 'Solo Mode', 'solo.subtitle': 'Choose a ruleset for your character',
                'profile.title': 'Your Profile', 'profile.subtitle': 'What should we call you?',
                'profile.google': 'Sign in with Google', 'profile.or': 'or as guest',
                'profile.name': 'Player name', 'profile.color': 'Pick a color',
                'profile.preview': 'Preview', 'profile.ready': 'Ready!', 'profile.enter': 'Enter room',
                'resume.title': 'Last session found', 'resume.dismiss': 'Dismiss', 'resume.continue': 'Continue'
            }
        };

        let currentLang = localStorage.getItem('rift_lang') || 'de';

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('rift_lang', lang);
            document.querySelectorAll('.lang-toggle__btn').forEach(b => b.classList.toggle('active', b.dataset.lang === lang));
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.dataset.i18n;
                if (i18n[lang]?.[key]) el.textContent = i18n[lang][key];
            });
        }

        // Step navigation helper (used by inline onclick + solo)
        function showStep(stepId) {
            const id = stepId.startsWith('step-') ? stepId : `step-${stepId}`;
            document.querySelectorAll('.login-step').forEach(s => s.classList.remove('active'));
            document.getElementById(id)?.classList.add('active');
            document.body.classList.toggle('modal-open', id !== 'step-welcome');
        }

        // Resume session
        function checkLastSession() {
            const raw = localStorage.getItem('rift_last_session');
            if (!raw) return;
            try {
                const s = JSON.parse(raw);
                if (Date.now() - s.timestamp > 86400000) return;
                document.getElementById('resumeInfo').textContent = `Raum: ${s.roomCode} • ${s.playerName}`;
                document.getElementById('resumeBanner').classList.add('show');
                document.getElementById('btnResumeJoin').onclick = () => { window.location.href = `login.html?join=${s.roomCode.replace('-','')}`; };
                document.getElementById('btnResumeDismiss').onclick = () => { document.getElementById('resumeBanner').classList.remove('show'); localStorage.removeItem('rift_last_session'); };
            } catch(e) {}
        }

        // QR
        function generateQRCode(code) {
            const c = document.getElementById('qrCode');
            c.innerHTML = '';
            if (typeof QRCode !== 'undefined') new QRCode(c, { text: `${location.origin}/login.html?join=${code}`, width: 180, height: 180, colorDark: '#000', colorLight: '#fff', correctLevel: QRCode.CorrectLevel.M });
        }

        // Scroll reveal
        function initScrollReveal() {
            const obs = new IntersectionObserver((entries) => {
                entries.forEach(e => {
                    if (e.isIntersecting) {
                        const delay = (e.target.dataset.delay || 0) * 120;
                        setTimeout(() => e.target.classList.add('revealed'), delay);
                        obs.unobserve(e.target);
                    }
                });
            }, { threshold: 0.15 });
            document.querySelectorAll('[data-reveal]').forEach(el => obs.observe(el));
        }

        // Sticky bar
        function initStickyBar() {
            const bar = document.getElementById('stickyBar');
            const hero = document.querySelector('.hero');
            if (!bar || !hero) return;
            const obs = new IntersectionObserver(([e]) => {
                bar.classList.toggle('visible', !e.isIntersecting);
            }, { threshold: 0 });
            obs.observe(hero);
        }

        // Modal backdrop click to close
        function initModalBackdrops() {
            document.querySelectorAll('.login-modal__backdrop').forEach(bd => {
                bd.addEventListener('click', () => showStep('step-welcome'));
            });
        }

        // Init
        let loginController;
        document.addEventListener('DOMContentLoaded', async () => {
            await RIFT.firebase.init();
            
            const urlParams = new URLSearchParams(window.location.search);
            const isLoggingOut = urlParams.get('logout') === 'true';
            
            if (isLoggingOut) {
                try { await firebase.auth().signOut(); } catch(e) {}
                window.history.replaceState({}, document.title, 'login.html');
            }

            if (!isLoggingOut) {
                const user = firebase.auth().currentUser;
                if (user && !user.isAnonymous) {
                    try {
                        const doc = await firebase.firestore().collection('users').doc(user.uid).get();
                        if (doc.exists && doc.data().displayName?.includes('#')) {
                            window.location.href = 'index.html';
                            return;
                        }
                    } catch(e) {}
                }
            }

            loginController = new RIFT.auth.LoginController();

            // Room invite URL
            const roomParam = urlParams.get('room');
            if (roomParam?.length >= 6) {
                setTimeout(() => {
                    loginController.showStep('join');
                    const inp = document.getElementById('room-code-input');
                    if (inp) { inp.value = roomParam.toUpperCase().replace(/(.{3})(.{3})/, '$1-$2'); loginController.formatCodeInput(inp); loginController.checkAndJoinRoom(); }
                }, 100);
            }

            setLanguage(currentLang);
            checkLastSession();
            initScrollReveal();
            initStickyBar();
            initModalBackdrops();

            document.querySelectorAll('.lang-toggle__btn').forEach(b => b.addEventListener('click', () => setLanguage(b.dataset.lang)));

            // Solo button
            document.getElementById('btn-solo-mode')?.addEventListener('click', () => showStep('step-solo'));
            document.querySelector('#step-solo .btn-back')?.addEventListener('click', () => showStep('step-welcome'));

            // QR toggle
            document.getElementById('btnToggleQR')?.addEventListener('click', () => {
                const d = document.getElementById('qrDisplay');
                d.classList.toggle('show');
                if (d.classList.contains('show')) generateQRCode(document.getElementById('generated-code').textContent);
            });

            // Join URL param
            const joinCode = urlParams.get('join');
            if (joinCode) {
                const inp = document.getElementById('room-code-input');
                if (inp) { inp.value = joinCode; inp.dispatchEvent(new Event('input')); }
                showStep('step-join');
            }

            // Page loaded — trigger animations
            requestAnimationFrame(() => document.body.classList.add('loaded'));
        });
    </script>
</body>
</html>
