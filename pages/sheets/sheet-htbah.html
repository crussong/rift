<!DOCTYPE html>
<html lang="de">
<head>
    <link rel="icon" type="image/svg+xml" href="/assets/icons/icon_rift_r.svg">
    <base href="/">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>RIFT – How To Be A Hero Charakterbogen</title>
    
    <link rel="stylesheet" href="/assets/css/sheet-layout.css">
    <link rel="stylesheet" href="/assets/css/core.css">
    <link rel="stylesheet" href="/assets/css/ui.css">
    <link rel="stylesheet" href="/assets/css/sidebar.css">
    <link rel="stylesheet" href="/assets/css/topbar.css">
    <link rel="stylesheet" href="/assets/css/footer.css">
    <link rel="stylesheet" href="/assets/css/settings.css">
    <link rel="stylesheet" href="/assets/css/sheet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">

    <!-- Auth Guard: Hide until authenticated -->
    <style>
        body:not(.auth-ready) .app { opacity: 0; pointer-events: none; }
        body:not(.auth-ready) .sheet-container { opacity: 0; pointer-events: none; }
        body:not(.auth-ready) main { opacity: 0; pointer-events: none; }
        body.auth-ready .app { opacity: 1; transition: opacity 0.15s ease; }
        body.auth-ready .sheet-container { opacity: 1; transition: opacity 0.15s ease; }
        body.auth-ready main { opacity: 1; transition: opacity 0.15s ease; }
    </style>
</head>
<body>
    <div class="app">
        <main class="main">
            <div class="main__content">
                
                <div class="sheet-page">
                    <!-- Page Header with Back Button -->
                    <div class="page-header">
                        <a href="/sheet" class="page-header__back">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 12H5M12 19l-7-7 7-7"/>
                            </svg>
                            <span>Charakterauswahl</span>
                        </a>
                        <div class="page-header__icon" style="color: #22c55e;">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M4.17157 3.17157C3 4.34315 3 6.22876 3 10V14C3 17.7712 3 19.6569 4.17157 20.8284C5.34315 22 7.22876 22 11 22H13C16.7712 22 18.6569 22 19.8284 20.8284C21 19.6569 21 17.7712 21 14V10C21 6.22876 21 4.34315 19.8284 3.17157C18.6569 2 16.7712 2 13 2H11C7.22876 2 5.34315 2 4.17157 3.17157Z"/>
                            </svg>
                        </div>
                        <div class="page-header__divider"></div>
                        <h1 class="page-header__title">Charakterbogen</h1>
                        <span class="page-header__tagline" style="color: #22c55e;">How To Be A Hero</span>
                    </div>
                    
                    <!-- Divider -->
                    <div class="section-divider"></div>
                    
                    <!-- Placeholder Content -->
                    <div class="sheet-placeholder">
                        <div class="sheet-placeholder__icon">
                            <img src="/assets/img/rulesets/ruleset_htbah.svg" alt="HTBAH">
                        </div>
                        <h2 class="sheet-placeholder__title">HTBAH Charakterbogen</h2>
                        <p class="sheet-placeholder__desc">Der interaktive Charakterbogen für How To Be A Hero wird gerade entwickelt.</p>
                        <div class="sheet-placeholder__features">
                            <div class="sheet-placeholder__feature">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                                Prozent-Attribute
                            </div>
                            <div class="sheet-placeholder__feature">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
                                Inventar
                            </div>
                            <div class="sheet-placeholder__feature">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                Fähigkeiten
                            </div>
                            <div class="sheet-placeholder__feature">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                                Biografie
                            </div>
                        </div>
                    </div>
                    
                </div>
                
            </div>
        </main>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- RIFT Services -->
    <script src="/assets/js/firebase-config.js"></script>
    <script>
        // Auth Guard - redirect to login if not authenticated
        (function() {
            function waitForAuth() {
                // Wait for Firebase SDK
                if (typeof firebase === 'undefined' || !firebase.auth) {
                    return setTimeout(waitForAuth, 50);
                }
                // Wait for Firebase app initialization
                try {
                    var auth = firebase.auth();
                    auth.onAuthStateChanged(function(user) {
                        if (!user) {
                            window.location.href = '/login';
                        } else {
                            document.body.classList.add('auth-ready');
                        }
                    });
                } catch(e) {
                    // Firebase not initialized yet, retry
                    setTimeout(waitForAuth, 50);
                }
            }
            waitForAuth();
        })();
    </script>

    <script src="/assets/js/room-service.js"></script>
    <script src="/assets/js/user-service.js"></script>
    <script src="/assets/js/pro-status.js"></script>
    
    <script src="/assets/js/auth.js"></script>
    <script src="/assets/js/ui.js"></script>
    <script src="/assets/js/layout.js"></script>
    <script src="/assets/js/settings.js"></script>
    <script src="/assets/js/transitions.js"></script>
    <script src="/assets/js/character-storage.js"></script>
    <script src="/assets/js/app.js"></script>
    
    <script>
        initLayout();
        
        const urlParams = new URLSearchParams(window.location.search);
        const charId = urlParams.get('id');
        const isNew = urlParams.get('new');
        
        if (charId) {
            console.log('[Sheet-HTBAH] Loading character:', charId);
            const char = CharacterStorage.getById(charId);
            if (char) {
                console.log('[Sheet-HTBAH] Character data:', char);
            } else {
                console.error('[Sheet-HTBAH] Character not found');
                if (window.RIFT?.ui?.Toast) {
                    RIFT.ui.Toast.error('Charakter nicht gefunden');
                }
            }
        } else if (isNew) {
            console.log('[Sheet-HTBAH] Creating new character');
        }
    </script>
    <script src="/assets/js/broadcast.js"></script>
</body>
</html>
