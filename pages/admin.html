<!DOCTYPE html>
<html lang="de">
<head>
    <link rel="icon" type="image/svg+xml" href="/assets/icons/icon_rift_r.svg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RIFT – Admin</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        
        :root {
            --bg: #0a0a0a;
            --bg-card: #141414;
            --bg-elevated: #1a1a1a;
            --bg-input: #1e1e1e;
            --text: #e5e5e5;
            --text-muted: #737373;
            --accent: #8B5CF6;
            --accent-hover: #A78BFA;
            --red: #EF4444;
            --green: #22C55E;
            --yellow: #F59E0B;
            --blue: #3B82F6;
            --border: rgba(255,255,255,0.08);
            --border-accent: rgba(139, 92, 246, 0.3);
            --radius: 12px;
            --radius-lg: 16px;
        }
        
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.5;
        }
        
        /* ========================================
           ACCESS DENIED STATE
           ======================================== */
        .access-denied {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
            padding: 40px;
        }
        
        .access-denied svg {
            width: 64px;
            height: 64px;
            color: var(--red);
            margin-bottom: 24px;
        }
        
        .access-denied h1 {
            font-size: 24px;
            margin-bottom: 12px;
        }
        
        .access-denied p {
            color: var(--text-muted);
            max-width: 400px;
        }
        
        .access-denied .btn {
            margin-top: 24px;
        }
        
        /* Hide admin content until verified */
        .admin-layout { display: none; }
        body.admin-ready .admin-layout { display: flex; }
        body.admin-ready .access-denied { display: none; }
        
        /* ========================================
           LAYOUT – Sidebar Dashboard
           ======================================== */
        .admin-layout {
            min-height: 100vh;
            flex-direction: row;
        }
        
        /* Header */
        .admin-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 56px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            z-index: 200;
        }
        
        .admin-header__left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .admin-header__toggle {
            display: none;
            width: 36px;
            height: 36px;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .admin-header__toggle:hover {
            background: var(--bg-elevated);
            color: var(--text);
        }
        
        .admin-header__toggle svg {
            width: 18px;
            height: 18px;
        }
        
        .admin-header__logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: var(--text);
        }
        
        .admin-header__logo img {
            height: 24px;
        }
        
        .admin-header__logo span {
            font-weight: 600;
            font-size: 15px;
        }
        
        .admin-header__badge {
            background: var(--accent);
            color: white;
            font-size: 9px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 4px;
            letter-spacing: 0.8px;
        }
        
        .admin-header__actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .admin-header__user {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-muted);
            font-size: 13px;
        }
        
        .admin-header__avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--bg-elevated);
            overflow: hidden;
        }
        
        .admin-header__avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Sidebar */
        .admin-sidebar {
            position: fixed;
            top: 56px;
            left: 0;
            bottom: 0;
            width: 240px;
            background: var(--bg-card);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            overflow-x: hidden;
            z-index: 150;
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.08) transparent;
        }
        
        .admin-sidebar::-webkit-scrollbar { width: 4px; }
        .admin-sidebar::-webkit-scrollbar-track { background: transparent; }
        .admin-sidebar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 4px; }
        
        /* Sidebar overlay for mobile */
        .admin-sidebar__overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 140;
        }
        
        /* Main Content */
        .admin-main {
            margin-left: 240px;
            padding: 80px 32px 32px;
            flex: 1;
            min-width: 0;
            max-width: 1400px;
        }
        
        /* Page Header */
        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
        }
        
        .page-header__title {
            font-size: 28px;
            font-weight: 700;
        }
        
        .page-header__subtitle {
            color: var(--text-muted);
            font-size: 14px;
            margin-top: 4px;
        }
        
        /* ========================================
           BUTTONS
           ======================================== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            text-decoration: none;
            white-space: nowrap;
        }
        
        .btn svg {
            width: 18px;
            height: 18px;
        }
        
        .btn--primary {
            background: var(--accent);
            color: white;
        }
        
        .btn--primary:hover {
            background: var(--accent-hover);
        }
        
        .btn--secondary {
            background: var(--bg-elevated);
            color: var(--text);
            border: 1px solid var(--border);
        }
        
        .btn--secondary:hover {
            border-color: var(--border-accent);
            background: var(--bg-input);
        }
        
        .btn--danger {
            background: rgba(239, 68, 68, 0.15);
            color: var(--red);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        .btn--danger:hover {
            background: var(--red);
            color: white;
        }
        
        .btn--small {
            padding: 6px 12px;
            font-size: 13px;
        }
        
        .btn--small svg {
            width: 16px;
            height: 16px;
        }
        
        .btn--ghost {
            background: transparent;
            color: var(--text-muted);
            padding: 8px;
        }
        
        .btn--ghost:hover {
            color: var(--text);
            background: var(--bg-elevated);
        }
        
        /* ========================================
           CARDS
           ======================================== */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }
        
        .card__header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }
        
        .card__title {
            font-size: 16px;
            font-weight: 600;
        }
        
        .card__body {
            padding: 24px;
        }
        
        /* ========================================
           NEWS TABLE
           ======================================== */
        .news-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .news-table th {
            text-align: left;
            padding: 12px 16px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            background: var(--bg-elevated);
            border-bottom: 1px solid var(--border);
        }
        
        .news-table td {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }
        
        .news-table tr:hover td {
            background: rgba(255, 255, 255, 0.02);
        }
        
        .news-table__image {
            width: 80px;
            height: 50px;
            border-radius: 6px;
            background: var(--bg-elevated);
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
        }
        
        .news-table__title {
            font-weight: 500;
            color: var(--text);
            margin-bottom: 4px;
        }
        
        .news-table__excerpt {
            font-size: 13px;
            color: var(--text-muted);
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .news-table__actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }
        
        /* Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 100px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .badge--published {
            background: rgba(34, 197, 94, 0.15);
            color: var(--green);
        }
        
        .badge--draft {
            background: rgba(245, 158, 11, 0.15);
            color: var(--yellow);
        }
        
        .badge--featured {
            background: rgba(139, 92, 246, 0.15);
            color: var(--accent);
        }
        
        /* News badges */
        .badge--update { background: rgba(34, 197, 94, 0.12); color: #4ADE80; }
        .badge--news { background: rgba(239, 68, 68, 0.12); color: #F87171; }
        .badge--guide { background: rgba(59, 130, 246, 0.12); color: #60A5FA; }
        
        /* Carousel badges */
        .badge--live { background: rgba(239, 68, 68, 0.15); color: #EF4444; }
        .badge--new { background: rgba(139, 92, 246, 0.15); color: #8B5CF6; }
        .badge--event { background: rgba(245, 158, 11, 0.15); color: #F59E0B; }
        .badge--featured { background: rgba(234, 179, 8, 0.15); color: #EAB308; }
        .badge--beta { background: rgba(59, 130, 246, 0.15); color: #3B82F6; }
        .badge--soon { background: rgba(107, 114, 128, 0.15); color: #9CA3AF; }
        .badge--hot { background: rgba(249, 115, 22, 0.15); color: #F97316; }
        .badge--community { background: rgba(20, 184, 166, 0.15); color: #14B8A6; }
        
        /* Carousel Type Tabs */
        .carousel-type-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-muted);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .carousel-type-tab:hover {
            background: var(--bg-elevated);
            border-color: var(--border-accent);
            color: var(--text);
        }
        .carousel-type-tab.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }
        .carousel-type-tab.active svg {
            stroke: white;
        }
        
        /* Sidebar Navigation */
        .admin-nav {
            padding: 12px;
        }
        
        .admin-nav__section {
            margin-bottom: 8px;
        }
        
        .admin-nav__section:last-child {
            margin-bottom: 0;
        }
        
        .admin-nav__label {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            color: var(--text-muted);
            padding: 12px 12px 6px;
            display: block;
            opacity: 0.6;
        }
        
        .admin-nav__items {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .admin-tab {
            width: 100%;
            padding: 9px 12px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--text-muted);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            text-align: left;
            position: relative;
        }
        
        .admin-tab:hover {
            color: var(--text);
            background: rgba(255, 255, 255, 0.04);
        }
        
        .admin-tab.active {
            color: white;
            background: rgba(255, 255, 255, 0.08);
        }
        
        .admin-tab svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            opacity: 0.5;
        }
        
        .admin-tab.active svg {
            opacity: 1;
        }
        
        .admin-tab span {
            flex: 1;
        }
        
        /* Category accent indicators */
        .admin-nav__section--content .admin-tab.active {
            background: rgba(139, 92, 246, 0.15);
            color: #c4b5fd;
        }
        .admin-nav__section--content .admin-tab.active svg { color: #a78bfa; }
        
        .admin-nav__section--management .admin-tab.active {
            background: rgba(59, 130, 246, 0.15);
            color: #93c5fd;
        }
        .admin-nav__section--management .admin-tab.active svg { color: #60a5fa; }
        
        .admin-nav__section--tools .admin-tab.active {
            background: rgba(34, 197, 94, 0.15);
            color: #86efac;
        }
        .admin-nav__section--tools .admin-tab.active svg { color: #4ade80; }
        
        .admin-nav__section--system .admin-tab.active {
            background: rgba(245, 158, 11, 0.15);
            color: #fcd34d;
        }
        .admin-nav__section--system .admin-tab.active svg { color: #fbbf24; }
        
        /* RIFT Pro */
        .admin-nav__section--pro .admin-tab.active {
            background: rgba(188, 162, 76, 0.15);
            color: #e8d48b;
        }
        .admin-nav__section--pro .admin-tab.active svg { color: #bca24c; }
        
        /* Admin Pages */
        .admin-page {
            display: none;
        }
        
        .admin-page.active {
            display: block;
        }
        
        /* Carousel Slides List */
        .slides-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .slide-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            transition: all 0.2s;
        }
        
        .slide-item:hover {
            border-color: var(--border-accent);
        }
        
        .slide-item.inactive {
            opacity: 0.5;
        }
        
        .slide-item__order {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .slide-item__order button {
            width: 28px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-muted);
            cursor: pointer;
        }
        
        .slide-item__order button:hover {
            background: var(--bg-input);
            color: var(--text);
        }
        
        .slide-item__preview {
            width: 120px;
            height: 68px;
            border-radius: 6px;
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
        }
        
        .slide-item__content {
            flex: 1;
            min-width: 0;
        }
        
        .slide-item__title {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .slide-item__meta {
            font-size: 13px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .slide-item__actions {
            display: flex;
            gap: 8px;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        
        .empty-state svg {
            width: 48px;
            height: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .empty-state p {
            margin-bottom: 20px;
        }
        
        /* ========================================
           MODAL
           ======================================== */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 40px 20px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            overflow-y: auto;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal__content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 700px;
            transform: translateY(-20px);
            transition: transform 0.2s ease;
        }
        
        .modal__content--wide {
            max-width: 850px;
        }
        
        .modal.active .modal__content {
            transform: translateY(0);
        }
        
        .modal__header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }
        
        .modal__title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .modal__body {
            padding: 24px;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }
        
        .modal__footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 20px 24px;
            border-top: 1px solid var(--border);
            background: var(--bg-elevated);
        }
        
        /* ========================================
           FORMS
           ======================================== */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--text);
            margin-bottom: 8px;
        }
        
        .form-label span {
            color: var(--text-muted);
            font-weight: 400;
        }
        
        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px 14px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s ease;
        }
        
        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }
        
        .form-input::placeholder,
        .form-textarea::placeholder {
            color: var(--text-muted);
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.6;
        }
        
        .form-textarea--large {
            min-height: 200px;
        }
        
        .form-hint {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 6px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        /* Checkbox */
        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .form-checkbox input {
            width: 18px;
            height: 18px;
            accent-color: var(--accent);
            cursor: pointer;
        }
        
        .form-checkbox span {
            font-size: 14px;
        }
        
        /* Range Slider */
        .form-range {
            width: 100%;
            height: 6px;
            background: var(--bg-input);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }
        
        .form-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.15s;
        }
        
        .form-range::-webkit-slider-thumb:hover {
            transform: scale(1.15);
        }
        
        .form-range::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: var(--accent);
            border-radius: 50%;
            border: none;
            cursor: pointer;
        }
        
        /* Color Picker */
        .form-color {
            width: 60px;
            height: 40px;
            padding: 4px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
        }
        
        .form-color::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        
        .form-color::-webkit-color-swatch {
            border: none;
            border-radius: 4px;
        }
        
        /* Form Radio */
        .form-radio-group {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }
        
        .form-radio {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px 16px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .form-radio:hover {
            border-color: var(--accent);
        }
        
        .form-radio:has(input:checked) {
            border-color: var(--accent);
            background: rgba(139, 92, 246, 0.1);
        }
        
        .form-radio input {
            width: 16px;
            height: 16px;
            accent-color: var(--accent);
            cursor: pointer;
        }
        
        .form-radio span {
            font-size: 14px;
        }
        
        /* Form Section Header */
        .form-section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 28px 0 16px 0;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
        }
        
        .form-section-header::before,
        .form-section-header::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }
        
        /* Image Upload */
        .image-upload {
            position: relative;
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            padding: 32px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--bg-input);
        }
        
        .image-upload:hover {
            border-color: var(--accent);
            background: rgba(139, 92, 246, 0.05);
        }
        
        .image-upload.has-image {
            padding: 0;
            border-style: solid;
        }
        
        .image-upload__preview {
            width: 100%;
            aspect-ratio: 16/9;
            object-fit: cover;
            border-radius: calc(var(--radius) - 2px);
            display: none;
        }
        
        .image-upload.has-image .image-upload__preview {
            display: block;
        }
        
        .image-upload.has-image .image-upload__placeholder {
            display: none;
        }
        
        .image-upload__placeholder svg {
            width: 40px;
            height: 40px;
            color: var(--text-muted);
            margin-bottom: 12px;
        }
        
        .image-upload__placeholder p {
            color: var(--text-muted);
            font-size: 14px;
        }
        
        .image-upload__placeholder small {
            color: var(--text-muted);
            font-size: 12px;
            opacity: 0.7;
        }
        
        .image-upload input {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
        }
        
        /* ========================================
           STATS GRID
           ======================================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
        }
        
        .stat-card__label {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        
        .stat-card__value {
            font-size: 28px;
            font-weight: 700;
        }
        
        .stat-card__value--accent { color: var(--accent); }
        .stat-card__value--green { color: var(--green); }
        .stat-card__value--yellow { color: var(--yellow); }
        
        /* ========================================
           TOAST
           ======================================== */
        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .toast {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: toastIn 0.3s ease;
        }
        
        .toast--success { border-color: var(--green); }
        .toast--error { border-color: var(--red); }
        
        .toast svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }
        
        .toast--success svg { color: var(--green); }
        .toast--error svg { color: var(--red); }
        
        @keyframes toastIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* ========================================
           RIFT PRO ADMIN COMPONENTS
           ======================================== */
        .pro-flag-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 14px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
        }
        
        .pro-flag-row span:first-child {
            font-size: 14px;
            font-weight: 500;
        }
        
        .pro-flag-toggle {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
            cursor: pointer;
        }
        
        .pro-flag-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .pro-flag-pill {
            position: absolute;
            inset: 0;
            background: var(--bg-elevated);
            border-radius: 24px;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }
        
        .pro-flag-pill::before {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--text-muted);
            top: 2px;
            left: 2px;
            transition: all 0.2s;
        }
        
        .pro-flag-toggle input:checked + .pro-flag-pill {
            background: rgba(188, 162, 76, 0.2);
            border-color: rgba(188, 162, 76, 0.4);
        }
        
        .pro-flag-toggle input:checked + .pro-flag-pill::before {
            transform: translateX(20px);
            background: #bca24c;
        }
        
        /* Theme Gating Item */
        .theme-gate-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .theme-gate-item:hover {
            border-color: rgba(188, 162, 76, 0.4);
        }
        
        .theme-gate-item.is-pro {
            border-color: rgba(188, 162, 76, 0.3);
            background: rgba(188, 162, 76, 0.06);
        }
        
        .theme-gate-item__badge {
            font-size: 10px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .theme-gate-item__badge--free {
            background: rgba(34, 197, 94, 0.15);
            color: var(--green);
        }
        
        .theme-gate-item__badge--pro {
            background: rgba(188, 162, 76, 0.15);
            color: #bca24c;
        }
        
        /* Churn Reason Bars */
        .churn-reason-row {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 12px;
            align-items: center;
            font-size: 13px;
        }
        
        .churn-reason-bar {
            height: 6px;
            border-radius: 3px;
            min-width: 8px;
        }
        
        /* Card Badge (count) */
        .card__badge {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 2px 10px;
            border-radius: 100px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
        }
        
        /* ========================================
           LOADING
           ======================================== */
        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ========================================
           RESPONSIVE
           ======================================== */
        @media (max-width: 1024px) {
            .admin-header__toggle {
                display: flex;
            }
            
            .admin-sidebar {
                transform: translateX(-100%);
                transition: transform 0.25s ease;
                z-index: 300;
            }
            
            .admin-sidebar.open {
                transform: translateX(0);
            }
            
            .admin-sidebar__overlay.open {
                display: block;
                z-index: 250;
            }
            
            .admin-main {
                margin-left: 0;
                padding: 72px 20px 20px;
            }
        }
        
        @media (max-width: 768px) {
            .admin-header {
                padding: 0 16px;
            }
            
            .admin-header .btn--secondary {
                display: none;
            }
            
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .modal__content {
                margin: 20px;
            }
            
            #page-proLimits > div[style*="grid-template-columns"],
            #page-proChurn > div[style*="grid-template-columns"],
            #page-proPipeline > div[style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
            }
        }
        
        /* Landing Page Admin */
        .lp-type-btn {
            padding: 8px 16px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-muted);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .lp-type-btn:hover { border-color: rgba(255,255,255,0.15); color: var(--text); }
        .lp-type-btn.active { background: rgba(240,208,96,0.1); border-color: rgba(240,208,96,0.3); color: #f0d060; }
        .form-label-sm { display: block; font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px; }
        .lp-settings-group { padding: 16px; background: var(--bg-input); border-radius: 10px; border: 1px solid var(--border); }
        .lp-tab { padding: 8px 16px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 8px; color: var(--text-muted); font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .lp-tab:hover { border-color: rgba(255,255,255,0.15); color: var(--text); }
        .lp-tab.active { background: rgba(139,92,246,0.12); border-color: rgba(139,92,246,0.3); color: var(--accent); }
        .lp-section { display: none; }
        .lp-section.active { display: block; }
        .lp-section-row { display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: var(--bg-input); border-radius: 10px; border: 1px solid var(--border); }
        .lp-group-fields[style*="display: none"], .lp-group-fields[style*="display:none"] { display: none !important; }
    </style>
</head>
<body>
    <!-- Access Denied (shown by default) -->
    <div class="access-denied">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <h1>Zugriff verweigert</h1>
        <p>Du benötigst Admin-Rechte um diese Seite zu sehen.</p>
        <a href="/hub" class="btn btn--secondary">Zurück zum Hub</a>
    </div>
    
    <!-- Admin Layout (hidden until verified) -->
    <div class="admin-layout">
        <!-- Header -->
        <header class="admin-header">
            <div class="admin-header__left">
                <button class="admin-header__toggle" id="sidebarToggle" onclick="toggleSidebar()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
                </button>
                <a href="/hub" class="admin-header__logo">
                    <img src="/assets/icons/icon_rift_r.svg" alt="RIFT">
                    <span>RIFT</span>
                    <span class="admin-header__badge">ADMIN</span>
                </a>
            </div>
            <div class="admin-header__actions">
                <a href="/hub" class="btn btn--secondary btn--small">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M15 18l-6-6 6-6"/>
                    </svg>
                    Zurück zum Hub
                </a>
                <div class="admin-header__user">
                    <div class="admin-header__avatar" id="adminAvatar"></div>
                    <span id="adminName">Admin</span>
                </div>
            </div>
        </header>
        
        <!-- Sidebar Overlay (mobile) -->
        <div class="admin-sidebar__overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
        
        <!-- Sidebar -->
        <aside class="admin-sidebar" id="adminSidebar">
            <nav class="admin-nav">
                <!-- Content Section -->
                <div class="admin-nav__section admin-nav__section--content">
                    <div class="admin-nav__label">Content</div>
                    <div class="admin-nav__items">
                        <button class="admin-tab active" onclick="switchTab('news')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 20H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v1m2 13a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2z"/></svg>
                            <span>News</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('carousel')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
                            <span>Carousel</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('features')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
                            <span>Features</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('quotes')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V21z"/><path d="M15 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V21z"/></svg>
                            <span>Zitate</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('changelog')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                            <span>Changelog</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('faq')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                            <span>FAQ</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('landingPage')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                            <span>Landing Page</span>
                        </button>
                    </div>
                </div>
                
                <!-- Management Section -->
                <div class="admin-nav__section admin-nav__section--management">
                    <div class="admin-nav__label">Management</div>
                    <div class="admin-nav__items">
                        <button class="admin-tab" onclick="switchTab('users')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            <span>Benutzer</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('sessions')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                            <span>Sessions</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('feedback')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                            <span>Feedback</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('announcements')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 17H2a3 3 0 0 0 3-3V9a7 7 0 0 1 14 0v5a3 3 0 0 0 3 3zm-8.27 4a2 2 0 0 1-3.46 0"/></svg>
                            <span>Banner</span>
                        </button>
                    </div>
                </div>
                
                <!-- Tools Section -->
                <div class="admin-nav__section admin-nav__section--tools">
                    <div class="admin-nav__label">Tools & Assets</div>
                    <div class="admin-nav__items">
                        <button class="admin-tab" onclick="switchTab('rulesets')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
                            <span>Regelwerke</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('assets')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                            <span>Assets</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('arenaThemes')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>
                            <span>Arena Themes</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('tokenLibrary')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="5"/><path d="M20 21a8 8 0 1 0-16 0"/></svg>
                            <span>Token Library</span>
                        </button>
                        <button class="admin-tab" data-tab="fokusKatalog" onclick="switchTab('fokusKatalog')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
                            <span>Fokus-Katalog</span>
                        </button>
                    </div>
                </div>
                
                <!-- RIFT Pro Section -->
                <div class="admin-nav__section admin-nav__section--pro">
                    <div class="admin-nav__label">RIFT Pro</div>
                    <div class="admin-nav__items">
                        <button class="admin-tab" onclick="switchTab('proOverview')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                            <span>Übersicht</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('proFeatureFlags')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>
                            <span>Feature Flags</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('proThemeGating')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                            <span>Theme-Gating</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('proLimits')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg>
                            <span>Limits</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('proPromos')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
                            <span>Promos & Trials</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('proPipeline')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                            <span>Content Pipeline</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('proRevenue')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                            <span>Revenue</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('proChurn')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="18" y1="8" x2="23" y2="13"/><line x1="23" y1="8" x2="18" y2="13"/></svg>
                            <span>Kündigungen</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('proLicenses')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4"/><path d="M4 6v12c0 1.1.9 2 2 2h14v-4"/><path d="M18 12a2 2 0 0 0-2 2c0 1.1.9 2 2 2h4v-4h-4z"/></svg>
                            <span>Lizenzen</span>
                        </button>
                    </div>
                </div>
                
                <!-- System Section -->
                <div class="admin-nav__section admin-nav__section--system">
                    <div class="admin-nav__label">System</div>
                    <div class="admin-nav__items">
                        <button class="admin-tab" onclick="switchTab('analytics')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 20V10"/><path d="M12 20V4"/><path d="M6 20v-6"/></svg>
                            <span>Analytics</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('audit')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                            <span>Audit Log</span>
                        </button>
                        <button class="admin-tab" onclick="switchTab('team')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/><circle cx="12" cy="12" r="3"/></svg>
                            <span>Team</span>
                        </button>
                    </div>
                </div>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="admin-main">
            
            <!-- ═══════════════════════════════════════
                 NEWS PAGE
                 ═══════════════════════════════════════ -->
            <div class="admin-page active" id="page-news">
                <!-- Page Header -->
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">News verwalten</h1>
                        <p class="page-header__subtitle">Erstelle und verwalte News-Artikel für alle RIFT Nutzer</p>
                    </div>
                    <button class="btn btn--primary" onclick="NewsAdmin.openEditor()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Neuer Artikel
                    </button>
                </div>
                
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card__label">Veröffentlicht</div>
                        <div class="stat-card__value stat-card__value--green" id="statPublished">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Entwürfe</div>
                        <div class="stat-card__value stat-card__value--yellow" id="statDrafts">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Featured</div>
                        <div class="stat-card__value stat-card__value--accent" id="statFeatured">0</div>
                    </div>
                </div>
                
                <!-- News Table -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">Alle Artikel</h2>
                    </div>
                    <div id="newsTableContainer">
                        <table class="news-table">
                            <thead>
                                <tr>
                                    <th style="width: 100px;">Bild</th>
                                    <th>Titel</th>
                                    <th style="width: 100px;">Kategorie</th>
                                    <th style="width: 100px;">Status</th>
                                    <th style="width: 120px;">Datum</th>
                                    <th style="width: 140px;"></th>
                                </tr>
                            </thead>
                            <tbody id="newsTableBody">
                                <tr>
                                    <td colspan="6">
                                        <div class="empty-state">
                                            <div class="loading-spinner" style="margin: 0 auto;"></div>
                                            <p style="margin-top: 16px;">Lade Artikel...</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 CAROUSEL PAGE
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-carousel">
                <!-- Page Header -->
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Carousels verwalten</h1>
                        <p class="page-header__subtitle">Hero-Slides auf verschiedenen Seiten bearbeiten</p>
                    </div>
                    <button class="btn btn--primary" onclick="CarouselAdmin.openEditor()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Neue Slide
                    </button>
                </div>
                
                <!-- Carousel Type Tabs -->
                <div class="carousel-type-tabs" style="display: flex; gap: 8px; margin-bottom: 24px;">
                    <button class="carousel-type-tab active" data-collection="hub_slides" onclick="CarouselAdmin.switchCollection('hub_slides', this)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg>
                        Carousel (Hub)
                    </button>
                    <button class="carousel-type-tab" data-collection="session_slides" onclick="CarouselAdmin.switchCollection('session_slides', this)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                        Carousel (Sessions)
                    </button>
                    <button class="carousel-type-tab" data-collection="sheet_slides" onclick="CarouselAdmin.switchCollection('sheet_slides', this)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                        Carousel (Charaktere)
                    </button>
                </div>
                
                <!-- Current Collection Indicator -->
                <div id="currentCollectionInfo" style="margin-bottom: 16px; padding: 12px 16px; background: var(--bg-input); border-radius: 8px; font-size: 13px; color: var(--text-muted);">
                    📍 Aktive Collection: <strong style="color: var(--text);">hub_slides</strong> (Hub-Startseite)
                </div>
                
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card__label">Aktive Slides</div>
                        <div class="stat-card__value stat-card__value--green" id="statActiveSlides">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Inaktiv</div>
                        <div class="stat-card__value stat-card__value--yellow" id="statInactiveSlides">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Autoplay</div>
                        <div class="stat-card__value" id="statAutoplay">6s</div>
                    </div>
                </div>
                
                <!-- Slides List -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">Alle Slides</h2>
                        <span style="font-size: 13px; color: var(--text-muted);">Reihenfolge per Pfeile ändern</span>
                    </div>
                    <div class="slides-list" id="slidesList">
                        <div class="empty-state">
                            <div class="loading-spinner" style="margin: 0 auto;"></div>
                            <p style="margin-top: 16px;">Lade Slides...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 FEATURES PAGE
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-features">
                <!-- Page Header -->
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Feature Showcase verwalten</h1>
                        <p class="page-header__subtitle">Features auf der Hub-Seite bearbeiten (Charakterbogen, Würfel, Maps, etc.)</p>
                    </div>
                    <button class="btn btn--primary" onclick="FeaturesAdmin.openEditor()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Neues Feature
                    </button>
                </div>
                
                <!-- Features List -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">Alle Features</h2>
                    </div>
                    <div class="slides-list" id="featuresList">
                        <div class="empty-state">
                            <div class="loading-spinner" style="margin: 0 auto;"></div>
                            <p style="margin-top: 16px;">Lade Features...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 QUOTES PAGE (Worte der Weisheit)
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-quotes">
                <!-- Page Header -->
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Worte der Weisheit</h1>
                        <p class="page-header__subtitle">Verwalte inspirierende Zitate für die Hub-Seite</p>
                    </div>
                    <button class="btn btn--primary" onclick="QuotesAdmin.openEditor()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Neues Zitat
                    </button>
                </div>
                
                <!-- Quote Settings -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card__header">
                        <h2 class="card__title">Einstellungen</h2>
                    </div>
                    <div class="card__body" style="padding: 24px;">
                        <div class="form-row" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px;">
                            <!-- Display Mode -->
                            <div class="form-group">
                                <label class="form-label">Anzeigemodus</label>
                                <select class="form-select" id="quoteDisplayMode" onchange="QuotesAdmin.updateSettings()">
                                    <option value="daily">Täglich wechselnd</option>
                                    <option value="random">Zufällig bei Seitenaufruf</option>
                                    <option value="sequential">Der Reihe nach</option>
                                    <option value="fixed">Festes Zitat</option>
                                </select>
                            </div>
                            
                            <!-- Change Time (for daily mode) -->
                            <div class="form-group" id="quoteChangeTimeGroup">
                                <label class="form-label">Wechselzeit (täglich)</label>
                                <input type="time" class="form-input" id="quoteChangeTime" value="00:00" onchange="QuotesAdmin.updateSettings()">
                            </div>
                            
                            <!-- Fixed Quote (for fixed mode) -->
                            <div class="form-group" id="quoteFixedGroup" style="display: none;">
                                <label class="form-label">Festes Zitat</label>
                                <select class="form-select" id="quoteFixedId" onchange="QuotesAdmin.updateSettings()">
                                    <option value="">Zitat auswählen...</option>
                                </select>
                            </div>
                            
                            <!-- Animation -->
                            <div class="form-group">
                                <label class="form-label">Animation</label>
                                <select class="form-select" id="quoteAnimation" onchange="QuotesAdmin.updateSettings()">
                                    <option value="fade">Fade</option>
                                    <option value="slide">Slide</option>
                                    <option value="typewriter">Schreibmaschine</option>
                                    <option value="none">Keine</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-section-header" style="margin-top: 24px;">
                            <span>Darstellung</span>
                        </div>
                        
                        <div class="form-row" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; margin-top: 16px;">
                            <!-- Font Style -->
                            <div class="form-group">
                                <label class="form-label">Schriftstil</label>
                                <select class="form-select" id="quoteFontStyle" onchange="QuotesAdmin.updateSettings()">
                                    <option value="normal">Normal</option>
                                    <option value="italic">Kursiv</option>
                                    <option value="serif">Serif (elegant)</option>
                                    <option value="handwritten">Handschrift</option>
                                </select>
                            </div>
                            
                            <!-- Font Size -->
                            <div class="form-group">
                                <label class="form-label">Schriftgröße</label>
                                <select class="form-select" id="quoteFontSize" onchange="QuotesAdmin.updateSettings()">
                                    <option value="small">Klein (16px)</option>
                                    <option value="medium" selected>Mittel (18px)</option>
                                    <option value="large">Groß (22px)</option>
                                    <option value="xlarge">Sehr groß (26px)</option>
                                </select>
                            </div>
                            
                            <!-- Text Alignment -->
                            <div class="form-group">
                                <label class="form-label">Ausrichtung</label>
                                <select class="form-select" id="quoteAlignment" onchange="QuotesAdmin.updateSettings()">
                                    <option value="left">Links</option>
                                    <option value="center" selected>Zentriert</option>
                                    <option value="right">Rechts</option>
                                </select>
                            </div>
                            
                            <!-- Show Quotation Marks -->
                            <div class="form-group">
                                <label class="form-label">Anführungszeichen</label>
                                <select class="form-select" id="quoteMarks" onchange="QuotesAdmin.updateSettings()">
                                    <option value="german">„Deutsch"</option>
                                    <option value="english">"English"</option>
                                    <option value="guillemets">«Guillemets»</option>
                                    <option value="none">Keine</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; margin-top: 16px;">
                            <!-- Show Author -->
                            <div class="form-group">
                                <label class="form-checkbox">
                                    <input type="checkbox" id="quoteShowAuthor" checked onchange="QuotesAdmin.updateSettings()">
                                    <span>Autor anzeigen</span>
                                </label>
                            </div>
                            
                            <!-- Show Source -->
                            <div class="form-group">
                                <label class="form-checkbox">
                                    <input type="checkbox" id="quoteShowSource" checked onchange="QuotesAdmin.updateSettings()">
                                    <span>Quelle anzeigen</span>
                                </label>
                            </div>
                            
                            <!-- Show Category Badge -->
                            <div class="form-group">
                                <label class="form-checkbox">
                                    <input type="checkbox" id="quoteShowCategory" onchange="QuotesAdmin.updateSettings()">
                                    <span>Kategorie-Badge</span>
                                </label>
                            </div>
                            
                            <!-- Enable Widget -->
                            <div class="form-group">
                                <label class="form-checkbox">
                                    <input type="checkbox" id="quoteEnabled" checked onchange="QuotesAdmin.updateSettings()">
                                    <span>Widget aktiv</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Preview -->
                        <div class="form-section-header" style="margin-top: 24px;">
                            <span>Vorschau</span>
                        </div>
                        
                        <div id="quotePreview" style="margin-top: 16px; padding: 32px; background: var(--bg); border-radius: var(--radius); border: 1px solid var(--border);">
                            <div id="quotePreviewContent" style="text-align: center;">
                                <p style="font-size: 18px; font-style: italic; color: var(--text); margin-bottom: 12px;">
                                    „Das Würfeln ist des Spielers Lust."
                                </p>
                                <p style="font-size: 14px; color: var(--text-muted);">
                                    — Unbekannter Roleplayer, <em>Irgendwo im Keller</em>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Stats -->
                <div class="stats-grid" style="margin-bottom: 24px;">
                    <div class="stat-card">
                        <div class="stat-card__label">Gesamt</div>
                        <div class="stat-card__value" id="statQuotesTotal">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Aktiv</div>
                        <div class="stat-card__value stat-card__value--green" id="statQuotesActive">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Kategorien</div>
                        <div class="stat-card__value stat-card__value--accent" id="statQuotesCategories">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Heutiges Zitat</div>
                        <div class="stat-card__value stat-card__value--blue" id="statQuotesToday">#1</div>
                    </div>
                </div>
                
                <!-- Filter Bar -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card__body" style="padding: 16px 24px;">
                        <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
                            <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
                                <input type="text" class="form-input" id="quoteSearch" placeholder="Zitate durchsuchen..." oninput="QuotesAdmin.filter()">
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <select class="form-select" id="quoteCategoryFilter" onchange="QuotesAdmin.filter()">
                                    <option value="">Alle Kategorien</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <select class="form-select" id="quoteStatusFilter" onchange="QuotesAdmin.filter()">
                                    <option value="">Alle Status</option>
                                    <option value="active">Aktiv</option>
                                    <option value="inactive">Inaktiv</option>
                                </select>
                            </div>
                            <button class="btn btn--secondary" onclick="QuotesAdmin.importQuotes()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="17 8 12 3 7 8"/>
                                    <line x1="12" y1="3" x2="12" y2="15"/>
                                </svg>
                                Import
                            </button>
                            <button class="btn btn--secondary" onclick="QuotesAdmin.exportQuotes()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Export
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Quotes List -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">Alle Zitate</h2>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn--ghost btn--small" onclick="QuotesAdmin.selectAll()">Alle auswählen</button>
                            <button class="btn btn--ghost btn--small" onclick="QuotesAdmin.deleteSelected()" id="deleteSelectedBtn" style="display: none; color: var(--red);">Ausgewählte löschen</button>
                        </div>
                    </div>
                    <div id="quotesTableContainer">
                        <table class="news-table">
                            <thead>
                                <tr>
                                    <th style="width: 40px;"><input type="checkbox" id="selectAllQuotes" onchange="QuotesAdmin.toggleSelectAll()"></th>
                                    <th>Zitat</th>
                                    <th style="width: 150px;">Autor</th>
                                    <th style="width: 120px;">Kategorie</th>
                                    <th style="width: 80px;">Status</th>
                                    <th style="width: 120px;">Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="quotesTableBody">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 60px;">
                                        <div class="loading-spinner" style="margin: 0 auto;"></div>
                                        <p style="margin-top: 16px; color: var(--text-muted);">Lade Zitate...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 USERS PAGE (Benutzer-Verwaltung)
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-users">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Benutzer-Verwaltung</h1>
                        <p class="page-header__subtitle">Alle registrierten Nutzer verwalten, Rollen vergeben und Aktivität überwachen</p>
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn--secondary" onclick="UsersAdmin.exportUsers()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                            Export
                        </button>
                    </div>
                </div>
                
                <!-- Stats -->
                <div class="stats-grid" style="margin-bottom: 24px;">
                    <div class="stat-card">
                        <div class="stat-card__label">Gesamt</div>
                        <div class="stat-card__value" id="statUsersTotal">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Heute aktiv</div>
                        <div class="stat-card__value stat-card__value--green" id="statUsersToday">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Diese Woche</div>
                        <div class="stat-card__value stat-card__value--blue" id="statUsersWeek">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Admins</div>
                        <div class="stat-card__value stat-card__value--accent" id="statUsersAdmins">0</div>
                    </div>
                </div>
                
                <!-- Filter -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card__body" style="padding: 16px 24px;">
                        <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
                            <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
                                <input type="text" class="form-input" id="userSearch" placeholder="Name, Email oder UID suchen..." oninput="UsersAdmin.filter()">
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <select class="form-select" id="userRoleFilter" onchange="UsersAdmin.filter()">
                                    <option value="">Alle Rollen</option>
                                    <option value="admin">Admin</option>
                                    <option value="moderator">Moderator</option>
                                    <option value="user">User</option>
                                    <option value="banned">Gesperrt</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <select class="form-select" id="userActivityFilter" onchange="UsersAdmin.filter()">
                                    <option value="">Alle</option>
                                    <option value="today">Heute aktiv</option>
                                    <option value="week">Diese Woche</option>
                                    <option value="month">Diesen Monat</option>
                                    <option value="inactive">Inaktiv (30+ Tage)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Users Table -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">Alle Benutzer</h2>
                        <span style="color: var(--text-muted); font-size: 13px;" id="usersCount">0 Benutzer</span>
                    </div>
                    <div id="usersTableContainer">
                        <table class="news-table">
                            <thead>
                                <tr>
                                    <th style="width: 50px;"></th>
                                    <th>Benutzer</th>
                                    <th style="width: 120px;">Rolle</th>
                                    <th style="width: 150px;">Registriert</th>
                                    <th style="width: 150px;">Letzter Login</th>
                                    <th style="width: 100px;">Sessions</th>
                                    <th style="width: 120px;">Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <tr><td colspan="7" style="text-align:center;padding:60px;"><div class="loading-spinner" style="margin:0 auto;"></div><p style="margin-top:16px;color:var(--text-muted);">Lade Benutzer...</p></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 SESSIONS PAGE (Sessions-Übersicht)
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-sessions">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Sessions-Übersicht</h1>
                        <p class="page-header__subtitle">Alle aktiven Sessions überwachen und moderieren</p>
                    </div>
                </div>
                
                <!-- Stats -->
                <div class="stats-grid" style="margin-bottom: 24px;">
                    <div class="stat-card">
                        <div class="stat-card__label">Aktive Sessions</div>
                        <div class="stat-card__value stat-card__value--green" id="statSessionsActive">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Diese Woche geplant</div>
                        <div class="stat-card__value stat-card__value--blue" id="statSessionsWeek">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Gesamt gespielt</div>
                        <div class="stat-card__value" id="statSessionsTotal">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">⌀ Spieler/Session</div>
                        <div class="stat-card__value stat-card__value--accent" id="statSessionsAvgPlayers">0</div>
                    </div>
                </div>
                
                <!-- Ruleset Stats -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card__header">
                        <h2 class="card__title">Beliebteste Regelwerke</h2>
                    </div>
                    <div class="card__body" style="padding: 24px;">
                        <div id="rulesetStats" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px;">
                            <div style="text-align: center; padding: 20px; color: var(--text-muted);">Lade Statistiken...</div>
                        </div>
                    </div>
                </div>
                
                <!-- Filter -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card__body" style="padding: 16px 24px;">
                        <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
                            <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
                                <input type="text" class="form-input" id="sessionSearch" placeholder="Session-Name suchen..." oninput="SessionsAdmin.filter()">
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <select class="form-select" id="sessionRulesetFilter" onchange="SessionsAdmin.filter()">
                                    <option value="">Alle Regelwerke</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <select class="form-select" id="sessionStatusFilter" onchange="SessionsAdmin.filter()">
                                    <option value="">Alle Status</option>
                                    <option value="active">Aktiv</option>
                                    <option value="scheduled">Geplant</option>
                                    <option value="ended">Beendet</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sessions Table -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">Alle Sessions</h2>
                    </div>
                    <div id="sessionsTableContainer">
                        <table class="news-table">
                            <thead>
                                <tr>
                                    <th>Session</th>
                                    <th style="width: 120px;">Regelwerk</th>
                                    <th style="width: 100px;">Spieler</th>
                                    <th style="width: 120px;">GM</th>
                                    <th style="width: 150px;">Nächstes Spiel</th>
                                    <th style="width: 100px;">Status</th>
                                    <th style="width: 100px;">Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="sessionsTableBody">
                                <tr><td colspan="7" style="text-align:center;padding:60px;"><div class="loading-spinner" style="margin:0 auto;"></div><p style="margin-top:16px;color:var(--text-muted);">Lade Sessions...</p></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 FEEDBACK PAGE (Bug Reports & Feedback)
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-feedback">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Feedback & Bug Reports</h1>
                        <p class="page-header__subtitle">User-Feedback sammeln und Bugs verwalten</p>
                    </div>
                </div>
                
                <!-- Stats -->
                <div class="stats-grid" style="margin-bottom: 24px;">
                    <div class="stat-card">
                        <div class="stat-card__label">Offen</div>
                        <div class="stat-card__value stat-card__value--yellow" id="statFeedbackOpen">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">In Bearbeitung</div>
                        <div class="stat-card__value stat-card__value--blue" id="statFeedbackProgress">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Gelöst</div>
                        <div class="stat-card__value stat-card__value--green" id="statFeedbackResolved">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Bugs</div>
                        <div class="stat-card__value stat-card__value--red" id="statFeedbackBugs">0</div>
                    </div>
                </div>
                
                <!-- Filter -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card__body" style="padding: 16px 24px;">
                        <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
                            <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
                                <input type="text" class="form-input" id="feedbackSearch" placeholder="Suchen..." oninput="FeedbackAdmin.filter()">
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <select class="form-select" id="feedbackTypeFilter" onchange="FeedbackAdmin.filter()">
                                    <option value="">Alle Typen</option>
                                    <option value="bug">Bug Report</option>
                                    <option value="feature">Feature Request</option>
                                    <option value="feedback">Feedback</option>
                                    <option value="question">Frage</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <select class="form-select" id="feedbackStatusFilter" onchange="FeedbackAdmin.filter()">
                                    <option value="">Alle Status</option>
                                    <option value="open">Offen</option>
                                    <option value="progress">In Bearbeitung</option>
                                    <option value="resolved">Gelöst</option>
                                    <option value="closed">Geschlossen</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <select class="form-select" id="feedbackPriorityFilter" onchange="FeedbackAdmin.filter()">
                                    <option value="">Alle Prioritäten</option>
                                    <option value="critical">Kritisch</option>
                                    <option value="high">Hoch</option>
                                    <option value="medium">Mittel</option>
                                    <option value="low">Niedrig</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Feedback List -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">Alle Einträge</h2>
                    </div>
                    <div id="feedbackListContainer" style="max-height: 600px; overflow-y: auto;">
                        <div style="text-align:center;padding:60px;"><div class="loading-spinner" style="margin:0 auto;"></div><p style="margin-top:16px;color:var(--text-muted);">Lade Feedback...</p></div>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 ANNOUNCEMENTS PAGE (Banner)
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-announcements">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Banner & Ankündigungen</h1>
                        <p class="page-header__subtitle">Erstelle Banner für wichtige Mitteilungen, Events und Wartungsarbeiten</p>
                    </div>
                    <button class="btn btn--primary" onclick="AnnouncementsAdmin.openEditor()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Neuer Banner
                    </button>
                </div>
                
                <!-- Banner Stats -->
                <div id="bannerStats" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
                    <div class="stat-card stat-card--small"><div class="stat-card__value" style="color:var(--green);">0</div><div class="stat-card__label">Aktiv</div></div>
                    <div class="stat-card stat-card--small"><div class="stat-card__value" style="color:var(--accent);">0</div><div class="stat-card__label">Geplant</div></div>
                    <div class="stat-card stat-card--small"><div class="stat-card__value">0</div><div class="stat-card__label">Views</div></div>
                    <div class="stat-card stat-card--small"><div class="stat-card__value">0</div><div class="stat-card__label">Dismissed</div></div>
                </div>
                
                <!-- Current Active Banner Preview -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card__header">
                        <h2 class="card__title">Live-Vorschau</h2>
                        <span class="card__badge" style="background: var(--green);">Aktiver Banner</span>
                    </div>
                    <div class="card__body" style="padding: 24px;">
                        <div id="activeBannerPreview" style="background: var(--bg); border-radius: 12px; min-height: 80px;">
                            <p style="color: var(--text-muted); text-align: center; padding: 30px;">Kein aktiver Banner</p>
                        </div>
                    </div>
                </div>
                
                <!-- Announcements List -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">Alle Banner</h2>
                        <div style="display: flex; gap: 12px;">
                            <select class="form-select" id="bannerFilterStatus" onchange="AnnouncementsAdmin.filter()" style="width: auto;">
                                <option value="">Alle Status</option>
                                <option value="active">Aktiv</option>
                                <option value="scheduled">Geplant</option>
                                <option value="inactive">Inaktiv</option>
                            </select>
                            <select class="form-select" id="bannerFilterType" onchange="AnnouncementsAdmin.filter()" style="width: auto;">
                                <option value="">Alle Typen</option>
                                <option value="info">Info</option>
                                <option value="warning">Warnung</option>
                                <option value="critical">Kritisch</option>
                                <option value="maintenance">Wartung</option>
                                <option value="event">Event</option>
                            </select>
                        </div>
                    </div>
                    <div class="slides-list" id="announcementsList">
                        <div style="text-align:center;padding:60px;"><div class="loading-spinner" style="margin:0 auto;"></div><p style="margin-top:16px;color:var(--text-muted);">Lade Banner...</p></div>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 ANALYTICS PAGE
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-analytics">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Analytics Dashboard</h1>
                        <p class="page-header__subtitle">Nutzungsstatistiken und Aktivitätsübersicht</p>
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <select class="form-select" id="analyticsTimeRange" onchange="AnalyticsAdmin.load()" style="width: auto;">
                            <option value="7">Letzte 7 Tage</option>
                            <option value="30" selected>Letzte 30 Tage</option>
                            <option value="90">Letzte 90 Tage</option>
                            <option value="365">Letztes Jahr</option>
                        </select>
                    </div>
                </div>
                
                <!-- Main Stats -->
                <div class="stats-grid" style="margin-bottom: 24px; grid-template-columns: repeat(5, 1fr);">
                    <div class="stat-card">
                        <div class="stat-card__label">Aktive User (heute)</div>
                        <div class="stat-card__value stat-card__value--green" id="statAnalyticsDAU">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Aktive User (Woche)</div>
                        <div class="stat-card__value stat-card__value--blue" id="statAnalyticsWAU">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Aktive User (Monat)</div>
                        <div class="stat-card__value" id="statAnalyticsMAU">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Neue Registrierungen</div>
                        <div class="stat-card__value stat-card__value--accent" id="statAnalyticsNewUsers">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Sessions gespielt</div>
                        <div class="stat-card__value stat-card__value--yellow" id="statAnalyticsSessions">0</div>
                    </div>
                </div>
                
                <!-- Charts Row -->
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-bottom: 24px;">
                    <!-- Activity Chart -->
                    <div class="card">
                        <div class="card__header">
                            <h2 class="card__title">Aktivität über Zeit</h2>
                        </div>
                        <div class="card__body" style="padding: 24px;">
                            <div id="activityChart" style="height: 250px; display: flex; align-items: flex-end; gap: 4px;">
                                <!-- Bars will be generated -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Peak Times -->
                    <div class="card">
                        <div class="card__header">
                            <h2 class="card__title">Peak-Zeiten</h2>
                        </div>
                        <div class="card__body" style="padding: 24px;">
                            <div id="peakTimesChart">
                                <div style="text-align: center; color: var(--text-muted);">Lade Daten...</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Popular Pages & Devices -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <div class="card">
                        <div class="card__header">
                            <h2 class="card__title">Beliebte Seiten</h2>
                        </div>
                        <div class="card__body" style="padding: 24px;">
                            <div id="popularPages">
                                <div style="text-align: center; color: var(--text-muted);">Lade Daten...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card__header">
                            <h2 class="card__title">Geräte & Browser</h2>
                        </div>
                        <div class="card__body" style="padding: 24px;">
                            <div id="deviceStats">
                                <div style="text-align: center; color: var(--text-muted);">Lade Daten...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 CHANGELOG PAGE
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-changelog">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Changelog</h1>
                        <p class="page-header__subtitle">Versionshistorie und Updates verwalten</p>
                    </div>
                    <button class="btn btn--primary" onclick="ChangelogAdmin.openEditor()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Neue Version
                    </button>
                </div>
                
                <!-- Changelog List -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">Alle Versionen</h2>
                    </div>
                    <div id="changelogList" style="max-height: 700px; overflow-y: auto;">
                        <div style="text-align:center;padding:60px;"><div class="loading-spinner" style="margin:0 auto;"></div><p style="margin-top:16px;color:var(--text-muted);">Lade Changelog...</p></div>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 FAQ PAGE
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-faq">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">FAQ / Help Center</h1>
                        <p class="page-header__subtitle">Häufig gestellte Fragen verwalten</p>
                    </div>
                    <button class="btn btn--primary" onclick="FAQAdmin.openEditor()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Neue FAQ
                    </button>
                </div>
                
                <!-- Categories -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card__header">
                        <h2 class="card__title">Kategorien</h2>
                        <button class="btn btn--ghost btn--small" onclick="FAQAdmin.openCategoryEditor()">+ Kategorie</button>
                    </div>
                    <div class="card__body" style="padding: 16px 24px;">
                        <div id="faqCategories" style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <span style="color: var(--text-muted);">Lade Kategorien...</span>
                        </div>
                    </div>
                </div>
                
                <!-- FAQ List -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">Alle FAQs</h2>
                    </div>
                    <div id="faqList" style="max-height: 600px; overflow-y: auto;">
                        <div style="text-align:center;padding:60px;"><div class="loading-spinner" style="margin:0 auto;"></div><p style="margin-top:16px;color:var(--text-muted);">Lade FAQs...</p></div>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 RULESETS PAGE
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-rulesets">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Regelwerke</h1>
                        <p class="page-header__subtitle">Unterstützte Regelwerke verwalten</p>
                    </div>
                    <button class="btn btn--primary" onclick="RulesetsAdmin.openEditor()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Neues Regelwerk
                    </button>
                </div>
                
                <!-- Rulesets Grid -->
                <div id="rulesetsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px;">
                    <div style="text-align:center;padding:60px;grid-column:1/-1;"><div class="loading-spinner" style="margin:0 auto;"></div><p style="margin-top:16px;color:var(--text-muted);">Lade Regelwerke...</p></div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 ASSETS PAGE
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-assets">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Asset-Manager</h1>
                        <p class="page-header__subtitle">Bilder, Tokens und Icons verwalten</p>
                    </div>
                    <button class="btn btn--primary" onclick="AssetsAdmin.openUpload()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        Upload
                    </button>
                </div>
                
                <!-- Stats -->
                <div class="stats-grid" style="margin-bottom: 24px;">
                    <div class="stat-card">
                        <div class="stat-card__label">Gesamt</div>
                        <div class="stat-card__value" id="statAssetsTotal">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Bilder</div>
                        <div class="stat-card__value stat-card__value--blue" id="statAssetsImages">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Portraits</div>
                        <div class="stat-card__value stat-card__value--accent" id="statAssetsPortraits">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Speicher</div>
                        <div class="stat-card__value stat-card__value--green" id="statAssetsStorage">0 MB</div>
                    </div>
                </div>
                
                <!-- Filter -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card__body" style="padding: 16px 24px;">
                        <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
                            <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
                                <input type="text" class="form-input" id="assetSearch" placeholder="Suchen..." oninput="AssetsAdmin.filter()">
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <select class="form-select" id="assetTypeFilter" onchange="AssetsAdmin.filter()">
                                    <option value="">Alle Typen</option>
                                    <optgroup label="Allgemein">
                                        <option value="image">Bilder</option>
                                        <option value="token">Tokens</option>
                                        <option value="map">Maps</option>
                                        <option value="icon">Icons</option>
                                    </optgroup>
                                    <optgroup label="Portraits">
                                        <option value="portrait">Portrait (Allgemein)</option>
                                        <option value="portrait-worldsapart">Portrait (Worlds Apart)</option>
                                        <option value="portrait-dnd5e">Portrait (D&D 5e)</option>
                                        <option value="portrait-htbah">Portrait (HTBAH)</option>
                                        <option value="portrait-cyberpunk">Portrait (Cyberpunk)</option>
                                    </optgroup>
                                    <optgroup label="Dice Modul">
                                        <option value="dice-arena">Dice Arena</option>
                                        <option value="dice-texture">Dice Textures</option>
                                    </optgroup>
                                    <optgroup label="RIFT">
                                        <option value="news-cover">News-Cover</option>
                                        <option value="carousel-cover">Carousel-Cover</option>
                                        <option value="feature-asset">Feature-Assets</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <select class="form-select" id="assetViewMode" onchange="AssetsAdmin.render()">
                                    <option value="grid">Grid</option>
                                    <option value="list">Liste</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Assets Grid -->
                <div class="card">
                    <div id="assetsContainer" style="padding: 24px;">
                        <div style="text-align:center;padding:60px;"><div class="loading-spinner" style="margin:0 auto;"></div><p style="margin-top:16px;color:var(--text-muted);">Lade Assets...</p></div>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 ARENA THEMES PAGE
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-arenaThemes">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Arena Themes</h1>
                        <p class="page-header__subtitle">Würfelarena-Hintergründe verwalten (Free, Pro)</p>
                    </div>
                    <div style="display:flex;gap:12px;">
                        <button class="btn btn--secondary" onclick="ArenaThemesAdmin.importDefaultThemes()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                            Import Defaults
                        </button>
                        <button class="btn btn--primary" onclick="ArenaThemesAdmin.openEditor()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                            Neues Theme
                        </button>
                    </div>
                </div>
                
                <!-- Stats -->
                <div style="display:flex;gap:16px;margin-bottom:24px;flex-wrap:wrap;">
                    <div style="flex:1;min-width:140px;background:var(--bg-elevated);border-radius:12px;padding:20px;display:flex;align-items:center;gap:16px;border:1px solid var(--border);">
                        <div style="width:48px;height:48px;border-radius:10px;background:rgba(139,92,246,0.15);display:flex;align-items:center;justify-content:center;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="#8b5cf6" stroke-width="2" style="width:24px;height:24px;"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                        </div>
                        <div>
                            <div style="font-size:28px;font-weight:700;line-height:1;" id="statArenaTotal">0</div>
                            <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">Gesamt</div>
                        </div>
                    </div>
                    <div style="flex:1;min-width:140px;background:var(--bg-elevated);border-radius:12px;padding:20px;display:flex;align-items:center;gap:16px;border:1px solid var(--border);">
                        <img src="/assets/rift_pro/img/png/rift_free_badge01_white.png" alt="Free" style="width:48px;height:auto;border-radius:8px;">
                        <div>
                            <div style="font-size:28px;font-weight:700;line-height:1;color:#22C55E;" id="statArenaFree">0</div>
                            <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">Free</div>
                        </div>
                    </div>
                    <div style="flex:1;min-width:140px;background:var(--bg-elevated);border-radius:12px;padding:20px;display:flex;align-items:center;gap:16px;border:1px solid var(--border);">
                        <img src="/assets/rift_pro/img/png/rift_pro_badge01_white.png" alt="Pro" style="width:48px;height:auto;border-radius:8px;">
                        <div>
                            <div style="font-size:28px;font-weight:700;line-height:1;color:#bca24d;" id="statArenaPro">0</div>
                            <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">Pro</div>
                        </div>
                    </div>
                </div>
                
                <!-- Filter -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card__body" style="padding: 16px 24px;">
                        <div style="display:flex;gap:16px;align-items:center;flex-wrap:wrap;">
                            <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
                                <input type="text" class="form-input" id="arenaThemeSearch" placeholder="Suchen..." oninput="ArenaThemesAdmin.filter()">
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <select class="form-select" id="arenaThemeTierFilter" onchange="ArenaThemesAdmin.filter()">
                                    <option value="">Alle Tiers</option>
                                    <option value="free">Free</option>
                                    <option value="pro">Pro</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Themes Grid -->
                <div class="card">
                    <div id="arenaThemesContainer" style="padding: 24px;">
                        <div style="text-align:center;padding:60px;"><div class="loading-spinner" style="margin:0 auto;"></div><p style="margin-top:16px;color:var(--text-muted);">Lade Arena Themes...</p></div>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 TOKEN LIBRARY PAGE
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-tokenLibrary">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Token Library</h1>
                        <p class="page-header__subtitle">RIFT-weite Token-Vorlagen verwalten (sichtbar im Whiteboard Library-Tab)</p>
                    </div>
                    <button class="btn btn--primary" onclick="TokenLibraryAdmin.showCreate()">
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Token hinzufügen
                    </button>
                </div>
                <div class="card">
                    <div id="tokenLibAdminGrid" style="display:flex;flex-direction:column;gap:8px"></div>
                    <div id="tokenLibAdminEmpty" style="text-align:center;padding:32px;color:var(--text-muted);font-size:14px">Lade...</div>
                </div>
                
                <!-- Token Create/Edit Modal -->
                <div id="tokenLibModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:1000;align-items:center;justify-content:center">
                    <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:24px;min-width:500px;max-width:600px;max-height:85vh;overflow-y:auto">
                        <h3 id="tokenLibModalTitle" style="margin-bottom:16px">Token erstellen</h3>
                        
                        <!-- Type Buttons (identical to whiteboard) -->
                        <div id="tlTypeButtons" style="display:flex;gap:8px;margin-bottom:16px">
                            <button class="tl-type-btn" data-type="player" style="flex:1;padding:8px 6px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:rgba(255,255,255,0.5);font-size:11px;font-weight:600;cursor:pointer;text-align:center">Spieler</button>
                            <button class="tl-type-btn" data-type="npc" style="flex:1;padding:8px 6px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:rgba(255,255,255,0.5);font-size:11px;font-weight:600;cursor:pointer;text-align:center">NPC</button>
                            <button class="tl-type-btn active" data-type="monster" style="flex:1;padding:8px 6px;border-radius:8px;border:1px solid rgba(239,68,68,0.4);background:rgba(239,68,68,0.15);color:white;font-size:11px;font-weight:600;cursor:pointer;text-align:center">Gegner</button>
                            <button class="tl-type-btn" data-type="hidden" style="flex:1;padding:8px 6px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:rgba(255,255,255,0.5);font-size:11px;font-weight:600;cursor:pointer;text-align:center">Versteckt</button>
                        </div>
                        
                        <!-- Name -->
                        <input type="text" id="tlName" placeholder="Name..." style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:8px;padding:10px 12px;color:var(--text);font-size:14px;margin-bottom:16px;box-sizing:border-box">
                        
                        <!-- Portrait + Background Color -->
                        <div style="display:flex;gap:16px;margin-bottom:16px">
                            <div id="tlPortraitPreview" style="width:64px;height:64px;border-radius:50%;background:rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;cursor:pointer;overflow:hidden;flex-shrink:0;border:3px solid #ef4444" title="Portrait hochladen" onclick="document.getElementById('tlPortraitInput').click()">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.4)" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                            </div>
                            <div style="flex:1">
                                <div style="font-size:11px;color:var(--text-muted);margin-bottom:6px">Hintergrund</div>
                                <div id="tlColorPicker" style="display:flex;gap:6px;flex-wrap:wrap"></div>
                            </div>
                        </div>
                        <div style="margin-bottom:16px">
                            <div style="font-size:11px;color:var(--text-muted);margin-bottom:6px">Rahmenfarbe</div>
                            <div id="tlBorderPicker" style="display:flex;gap:6px;flex-wrap:wrap"></div>
                        </div>
                        <input type="file" id="tlPortraitInput" accept="image/*" style="display:none">
                        
                        <!-- Bild-URL (alternative to upload) -->
                        <div style="margin-bottom:16px">
                            <div style="font-size:11px;color:var(--text-muted);margin-bottom:6px">Bild-URL (alternativ zum Upload)</div>
                            <input type="text" id="tlImg" placeholder="https://..." style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:8px;padding:8px 12px;color:var(--text);font-size:13px;box-sizing:border-box">
                        </div>
                        
                        <!-- Stats Grid (identical layout to whiteboard) -->
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px">
                            <div><label style="font-size:11px;color:var(--text-muted);text-transform:uppercase;display:block;margin-bottom:4px">HP</label><input type="number" id="tlHp" placeholder="0" min="0" style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:10px 12px;color:var(--text);font-size:14px;box-sizing:border-box"></div>
                            <div><label style="font-size:11px;color:var(--text-muted);text-transform:uppercase;display:block;margin-bottom:4px">Max HP</label><input type="number" id="tlMaxHp" placeholder="0" min="0" style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:10px 12px;color:var(--text);font-size:14px;box-sizing:border-box"></div>
                            <div><label style="font-size:11px;color:var(--text-muted);text-transform:uppercase;display:block;margin-bottom:4px">AC / Rüstung</label><input type="number" id="tlAc" placeholder="10" min="0" style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:10px 12px;color:var(--text);font-size:14px;box-sizing:border-box"></div>
                            <div><label style="font-size:11px;color:var(--text-muted);text-transform:uppercase;display:block;margin-bottom:4px">Bewegung (Felder)</label><input type="number" id="tlSpeed" placeholder="6" min="0" style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:10px 12px;color:var(--text);font-size:14px;box-sizing:border-box"></div>
                            <div><label style="font-size:11px;color:var(--text-muted);text-transform:uppercase;display:block;margin-bottom:4px">Reichweite (Felder)</label><input type="number" id="tlRange" placeholder="1" min="0" style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:10px 12px;color:var(--text);font-size:14px;box-sizing:border-box"></div>
                            <div><label style="font-size:11px;color:var(--text-muted);text-transform:uppercase;display:block;margin-bottom:4px">Initiative</label><input type="number" id="tlInit" placeholder="--" min="0" style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:10px 12px;color:var(--text);font-size:14px;box-sizing:border-box"></div>
                        </div>
                        
                        <!-- Size Presets (identical to whiteboard) -->
                        <div style="margin-bottom:16px">
                            <div style="font-size:11px;color:var(--text-muted);margin-bottom:8px;text-transform:uppercase">Token-Größe</div>
                            <div id="tlSizePresets" style="display:flex;gap:6px;flex-wrap:wrap">
                                <button class="tl-size-btn" data-size="44" style="padding:6px 12px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:rgba(255,255,255,0.5);font-size:11px;font-weight:600;cursor:pointer">Klein (1x1)</button>
                                <button class="tl-size-btn active" data-size="70" style="padding:6px 12px;border-radius:6px;border:1px solid rgba(139,92,246,0.5);background:rgba(139,92,246,0.2);color:white;font-size:11px;font-weight:600;cursor:pointer">Normal (1x1)</button>
                                <button class="tl-size-btn" data-size="140" style="padding:6px 12px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:rgba(255,255,255,0.5);font-size:11px;font-weight:600;cursor:pointer">Groß (2x2)</button>
                                <button class="tl-size-btn" data-size="210" style="padding:6px 12px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:rgba(255,255,255,0.5);font-size:11px;font-weight:600;cursor:pointer">Riesig (3x3)</button>
                                <button class="tl-size-btn" data-size="280" style="padding:6px 12px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:rgba(255,255,255,0.5);font-size:11px;font-weight:600;cursor:pointer">Kolossal (4x4)</button>
                            </div>
                        </div>
                        
                        <!-- GM Notes -->
                        <div style="margin-bottom:16px">
                            <div style="font-size:11px;color:var(--text-muted);margin-bottom:6px;text-transform:uppercase">GM-Notiz</div>
                            <textarea id="tlNotes" rows="2" placeholder="Nur für den GM sichtbar..." style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:8px 12px;color:var(--text);font-size:13px;resize:vertical;box-sizing:border-box;font-family:inherit"></textarea>
                        </div>
                        
                        <!-- Zugehörigkeit -->
                        <div style="margin-bottom:16px">
                            <div style="display:flex;align-items:flex-end;gap:6px">
                                <div style="flex:1">
                                    <label style="font-size:11px;color:var(--text-muted);text-transform:uppercase;display:block;margin-bottom:4px">Zugehörigkeit</label>
                                    <input type="text" id="tlAffiliation" placeholder="z.B. Gilde der Magier, Orks..." style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:8px 12px;color:var(--text);font-size:13px;box-sizing:border-box">
                                </div>
                                <button id="tlAffVis" class="tl-vis-toggle visible" title="Für Spieler sichtbar" style="display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border:none;background:rgba(255,255,255,0.05);border-radius:4px;cursor:pointer;color:#22c55e;flex-shrink:0;margin-bottom:2px"><svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button>
                            </div>
                        </div>
                        
                        <!-- Items -->
                        <div style="margin-bottom:16px">
                            <div style="display:flex;align-items:flex-end;gap:6px">
                                <div style="flex:1">
                                    <label style="font-size:11px;color:var(--text-muted);text-transform:uppercase;display:block;margin-bottom:4px">Items</label>
                                    <input type="text" id="tlItems" placeholder="z.B. Schwert, Heiltrank, Schlüssel..." style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:8px 12px;color:var(--text);font-size:13px;box-sizing:border-box">
                                </div>
                                <button id="tlItemsVis" class="tl-vis-toggle visible" title="Für Spieler sichtbar" style="display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border:none;background:rgba(255,255,255,0.05);border-radius:4px;cursor:pointer;color:#22c55e;flex-shrink:0;margin-bottom:2px"><svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button>
                            </div>
                        </div>
                        
                        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:16px">
                            <button class="btn btn--secondary" onclick="TokenLibraryAdmin.hideModal()">Abbrechen</button>
                            <button class="btn btn--primary" onclick="TokenLibraryAdmin.save()">Speichern</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 AUDIT LOG PAGE
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-audit">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Audit Log</h1>
                        <p class="page-header__subtitle">Alle Admin-Aktionen und Änderungen nachverfolgen</p>
                    </div>
                    <button class="btn btn--secondary" onclick="AuditAdmin.export()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        Export
                    </button>
                </div>
                
                <!-- Filter -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card__body" style="padding: 16px 24px;">
                        <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
                            <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
                                <input type="text" class="form-input" id="auditSearch" placeholder="Suchen..." oninput="AuditAdmin.filter()">
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <select class="form-select" id="auditActionFilter" onchange="AuditAdmin.filter()">
                                    <option value="">Alle Aktionen</option>
                                    <option value="create">Erstellt</option>
                                    <option value="update">Bearbeitet</option>
                                    <option value="delete">Gelöscht</option>
                                    <option value="login">Login</option>
                                    <option value="settings">Einstellungen</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <select class="form-select" id="auditUserFilter" onchange="AuditAdmin.filter()">
                                    <option value="">Alle Admins</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <input type="date" class="form-input" id="auditDateFilter" onchange="AuditAdmin.filter()">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Audit Log List -->
                <div class="card">
                    <div id="auditLogContainer" style="max-height: 600px; overflow-y: auto;">
                        <div style="text-align:center;padding:60px;"><div class="loading-spinner" style="margin:0 auto;"></div><p style="margin-top:16px;color:var(--text-muted);">Lade Audit Log...</p></div>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 TEAM PAGE
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-team">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Team & Admins</h1>
                        <p class="page-header__subtitle">Verwalte wer Zugriff auf das Admin-Panel hat</p>
                    </div>
                </div>
                
                <!-- Add Admin -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card__header">
                        <h2 class="card__title">Admin hinzufügen</h2>
                    </div>
                    <div class="card__body" style="padding: 24px;">
                        <p style="color: var(--text-muted); margin-bottom: 16px;">
                            Wenn jemand die Admin-Seite ohne Berechtigung aufruft, wird seine UID angezeigt. 
                            Diese UID kannst du hier eintragen um der Person Zugriff zu geben.
                        </p>
                        <div style="display: flex; gap: 12px;">
                            <input type="text" class="form-input" id="newAdminUid" placeholder="UID eingeben (z.B. abc123xyz...)" style="flex: 1; font-family: monospace;">
                            <input type="text" class="form-input" id="newAdminName" placeholder="Name (optional)" style="width: 200px;">
                            <button class="btn btn--primary" onclick="TeamAdmin.addAdmin()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
                                Hinzufügen
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Current Admins -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">Aktuelle Admins</h2>
                        <span class="card__badge" id="adminCount">0</span>
                    </div>
                    <div id="adminList" style="padding: 0;">
                        <div style="text-align:center;padding:60px;color:var(--text-muted);">Lade Admins...</div>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 FOKUS-KATALOG — ABILITY EDITOR
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-fokusKatalog">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Fokus-Katalog</h1>
                        <p class="page-header__subtitle">Alle Worlds Apart F&auml;higkeiten verwalten &mdash; Texte, Werte, Farben, Piktogramme</p>
                    </div>
                    <div style="display:flex;gap:8px">
                        <button class="btn btn--outline" onclick="FokusAdmin.exportJSON()">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                            JSON Export
                        </button>
                        <button class="btn btn--primary" onclick="FokusAdmin.saveAll()">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                            Speichern
                        </button>
                    </div>
                </div>

                <!-- Category Tabs -->
                <div class="card" style="padding:0;margin-bottom:16px">
                    <div id="fk-category-tabs" style="display:flex;border-bottom:1px solid var(--border)">
                        <button class="fk-cat-tab active" onclick="FokusAdmin.switchCategory('element')" data-cat="element" style="flex:1;padding:14px;background:none;border:none;color:var(--text);font-size:14px;font-weight:600;cursor:pointer;border-bottom:2px solid var(--accent);transition:all 0.2s">
                            Element
                            <span style="font-size:11px;opacity:0.5;margin-left:4px" id="fk-count-element">—</span>
                        </button>
                        <button class="fk-cat-tab" onclick="FokusAdmin.switchCategory('weapon')" data-cat="weapon" style="flex:1;padding:14px;background:none;border:none;color:var(--text-muted);font-size:14px;font-weight:600;cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s">
                            Waffen-Spezialist
                            <span style="font-size:11px;opacity:0.5;margin-left:4px" id="fk-count-weapon">0</span>
                        </button>
                        <button class="fk-cat-tab" onclick="FokusAdmin.switchCategory('support')" data-cat="support" style="flex:1;padding:14px;background:none;border:none;color:var(--text-muted);font-size:14px;font-weight:600;cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s">
                            Support
                            <span style="font-size:11px;opacity:0.5;margin-left:4px" id="fk-count-support">0</span>
                        </button>
                    </div>
                </div>

                <!-- Style Selector + Ability List -->
                <div style="display:flex;gap:16px">
                    <!-- Style List (Left) -->
                    <div class="card" style="width:220px;flex-shrink:0;padding:8px">
                        <div id="fk-style-list" style="display:flex;flex-direction:column;gap:4px"></div>
                        <button class="btn btn--outline" style="width:100%;margin-top:8px;font-size:12px" onclick="FokusAdmin.addStyle()">
                            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                            Neuer Stil
                        </button>
                    </div>

                    <!-- Ability Editor (Right) -->
                    <div class="card" style="flex:1;padding:0">
                        <!-- Style Meta Header -->
                        <div id="fk-style-header" style="padding:16px;border-bottom:1px solid var(--border);display:none">
                            <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
                                <div id="fk-style-icon-preview" style="width:40px;height:40px;border-radius:10px;background:var(--bg-input);display:flex;align-items:center;justify-content:center;overflow:hidden">
                                    <span style="color:var(--text-muted);font-size:11px">Icon</span>
                                </div>
                                <div style="flex:1;display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:8px;align-items:center">
                                    <input type="text" id="fk-style-name" placeholder="Stil-Name" style="background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:var(--text);font-size:14px;font-weight:600">
                                    <input type="text" id="fk-style-mainAttr" placeholder="Haupt-Attr (z.B. KRF)" style="background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:var(--text);font-size:13px">
                                    <input type="text" id="fk-style-icon" placeholder="icon_focus_fire.png" style="background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:var(--text);font-size:13px">
                                    <input type="color" id="fk-style-color" value="#ff6b35" style="width:40px;height:36px;border:none;border-radius:6px;cursor:pointer;background:none">
                                </div>
                            </div>
                        </div>

                        <!-- Ability Tables -->
                        <div id="fk-abilities-area" style="padding:16px">
                            <div style="text-align:center;padding:40px;color:var(--text-muted)">Stil ausw&auml;hlen</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fokus Ability Edit Modal -->
            <div id="fk-ability-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:1000;align-items:center;justify-content:center">
                <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:24px;width:700px;max-height:85vh;overflow-y:auto">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
                        <h3 id="fk-modal-title">F&auml;higkeit bearbeiten</h3>
                        <button onclick="FokusAdmin.closeModal()" style="background:none;border:none;color:var(--text-muted);font-size:20px;cursor:pointer">&times;</button>
                    </div>

                    <!-- Core Fields -->
                    <div style="display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:10px;margin-bottom:16px">
                        <div>
                            <label style="font-size:11px;color:var(--text-muted);text-transform:uppercase;display:block;margin-bottom:4px">Name</label>
                            <input type="text" id="fk-ab-name" style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:var(--text);font-size:13px;box-sizing:border-box">
                        </div>
                        <div>
                            <label style="font-size:11px;color:var(--text-muted);text-transform:uppercase;display:block;margin-bottom:4px">Attribut</label>
                            <select id="fk-ab-attr" style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:var(--text);font-size:13px;box-sizing:border-box">
                                <option value="KRF">KRF</option><option value="GES">GES</option><option value="ZÄH">ZÄH</option><option value="VER">VER</option><option value="PRÄ">PRÄ</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-size:11px;color:var(--text-muted);text-transform:uppercase;display:block;margin-bottom:4px">W&uuml;rfel</label>
                            <select id="fk-ab-dice" style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:var(--text);font-size:13px;box-sizing:border-box">
                                <option value="d6">d6</option><option value="d8">d8</option><option value="d10">d10</option><option value="d12">d12</option><option value="d20">d20</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-size:11px;color:var(--text-muted);text-transform:uppercase;display:block;margin-bottom:4px">Reichweite</label>
                            <input type="number" id="fk-ab-range" min="1" max="20" style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:var(--text);font-size:13px;box-sizing:border-box">
                        </div>
                    </div>

                    <!-- Status + Pictogram -->
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px">
                        <div>
                            <label style="font-size:11px;color:var(--text-muted);text-transform:uppercase;display:block;margin-bottom:4px">Status (z.B. Brennend &ge;15)</label>
                            <input type="text" id="fk-ab-status" placeholder="&mdash;" style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:var(--text);font-size:13px;box-sizing:border-box">
                        </div>
                        <div>
                            <label style="font-size:11px;color:var(--text-muted);text-transform:uppercase;display:block;margin-bottom:4px">Piktogramm (24x24 URL)</label>
                            <div style="display:flex;gap:8px;align-items:center">
                                <input type="text" id="fk-ab-pictogram" placeholder="/assets/icons/..." style="flex:1;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:var(--text);font-size:13px;box-sizing:border-box">
                                <div id="fk-ab-picto-preview" style="width:32px;height:32px;border-radius:6px;background:var(--bg-input);display:flex;align-items:center;justify-content:center;flex-shrink:0;overflow:hidden">
                                    <span style="font-size:9px;color:var(--text-muted)">24</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr style="border:none;border-top:1px solid var(--border);margin:16px 0">

                    <!-- Description Tiers -->
                    <div style="margin-bottom:12px">
                        <label style="font-size:11px;color:var(--text-muted);text-transform:uppercase;display:block;margin-bottom:4px">Kurzbeschreibung</label>
                        <input type="text" id="fk-ab-desc" style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:var(--text);font-size:13px;box-sizing:border-box">
                    </div>
                    <div style="margin-bottom:12px">
                        <label style="font-size:11px;color:var(--accent);text-transform:uppercase;display:block;margin-bottom:4px">Detail (Mechanik)</label>
                        <textarea id="fk-ab-detail" rows="3" style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:var(--text);font-size:13px;resize:vertical;box-sizing:border-box"></textarea>
                    </div>
                    <div style="margin-bottom:12px">
                        <label style="font-size:11px;color:var(--blue);text-transform:uppercase;display:block;margin-bottom:4px">Battlemap (Taktik)</label>
                        <textarea id="fk-ab-battlemap" rows="3" style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:var(--text);font-size:13px;resize:vertical;box-sizing:border-box"></textarea>
                    </div>
                    <div style="margin-bottom:16px">
                        <label style="font-size:11px;color:var(--yellow);text-transform:uppercase;display:block;margin-bottom:4px">GM-Hinweis (Narration)</label>
                        <textarea id="fk-ab-gm" rows="3" style="width:100%;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:var(--text);font-size:13px;resize:vertical;box-sizing:border-box"></textarea>
                    </div>

                    <div style="display:flex;justify-content:flex-end;gap:8px">
                        <button class="btn btn--outline" onclick="FokusAdmin.closeModal()">Abbrechen</button>
                        <button class="btn btn--primary" onclick="FokusAdmin.saveAbility()">Speichern</button>
                    </div>
                </div>
            </div>

            <!-- ═══════════════════════════════════════
                 RIFT PRO – SUBSCRIBER ÜBERSICHT
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-proOverview">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">RIFT Pro – Übersicht</h1>
                        <p class="page-header__subtitle">Subscriber-Dashboard, Kennzahlen und aktive Abonnements</p>
                    </div>
                    <button class="btn btn--primary" onclick="ProAdmin.openGrantModal()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
                        Pro vergeben
                    </button>
                </div>
                
                <!-- KPI Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card__label">Aktive Abos</div>
                        <div class="stat-card__value" id="proStatActive" style="color: #bca24c;">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Monatlich</div>
                        <div class="stat-card__value" id="proStatMonthly" style="color: var(--blue);">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Jährlich</div>
                        <div class="stat-card__value" id="proStatYearly" style="color: var(--green);">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Neu diese Woche</div>
                        <div class="stat-card__value" id="proStatNewWeek" style="color: var(--accent);">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Churn (30d)</div>
                        <div class="stat-card__value" id="proStatChurn" style="color: var(--red);">0%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">MRR</div>
                        <div class="stat-card__value" id="proStatMRR" style="color: #bca24c;">0 €</div>
                    </div>
                </div>
                
                <!-- Subscriber Table -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">Aktive Subscriber</h2>
                        <div style="display:flex;gap:8px;">
                            <select class="form-select" style="width:auto;padding:6px 12px;font-size:13px;" id="proSubFilter">
                                <option value="all">Alle</option>
                                <option value="monthly">Monatlich</option>
                                <option value="yearly">Jährlich</option>
                                <option value="trial">Trial</option>
                                <option value="gift">Geschenk</option>
                            </select>
                            <input type="text" class="form-input" placeholder="Suche nach Name oder Email..." style="width:240px;padding:6px 12px;font-size:13px;" id="proSubSearch">
                        </div>
                    </div>
                    <div id="proSubscriberTable" style="overflow-x:auto;">
                        <table class="news-table">
                            <thead>
                                <tr>
                                    <th>Benutzer</th>
                                    <th>Plan</th>
                                    <th>Status</th>
                                    <th>Seit</th>
                                    <th>Verlängerung</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="proSubTableBody">
                                <tr><td colspan="6" style="text-align:center;padding:40px;color:var(--text-muted);">Lade Subscriber...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 RIFT PRO – FEATURE FLAGS
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-proFeatureFlags">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Pro Feature Flags</h1>
                        <p class="page-header__subtitle">Features zwischen Free und Pro umschalten – Änderungen wirken sofort</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">Feature-Zuordnung</h2>
                        <button class="btn btn--primary btn--small" onclick="ProAdmin.saveFeatureFlags()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                            Speichern
                        </button>
                    </div>
                    <div class="card__body" id="proFeatureFlagsList">
                        <div style="display:flex;flex-direction:column;gap:12px;">
                            <!-- Dice & Themes -->
                            <div class="form-section-header">Würfel & Themes</div>
                            <div class="pro-flag-row"><span>130+ Würfel-Themes</span><label class="pro-flag-toggle"><input type="checkbox" checked data-flag="diceThemes130"><span class="pro-flag-pill"></span></label></div>
                            <div class="pro-flag-row"><span>50+ Zahlen-Themes</span><label class="pro-flag-toggle"><input type="checkbox" checked data-flag="numberThemes50"><span class="pro-flag-pill"></span></label></div>
                            <div class="pro-flag-row"><span>30+ Arena-Themes</span><label class="pro-flag-toggle"><input type="checkbox" checked data-flag="arenaThemes30"><span class="pro-flag-pill"></span></label></div>
                            <div class="pro-flag-row"><span>Würfel- & Arena-Effekte</span><label class="pro-flag-toggle"><input type="checkbox" checked data-flag="diceEffects"><span class="pro-flag-pill"></span></label></div>
                            
                            <!-- Limits -->
                            <div class="form-section-header">Kapazitäten</div>
                            <div class="pro-flag-row"><span>Unendlich Sessions pro Account</span><label class="pro-flag-toggle"><input type="checkbox" checked data-flag="unlimitedSessions"><span class="pro-flag-pill"></span></label></div>
                            <div class="pro-flag-row"><span>3 Charaktere pro Raum</span><label class="pro-flag-toggle"><input type="checkbox" checked data-flag="threeCharsPerRoom"><span class="pro-flag-pill"></span></label></div>
                            <div class="pro-flag-row"><span>Bis 10 Teilnehmer / Raum</span><label class="pro-flag-toggle"><input type="checkbox" checked data-flag="tenParticipants"><span class="pro-flag-pill"></span></label></div>
                            <div class="pro-flag-row"><span>Bis 5 Sessions / Raum</span><label class="pro-flag-toggle"><input type="checkbox" checked data-flag="fiveSessionsPerRoom"><span class="pro-flag-pill"></span></label></div>
                            
                            <!-- Tools -->
                            <div class="form-section-header">Tools & Features</div>
                            <div class="pro-flag-row"><span>Backup & Export</span><label class="pro-flag-toggle"><input type="checkbox" checked data-flag="backupExport"><span class="pro-flag-pill"></span></label></div>
                            <div class="pro-flag-row"><span>Erweitertes GM-Dashboard</span><label class="pro-flag-toggle"><input type="checkbox" checked data-flag="advancedGM"><span class="pro-flag-pill"></span></label></div>
                            <div class="pro-flag-row"><span>Kampagnen-Funktion</span><label class="pro-flag-toggle"><input type="checkbox" checked data-flag="campaigns"><span class="pro-flag-pill"></span></label></div>
                            <div class="pro-flag-row"><span>Session-Vorlagen</span><label class="pro-flag-toggle"><input type="checkbox" checked data-flag="sessionTemplates"><span class="pro-flag-pill"></span></label></div>
                            <div class="pro-flag-row"><span>Erweiterte Asset-Bibliothek</span><label class="pro-flag-toggle"><input type="checkbox" checked data-flag="extendedAssets"><span class="pro-flag-pill"></span></label></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 RIFT PRO – THEME GATING
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-proThemeGating">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Theme-Gating</h1>
                        <p class="page-header__subtitle">Bestimme welche Themes Free-Usern zur Verfügung stehen</p>
                    </div>
                    <button class="btn btn--primary" onclick="ProAdmin.saveThemeGating()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                        Gating speichern
                    </button>
                </div>
                
                <!-- Theme Category Tabs -->
                <div style="display:flex;gap:8px;margin-bottom:24px;">
                    <button class="carousel-type-tab active" onclick="ProAdmin.switchThemeTab('dice')" id="themeTabDice">
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                        Würfel-Themes
                    </button>
                    <button class="carousel-type-tab" onclick="ProAdmin.switchThemeTab('number')" id="themeTabNumber">
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 9h16M4 15h16M10 3L8 21M16 3l-2 18"/></svg>
                        Zahlen-Themes
                    </button>
                    <button class="carousel-type-tab" onclick="ProAdmin.switchThemeTab('arena')" id="themeTabArena">
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
                        Arena-Themes
                    </button>
                </div>
                
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title" id="themeGatingTitle">Würfel-Themes</h2>
                        <div style="display:flex;gap:12px;align-items:center;">
                            <span style="font-size:12px;color:var(--text-muted);" id="themeGatingCount">0 Free / 0 Pro</span>
                            <button class="btn btn--secondary btn--small" onclick="ProAdmin.setAllThemes('free')">Alle Free</button>
                            <button class="btn btn--secondary btn--small" onclick="ProAdmin.setAllThemes('pro')">Alle Pro</button>
                        </div>
                    </div>
                    <div class="card__body" id="themeGatingGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:8px;">
                        <div style="text-align:center;padding:40px;color:var(--text-muted);grid-column:1/-1;">Lade Themes...</div>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 RIFT PRO – LIMITS KONFIGURATION
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-proLimits">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Tier-Limits</h1>
                        <p class="page-header__subtitle">Free- und Pro-Kontingente konfigurieren – live aus Firestore</p>
                    </div>
                    <button class="btn btn--primary" onclick="ProAdmin.saveLimits()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/></svg>
                        Limits speichern
                    </button>
                </div>
                
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;">
                    <!-- Free Limits -->
                    <div class="card">
                        <div class="card__header">
                            <h2 class="card__title">Free Tier</h2>
                        </div>
                        <div class="card__body" style="display:flex;flex-direction:column;gap:16px;">
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Sessions pro Account</label>
                                <input type="number" class="form-input" id="limitFreeSessionsAccount" value="5" min="1" max="100">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Sessions pro Raum</label>
                                <input type="number" class="form-input" id="limitFreeSessionsRoom" value="2" min="1" max="20">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Teilnehmer pro Raum</label>
                                <input type="number" class="form-input" id="limitFreeParticipants" value="6" min="1" max="50">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Teilnehmer pro Session</label>
                                <input type="number" class="form-input" id="limitFreeSessionParticipants" value="6" min="1" max="50">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Charaktere pro Raum & Regelwerk</label>
                                <input type="number" class="form-input" id="limitFreeCharsRoom" value="1" min="1" max="10">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Würfel-Themes</label>
                                <input type="number" class="form-input" id="limitFreeDiceThemes" value="10" min="0" max="500">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Zahlen-Themes</label>
                                <input type="number" class="form-input" id="limitFreeNumberThemes" value="6" min="0" max="500">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Arena-Themes</label>
                                <input type="number" class="form-input" id="limitFreeArenaThemes" value="12" min="0" max="500">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pro Limits -->
                    <div class="card" style="border-color:rgba(188,162,76,0.25);">
                        <div class="card__header" style="border-color:rgba(188,162,76,0.15);">
                            <h2 class="card__title" style="color:#bca24c;">Pro Tier ★</h2>
                        </div>
                        <div class="card__body" style="display:flex;flex-direction:column;gap:16px;">
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Sessions pro Account <span>(0 = unbegrenzt)</span></label>
                                <input type="number" class="form-input" id="limitProSessionsAccount" value="0" min="0" max="9999">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Sessions pro Raum</label>
                                <input type="number" class="form-input" id="limitProSessionsRoom" value="5" min="1" max="100">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Teilnehmer pro Raum</label>
                                <input type="number" class="form-input" id="limitProParticipants" value="10" min="1" max="100">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Teilnehmer pro Session</label>
                                <input type="number" class="form-input" id="limitProSessionParticipants" value="10" min="1" max="100">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Charaktere pro Raum & Regelwerk</label>
                                <input type="number" class="form-input" id="limitProCharsRoom" value="3" min="1" max="20">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Würfel-Themes <span>(0 = alle)</span></label>
                                <input type="number" class="form-input" id="limitProDiceThemes" value="0" min="0" max="9999">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Zahlen-Themes <span>(0 = alle)</span></label>
                                <input type="number" class="form-input" id="limitProNumberThemes" value="0" min="0" max="9999">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Arena-Themes <span>(0 = alle)</span></label>
                                <input type="number" class="form-input" id="limitProArenaThemes" value="0" min="0" max="9999">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 RIFT PRO – PROMOS & TRIALS
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-proPromos">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Promos & Trials</h1>
                        <p class="page-header__subtitle">Gutscheincodes erstellen, Trials verwalten und Aktionen planen</p>
                    </div>
                    <button class="btn btn--primary" onclick="ProAdmin.openPromoEditor()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Neuer Code
                    </button>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card__label">Aktive Codes</div>
                        <div class="stat-card__value" id="promoStatActive" style="color:#bca24c;">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Einlösungen gesamt</div>
                        <div class="stat-card__value" id="promoStatRedeemed" style="color:var(--green);">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Aktive Trials</div>
                        <div class="stat-card__value" id="promoStatTrials" style="color:var(--blue);">0</div>
                    </div>
                </div>
                
                <!-- Trial Config -->
                <div class="card" style="margin-bottom:24px;">
                    <div class="card__header">
                        <h2 class="card__title">Trial-Einstellungen</h2>
                        <button class="btn btn--primary btn--small" onclick="ProAdmin.saveTrialConfig()">Speichern</button>
                    </div>
                    <div class="card__body">
                        <div class="form-row">
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Trial-Dauer (Tage)</label>
                                <input type="number" class="form-input" id="trialDuration" value="14" min="1" max="90">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label class="form-label">Trial aktiviert</label>
                                <select class="form-select" id="trialEnabled">
                                    <option value="true">Ja – neue User erhalten Trial</option>
                                    <option value="false">Nein – Trial deaktiviert</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Promo Codes Table -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">Gutscheincodes</h2>
                    </div>
                    <div id="promoCodesTable" style="overflow-x:auto;">
                        <table class="news-table">
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Typ</th>
                                    <th>Dauer</th>
                                    <th>Einlösungen</th>
                                    <th>Max</th>
                                    <th>Gültig bis</th>
                                    <th>Status</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="promoTableBody">
                                <tr><td colspan="8" style="text-align:center;padding:40px;color:var(--text-muted);">Keine Codes vorhanden</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 RIFT PRO – CONTENT PIPELINE
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-proPipeline">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Pro Content Pipeline</h1>
                        <p class="page-header__subtitle">Geplante Themes, Assets und Features für Pro-Subscriber</p>
                    </div>
                    <button class="btn btn--primary" onclick="ProAdmin.openPipelineEditor()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Neuer Eintrag
                    </button>
                </div>
                
                <!-- Pipeline Kanban -->
                <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;">
                    <!-- In Arbeit -->
                    <div class="card">
                        <div class="card__header">
                            <h2 class="card__title" style="display:flex;align-items:center;gap:8px;">
                                <span style="width:8px;height:8px;border-radius:50%;background:var(--yellow);"></span>
                                In Arbeit
                            </h2>
                            <span class="card__badge" id="pipelineWipCount">0</span>
                        </div>
                        <div class="card__body" id="pipelineWip" style="min-height:200px;display:flex;flex-direction:column;gap:8px;">
                            <div style="text-align:center;padding:20px;color:var(--text-muted);font-size:13px;">Leer</div>
                        </div>
                    </div>
                    
                    <!-- Review -->
                    <div class="card">
                        <div class="card__header">
                            <h2 class="card__title" style="display:flex;align-items:center;gap:8px;">
                                <span style="width:8px;height:8px;border-radius:50%;background:var(--blue);"></span>
                                Bereit
                            </h2>
                            <span class="card__badge" id="pipelineReadyCount">0</span>
                        </div>
                        <div class="card__body" id="pipelineReady" style="min-height:200px;display:flex;flex-direction:column;gap:8px;">
                            <div style="text-align:center;padding:20px;color:var(--text-muted);font-size:13px;">Leer</div>
                        </div>
                    </div>
                    
                    <!-- Geplant -->
                    <div class="card">
                        <div class="card__header">
                            <h2 class="card__title" style="display:flex;align-items:center;gap:8px;">
                                <span style="width:8px;height:8px;border-radius:50%;background:var(--green);"></span>
                                Veröffentlicht
                            </h2>
                            <span class="card__badge" id="pipelineDoneCount">0</span>
                        </div>
                        <div class="card__body" id="pipelineDone" style="min-height:200px;display:flex;flex-direction:column;gap:8px;">
                            <div style="text-align:center;padding:20px;color:var(--text-muted);font-size:13px;">Leer</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 RIFT PRO – REVENUE
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-proRevenue">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Revenue Analytics</h1>
                        <p class="page-header__subtitle">MRR, ARR, Conversion und Umsatzentwicklung</p>
                    </div>
                    <div style="display:flex;gap:8px;">
                        <select class="form-select" style="width:auto;padding:6px 12px;font-size:13px;" id="revenuePeriod">
                            <option value="30d">Letzte 30 Tage</option>
                            <option value="90d">Letzte 90 Tage</option>
                            <option value="12m">Letzte 12 Monate</option>
                            <option value="all">Gesamtzeitraum</option>
                        </select>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card__label">MRR (Monthly Recurring)</div>
                        <div class="stat-card__value" id="revMRR" style="color:#bca24c;">0 €</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">ARR (Annual Recurring)</div>
                        <div class="stat-card__value" id="revARR" style="color:var(--green);">0 €</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Conversion Free → Pro</div>
                        <div class="stat-card__value" id="revConversion" style="color:var(--accent);">0%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Ø Lifetime Value</div>
                        <div class="stat-card__value" id="revLTV" style="color:var(--blue);">0 €</div>
                    </div>
                </div>
                
                <!-- Revenue Chart Placeholder -->
                <div class="card" style="margin-bottom:24px;">
                    <div class="card__header">
                        <h2 class="card__title">Umsatzentwicklung</h2>
                    </div>
                    <div class="card__body" id="revenueChart" style="height:300px;display:flex;align-items:center;justify-content:center;color:var(--text-muted);">
                        Chart wird geladen...
                    </div>
                </div>
                
                <!-- Top Converting Features -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">Beliebteste Pro-Features</h2>
                        <span style="font-size:12px;color:var(--text-muted);">Nutzung nach Aktivierung</span>
                    </div>
                    <div class="card__body" id="topFeaturesTable">
                        <table class="news-table">
                            <thead>
                                <tr>
                                    <th>Feature</th>
                                    <th>Nutzung</th>
                                    <th>% der Pro-User</th>
                                    <th>Trend</th>
                                </tr>
                            </thead>
                            <tbody id="topFeaturesBody">
                                <tr><td colspan="4" style="text-align:center;padding:40px;color:var(--text-muted);">Lade Daten...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 RIFT PRO – KÜNDIGUNGS-FEEDBACK
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-proChurn">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Kündigungs-Analyse</h1>
                        <p class="page-header__subtitle">Exit-Survey Ergebnisse und Churn-Tracking</p>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card__label">Kündigungen (30d)</div>
                        <div class="stat-card__value" id="churnTotal" style="color:var(--red);">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Churn-Rate</div>
                        <div class="stat-card__value" id="churnRate" style="color:var(--yellow);">0%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Ø Abo-Dauer</div>
                        <div class="stat-card__value" id="churnAvgDuration" style="color:var(--blue);">0 Mon.</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Win-Backs</div>
                        <div class="stat-card__value" id="churnWinbacks" style="color:var(--green);">0</div>
                    </div>
                </div>
                
                <!-- Reasons Breakdown -->
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;">
                    <div class="card">
                        <div class="card__header">
                            <h2 class="card__title">Kündigungsgründe</h2>
                        </div>
                        <div class="card__body" id="churnReasons" style="display:flex;flex-direction:column;gap:12px;">
                            <div class="churn-reason-row">
                                <div class="churn-reason-bar" style="width:45%;background:var(--red);"></div>
                                <span>Zu teuer</span><span style="color:var(--text-muted);">45%</span>
                            </div>
                            <div class="churn-reason-row">
                                <div class="churn-reason-bar" style="width:25%;background:var(--yellow);"></div>
                                <span>Features nicht genutzt</span><span style="color:var(--text-muted);">25%</span>
                            </div>
                            <div class="churn-reason-row">
                                <div class="churn-reason-bar" style="width:15%;background:var(--blue);"></div>
                                <span>Nur temporär gebraucht</span><span style="color:var(--text-muted);">15%</span>
                            </div>
                            <div class="churn-reason-row">
                                <div class="churn-reason-bar" style="width:10%;background:var(--accent);"></div>
                                <span>Gruppe aufgelöst</span><span style="color:var(--text-muted);">10%</span>
                            </div>
                            <div class="churn-reason-row">
                                <div class="churn-reason-bar" style="width:5%;background:var(--text-muted);"></div>
                                <span>Sonstiges</span><span style="color:var(--text-muted);">5%</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Cancellations -->
                    <div class="card">
                        <div class="card__header">
                            <h2 class="card__title">Letzte Kündigungen</h2>
                        </div>
                        <div id="churnRecentList" style="overflow-y:auto;max-height:360px;">
                            <table class="news-table">
                                <thead>
                                    <tr>
                                        <th>Benutzer</th>
                                        <th>Grund</th>
                                        <th>Laufzeit</th>
                                        <th>Datum</th>
                                    </tr>
                                </thead>
                                <tbody id="churnTableBody">
                                    <tr><td colspan="4" style="text-align:center;padding:40px;color:var(--text-muted);">Lade Daten...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 RIFT PRO – LIZENZEN
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-proLicenses">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Geschenk- & Team-Lizenzen</h1>
                        <p class="page-header__subtitle">Pro-Lizenzen verschenken, Team-Abos verwalten</p>
                    </div>
                    <button class="btn btn--primary" onclick="ProAdmin.openLicenseEditor()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Neue Lizenz
                    </button>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card__label">Geschenk-Lizenzen</div>
                        <div class="stat-card__value" id="licenseGiftCount" style="color:#bca24c;">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Team-Gruppen</div>
                        <div class="stat-card__value" id="licenseTeamCount" style="color:var(--blue);">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card__label">Aktive Lizenzen</div>
                        <div class="stat-card__value" id="licenseActiveCount" style="color:var(--green);">0</div>
                    </div>
                </div>
                
                <!-- Gift Licenses -->
                <div class="card" style="margin-bottom:24px;">
                    <div class="card__header">
                        <h2 class="card__title">Geschenk-Lizenzen</h2>
                    </div>
                    <div id="giftLicenseTable" style="overflow-x:auto;">
                        <table class="news-table">
                            <thead>
                                <tr>
                                    <th>Geschenkt von</th>
                                    <th>Empfänger</th>
                                    <th>Dauer</th>
                                    <th>Erstellt</th>
                                    <th>Status</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="giftLicenseBody">
                                <tr><td colspan="6" style="text-align:center;padding:40px;color:var(--text-muted);">Keine Geschenk-Lizenzen</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Team Licenses -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">Team-Lizenzen</h2>
                    </div>
                    <div id="teamLicenseTable" style="overflow-x:auto;">
                        <table class="news-table">
                            <thead>
                                <tr>
                                    <th>Gruppenname</th>
                                    <th>Inhaber (GM)</th>
                                    <th>Mitglieder</th>
                                    <th>Max</th>
                                    <th>Erstellt</th>
                                    <th>Status</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="teamLicenseBody">
                                <tr><td colspan="7" style="text-align:center;padding:40px;color:var(--text-muted);">Keine Team-Lizenzen</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ═══════════════════════════════════════
                 LANDING PAGE CONFIG
                 ═══════════════════════════════════════ -->
            <div class="admin-page" id="page-landingPage">
                <div class="page-header">
                    <div>
                        <h1 class="page-header__title">Landing Page</h1>
                        <p class="page-header__subtitle">Gesamte Login-Seite konfigurieren — Hintergrund, Sektionen, Effekte, Bilder, Custom Code</p>
                    </div>
                    <button class="btn btn--primary" onclick="LandingAdmin.save()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                        Speichern
                    </button>
                </div>

                <!-- ─── TAB NAV ─── -->
                <div style="display:flex;gap:6px;margin-bottom:24px;flex-wrap:wrap;">
                    <button class="lp-tab active" onclick="LandingAdmin.switchSection('bg',this)">Hintergrund</button>
                    <button class="lp-tab" onclick="LandingAdmin.switchSection('hero',this)">Hero</button>
                    <button class="lp-tab" onclick="LandingAdmin.switchSection('sections',this)">Sektionen</button>
                    <button class="lp-tab" onclick="LandingAdmin.switchSection('overlays',this)">Overlays &amp; Bilder</button>
                    <button class="lp-tab" onclick="LandingAdmin.switchSection('proTeaser',this)">Pro Teaser</button>
                    <button class="lp-tab" onclick="LandingAdmin.switchSection('code',this)">Custom Code</button>
                </div>

                <!-- ═══════════════════════════════════════
                     TAB: HINTERGRUND
                     ═══════════════════════════════════════ -->
                <div class="lp-section active" id="lp-sec-bg">
                    <!-- Animated Orbs -->
                    <div class="card" style="margin-bottom:24px;">
                        <div class="card__header">
                            <h2 class="card__title">Animierte Hintergrund-Orbs</h2>
                            <label class="toggle" style="gap:8px;"><input type="checkbox" id="lp-orbs-enabled" checked><span class="toggle__slider"></span><span style="font-size:12px;color:var(--text-muted);">Sichtbar</span></label>
                        </div>
                        <div class="card__body" style="padding:24px;">
                            <p style="font-size:12px;color:var(--text-muted);margin-bottom:16px;">Drei schwebende Farbkugeln im Hintergrund der gesamten Seite.</p>
                            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;">
                                <div><label class="form-label-sm">Orb 1 — Farbe</label><div style="display:flex;gap:8px;align-items:center;"><input type="color" id="lp-orb1-color" value="#FF4655" style="width:36px;height:36px;border:none;border-radius:8px;cursor:pointer;"><input type="text" class="form-input" id="lp-orb1-color-hex" value="#FF4655" style="font-family:monospace;font-size:12px;"></div></div>
                                <div><label class="form-label-sm">Orb 2 — Farbe</label><div style="display:flex;gap:8px;align-items:center;"><input type="color" id="lp-orb2-color" value="#8B5CF6" style="width:36px;height:36px;border:none;border-radius:8px;cursor:pointer;"><input type="text" class="form-input" id="lp-orb2-color-hex" value="#8B5CF6" style="font-family:monospace;font-size:12px;"></div></div>
                                <div><label class="form-label-sm">Orb 3 — Farbe</label><div style="display:flex;gap:8px;align-items:center;"><input type="color" id="lp-orb3-color" value="#F59E0B" style="width:36px;height:36px;border:none;border-radius:8px;cursor:pointer;"><input type="text" class="form-input" id="lp-orb3-color-hex" value="#F59E0B" style="font-family:monospace;font-size:12px;"></div></div>
                            </div>
                            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:14px;">
                                <div><label class="form-label-sm">Orb 1 — Größe (vw)</label><input type="number" class="form-input" id="lp-orb1-size" value="40" min="10" max="80"></div>
                                <div><label class="form-label-sm">Orb 2 — Größe (vw)</label><input type="number" class="form-input" id="lp-orb2-size" value="35" min="10" max="80"></div>
                                <div><label class="form-label-sm">Orb 3 — Größe (vw)</label><input type="number" class="form-input" id="lp-orb3-size" value="30" min="10" max="80"></div>
                            </div>
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:14px;">
                                <div><label class="form-label-sm">Blur (px)</label><input type="range" id="lp-orbs-blur" min="40" max="200" value="120" style="width:100%;" oninput="this.nextElementSibling.textContent=this.value+'px'"><span style="font-size:11px;color:var(--text-muted);">120px</span></div>
                                <div><label class="form-label-sm">Deckkraft</label><input type="range" id="lp-orbs-opacity" min="0" max="100" value="100" style="width:100%;" oninput="this.nextElementSibling.textContent=this.value+'%'"><span style="font-size:11px;color:var(--text-muted);">100%</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- Page Background Image/Video -->
                    <div class="card" style="margin-bottom:24px;">
                        <div class="card__header">
                            <h2 class="card__title">Hintergrundbild / Video</h2>
                            <label class="toggle" style="gap:8px;"><input type="checkbox" id="lp-pagebg-enabled"><span class="toggle__slider"></span><span style="font-size:12px;color:var(--text-muted);">Aktiv</span></label>
                        </div>
                        <div class="card__body" style="padding:24px;">
                            <div style="display:flex;gap:8px;margin-bottom:16px;">
                                <button class="lp-type-btn active" data-group="pagebg" data-type="image" onclick="LandingAdmin.setGroupType('pagebg','image',this)">Bild</button>
                                <button class="lp-type-btn" data-group="pagebg" data-type="video" onclick="LandingAdmin.setGroupType('pagebg','video',this)">Video</button>
                                <button class="lp-type-btn" data-group="pagebg" data-type="gradient" onclick="LandingAdmin.setGroupType('pagebg','gradient',this)">Gradient</button>
                            </div>
                            <div class="lp-group-fields" data-group="pagebg" data-type="image">
                                <div style="display:grid;grid-template-columns:2fr 1fr 1fr;gap:14px;">
                                    <div><label class="form-label-sm">URL</label><input type="text" class="form-input" id="lp-pagebg-url" placeholder="https://... oder assets/img/..."></div>
                                    <div><label class="form-label-sm">Object-Fit</label><select class="form-select" id="lp-pagebg-fit"><option value="cover">Cover</option><option value="contain">Contain</option><option value="none">None</option></select></div>
                                    <div><label class="form-label-sm">Position</label><select class="form-select" id="lp-pagebg-pos"><option value="center">Center</option><option value="top">Top</option><option value="bottom">Bottom</option></select></div>
                                </div>
                            </div>
                            <div class="lp-group-fields" data-group="pagebg" data-type="video" style="display:none;">
                                <label class="form-label-sm">Video-URL (mp4, webm)</label><input type="text" class="form-input" id="lp-pagebg-video" placeholder="https://...">
                            </div>
                            <div class="lp-group-fields" data-group="pagebg" data-type="gradient" style="display:none;">
                                <label class="form-label-sm">CSS Gradient</label><input type="text" class="form-input" id="lp-pagebg-gradient" placeholder="linear-gradient(180deg, transparent, rgba(0,0,0,0.8))">
                            </div>
                            <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;margin-top:14px;">
                                <div><label class="form-label-sm">Deckkraft</label><input type="range" id="lp-pagebg-opacity" min="0" max="100" value="15" style="width:100%;" oninput="this.nextElementSibling.textContent=this.value+'%'"><span style="font-size:11px;color:var(--text-muted);">15%</span></div>
                                <div><label class="form-label-sm">Blur (px)</label><input type="range" id="lp-pagebg-blur" min="0" max="40" value="0" style="width:100%;" oninput="this.nextElementSibling.textContent=this.value+'px'"><span style="font-size:11px;color:var(--text-muted);">0px</span></div>
                                <div><label class="form-label-sm">Blend-Mode</label><select class="form-select" id="lp-pagebg-blend"><option value="normal">Normal</option><option value="screen">Screen</option><option value="overlay">Overlay</option><option value="multiply">Multiply</option><option value="soft-light">Soft Light</option><option value="luminosity">Luminosity</option></select></div>
                            </div>
                        </div>
                    </div>

                    <!-- Noise Texture -->
                    <div class="card">
                        <div class="card__header">
                            <h2 class="card__title">Noise / Grain Overlay</h2>
                            <label class="toggle" style="gap:8px;"><input type="checkbox" id="lp-noise-enabled" checked><span class="toggle__slider"></span><span style="font-size:12px;color:var(--text-muted);">Sichtbar</span></label>
                        </div>
                        <div class="card__body" style="padding:24px;">
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;">
                                <div><label class="form-label-sm">Deckkraft</label><input type="range" id="lp-noise-opacity" min="0" max="100" value="40" style="width:100%;" oninput="this.nextElementSibling.textContent=this.value+'%'"><span style="font-size:11px;color:var(--text-muted);">40%</span></div>
                                <div><label class="form-label-sm">Custom SVG URL (leer = Standard)</label><input type="text" class="form-input" id="lp-noise-url" placeholder="Standard-Noise"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ═══════════════════════════════════════
                     TAB: HERO
                     ═══════════════════════════════════════ -->
                <div class="lp-section" id="lp-sec-hero">
                    <div class="card" style="margin-bottom:24px;">
                        <div class="card__header"><h2 class="card__title">Hero Inhalte</h2></div>
                        <div class="card__body" style="padding:24px;">
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px;">
                                <div><label class="form-label-sm">Logo URL (leer = Standard)</label><input type="text" class="form-input" id="lp-hero-logo" placeholder="/assets/img/logo_rift.png"></div>
                                <div><label class="form-label-sm">Logo Breite (CSS, leer = Standard)</label><input type="text" class="form-input" id="lp-hero-logo-width" placeholder="z.B. 280px oder 25vw"></div>
                            </div>
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px;">
                                <div><label class="form-label-sm">Headline Zeile 1 Override (leer = i18n)</label><input type="text" class="form-input" id="lp-hero-line1" placeholder="Tabletop."></div>
                                <div><label class="form-label-sm">Headline Zeile 2 Override</label><input type="text" class="form-input" id="lp-hero-line2" placeholder="Ohne Grenzen."></div>
                            </div>
                            <div style="margin-bottom:14px;">
                                <label class="form-label-sm">Subtitle Override (leer = i18n)</label>
                                <textarea class="form-input" id="lp-hero-subtitle" rows="2" style="resize:vertical;"></textarea>
                            </div>
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;">
                                <div><label class="form-label-sm">Headline Gradient Farbe 1</label><div style="display:flex;gap:8px;"><input type="color" id="lp-hero-grad1" value="#FF4655" style="width:36px;height:36px;border:none;border-radius:8px;"><input type="text" class="form-input" id="lp-hero-grad1-hex" value="#FF4655" style="font-family:monospace;font-size:12px;"></div></div>
                                <div><label class="form-label-sm">Headline Gradient Farbe 2</label><div style="display:flex;gap:8px;"><input type="color" id="lp-hero-grad2" value="#f97316" style="width:36px;height:36px;border:none;border-radius:8px;"><input type="text" class="form-input" id="lp-hero-grad2-hex" value="#f97316" style="font-family:monospace;font-size:12px;"></div></div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card__header"><h2 class="card__title">Hero Hintergrundbild</h2><label class="toggle" style="gap:8px;"><input type="checkbox" id="lp-herobg-enabled"><span class="toggle__slider"></span><span style="font-size:12px;color:var(--text-muted);">Aktiv</span></label></div>
                        <div class="card__body" style="padding:24px;">
                            <p style="font-size:12px;color:var(--text-muted);margin-bottom:14px;">Optionales Bild nur hinter dem Hero-Bereich (z.B. Artwork, Szene).</p>
                            <div style="display:grid;grid-template-columns:2fr 1fr 1fr;gap:14px;">
                                <div><label class="form-label-sm">URL</label><input type="text" class="form-input" id="lp-herobg-url" placeholder="https://..."></div>
                                <div><label class="form-label-sm">Deckkraft</label><input type="range" id="lp-herobg-opacity" min="0" max="100" value="8" style="width:100%;" oninput="this.nextElementSibling.textContent=this.value+'%'"><span style="font-size:11px;color:var(--text-muted);">8%</span></div>
                                <div><label class="form-label-sm">Position</label><select class="form-select" id="lp-herobg-pos"><option value="center">Center</option><option value="top">Top</option><option value="bottom">Bottom</option></select></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ═══════════════════════════════════════
                     TAB: SEKTIONEN
                     ═══════════════════════════════════════ -->
                <div class="lp-section" id="lp-sec-sections">
                    <div class="card" style="margin-bottom:24px;">
                        <div class="card__header"><h2 class="card__title">Sektionen ein/ausblenden</h2></div>
                        <div class="card__body" style="padding:24px;">
                            <p style="font-size:12px;color:var(--text-muted);margin-bottom:20px;">Steuere welche Sektionen auf der Landing Page sichtbar sind.</p>
                            <div style="display:flex;flex-direction:column;gap:12px;">
                                <div class="lp-section-row"><label class="toggle" style="gap:8px;"><input type="checkbox" id="lp-vis-features" checked><span class="toggle__slider"></span></label><strong style="font-size:13px;">Features</strong><span style="font-size:12px;color:var(--text-muted);">— 6 Feature-Cards</span></div>
                                <div class="lp-section-row"><label class="toggle" style="gap:8px;"><input type="checkbox" id="lp-vis-systems" checked><span class="toggle__slider"></span></label><strong style="font-size:13px;">Regelwerke</strong><span style="font-size:12px;color:var(--text-muted);">— 4 Ruleset-Badges</span></div>
                                <div class="lp-section-row"><label class="toggle" style="gap:8px;"><input type="checkbox" id="lp-vis-opensource" checked><span class="toggle__slider"></span></label><strong style="font-size:13px;">Aus Liebe zum Hobby</strong><span style="font-size:12px;color:var(--text-muted);">— Community-Perks</span></div>
                                <div class="lp-section-row"><label class="toggle" style="gap:8px;"><input type="checkbox" id="lp-vis-proTeaser" checked><span class="toggle__slider"></span></label><strong style="font-size:13px;background:linear-gradient(135deg,#f0d060,#bca24c);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">RIFT Pro Teaser</strong><span style="font-size:12px;color:var(--text-muted);">— Pro-Features</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card__header"><h2 class="card__title">Scroll-Effekte</h2></div>
                        <div class="card__body" style="padding:24px;">
                            <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;">
                                <div><label class="form-label-sm">Scroll Reveal</label><select class="form-select" id="lp-scroll-reveal"><option value="fade-up">Fade Up (Standard)</option><option value="fade-in">Fade In</option><option value="scale">Scale</option><option value="none">Deaktiviert</option></select></div>
                                <div><label class="form-label-sm">Stagger Delay (ms)</label><input type="number" class="form-input" id="lp-scroll-delay" value="120" min="0" max="500" step="10"></div>
                                <div><label class="form-label-sm">Sticky CTA Bar</label><select class="form-select" id="lp-sticky-bar"><option value="visible">Sichtbar beim Scrollen</option><option value="hidden">Ausgeblendet</option></select></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ═══════════════════════════════════════
                     TAB: OVERLAYS & BILDER
                     ═══════════════════════════════════════ -->
                <div class="lp-section" id="lp-sec-overlays">
                    <div class="card" style="margin-bottom:24px;">
                        <div class="card__header">
                            <h2 class="card__title">Floating Overlays</h2>
                            <button class="btn btn--ghost" style="font-size:12px;" onclick="LandingAdmin.addOverlay()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                                Overlay hinzufügen
                            </button>
                        </div>
                        <div class="card__body" style="padding:24px;">
                            <p style="font-size:12px;color:var(--text-muted);margin-bottom:16px;">Bilder, Shapes oder Effekte die über der Seite schweben. Jedes Overlay ist frei positionierbar.</p>
                            <div id="lp-overlays-list">
                                <div style="text-align:center;padding:30px;color:var(--text-muted);font-size:13px;">Noch keine Overlays konfiguriert</div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card__header"><h2 class="card__title">Fullscreen Overlay</h2><label class="toggle" style="gap:8px;"><input type="checkbox" id="lp-fulloverlay-enabled"><span class="toggle__slider"></span><span style="font-size:12px;color:var(--text-muted);">Aktiv</span></label></div>
                        <div class="card__body" style="padding:24px;">
                            <p style="font-size:12px;color:var(--text-muted);margin-bottom:14px;">Ein ganzseitiges Overlay über dem gesamten Background (z.B. Vignette, Farbfilter, Scanlines).</p>
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;">
                                <div><label class="form-label-sm">Typ</label><select class="form-select" id="lp-fulloverlay-type"><option value="gradient">Gradient</option><option value="image">Bild</option><option value="css">CSS (custom)</option></select></div>
                                <div><label class="form-label-sm">Deckkraft</label><input type="range" id="lp-fulloverlay-opacity" min="0" max="100" value="30" style="width:100%;" oninput="this.nextElementSibling.textContent=this.value+'%'"><span style="font-size:11px;color:var(--text-muted);">30%</span></div>
                            </div>
                            <div style="margin-top:14px;"><label class="form-label-sm">Wert (Gradient CSS / URL / Custom CSS)</label><input type="text" class="form-input" id="lp-fulloverlay-value" placeholder="radial-gradient(ellipse at center, transparent 50%, rgba(0,0,0,0.6))"></div>
                            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;">
                                <button class="btn btn--ghost" style="font-size:11px;padding:5px 10px;" onclick="document.getElementById('lp-fulloverlay-value').value='radial-gradient(ellipse at center, transparent 50%, rgba(0,0,0,0.6))'">Vignette</button>
                                <button class="btn btn--ghost" style="font-size:11px;padding:5px 10px;" onclick="document.getElementById('lp-fulloverlay-value').value='linear-gradient(180deg, rgba(0,0,0,0.3) 0%, transparent 30%, transparent 70%, rgba(0,0,0,0.5) 100%)'">Top+Bottom Fade</button>
                                <button class="btn btn--ghost" style="font-size:11px;padding:5px 10px;" onclick="document.getElementById('lp-fulloverlay-value').value='repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px)'">Scanlines</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ═══════════════════════════════════════
                     TAB: PRO TEASER
                     ═══════════════════════════════════════ -->
                <div class="lp-section" id="lp-sec-proTeaser">
                    <div class="card" style="margin-bottom:24px;">
                        <div class="card__header">
                            <h2 class="card__title"><span style="background:linear-gradient(135deg,#f0d060,#bca24c);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">PRO</span> Teaser Hintergrund</h2>
                            <label class="toggle" style="gap:8px;"><input type="checkbox" id="lp-pro-bg-enabled" checked><span class="toggle__slider"></span><span style="font-size:12px;color:var(--text-muted);">Aktiv</span></label>
                        </div>
                        <div class="card__body" style="padding:24px;">
                            <div style="margin-bottom:20px;">
                                <label class="form-label-sm">Hintergrund-Typ</label>
                                <div style="display:flex;gap:8px;flex-wrap:wrap;">
                                    <button class="lp-type-btn active" data-group="pro" data-type="none" onclick="LandingAdmin.setGroupType('pro','none',this)">Keiner</button>
                                    <button class="lp-type-btn" data-group="pro" data-type="image" onclick="LandingAdmin.setGroupType('pro','image',this)">Bild</button>
                                    <button class="lp-type-btn" data-group="pro" data-type="video" onclick="LandingAdmin.setGroupType('pro','video',this)">Video</button>
                                    <button class="lp-type-btn" data-group="pro" data-type="gradient" onclick="LandingAdmin.setGroupType('pro','gradient',this)">Gradient</button>
                                    <button class="lp-type-btn" data-group="pro" data-type="html" onclick="LandingAdmin.setGroupType('pro','html',this)">Custom HTML</button>
                                </div>
                            </div>
                            <div class="lp-group-fields" data-group="pro" data-type="image" style="display:none;"><div class="lp-settings-group"><div style="display:grid;grid-template-columns:2fr 1fr 1fr;gap:14px;"><div><label class="form-label-sm">URL</label><input type="text" class="form-input" id="lp-pro-bg-image" placeholder="https://..."></div><div><label class="form-label-sm">Fit</label><select class="form-select" id="lp-pro-bg-image-fit"><option value="cover">Cover</option><option value="contain">Contain</option><option value="none">None</option></select></div><div><label class="form-label-sm">Position</label><select class="form-select" id="lp-pro-bg-image-pos"><option value="center">Center</option><option value="top">Top</option><option value="bottom">Bottom</option></select></div></div></div></div>
                            <div class="lp-group-fields" data-group="pro" data-type="video" style="display:none;"><div class="lp-settings-group"><label class="form-label-sm">Video-URL</label><input type="text" class="form-input" id="lp-pro-bg-video" placeholder="https://... (mp4, webm)"></div></div>
                            <div class="lp-group-fields" data-group="pro" data-type="gradient" style="display:none;"><div class="lp-settings-group"><label class="form-label-sm">CSS Gradient</label><input type="text" class="form-input" id="lp-pro-bg-gradient" placeholder="radial-gradient(...)"><div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px;"><button class="btn btn--ghost" style="font-size:10px;padding:4px 8px;" onclick="document.getElementById('lp-pro-bg-gradient').value='radial-gradient(circle at 50% 0%, rgba(240,208,96,0.15), transparent 70%)'">Gold Glow</button><button class="btn btn--ghost" style="font-size:10px;padding:4px 8px;" onclick="document.getElementById('lp-pro-bg-gradient').value='radial-gradient(ellipse at 30% 80%, rgba(255,70,85,0.1), transparent 60%)'">Red Accent</button><button class="btn btn--ghost" style="font-size:10px;padding:4px 8px;" onclick="document.getElementById('lp-pro-bg-gradient').value='linear-gradient(135deg, rgba(240,208,96,0.08), rgba(139,92,246,0.06))'">Gold→Purple</button></div></div></div>
                            <div class="lp-group-fields" data-group="pro" data-type="html" style="display:none;"><div class="lp-settings-group"><label class="form-label-sm">Custom HTML</label><textarea class="form-input" id="lp-pro-bg-html" rows="5" style="font-family:monospace;font-size:12px;resize:vertical;"></textarea></div></div>
                            <hr style="border:none;border-top:1px solid var(--border);margin:18px 0;">
                            <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;">
                                <div><label class="form-label-sm">Deckkraft</label><input type="range" id="lp-pro-bg-opacity" min="0" max="100" value="10" style="width:100%;" oninput="this.nextElementSibling.textContent=this.value+'%'"><span style="font-size:11px;color:var(--text-muted);">10%</span></div>
                                <div><label class="form-label-sm">Blur</label><input type="range" id="lp-pro-bg-blur" min="0" max="40" value="0" style="width:100%;" oninput="this.nextElementSibling.textContent=this.value+'px'"><span style="font-size:11px;color:var(--text-muted);">0px</span></div>
                                <div><label class="form-label-sm">Blend-Mode</label><select class="form-select" id="lp-pro-bg-blend"><option value="normal">Normal</option><option value="screen">Screen</option><option value="overlay">Overlay</option><option value="soft-light">Soft Light</option><option value="luminosity">Luminosity</option></select></div>
                            </div>
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:14px;">
                                <div><label class="form-label-sm">Overlay-Farbe</label><input type="text" class="form-input" id="lp-pro-overlay-color" placeholder="rgba(0,0,0,0.3)"></div>
                                <div><label class="form-label-sm">CSS Animation</label><input type="text" class="form-input" id="lp-pro-bg-animation" placeholder="pulse 4s ease-in-out infinite"></div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card__header"><h2 class="card__title">Vorschau</h2><button class="btn btn--ghost" style="font-size:12px;" onclick="LandingAdmin.refreshPreview()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg> Aktualisieren</button></div>
                        <div class="card__body" style="padding:0;"><div id="lp-preview" style="position:relative;height:180px;border-radius:0 0 12px 12px;overflow:hidden;background:linear-gradient(135deg,rgba(240,208,96,0.03),rgba(188,162,76,0.02));border-top:1px solid var(--border);"><div id="lp-preview-bg" style="position:absolute;inset:0;overflow:hidden;"></div><div style="position:relative;z-index:1;display:flex;align-items:center;justify-content:center;height:100%;text-align:center;"><div><span style="display:inline-block;padding:3px 10px;background:linear-gradient(135deg,#f0d060,#bca24c);border-radius:100px;font-size:9px;font-weight:800;color:#1a1200;letter-spacing:0.1em;margin-bottom:6px;">PRO</span><div style="font-size:18px;font-weight:700;color:#f0f0f0;">RIFT Pro</div></div></div></div></div>
                    </div>
                </div>

                <!-- ═══════════════════════════════════════
                     TAB: CUSTOM CODE
                     ═══════════════════════════════════════ -->
                <div class="lp-section" id="lp-sec-code">
                    <div class="card" style="margin-bottom:24px;">
                        <div class="card__header"><h2 class="card__title">Custom CSS</h2></div>
                        <div class="card__body" style="padding:24px;">
                            <p style="font-size:12px;color:var(--text-muted);margin-bottom:14px;">Wird als <code style="background:var(--bg-input);padding:2px 6px;border-radius:4px;">&lt;style&gt;</code> in den &lt;head&gt; der Login-Seite injiziert. Überschreibt alles.</p>
                            <textarea class="form-input" id="lp-custom-css" rows="10" style="font-family:'SF Mono',Monaco,Consolas,monospace;font-size:12px;resize:vertical;line-height:1.6;" placeholder=".hero__h1 { font-size: 5rem; }&#10;.feature-card:hover { transform: scale(1.05); }&#10;.pro-teaser__inner { border-color: gold; }"></textarea>
                        </div>
                    </div>
                    <div class="card" style="margin-bottom:24px;">
                        <div class="card__header"><h2 class="card__title">Custom HTML (Head)</h2></div>
                        <div class="card__body" style="padding:24px;">
                            <p style="font-size:12px;color:var(--text-muted);margin-bottom:14px;">HTML das in den &lt;head&gt; injiziert wird (z.B. externe Fonts, Meta-Tags, Preloads).</p>
                            <textarea class="form-input" id="lp-custom-head" rows="4" style="font-family:monospace;font-size:12px;resize:vertical;" placeholder='<link rel="preload" href="..." as="image">'></textarea>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card__header"><h2 class="card__title">Custom HTML (Body)</h2></div>
                        <div class="card__body" style="padding:24px;">
                            <p style="font-size:12px;color:var(--text-muted);margin-bottom:14px;">HTML das direkt nach dem &lt;body&gt; injiziert wird (z.B. Partikel-Container, Canvas, Dekoelemente).</p>
                            <textarea class="form-input" id="lp-custom-body" rows="6" style="font-family:monospace;font-size:12px;resize:vertical;" placeholder='<canvas id="particles" style="position:fixed;inset:0;pointer-events:none;z-index:0;"></canvas>&#10;<script src="/assets/js/particles.js"><\/script>'></textarea>
                        </div>
                    </div>
                </div>
            </div>
            
        </main>
    </div>
    
    <!-- Editor Modal -->
    <div class="modal" id="editorModal">
        <div class="modal__content">
            <div class="modal__header">
                <h3 class="modal__title" id="editorTitle">Neuer Artikel</h3>
                <button class="btn btn--ghost" onclick="NewsAdmin.closeEditor()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal__body">
                <input type="hidden" id="articleId">
                
                <!-- Image Upload -->
                <div class="form-group">
                    <label class="form-label">Titelbild <span>(16:9, min. 1200×675px)</span></label>
                    <div class="image-upload" id="imageUpload">
                        <img class="image-upload__preview" id="imagePreview" src="" alt="">
                        <div class="image-upload__placeholder">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <polyline points="21 15 16 10 5 21"/>
                            </svg>
                            <p>Bild hierher ziehen oder klicken</p>
                            <small>JPG, PNG oder WebP</small>
                        </div>
                        <input type="file" id="imageInput" accept="image/jpeg,image/png,image/webp">
                    </div>
                    <p class="form-hint" id="imageHint"></p>
                </div>
                
                <!-- Title -->
                <div class="form-group">
                    <label class="form-label">Titel</label>
                    <input type="text" class="form-input" id="articleTitle" placeholder="Aussagekräftiger Titel...">
                </div>
                
                <!-- Excerpt -->
                <div class="form-group">
                    <label class="form-label">Kurzbeschreibung <span>(max. 160 Zeichen)</span></label>
                    <textarea class="form-textarea" id="articleExcerpt" placeholder="Kurze Zusammenfassung für die Vorschau..." maxlength="160"></textarea>
                    <p class="form-hint"><span id="excerptCount">0</span>/160 Zeichen</p>
                </div>
                
                <!-- Content -->
                <div class="form-group">
                    <label class="form-label">Inhalt <span>(Markdown unterstützt)</span></label>
                    <textarea class="form-textarea form-textarea--large" id="articleContent" placeholder="Der vollständige Artikeltext..."></textarea>
                </div>
                
                <!-- Category & Featured -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Kategorie</label>
                        <select class="form-select" id="articleCategory">
                            <option value="update">Update</option>
                            <option value="news">News</option>
                            <option value="guide">Guide</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Optionen</label>
                        <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 8px;">
                            <label class="form-checkbox">
                                <input type="checkbox" id="articleFeatured">
                                <span>Als Featured markieren</span>
                            </label>
                            <label class="form-checkbox">
                                <input type="checkbox" id="articlePublished">
                                <span>Veröffentlichen</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal__footer">
                <button class="btn btn--secondary" onclick="NewsAdmin.closeEditor()">Abbrechen</button>
                <button class="btn btn--primary" id="saveBtn" onclick="NewsAdmin.save()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    Speichern
                </button>
            </div>
        </div>
    </div>
    
    <!-- Carousel Editor Modal -->
    <div class="modal" id="carouselModal">
        <div class="modal__content modal__content--wide">
            <div class="modal__header">
                <h3 class="modal__title" id="carouselEditorTitle">Neue Slide</h3>
                <button class="btn btn--ghost" onclick="CarouselAdmin.closeEditor()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal__body">
                <input type="hidden" id="slideId">
                
                <!-- Title -->
                <div class="form-group">
                    <label class="form-label">Titel</label>
                    <input type="text" class="form-input" id="slideTitle" placeholder="Hauptüberschrift der Slide...">
                </div>
                
                <!-- Description -->
                <div class="form-group">
                    <label class="form-label">Beschreibung</label>
                    <textarea class="form-textarea" id="slideDescription" placeholder="Kurzer Text unter dem Titel..."></textarea>
                </div>
                
                <!-- Badge & Type -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Badge Text</label>
                        <input type="text" class="form-input" id="slideBadge" placeholder="z.B. Aktive Session, Neu, Feature">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Badge Typ</label>
                        <select class="form-select" id="slideBadgeType">
                            <option value="live">🔴 Live (rot, pulsierend)</option>
                            <option value="new">🟣 Neu (lila)</option>
                            <option value="event">🟠 Event (orange)</option>
                            <option value="update">🟢 Update (grün)</option>
                            <option value="featured">🌟 Featured (gold)</option>
                            <option value="beta">🔵 Beta (blau)</option>
                            <option value="soon">⚪ Coming Soon (grau)</option>
                            <option value="hot">🔥 Hot (rot/orange)</option>
                            <option value="community">💬 Community (türkis)</option>
                        </select>
                    </div>
                </div>
                
                <!-- CTA -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Button Text</label>
                        <input type="text" class="form-input" id="slideCtaText" placeholder="z.B. Jetzt starten">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Button Link</label>
                        <input type="text" class="form-input" id="slideCtaLink" placeholder="z.B. session.html">
                    </div>
                </div>
                
                <!-- Tab Label & Autoplay -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Tab Label <span>(kurz)</span></label>
                        <input type="text" class="form-input" id="slideTabLabel" placeholder="z.B. Session, News">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Autoplay Dauer <span>(Sekunden)</span></label>
                        <input type="number" class="form-input" id="slideAutoplay" placeholder="6" min="2" max="60" value="6">
                    </div>
                </div>
                
                <!-- Background Section Header -->
                <div class="form-section-header">
                    <span>Hintergrund</span>
                </div>
                
                <!-- Background Type Selection -->
                <div class="form-group">
                    <label class="form-label">Hintergrund-Typ</label>
                    <div class="form-radio-group">
                        <label class="form-radio">
                            <input type="radio" name="bgType" value="css" checked onchange="CarouselAdmin.toggleBgType('css')">
                            <span>CSS / Gradient</span>
                        </label>
                        <label class="form-radio">
                            <input type="radio" name="bgType" value="image" onchange="CarouselAdmin.toggleBgType('image')">
                            <span>Bild Upload</span>
                        </label>
                        <label class="form-radio">
                            <input type="radio" name="bgType" value="video" onchange="CarouselAdmin.toggleBgType('video')">
                            <span>Video</span>
                        </label>
                    </div>
                </div>
                
                <!-- CSS Background -->
                <div class="form-group" id="bgCssGroup">
                    <label class="form-label">CSS Hintergrund</label>
                    <textarea class="form-textarea" id="slideBackground" placeholder="z.B. linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(59, 130, 246, 0.2)), url('...') center/cover"></textarea>
                    <p class="form-hint">Gradient, Farbe oder URL</p>
                </div>
                
                <!-- Image Upload -->
                <div class="form-group" id="bgImageGroup" style="display: none;">
                    <label class="form-label">Bild hochladen oder URL eingeben</label>
                    <div class="image-upload" id="slideBgUpload">
                        <img class="image-upload__preview" id="slideBgPreview" src="" alt="">
                        <div class="image-upload__placeholder">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <polyline points="21 15 16 10 5 21"/>
                            </svg>
                            <p>Bild hierher ziehen oder klicken</p>
                            <small>16:9, min. 1920×1080px empfohlen</small>
                        </div>
                        <input type="file" id="slideBgInput" accept="image/jpeg,image/png,image/webp">
                    </div>
                    <div class="form-group" style="margin-top: 12px;">
                        <label class="form-label">Oder: Bild-URL direkt eingeben</label>
                        <input type="text" class="form-input" id="slideBgImageUrlDirect" placeholder="https://example.com/image.jpg" oninput="CarouselAdmin.previewImageUrl(this.value)">
                    </div>
                    <input type="hidden" id="slideBgImageUrl">
                </div>
                
                <!-- Video Background -->
                <div class="form-group" id="bgVideoGroup" style="display: none;">
                    <label class="form-label">Video URL <span>(YouTube oder MP4)</span></label>
                    <input type="text" class="form-input" id="slideVideoUrl" placeholder="https://youtube.com/watch?v=... oder video.mp4">
                    <p class="form-hint">YouTube-Links werden automatisch konvertiert. Videos laufen stumm im Loop.</p>
                    
                    <div class="form-row" style="margin-top: 16px;">
                        <div class="form-group">
                            <label class="form-label">Abspielgeschwindigkeit</label>
                            <select class="form-select" id="slideVideoSpeed">
                                <option value="0.25">0.25x (Sehr langsam)</option>
                                <option value="0.5">0.5x (Langsam)</option>
                                <option value="0.75">0.75x</option>
                                <option value="1" selected>1x (Normal)</option>
                                <option value="1.25">1.25x</option>
                                <option value="1.5">1.5x (Schnell)</option>
                                <option value="2">2x (Sehr schnell)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Video Zoom</label>
                            <select class="form-select" id="slideVideoZoom">
                                <option value="100">100% (Kein Zoom)</option>
                                <option value="110">110%</option>
                                <option value="120" selected>120% (Standard)</option>
                                <option value="130">130%</option>
                                <option value="150">150%</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" style="margin-top: 12px;">
                        <label class="form-label">Video Startzeit (Sekunden)</label>
                        <input type="number" class="form-input" id="slideVideoStart" placeholder="0" min="0" value="0">
                        <p class="form-hint">Video startet ab dieser Sekunde</p>
                    </div>
                </div>
                
                <!-- Overlay/Gradient Options -->
                <div class="form-section-header">
                    <span>Overlay / Abdunklung</span>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Overlay Farbe</label>
                        <select class="form-select" id="slideOverlayColor">
                            <option value="none">Kein Overlay</option>
                            <option value="black" selected>Schwarz</option>
                            <option value="accent">Akzentfarbe (Rot)</option>
                            <option value="purple">Lila</option>
                            <option value="blue">Blau</option>
                            <option value="custom">Eigene Farbe...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Overlay Stärke: <span id="overlayOpacityValue">50%</span></label>
                        <input type="range" class="form-range" id="slideOverlayOpacity" min="0" max="100" value="50" oninput="document.getElementById('overlayOpacityValue').textContent = this.value + '%'">
                    </div>
                </div>
                
                <div class="form-group" id="customOverlayGroup" style="display: none;">
                    <label class="form-label">Eigene Overlay Farbe</label>
                    <input type="color" class="form-color" id="slideOverlayCustom" value="#000000">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Gradient Richtung</label>
                    <select class="form-select" id="slideGradientDirection">
                        <option value="none">Kein Gradient</option>
                        <option value="to-right" selected>Links → Rechts (Text lesbar)</option>
                        <option value="to-left">Rechts → Links</option>
                        <option value="to-bottom">Oben → Unten</option>
                        <option value="to-top">Unten → Oben</option>
                        <option value="radial">Radial (Mitte hell)</option>
                    </select>
                </div>
                
                <!-- Countdown Section -->
                <div class="form-section-header">
                    <span>Countdown (optional)</span>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Countdown Ziel-Datum</label>
                        <input type="datetime-local" class="form-input" id="slideCountdownDate">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Countdown Label</label>
                        <input type="text" class="form-input" id="slideCountdownLabel" placeholder="z.B. Event startet in">
                    </div>
                </div>
                
                <!-- UI Elements Section -->
                <div class="form-section-header">
                    <span>UI Elemente anzeigen</span>
                </div>
                
                <div class="form-group">
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <label class="form-checkbox">
                            <input type="checkbox" id="slideShowBadge" checked>
                            <span>Badge anzeigen</span>
                        </label>
                        <label class="form-checkbox">
                            <input type="checkbox" id="slideShowTitle" checked>
                            <span>Titel anzeigen</span>
                        </label>
                        <label class="form-checkbox">
                            <input type="checkbox" id="slideShowDescription" checked>
                            <span>Beschreibung anzeigen</span>
                        </label>
                        <label class="form-checkbox">
                            <input type="checkbox" id="slideShowCta" checked>
                            <span>CTA Button anzeigen</span>
                        </label>
                    </div>
                </div>
                
                <!-- Global Carousel UI (affects all slides) -->
                <div class="form-section-header">
                    <span>Carousel Navigation (global)</span>
                </div>
                
                <div class="form-group">
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <label class="form-checkbox">
                            <input type="checkbox" id="carouselShowArrows" checked>
                            <span>Pfeile links/rechts anzeigen</span>
                        </label>
                        <label class="form-checkbox">
                            <input type="checkbox" id="carouselShowTabs" checked>
                            <span>Tab-Navigation unten anzeigen</span>
                        </label>
                        <label class="form-checkbox">
                            <input type="checkbox" id="carouselShowDots" checked>
                            <span>Dots (Mobile) anzeigen</span>
                        </label>
                        <label class="form-checkbox">
                            <input type="checkbox" id="carouselAutoplay" checked>
                            <span>Autoplay aktiviert</span>
                        </label>
                    </div>
                </div>
                
                <!-- Options -->
                <div class="form-section-header">
                    <span>Sonstige Optionen</span>
                </div>
                
                <div class="form-group">
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <label class="form-checkbox">
                            <input type="checkbox" id="slideLiveIndicator">
                            <span>Live-Indikator anzeigen (pulsierender Punkt)</span>
                        </label>
                        <label class="form-checkbox">
                            <input type="checkbox" id="slideActive" checked>
                            <span>Slide aktiv (wird angezeigt)</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal__footer">
                <button class="btn btn--secondary" onclick="CarouselAdmin.closeEditor()">Abbrechen</button>
                <button class="btn btn--primary" onclick="CarouselAdmin.save()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    Speichern
                </button>
            </div>
        </div>
    </div>
    
    <!-- Features Modal -->
    <div class="modal" id="featuresModal">
        <div class="modal__content">
            <div class="modal__header">
                <h3 class="modal__title" id="featureEditorTitle">Neues Feature</h3>
                <button class="btn btn--ghost" onclick="FeaturesAdmin.closeEditor()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal__body">
                <input type="hidden" id="featureId">
                
                <!-- Tab Label & ID -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Tab Label</label>
                        <input type="text" class="form-input" id="featureTabLabel" placeholder="z.B. Charakterbogen">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Feature ID</label>
                        <input type="text" class="form-input" id="featureIdInput" placeholder="z.B. charsheet">
                        <p class="form-hint">Eindeutige ID (keine Leerzeichen)</p>
                    </div>
                </div>
                
                <!-- Title -->
                <div class="form-group">
                    <label class="form-label">Titel</label>
                    <input type="text" class="form-input" id="featureTitle" placeholder="Erschaffe jeden Helden, den du dir vorstellen kannst">
                </div>
                
                <!-- Description -->
                <div class="form-group">
                    <label class="form-label">Beschreibung</label>
                    <textarea class="form-textarea" id="featureDescription" placeholder="Kurze Beschreibung des Features..."></textarea>
                </div>
                
                <!-- Highlights -->
                <div class="form-group">
                    <label class="form-label">Highlights (Bullet Points)</label>
                    <div id="featureHighlightsList"></div>
                    <button type="button" class="btn btn--secondary" onclick="FeaturesAdmin.addHighlight()" style="margin-top: 8px;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Highlight hinzufügen
                    </button>
                </div>
                
                <!-- CTA -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Button Text</label>
                        <input type="text" class="form-input" id="featureCtaText" placeholder="z.B. Charakter erstellen">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Button Link</label>
                        <input type="text" class="form-input" id="featureCtaLink" placeholder="z.B. characters.html">
                    </div>
                </div>
                
                <!-- Badge Section -->
                <div class="form-section-header" style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border);">
                    <span>Badge & Styling</span>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Badge Text (optional)</label>
                        <input type="text" class="form-input" id="featureBadgeText" placeholder="z.B. Neu, Beta, Coming Soon">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Badge Farbe</label>
                        <select class="form-select" id="featureBadgeColor">
                            <option value="">Keine</option>
                            <option value="red">Rot (Wichtig)</option>
                            <option value="green">Grün (Neu)</option>
                            <option value="purple">Lila (Beta)</option>
                            <option value="orange">Orange (Coming Soon)</option>
                            <option value="blue">Blau (Info)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Akzentfarbe</label>
                        <select class="form-select" id="featureAccentColor">
                            <option value="">Standard (Rot)</option>
                            <option value="#8B5CF6">Lila</option>
                            <option value="#3B82F6">Blau</option>
                            <option value="#22C55E">Grün</option>
                            <option value="#F59E0B">Orange</option>
                            <option value="#EC4899">Pink</option>
                        </select>
                        <p class="form-hint">Farbe für Button und Akzente</p>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Layout</label>
                        <select class="form-select" id="featureLayout">
                            <option value="image-left">Bild links</option>
                            <option value="image-right">Bild rechts</option>
                        </select>
                    </div>
                </div>
                
                <!-- Image Section -->
                <div class="form-section-header" style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border);">
                    <span>Bild / Icon</span>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Bild URL</label>
                    <input type="text" class="form-input" id="featureImageUrl" placeholder="https://...">
                    <p class="form-hint">Empfohlen: 800×600px oder größer</p>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Oder Icon (falls kein Bild)</label>
                        <select class="form-select" id="featureIcon">
                            <option value="">Kein Icon</option>
                            <option value="user">👤 Benutzer/Charakter</option>
                            <option value="dice">🎲 Würfel</option>
                            <option value="map">🗺️ Karte</option>
                            <option value="chat">💬 Chat</option>
                            <option value="book">📖 Buch/Regeln</option>
                            <option value="sword">⚔️ Kampf</option>
                            <option value="magic">✨ Magie</option>
                            <option value="shield">🛡️ Schild</option>
                            <option value="scroll">📜 Notizen</option>
                            <option value="crown">👑 GM/Meister</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Icon Hintergrund</label>
                        <select class="form-select" id="featureIconBg">
                            <option value="">Transparent</option>
                            <option value="gradient-red">Rot Gradient</option>
                            <option value="gradient-purple">Lila Gradient</option>
                            <option value="gradient-blue">Blau Gradient</option>
                            <option value="gradient-green">Grün Gradient</option>
                            <option value="solid-dark">Dunkel</option>
                        </select>
                    </div>
                </div>
                
                <!-- Options -->
                <div class="form-section-header" style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border);">
                    <span>Optionen</span>
                </div>
                
                <div class="form-group">
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <label class="form-checkbox">
                            <input type="checkbox" id="featureActive" checked>
                            <span>Feature aktiv (wird angezeigt)</span>
                        </label>
                        <label class="form-checkbox">
                            <input type="checkbox" id="featureHighlight">
                            <span>Feature hervorheben (größere Darstellung)</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal__footer">
                <button class="btn btn--secondary" onclick="FeaturesAdmin.closeEditor()">Abbrechen</button>
                <button class="btn btn--primary" onclick="FeaturesAdmin.save()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    Speichern
                </button>
            </div>
        </div>
    </div>
    
    <!-- Quote Editor Modal -->
    <div class="modal" id="quoteModal">
        <div class="modal__content">
            <div class="modal__header">
                <h3 class="modal__title" id="quoteEditorTitle">Neues Zitat</h3>
                <button class="btn btn--ghost" onclick="QuotesAdmin.closeEditor()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal__body">
                <input type="hidden" id="quoteId">
                
                <!-- Quote Text -->
                <div class="form-group">
                    <label class="form-label">Zitat <span>*</span></label>
                    <textarea class="form-textarea form-textarea--large" id="quoteText" placeholder="Das Zitat eingeben..." style="min-height: 120px;"></textarea>
                    <p class="form-hint"><span id="quoteCharCount">0</span> Zeichen</p>
                </div>
                
                <!-- Author & Source -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Autor <span>*</span></label>
                        <input type="text" class="form-input" id="quoteAuthor" placeholder="z.B. Albert Einstein">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quelle <span>(optional)</span></label>
                        <input type="text" class="form-input" id="quoteSource" placeholder="z.B. Buch, Film, Rede...">
                    </div>
                </div>
                
                <!-- Year & Original Language -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Jahr <span>(optional)</span></label>
                        <input type="text" class="form-input" id="quoteYear" placeholder="z.B. 1921">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Originalsprache</label>
                        <select class="form-select" id="quoteLanguage">
                            <option value="de">Deutsch</option>
                            <option value="en">Englisch</option>
                            <option value="la">Latein</option>
                            <option value="fr">Französisch</option>
                            <option value="other">Andere</option>
                        </select>
                    </div>
                </div>
                
                <!-- Category & Tags -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Kategorie</label>
                        <select class="form-select" id="quoteCategory">
                            <option value="wisdom">Weisheit</option>
                            <option value="motivation">Motivation</option>
                            <option value="humor">Humor</option>
                            <option value="rpg">Rollenspiel</option>
                            <option value="fantasy">Fantasy</option>
                            <option value="scifi">Sci-Fi</option>
                            <option value="philosophy">Philosophie</option>
                            <option value="gaming">Gaming</option>
                            <option value="life">Leben</option>
                            <option value="friendship">Freundschaft</option>
                            <option value="adventure">Abenteuer</option>
                            <option value="custom">Eigene...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tags <span>(kommagetrennt)</span></label>
                        <input type="text" class="form-input" id="quoteTags" placeholder="z.B. Leben, Mut, Träume">
                    </div>
                </div>
                
                <!-- Custom Category (hidden by default) -->
                <div class="form-group" id="customCategoryGroup" style="display: none;">
                    <label class="form-label">Eigene Kategorie</label>
                    <input type="text" class="form-input" id="quoteCustomCategory" placeholder="Kategorie eingeben...">
                </div>
                
                <div class="form-section-header" style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border);">
                    <span>Erweiterte Optionen</span>
                </div>
                
                <!-- Link & Image -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Link <span>(optional)</span></label>
                        <input type="text" class="form-input" id="quoteLink" placeholder="https://...">
                        <p class="form-hint">Verlinkt das Zitat zu einer externen Quelle</p>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Bild URL <span>(optional)</span></label>
                        <input type="text" class="form-input" id="quoteImageUrl" placeholder="https://...">
                        <p class="form-hint">Hintergrundbild für besondere Zitate</p>
                    </div>
                </div>
                
                <!-- Scheduling -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Gültig ab</label>
                        <input type="date" class="form-input" id="quoteValidFrom">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Gültig bis</label>
                        <input type="date" class="form-input" id="quoteValidUntil">
                        <p class="form-hint">Leer = unbegrenzt</p>
                    </div>
                </div>
                
                <!-- Special Days -->
                <div class="form-group">
                    <label class="form-label">Für besondere Tage</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 8px;">
                        <label class="form-checkbox">
                            <input type="checkbox" id="quoteNewYear">
                            <span>Neujahr</span>
                        </label>
                        <label class="form-checkbox">
                            <input type="checkbox" id="quoteChristmas">
                            <span>Weihnachten</span>
                        </label>
                        <label class="form-checkbox">
                            <input type="checkbox" id="quoteHalloween">
                            <span>Halloween</span>
                        </label>
                        <label class="form-checkbox">
                            <input type="checkbox" id="quoteEaster">
                            <span>Ostern</span>
                        </label>
                        <label class="form-checkbox">
                            <input type="checkbox" id="quoteValentine">
                            <span>Valentinstag</span>
                        </label>
                    </div>
                </div>
                
                <!-- Priority & Options -->
                <div class="form-row" style="margin-top: 16px;">
                    <div class="form-group">
                        <label class="form-label">Priorität</label>
                        <select class="form-select" id="quotePriority">
                            <option value="1">Normal</option>
                            <option value="2">Hoch (2x Chance)</option>
                            <option value="3">Sehr hoch (3x Chance)</option>
                        </select>
                        <p class="form-hint">Höhere Priorität = häufiger angezeigt</p>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 8px;">
                            <label class="form-checkbox">
                                <input type="checkbox" id="quoteActive" checked>
                                <span>Zitat aktiv</span>
                            </label>
                            <label class="form-checkbox">
                                <input type="checkbox" id="quoteFeatured">
                                <span>Als Featured markieren</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal__footer">
                <button class="btn btn--secondary" onclick="QuotesAdmin.closeEditor()">Abbrechen</button>
                <button class="btn btn--primary" onclick="QuotesAdmin.save()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    Speichern
                </button>
            </div>
        </div>
    </div>
    
    <!-- Import Quotes Modal -->
    <div class="modal" id="importQuotesModal">
        <div class="modal__content">
            <div class="modal__header">
                <h3 class="modal__title">Zitate importieren</h3>
                <button class="btn btn--ghost" onclick="QuotesAdmin.closeImport()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal__body">
                <div class="form-group">
                    <label class="form-label">Format</label>
                    <select class="form-select" id="importFormat">
                        <option value="json">JSON</option>
                        <option value="csv">CSV</option>
                        <option value="text">Einfacher Text (ein Zitat pro Zeile)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Daten einfügen</label>
                    <textarea class="form-textarea form-textarea--large" id="importData" placeholder="JSON, CSV oder Text hier einfügen..."></textarea>
                </div>
                
                <div class="form-group" id="importTextOptions" style="display: none;">
                    <label class="form-label">Trennzeichen für Text-Import</label>
                    <input type="text" class="form-input" id="importSeparator" value=" — " placeholder="Trennzeichen zwischen Zitat und Autor">
                    <p class="form-hint">z.B. " — " für "Zitat — Autor"</p>
                </div>
                
                <div id="importPreview" style="display: none; margin-top: 16px; padding: 16px; background: var(--bg); border-radius: var(--radius); border: 1px solid var(--border);">
                    <p style="font-weight: 600; margin-bottom: 8px;">Vorschau (<span id="importCount">0</span> Zitate):</p>
                    <div id="importPreviewList" style="max-height: 200px; overflow-y: auto;"></div>
                </div>
            </div>
            <div class="modal__footer">
                <button class="btn btn--secondary" onclick="QuotesAdmin.closeImport()">Abbrechen</button>
                <button class="btn btn--secondary" onclick="QuotesAdmin.previewImport()">Vorschau</button>
                <button class="btn btn--primary" onclick="QuotesAdmin.confirmImport()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    Importieren
                </button>
            </div>
        </div>
    </div>
    
    <!-- ═══════════════════════════════════════
         ANNOUNCEMENTS MODAL
         ═══════════════════════════════════════ -->
    <div class="modal" id="announcementModal">
        <div class="modal__content" style="max-width: 700px;">
            <div class="modal__header">
                <h3 class="modal__title" id="announcementModalTitle">Neuer Banner</h3>
                <button class="btn btn--ghost" onclick="AnnouncementsAdmin.closeEditor()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal__body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label class="form-label">Titel *</label>
                        <input type="text" class="form-input" id="bannerTitle" placeholder="Banner-Titel" oninput="AnnouncementsAdmin.updatePreview()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Typ</label>
                        <select class="form-select" id="bannerType" onchange="AnnouncementsAdmin.updatePreview()">
                            <option value="info">ℹ️ Info</option>
                            <option value="warning">⚠️ Warnung</option>
                            <option value="critical">🚨 Kritisch</option>
                            <option value="maintenance">🔧 Wartung</option>
                            <option value="event">🎉 Event</option>
                            <option value="update">🚀 Update</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nachricht</label>
                    <textarea class="form-textarea" id="bannerMessage" placeholder="Optionale Beschreibung..." rows="2" oninput="AnnouncementsAdmin.updatePreview()"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label class="form-label">Stil</label>
                        <select class="form-select" id="bannerStyle" onchange="AnnouncementsAdmin.updatePreview()">
                            <option value="bar">🔲 Bar (oben)</option>
                            <option value="toast">📱 Toast (Ecke)</option>
                            <option value="card">🃏 Card (Content)</option>
                            <option value="modal">💬 Modal (Popup)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Zielgruppe</label>
                        <select class="form-select" id="bannerAudience">
                            <option value="all">Alle</option>
                            <option value="logged_in">Eingeloggte User</option>
                            <option value="logged_out">Ausgeloggte User</option>
                            <option value="admin">Nur Admins</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label class="form-label">Seiten</label>
                        <select class="form-select" id="bannerPages">
                            <option value="all">Alle Seiten</option>
                            <option value="index">Nur Hub</option>
                            <option value="session">Nur Session</option>
                            <option value="dice">Nur Würfel</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Priorität</label>
                        <select class="form-select" id="bannerPriority">
                            <option value="0">Normal</option>
                            <option value="5">Hoch</option>
                            <option value="10">Kritisch</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label class="form-label">Startdatum (optional)</label>
                        <input type="datetime-local" class="form-input" id="bannerStartDate">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Enddatum (optional)</label>
                        <input type="datetime-local" class="form-input" id="bannerEndDate">
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label class="form-label">Link URL (optional)</label>
                        <input type="url" class="form-input" id="bannerLinkUrl" placeholder="https://..." oninput="AnnouncementsAdmin.updatePreview()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Link Text</label>
                        <input type="text" class="form-input" id="bannerLinkText" placeholder="Mehr erfahren" oninput="AnnouncementsAdmin.updatePreview()">
                    </div>
                </div>
                
                <div style="display: flex; gap: 16px; margin-top: 8px;">
                    <label class="form-checkbox">
                        <input type="checkbox" id="bannerActive" checked>
                        <span>Aktiv</span>
                    </label>
                    <label class="form-checkbox">
                        <input type="checkbox" id="bannerDismissible" checked>
                        <span>Schließbar</span>
                    </label>
                    <label class="form-checkbox">
                        <input type="checkbox" id="bannerShowCountdown">
                        <span>Countdown anzeigen</span>
                    </label>
                </div>
                
                <!-- Preview -->
                <div style="margin-top: 20px; padding: 16px; background: var(--bg); border-radius: var(--radius); border: 1px solid var(--border);">
                    <p style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: 12px; text-transform: uppercase;">Vorschau</p>
                    <div id="bannerEditorPreview" style="border-radius: 8px; overflow: hidden;"></div>
                </div>
            </div>
            <div class="modal__footer">
                <button class="btn btn--secondary" onclick="AnnouncementsAdmin.closeEditor()">Abbrechen</button>
                <button class="btn btn--primary" onclick="AnnouncementsAdmin.save()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                    Speichern
                </button>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- Pro Grant Modal -->
    <div class="modal" id="proGrantModal">
        <div class="modal__content" style="max-width:520px;">
            <div class="modal__header">
                <h3 class="modal__title">Pro-Status vergeben</h3>
                <button class="btn btn--ghost" onclick="ProAdmin.closeGrantModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal__body">
                <!-- User Lookup -->
                <div class="form-group">
                    <label class="form-label">Benutzer suchen</label>
                    <div style="display:flex;gap:8px;">
                        <input type="text" class="form-input" id="proGrantSearch" placeholder="UID, Email oder Anzeigename…" style="flex:1;">
                        <button class="btn btn--secondary btn--small" onclick="ProAdmin.lookupUser()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                            Suchen
                        </button>
                    </div>
                    <div id="proGrantUserResult" style="margin-top:12px;"></div>
                </div>
                
                <!-- Plan Selection -->
                <div class="form-group">
                    <label class="form-label">Plan</label>
                    <select class="form-select" id="proGrantPlan">
                        <option value="gift">Geschenk (Admin)</option>
                        <option value="monthly">Monatlich</option>
                        <option value="yearly">Jährlich</option>
                        <option value="trial">Trial</option>
                    </select>
                </div>
                
                <!-- Expiry -->
                <div class="form-group">
                    <label class="form-label">Ablaufdatum <span style="color:var(--text-muted);">(optional – leer = unbegrenzt)</span></label>
                    <input type="date" class="form-input" id="proGrantExpiry">
                </div>
                
                <!-- Note -->
                <div class="form-group">
                    <label class="form-label">Notiz <span style="color:var(--text-muted);">(intern)</span></label>
                    <input type="text" class="form-input" id="proGrantNote" placeholder="z.B. Beta-Tester, Gewinnspiel…">
                </div>
            </div>
            <div class="modal__footer">
                <button class="btn btn--secondary" onclick="ProAdmin.closeGrantModal()">Abbrechen</button>
                <button class="btn btn--primary" id="proGrantSubmitBtn" onclick="ProAdmin.grantPro()" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    Pro vergeben
                </button>
            </div>
        </div>
    </div>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <script>
        // ========================================
        // FIREBASE CONFIG
        // ========================================
        const firebaseConfig = {
            apiKey: "AIzaSyCcoId9a62tLIqIRFaFt_ADMTedTUzf3f8",
            authDomain: "rift-app-de805.firebaseapp.com",
            databaseURL: "https://rift-app-de805-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "rift-app-de805",
            storageBucket: "rift-app-de805.firebasestorage.app",
            messagingSenderId: "974596929896",
            appId: "1:974596929896:web:a6542045dae21899d07edd"
        };
        
        // Admin UID Whitelist (Fallback - primary source is Firebase)
        const FALLBACK_ADMIN_UIDS = ['geBL1RI92jUiPrFK1oJ5u2Z25hM2'];
        let ADMIN_UIDS = [...FALLBACK_ADMIN_UIDS];
        
        // Load admin UIDs from Firebase
        async function loadAdminUIDs() {
            try {
                const doc = await db.collection('config').doc('admins').get();
                if (doc.exists && doc.data().uids) {
                    ADMIN_UIDS = [...new Set([...FALLBACK_ADMIN_UIDS, ...doc.data().uids])];
                    console.log('[Admin] Loaded', ADMIN_UIDS.length, 'admin UIDs from Firebase');
                }
            } catch (e) {
                console.warn('[Admin] Could not load admin UIDs from Firebase, using fallback');
            }
        }
        
        let db, currentUser;
        
        // ========================================
        // TOAST NOTIFICATIONS
        // ========================================
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast--${type}`;
            
            const icon = type === 'success' 
                ? '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>'
                : '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>';
            
            toast.innerHTML = `${icon}<span>${message}</span>`;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // ========================================
        // NEWS ADMIN MODULE
        // ========================================
        const NewsAdmin = {
            articles: [],
            currentImageFile: null,
            currentImageUrl: null,
            
            async load() {
                try {
                    const snapshot = await db.collection('hub_news')
                        .orderBy('createdAt', 'desc')
                        .get();
                    
                    this.articles = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    this.render();
                    this.updateStats();
                } catch (e) {
                    console.error('[Admin] Error loading news:', e);
                    showToast('Fehler beim Laden der Artikel', 'error');
                }
            },
            
            updateStats() {
                const published = this.articles.filter(a => a.published).length;
                const drafts = this.articles.filter(a => !a.published).length;
                const featured = this.articles.filter(a => a.featured && a.published).length;
                
                document.getElementById('statPublished').textContent = published;
                document.getElementById('statDrafts').textContent = drafts;
                document.getElementById('statFeatured').textContent = featured;
            },
            
            render() {
                const tbody = document.getElementById('newsTableBody');
                
                if (this.articles.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6">
                                <div class="empty-state">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14 2 14 8 20 8"/>
                                        <line x1="16" y1="13" x2="8" y2="13"/>
                                        <line x1="16" y1="17" x2="8" y2="17"/>
                                        <polyline points="10 9 9 9 8 9"/>
                                    </svg>
                                    <p>Noch keine Artikel vorhanden</p>
                                    <button class="btn btn--primary btn--small" onclick="NewsAdmin.openEditor()">
                                        Ersten Artikel erstellen
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                const categoryLabels = {
                    update: 'Update',
                    news: 'News',
                    guide: 'Guide'
                };
                
                tbody.innerHTML = this.articles.map(article => {
                    const date = article.publishedAt?.toDate?.() || article.createdAt?.toDate?.() || new Date();
                    const dateStr = date.toLocaleDateString('de-DE', { day: '2-digit', month: 'short', year: 'numeric' });
                    
                    return `
                        <tr>
                            <td>
                                <div class="news-table__image" style="background-image: url('${article.imageUrl || ''}');"></div>
                            </td>
                            <td>
                                <div class="news-table__title">${this.escapeHtml(article.title || 'Ohne Titel')}</div>
                                <div class="news-table__excerpt">${this.escapeHtml(article.excerpt || '')}</div>
                            </td>
                            <td>
                                <span class="badge badge--${article.category || 'news'}">${categoryLabels[article.category] || 'News'}</span>
                            </td>
                            <td>
                                ${article.featured ? '<span class="badge badge--featured" style="margin-right:4px;">★</span>' : ''}
                                <span class="badge badge--${article.published ? 'published' : 'draft'}">${article.published ? 'Live' : 'Entwurf'}</span>
                            </td>
                            <td style="color: var(--text-muted); font-size: 13px;">${dateStr}</td>
                            <td>
                                <div class="news-table__actions">
                                    <button class="btn btn--secondary btn--small" onclick="NewsAdmin.edit('${article.id}')">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px;">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                        </svg>
                                        Edit
                                    </button>
                                    <button class="btn btn--danger btn--small" onclick="NewsAdmin.delete('${article.id}')">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px;">
                                            <polyline points="3 6 5 6 21 6"/>
                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
            },
            
            openEditor(id = null) {
                const modal = document.getElementById('editorModal');
                const title = document.getElementById('editorTitle');
                
                // Reset form
                document.getElementById('articleId').value = '';
                document.getElementById('articleTitle').value = '';
                document.getElementById('articleExcerpt').value = '';
                document.getElementById('articleContent').value = '';
                document.getElementById('articleCategory').value = 'update';
                document.getElementById('articleFeatured').checked = false;
                document.getElementById('articlePublished').checked = false;
                document.getElementById('imagePreview').src = '';
                document.getElementById('imageUpload').classList.remove('has-image');
                document.getElementById('imageHint').textContent = '';
                document.getElementById('excerptCount').textContent = '0';
                this.currentImageFile = null;
                this.currentImageUrl = null;
                
                if (id) {
                    const article = this.articles.find(a => a.id === id);
                    if (article) {
                        title.textContent = 'Artikel bearbeiten';
                        document.getElementById('articleId').value = id;
                        document.getElementById('articleTitle').value = article.title || '';
                        document.getElementById('articleExcerpt').value = article.excerpt || '';
                        document.getElementById('articleContent').value = article.content || '';
                        document.getElementById('articleCategory').value = article.category || 'update';
                        document.getElementById('articleFeatured').checked = article.featured || false;
                        document.getElementById('articlePublished').checked = article.published || false;
                        document.getElementById('excerptCount').textContent = (article.excerpt || '').length;
                        
                        if (article.imageUrl) {
                            this.currentImageUrl = article.imageUrl;
                            document.getElementById('imagePreview').src = article.imageUrl;
                            document.getElementById('imageUpload').classList.add('has-image');
                        }
                    }
                } else {
                    title.textContent = 'Neuer Artikel';
                }
                
                modal.classList.add('active');
            },
            
            closeEditor() {
                document.getElementById('editorModal').classList.remove('active');
            },
            
            edit(id) {
                this.openEditor(id);
            },
            
            async save() {
                const id = document.getElementById('articleId').value;
                const title = document.getElementById('articleTitle').value.trim();
                const excerpt = document.getElementById('articleExcerpt').value.trim();
                const content = document.getElementById('articleContent').value.trim();
                const category = document.getElementById('articleCategory').value;
                const featured = document.getElementById('articleFeatured').checked;
                const published = document.getElementById('articlePublished').checked;
                
                if (!title) {
                    showToast('Bitte Titel eingeben', 'error');
                    return;
                }
                
                const saveBtn = document.getElementById('saveBtn');
                saveBtn.disabled = true;
                saveBtn.innerHTML = '<div class="loading-spinner" style="width:18px;height:18px;"></div> Speichern...';
                
                try {
                    // Upload image if new one selected
                    let imageUrl = this.currentImageUrl;
                    if (this.currentImageFile) {
                        imageUrl = await this.uploadImage(this.currentImageFile);
                    }
                    
                    const data = {
                        title,
                        excerpt,
                        content,
                        category,
                        featured,
                        published,
                        imageUrl: imageUrl || null,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    if (id) {
                        // Update existing
                        await db.collection('hub_news').doc(id).update(data);
                        showToast('Artikel aktualisiert');
                    } else {
                        // Create new
                        data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                        data.publishedAt = published ? firebase.firestore.FieldValue.serverTimestamp() : null;
                        data.authorId = currentUser.uid;
                        data.authorName = currentUser.displayName || 'Admin';
                        await db.collection('hub_news').add(data);
                        showToast('Artikel erstellt');
                    }
                    
                    this.closeEditor();
                    this.load();
                } catch (e) {
                    console.error('[Admin] Error saving article:', e);
                    showToast('Fehler beim Speichern', 'error');
                } finally {
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = `
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                            <polyline points="17 21 17 13 7 13 7 21"/>
                            <polyline points="7 3 7 8 15 8"/>
                        </svg>
                        Speichern
                    `;
                }
            },
            
            async uploadImage(file) {
                // Upload to Cloudinary (same as chat.html)
                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', 'RIFTapp');
                formData.append('folder', 'news'); // Organize in news folder
                
                const response = await fetch('https://api.cloudinary.com/v1_1/dza4jgreq/image/upload', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) throw new Error('Upload failed');
                
                const data = await response.json();
                if (data.secure_url) return data.secure_url;
                throw new Error(data.error?.message || 'Upload failed');
            },
            
            async delete(id) {
                if (!confirm('Artikel wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden.')) {
                    return;
                }
                
                try {
                    await db.collection('hub_news').doc(id).delete();
                    showToast('Artikel gelöscht');
                    this.load();
                } catch (e) {
                    console.error('[Admin] Error deleting article:', e);
                    showToast('Fehler beim Löschen', 'error');
                }
            },
            
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        };
        
        // ========================================
        // ANNOUNCEMENTS ADMIN MODULE
        // ========================================
        const AnnouncementsAdmin = {
            banners: [],
            editingId: null,
            
            typeConfig: {
                info: { color: '#3b82f6', icon: 'ℹ️', label: 'Info' },
                warning: { color: '#f59e0b', icon: '⚠️', label: 'Warnung' },
                critical: { color: '#ef4444', icon: '🚨', label: 'Kritisch' },
                maintenance: { color: '#6b7280', icon: '🔧', label: 'Wartung' },
                event: { color: '#8b5cf6', icon: '🎉', label: 'Event' },
                update: { color: '#22c55e', icon: '🚀', label: 'Update' }
            },
            
            async load() {
                try {
                    const snapshot = await db.collection('announcements')
                        .orderBy('createdAt', 'desc')
                        .get();
                    
                    this.banners = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    this.render();
                    this.updateStats();
                    this.updatePreviewBanner();
                } catch (e) {
                    console.error('[Admin] Error loading announcements:', e);
                    showToast('Fehler beim Laden der Banner', 'error');
                }
            },
            
            updateStats() {
                const now = new Date();
                const active = this.banners.filter(b => {
                    if (!b.active) return false;
                    if (b.startDate) {
                        const start = b.startDate.toDate ? b.startDate.toDate() : new Date(b.startDate);
                        if (now < start) return false;
                    }
                    if (b.endDate) {
                        const end = b.endDate.toDate ? b.endDate.toDate() : new Date(b.endDate);
                        if (now > end) return false;
                    }
                    return true;
                }).length;
                
                const scheduled = this.banners.filter(b => {
                    if (!b.active) return false;
                    if (b.startDate) {
                        const start = b.startDate.toDate ? b.startDate.toDate() : new Date(b.startDate);
                        if (now < start) return true;
                    }
                    return false;
                }).length;
                
                const totalViews = this.banners.reduce((sum, b) => sum + (b.views || 0), 0);
                const totalDismisses = this.banners.reduce((sum, b) => sum + (b.dismisses || 0), 0);
                
                const stats = document.getElementById('bannerStats');
                if (stats) {
                    const values = stats.querySelectorAll('.stat-card__value');
                    if (values[0]) values[0].textContent = active;
                    if (values[1]) values[1].textContent = scheduled;
                    if (values[2]) values[2].textContent = totalViews;
                    if (values[3]) values[3].textContent = totalDismisses;
                }
            },
            
            updatePreviewBanner() {
                const now = new Date();
                const activeBanner = this.banners.find(b => {
                    if (!b.active) return false;
                    if (b.startDate) {
                        const start = b.startDate.toDate ? b.startDate.toDate() : new Date(b.startDate);
                        if (now < start) return false;
                    }
                    if (b.endDate) {
                        const end = b.endDate.toDate ? b.endDate.toDate() : new Date(b.endDate);
                        if (now > end) return false;
                    }
                    return true;
                });
                
                const preview = document.getElementById('activeBannerPreview');
                if (!preview) return;
                
                if (activeBanner) {
                    const config = this.typeConfig[activeBanner.type] || this.typeConfig.info;
                    preview.innerHTML = this.renderBannerPreview(activeBanner, config);
                } else {
                    preview.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 30px;">Kein aktiver Banner</p>';
                }
            },
            
            renderBannerPreview(banner, config) {
                const style = banner.style || 'bar';
                if (style === 'bar') {
                    return `<div style="background: ${config.color}; color: white; padding: 12px 20px; display: flex; align-items: center; justify-content: center; gap: 16px; font-size: 14px; border-radius: 8px;">
                        <span>${config.icon} <strong>${this.escapeHtml(banner.title)}</strong></span>
                        ${banner.message ? `<span style="opacity:0.9;">${this.escapeHtml(banner.message)}</span>` : ''}
                        ${banner.linkUrl ? `<a href="#" style="padding:6px 14px;background:rgba(255,255,255,0.2);color:white;border-radius:6px;text-decoration:none;font-weight:500;font-size:13px;">${this.escapeHtml(banner.linkText || 'Mehr')}</a>` : ''}
                    </div>`;
                } else if (style === 'toast') {
                    return `<div style="background: var(--bg-elevated); border: 1px solid var(--border); border-radius: 12px; padding: 16px 20px; display: flex; align-items: flex-start; gap: 12px; max-width: 360px; margin-left: auto;">
                        <span style="font-size: 24px;">${config.icon}</span>
                        <div style="flex:1;">
                            <div style="font-weight: 600; color: ${config.color}; margin-bottom: 2px;">${this.escapeHtml(banner.title)}</div>
                            ${banner.message ? `<div style="font-size: 14px; color: var(--text-muted);">${this.escapeHtml(banner.message)}</div>` : ''}
                        </div>
                    </div>`;
                } else if (style === 'card') {
                    return `<div style="background: var(--bg-elevated); border: 1px solid var(--border); border-left: 4px solid ${config.color}; border-radius: 8px; padding: 16px 20px; display: flex; align-items: flex-start; gap: 12px;">
                        <span style="font-size: 20px;">${config.icon}</span>
                        <div style="flex:1;">
                            <div style="font-weight: 600; color: var(--text); margin-bottom: 4px;">${this.escapeHtml(banner.title)}</div>
                            ${banner.message ? `<div style="font-size: 13px; color: var(--text-muted);">${this.escapeHtml(banner.message)}</div>` : ''}
                        </div>
                    </div>`;
                } else {
                    return `<div style="background: var(--bg-elevated); border: 1px solid var(--border); border-radius: 16px; padding: 32px; text-align: center; max-width: 400px; margin: 0 auto;">
                        <div style="font-size:48px;margin-bottom:16px;">${config.icon}</div>
                        <div style="font-size:20px;font-weight:700;color:${config.color};margin-bottom:8px;">${this.escapeHtml(banner.title)}</div>
                        ${banner.message ? `<div style="color: var(--text-muted); margin-bottom: 16px;">${this.escapeHtml(banner.message)}</div>` : ''}
                        ${banner.linkUrl ? `<a href="#" style="display:inline-block;padding:10px 24px;background:${config.color};color:white;border-radius:8px;text-decoration:none;font-weight:500;">${this.escapeHtml(banner.linkText || 'Mehr erfahren')}</a>` : ''}
                    </div>`;
                }
            },
            
            getStatusBadge(banner) {
                const now = new Date();
                if (!banner.active) {
                    return '<span style="color: var(--text-muted);">Inaktiv</span>';
                }
                if (banner.startDate) {
                    const start = banner.startDate.toDate ? banner.startDate.toDate() : new Date(banner.startDate);
                    if (now < start) {
                        return '<span style="color: var(--accent);">Geplant</span>';
                    }
                }
                if (banner.endDate) {
                    const end = banner.endDate.toDate ? banner.endDate.toDate() : new Date(banner.endDate);
                    if (now > end) {
                        return '<span style="color: var(--text-muted);">Abgelaufen</span>';
                    }
                }
                return '<span style="color: var(--green);">Aktiv</span>';
            },
            
            render() {
                const container = document.getElementById('announcementsList');
                
                if (this.banners.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                            </svg>
                            <p>Noch keine Banner vorhanden</p>
                            <button class="btn btn--primary btn--small" onclick="AnnouncementsAdmin.openEditor()">
                                Ersten Banner erstellen
                            </button>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = this.banners.map(banner => {
                    const config = this.typeConfig[banner.type] || this.typeConfig.info;
                    return `
                        <div class="slide-item ${!banner.active ? 'inactive' : ''}">
                            <div class="slide-item__preview" style="background: ${config.color}; display: flex; align-items: center; justify-content: center; font-size: 24px;">${config.icon}</div>
                            <div class="slide-item__content">
                                <div class="slide-item__title">${this.escapeHtml(banner.title || 'Ohne Titel')}</div>
                                <div class="slide-item__meta">
                                    <span style="color: ${config.color};">${config.label}</span>
                                    <span>${banner.style || 'bar'}</span>
                                    ${this.getStatusBadge(banner)}
                                    <span>${banner.views || 0} Views</span>
                                </div>
                            </div>
                            <div class="slide-item__actions">
                                <button class="btn btn--secondary btn--small" onclick="AnnouncementsAdmin.edit('${banner.id}')">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                    </svg>
                                    Bearbeiten
                                </button>
                                <button class="btn btn--danger btn--small" onclick="AnnouncementsAdmin.delete('${banner.id}')">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                        <polyline points="3 6 5 6 21 6"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                    </svg>
                                    Löschen
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            },
            
            filter() {
                const status = document.getElementById('bannerFilterStatus').value;
                const type = document.getElementById('bannerFilterType').value;
                
                const now = new Date();
                const filtered = this.banners.filter(banner => {
                    if (type && banner.type !== type) return false;
                    
                    if (status) {
                        const isActive = banner.active !== false;
                        let isScheduled = false;
                        let isExpired = false;
                        
                        if (banner.startDate) {
                            const start = banner.startDate.toDate ? banner.startDate.toDate() : new Date(banner.startDate);
                            if (now < start) isScheduled = true;
                        }
                        if (banner.endDate) {
                            const end = banner.endDate.toDate ? banner.endDate.toDate() : new Date(banner.endDate);
                            if (now > end) isExpired = true;
                        }
                        
                        if (status === 'active' && (!isActive || isScheduled || isExpired)) return false;
                        if (status === 'scheduled' && !isScheduled) return false;
                        if (status === 'inactive' && isActive) return false;
                    }
                    
                    return true;
                });
                
                // Temporarily replace banners for rendering
                const original = this.banners;
                this.banners = filtered;
                this.render();
                this.banners = original;
            },
            
            openEditor(id = null) {
                this.editingId = id;
                
                // Reset form
                document.getElementById('bannerTitle').value = '';
                document.getElementById('bannerType').value = 'info';
                document.getElementById('bannerMessage').value = '';
                document.getElementById('bannerStyle').value = 'bar';
                document.getElementById('bannerAudience').value = 'all';
                document.getElementById('bannerPages').value = 'all';
                document.getElementById('bannerPriority').value = '0';
                document.getElementById('bannerStartDate').value = '';
                document.getElementById('bannerEndDate').value = '';
                document.getElementById('bannerLinkUrl').value = '';
                document.getElementById('bannerLinkText').value = '';
                document.getElementById('bannerActive').checked = true;
                document.getElementById('bannerDismissible').checked = true;
                document.getElementById('bannerShowCountdown').checked = false;
                
                if (id) {
                    const banner = this.banners.find(b => b.id === id);
                    if (banner) {
                        document.getElementById('bannerTitle').value = banner.title || '';
                        document.getElementById('bannerType').value = banner.type || 'info';
                        document.getElementById('bannerMessage').value = banner.message || '';
                        document.getElementById('bannerStyle').value = banner.style || 'bar';
                        document.getElementById('bannerAudience').value = banner.audience || 'all';
                        document.getElementById('bannerPages').value = banner.pages || 'all';
                        document.getElementById('bannerPriority').value = String(banner.priority || 0);
                        document.getElementById('bannerLinkUrl').value = banner.linkUrl || '';
                        document.getElementById('bannerLinkText').value = banner.linkText || '';
                        document.getElementById('bannerActive').checked = banner.active !== false;
                        document.getElementById('bannerDismissible').checked = banner.dismissible !== false;
                        document.getElementById('bannerShowCountdown').checked = banner.showCountdown || false;
                        
                        if (banner.startDate) {
                            const d = banner.startDate.toDate ? banner.startDate.toDate() : new Date(banner.startDate);
                            document.getElementById('bannerStartDate').value = d.toISOString().slice(0, 16);
                        }
                        if (banner.endDate) {
                            const d = banner.endDate.toDate ? banner.endDate.toDate() : new Date(banner.endDate);
                            document.getElementById('bannerEndDate').value = d.toISOString().slice(0, 16);
                        }
                    }
                }
                
                document.getElementById('announcementModalTitle').textContent = id ? 'Banner bearbeiten' : 'Neuer Banner';
                document.getElementById('announcementModal').classList.add('active');
                this.updatePreview();
            },
            
            closeEditor() {
                document.getElementById('announcementModal').classList.remove('active');
                this.editingId = null;
            },
            
            updatePreview() {
                const banner = {
                    title: document.getElementById('bannerTitle').value || 'Vorschau-Titel',
                    type: document.getElementById('bannerType').value,
                    message: document.getElementById('bannerMessage').value,
                    style: document.getElementById('bannerStyle').value,
                    linkUrl: document.getElementById('bannerLinkUrl').value,
                    linkText: document.getElementById('bannerLinkText').value
                };
                
                const config = this.typeConfig[banner.type] || this.typeConfig.info;
                const preview = document.getElementById('bannerEditorPreview');
                if (preview) {
                    preview.innerHTML = this.renderBannerPreview(banner, config);
                }
            },
            
            async save() {
                const title = document.getElementById('bannerTitle').value.trim();
                if (!title) {
                    showToast('Bitte Titel eingeben', 'error');
                    return;
                }
                
                const data = {
                    title,
                    type: document.getElementById('bannerType').value,
                    message: document.getElementById('bannerMessage').value.trim(),
                    style: document.getElementById('bannerStyle').value,
                    audience: document.getElementById('bannerAudience').value,
                    pages: document.getElementById('bannerPages').value,
                    priority: parseInt(document.getElementById('bannerPriority').value) || 0,
                    linkUrl: document.getElementById('bannerLinkUrl').value.trim(),
                    linkText: document.getElementById('bannerLinkText').value.trim(),
                    active: document.getElementById('bannerActive').checked,
                    dismissible: document.getElementById('bannerDismissible').checked,
                    showCountdown: document.getElementById('bannerShowCountdown').checked,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                const startDate = document.getElementById('bannerStartDate').value;
                const endDate = document.getElementById('bannerEndDate').value;
                
                if (startDate) {
                    data.startDate = firebase.firestore.Timestamp.fromDate(new Date(startDate));
                } else {
                    data.startDate = null;
                }
                
                if (endDate) {
                    data.endDate = firebase.firestore.Timestamp.fromDate(new Date(endDate));
                } else {
                    data.endDate = null;
                }
                
                try {
                    if (this.editingId) {
                        await db.collection('announcements').doc(this.editingId).update(data);
                        showToast('Banner aktualisiert');
                    } else {
                        data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                        data.views = 0;
                        data.dismisses = 0;
                        await db.collection('announcements').add(data);
                        showToast('Banner erstellt');
                    }
                    
                    this.closeEditor();
                    this.load();
                } catch (e) {
                    console.error('[Admin] Error saving banner:', e);
                    showToast('Fehler beim Speichern', 'error');
                }
            },
            
            edit(id) {
                this.openEditor(id);
            },
            
            async delete(id) {
                if (!confirm('Banner wirklich löschen?')) return;
                
                try {
                    await db.collection('announcements').doc(id).delete();
                    showToast('Banner gelöscht');
                    this.load();
                } catch (e) {
                    console.error('[Admin] Error deleting banner:', e);
                    showToast('Fehler beim Löschen', 'error');
                }
            },
            
            escapeHtml(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        };
        
        // ========================================
        // SIDEBAR TOGGLE (mobile)
        // ========================================
        function toggleSidebar() {
            document.getElementById('adminSidebar').classList.toggle('open');
            document.getElementById('sidebarOverlay').classList.toggle('open');
        }
        
        // ========================================
        // TAB SWITCHING
        // ========================================
        function switchTab(tabId) {
            // Update tabs
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.toggle('active', 
                    tab.dataset.tab === tabId || 
                    tab.textContent.toLowerCase().includes(tabId.toLowerCase())
                );
            });
            
            // Update pages
            document.querySelectorAll('.admin-page').forEach(page => {
                page.classList.toggle('active', page.id === `page-${tabId}`);
            });
            
            // Scroll content to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Close sidebar on mobile
            if (window.innerWidth <= 1024) {
                document.getElementById('adminSidebar').classList.remove('open');
                document.getElementById('sidebarOverlay').classList.remove('open');
            }
            
            // Load data for the tab
            if (tabId === 'carousel') {
                CarouselAdmin.load();
            } else if (tabId === 'quotes') {
                QuotesAdmin.load();
            } else if (tabId === 'announcements') {
                AnnouncementsAdmin.load();
            } else if (tabId === 'proOverview') {
                ProAdmin.loadSubscribers();
            } else if (tabId === 'proFeatureFlags') {
                ProAdmin.loadFeatureFlags();
            } else if (tabId === 'proThemeGating') {
                ProAdmin.loadThemeGating('dice');
            } else if (tabId === 'proLimits') {
                ProAdmin.loadLimits();
            } else if (tabId === 'landingPage') {
                LandingAdmin.load();
            } else if (tabId === 'tokenLibrary') {
                TokenLibraryAdmin.load();
            } else if (tabId === 'fokusKatalog') {
                FokusAdmin.load();
            }
        }
        
        // ========================================
        // LANDING PAGE ADMIN MODULE
        // ========================================
        const LandingAdmin = {
            config: null,
            overlays: [],
            
            async load() {
                try {
                    const doc = await firebase.firestore().collection('admin').doc('landing_config').get();
                    this.config = doc.exists ? doc.data() : {};
                    this.overlays = this.config.overlays || [];
                    this.populateForm(this.config);
                    this.refreshPreview();
                    this.renderOverlays();
                    // Sync color pickers with hex inputs
                    this.initColorSync();
                } catch(e) {
                    console.error('LandingAdmin.load error:', e);
                }
            },
            
            // ── Tab switching ──
            switchSection(id, btn) {
                document.querySelectorAll('.lp-tab').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                document.querySelectorAll('.lp-section').forEach(s => s.classList.remove('active'));
                const sec = document.getElementById('lp-sec-' + id);
                if (sec) sec.classList.add('active');
            },
            
            // ── Group type switching (pagebg, pro) ──
            setGroupType(group, type, btn) {
                document.querySelectorAll(`.lp-type-btn[data-group="${group}"]`).forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                document.querySelectorAll(`.lp-group-fields[data-group="${group}"]`).forEach(f => f.style.display = 'none');
                const target = document.querySelector(`.lp-group-fields[data-group="${group}"][data-type="${type}"]`);
                if (target) target.style.display = 'block';
            },
            
            // ── Color picker ↔ hex input sync ──
            initColorSync() {
                const pairs = [
                    ['lp-orb1-color','lp-orb1-color-hex'],['lp-orb2-color','lp-orb2-color-hex'],['lp-orb3-color','lp-orb3-color-hex'],
                    ['lp-hero-grad1','lp-hero-grad1-hex'],['lp-hero-grad2','lp-hero-grad2-hex']
                ];
                pairs.forEach(([picker, hex]) => {
                    const p = document.getElementById(picker), h = document.getElementById(hex);
                    if (!p || !h) return;
                    p.addEventListener('input', () => h.value = p.value);
                    h.addEventListener('input', () => { if (/^#[0-9a-f]{6}$/i.test(h.value)) p.value = h.value; });
                });
            },
            
            // ── Populate all form fields ──
            populateForm(c) {
                // Background > Orbs
                const orbs = c.orbs || {};
                document.getElementById('lp-orbs-enabled').checked = orbs.enabled !== false;
                this.setVal('lp-orb1-color', orbs.color1 || '#FF4655'); this.setVal('lp-orb1-color-hex', orbs.color1 || '#FF4655');
                this.setVal('lp-orb2-color', orbs.color2 || '#8B5CF6'); this.setVal('lp-orb2-color-hex', orbs.color2 || '#8B5CF6');
                this.setVal('lp-orb3-color', orbs.color3 || '#F59E0B'); this.setVal('lp-orb3-color-hex', orbs.color3 || '#F59E0B');
                this.setVal('lp-orb1-size', orbs.size1 ?? 40); this.setVal('lp-orb2-size', orbs.size2 ?? 35); this.setVal('lp-orb3-size', orbs.size3 ?? 30);
                this.setRange('lp-orbs-blur', orbs.blur ?? 120, 'px'); this.setRange('lp-orbs-opacity', orbs.opacity ?? 100, '%');
                
                // Background > Page BG
                const pbg = c.pageBg || {};
                document.getElementById('lp-pagebg-enabled').checked = !!pbg.enabled;
                const pbgType = pbg.type || 'image';
                document.querySelectorAll('.lp-type-btn[data-group="pagebg"]').forEach(b => b.classList.toggle('active', b.dataset.type === pbgType));
                document.querySelectorAll('.lp-group-fields[data-group="pagebg"]').forEach(f => f.style.display = f.dataset.type === pbgType ? 'block' : 'none');
                this.setVal('lp-pagebg-url', pbg.url || ''); this.setVal('lp-pagebg-fit', pbg.fit || 'cover'); this.setVal('lp-pagebg-pos', pbg.pos || 'center');
                this.setVal('lp-pagebg-video', pbg.videoUrl || ''); this.setVal('lp-pagebg-gradient', pbg.gradient || '');
                this.setRange('lp-pagebg-opacity', pbg.opacity ?? 15, '%'); this.setRange('lp-pagebg-blur', pbg.blur ?? 0, 'px');
                this.setVal('lp-pagebg-blend', pbg.blendMode || 'normal');
                
                // Background > Noise
                const noise = c.noise || {};
                document.getElementById('lp-noise-enabled').checked = noise.enabled !== false;
                this.setRange('lp-noise-opacity', noise.opacity ?? 40, '%');
                this.setVal('lp-noise-url', noise.url || '');
                
                // Hero
                const hero = c.hero || {};
                this.setVal('lp-hero-logo', hero.logoUrl || ''); this.setVal('lp-hero-logo-width', hero.logoWidth || '');
                this.setVal('lp-hero-line1', hero.line1 || ''); this.setVal('lp-hero-line2', hero.line2 || '');
                this.setVal('lp-hero-subtitle', hero.subtitle || '');
                this.setVal('lp-hero-grad1', hero.gradColor1 || '#FF4655'); this.setVal('lp-hero-grad1-hex', hero.gradColor1 || '#FF4655');
                this.setVal('lp-hero-grad2', hero.gradColor2 || '#f97316'); this.setVal('lp-hero-grad2-hex', hero.gradColor2 || '#f97316');
                const hbg = hero.bg || {};
                document.getElementById('lp-herobg-enabled').checked = !!hbg.enabled;
                this.setVal('lp-herobg-url', hbg.url || ''); this.setRange('lp-herobg-opacity', hbg.opacity ?? 8, '%'); this.setVal('lp-herobg-pos', hbg.pos || 'center');
                
                // Sections
                const vis = c.visibility || {};
                document.getElementById('lp-vis-features').checked = vis.features !== false;
                document.getElementById('lp-vis-systems').checked = vis.systems !== false;
                document.getElementById('lp-vis-opensource').checked = vis.opensource !== false;
                document.getElementById('lp-vis-proTeaser').checked = vis.proTeaser !== false;
                const scroll = c.scroll || {};
                this.setVal('lp-scroll-reveal', scroll.reveal || 'fade-up');
                this.setVal('lp-scroll-delay', scroll.delay ?? 120);
                this.setVal('lp-sticky-bar', scroll.stickyBar || 'visible');
                
                // Fullscreen overlay
                const fo = c.fullOverlay || {};
                document.getElementById('lp-fulloverlay-enabled').checked = !!fo.enabled;
                this.setVal('lp-fulloverlay-type', fo.type || 'gradient');
                this.setRange('lp-fulloverlay-opacity', fo.opacity ?? 30, '%');
                this.setVal('lp-fulloverlay-value', fo.value || '');
                
                // Pro teaser
                const pro = c.proTeaser || {};
                document.getElementById('lp-pro-bg-enabled').checked = pro.enabled !== false;
                const proType = pro.type || 'none';
                document.querySelectorAll('.lp-type-btn[data-group="pro"]').forEach(b => b.classList.toggle('active', b.dataset.type === proType));
                document.querySelectorAll('.lp-group-fields[data-group="pro"]').forEach(f => f.style.display = f.dataset.type === proType ? 'block' : 'none');
                this.setVal('lp-pro-bg-image', pro.imageUrl || ''); this.setVal('lp-pro-bg-image-fit', pro.imageFit || 'cover'); this.setVal('lp-pro-bg-image-pos', pro.imagePos || 'center');
                this.setVal('lp-pro-bg-video', pro.videoUrl || ''); this.setVal('lp-pro-bg-gradient', pro.gradient || ''); this.setVal('lp-pro-bg-html', pro.customHtml || '');
                this.setRange('lp-pro-bg-opacity', pro.opacity ?? 10, '%'); this.setRange('lp-pro-bg-blur', pro.blur ?? 0, 'px');
                this.setVal('lp-pro-bg-blend', pro.blendMode || 'normal');
                this.setVal('lp-pro-overlay-color', pro.overlayColor || ''); this.setVal('lp-pro-bg-animation', pro.animation || '');
                
                // Custom Code
                this.setVal('lp-custom-css', c.customCss || ''); this.setVal('lp-custom-head', c.customHead || ''); this.setVal('lp-custom-body', c.customBody || '');
            },
            
            // ── Helpers ──
            setVal(id, val) { const el = document.getElementById(id); if (el) el.value = val; },
            setRange(id, val, unit) { const el = document.getElementById(id); if (el) { el.value = val; const sp = el.nextElementSibling; if (sp) sp.textContent = val + unit; } },
            getVal(id) { const el = document.getElementById(id); return el ? el.value.trim() : ''; },
            getNum(id, def) { const v = parseInt(document.getElementById(id)?.value); return isNaN(v) ? def : v; },
            getChecked(id) { return document.getElementById(id)?.checked ?? false; },
            getActiveType(group) { return document.querySelector(`.lp-type-btn[data-group="${group}"].active`)?.dataset.type || 'none'; },
            
            // ── Collect all form data ──
            getFormData() {
                return {
                    orbs: {
                        enabled: this.getChecked('lp-orbs-enabled'),
                        color1: this.getVal('lp-orb1-color-hex') || this.getVal('lp-orb1-color'),
                        color2: this.getVal('lp-orb2-color-hex') || this.getVal('lp-orb2-color'),
                        color3: this.getVal('lp-orb3-color-hex') || this.getVal('lp-orb3-color'),
                        size1: this.getNum('lp-orb1-size', 40), size2: this.getNum('lp-orb2-size', 35), size3: this.getNum('lp-orb3-size', 30),
                        blur: this.getNum('lp-orbs-blur', 120), opacity: this.getNum('lp-orbs-opacity', 100)
                    },
                    pageBg: {
                        enabled: this.getChecked('lp-pagebg-enabled'),
                        type: this.getActiveType('pagebg'),
                        url: this.getVal('lp-pagebg-url'), fit: this.getVal('lp-pagebg-fit'), pos: this.getVal('lp-pagebg-pos'),
                        videoUrl: this.getVal('lp-pagebg-video'), gradient: this.getVal('lp-pagebg-gradient'),
                        opacity: this.getNum('lp-pagebg-opacity', 15), blur: this.getNum('lp-pagebg-blur', 0), blendMode: this.getVal('lp-pagebg-blend')
                    },
                    noise: { enabled: this.getChecked('lp-noise-enabled'), opacity: this.getNum('lp-noise-opacity', 40), url: this.getVal('lp-noise-url') },
                    hero: {
                        logoUrl: this.getVal('lp-hero-logo'), logoWidth: this.getVal('lp-hero-logo-width'),
                        line1: this.getVal('lp-hero-line1'), line2: this.getVal('lp-hero-line2'), subtitle: this.getVal('lp-hero-subtitle'),
                        gradColor1: this.getVal('lp-hero-grad1-hex'), gradColor2: this.getVal('lp-hero-grad2-hex'),
                        bg: { enabled: this.getChecked('lp-herobg-enabled'), url: this.getVal('lp-herobg-url'), opacity: this.getNum('lp-herobg-opacity', 8), pos: this.getVal('lp-herobg-pos') }
                    },
                    visibility: {
                        features: this.getChecked('lp-vis-features'), systems: this.getChecked('lp-vis-systems'),
                        opensource: this.getChecked('lp-vis-opensource'), proTeaser: this.getChecked('lp-vis-proTeaser')
                    },
                    scroll: { reveal: this.getVal('lp-scroll-reveal'), delay: this.getNum('lp-scroll-delay', 120), stickyBar: this.getVal('lp-sticky-bar') },
                    overlays: this.overlays,
                    fullOverlay: {
                        enabled: this.getChecked('lp-fulloverlay-enabled'), type: this.getVal('lp-fulloverlay-type'),
                        opacity: this.getNum('lp-fulloverlay-opacity', 30), value: this.getVal('lp-fulloverlay-value')
                    },
                    proTeaser: {
                        enabled: this.getChecked('lp-pro-bg-enabled'), type: this.getActiveType('pro'),
                        imageUrl: this.getVal('lp-pro-bg-image'), imageFit: this.getVal('lp-pro-bg-image-fit'), imagePos: this.getVal('lp-pro-bg-image-pos'),
                        videoUrl: this.getVal('lp-pro-bg-video'), gradient: this.getVal('lp-pro-bg-gradient'), customHtml: this.getVal('lp-pro-bg-html'),
                        opacity: this.getNum('lp-pro-bg-opacity', 10), blur: this.getNum('lp-pro-bg-blur', 0), blendMode: this.getVal('lp-pro-bg-blend'),
                        overlayColor: this.getVal('lp-pro-overlay-color'), animation: this.getVal('lp-pro-bg-animation')
                    },
                    customCss: this.getVal('lp-custom-css'), customHead: this.getVal('lp-custom-head'), customBody: this.getVal('lp-custom-body'),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedBy: firebase.auth().currentUser?.email || 'unknown'
                };
            },
            
            // ── Overlays CRUD ──
            addOverlay() {
                this.overlays.push({ id: Date.now(), type: 'image', url: '', top: '10%', left: '5%', width: '200px', opacity: 15, zIndex: 1, animation: '', pointerEvents: false });
                this.renderOverlays();
            },
            removeOverlay(idx) { this.overlays.splice(idx, 1); this.renderOverlays(); },
            renderOverlays() {
                const list = document.getElementById('lp-overlays-list');
                if (!this.overlays.length) { list.innerHTML = '<div style="text-align:center;padding:30px;color:var(--text-muted);font-size:13px;">Noch keine Overlays konfiguriert</div>'; return; }
                list.innerHTML = this.overlays.map((o, i) => `
                    <div style="padding:14px;background:var(--bg-input);border:1px solid var(--border);border-radius:10px;margin-bottom:10px;">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                            <strong style="font-size:12px;color:var(--text-muted);">Overlay #${i + 1}</strong>
                            <button class="btn btn--ghost" style="font-size:11px;padding:4px 8px;color:var(--red);" onclick="LandingAdmin.removeOverlay(${i})">Entfernen</button>
                        </div>
                        <div style="display:grid;grid-template-columns:1fr 2fr 1fr 1fr;gap:10px;font-size:12px;">
                            <div><label class="form-label-sm">Typ</label><select class="form-select" style="font-size:11px;" onchange="LandingAdmin.overlays[${i}].type=this.value"><option ${o.type==='image'?'selected':''} value="image">Bild</option><option ${o.type==='html'?'selected':''} value="html">HTML</option><option ${o.type==='shape'?'selected':''} value="shape">Shape</option></select></div>
                            <div><label class="form-label-sm">URL / HTML</label><input class="form-input" style="font-size:11px;" value="${(o.url||o.html||'').replace(/"/g,'&quot;')}" onchange="LandingAdmin.overlays[${i}][LandingAdmin.overlays[${i}].type==='image'?'url':'html']=this.value"></div>
                            <div><label class="form-label-sm">Top</label><input class="form-input" style="font-size:11px;" value="${o.top||''}" onchange="LandingAdmin.overlays[${i}].top=this.value"></div>
                            <div><label class="form-label-sm">Left</label><input class="form-input" style="font-size:11px;" value="${o.left||''}" onchange="LandingAdmin.overlays[${i}].left=this.value"></div>
                        </div>
                        <div style="display:grid;grid-template-columns:1fr 1fr 1fr 2fr;gap:10px;margin-top:8px;font-size:12px;">
                            <div><label class="form-label-sm">Breite</label><input class="form-input" style="font-size:11px;" value="${o.width||''}" onchange="LandingAdmin.overlays[${i}].width=this.value"></div>
                            <div><label class="form-label-sm">Deckkraft %</label><input type="number" class="form-input" style="font-size:11px;" value="${o.opacity??15}" min="0" max="100" onchange="LandingAdmin.overlays[${i}].opacity=+this.value"></div>
                            <div><label class="form-label-sm">z-index</label><input type="number" class="form-input" style="font-size:11px;" value="${o.zIndex??1}" onchange="LandingAdmin.overlays[${i}].zIndex=+this.value"></div>
                            <div><label class="form-label-sm">CSS Animation</label><input class="form-input" style="font-size:11px;" value="${o.animation||''}" onchange="LandingAdmin.overlays[${i}].animation=this.value"></div>
                        </div>
                    </div>
                `).join('');
            },
            
            // ── Pro teaser preview ──
            buildBgHtml(pro) {
                if (!pro || !pro.enabled || pro.type === 'none') return '';
                const opacity = (pro.opacity ?? 10) / 100;
                const blur = pro.blur ?? 0;
                const blend = pro.blendMode || 'normal';
                const anim = pro.animation ? `animation:${pro.animation};` : '';
                const base = `position:absolute;inset:0;opacity:${opacity};filter:blur(${blur}px);mix-blend-mode:${blend};${anim}`;
                let html = '';
                if (pro.type === 'image' && pro.imageUrl) html = `<img src="${pro.imageUrl}" style="${base}width:100%;height:100%;object-fit:${pro.imageFit||'cover'};object-position:${pro.imagePos||'center'};" alt="">`;
                else if (pro.type === 'video' && pro.videoUrl) html = `<video autoplay muted loop playsinline style="${base}width:100%;height:100%;object-fit:cover;"><source src="${pro.videoUrl}"></video>`;
                else if (pro.type === 'gradient' && pro.gradient) html = `<div style="${base}background:${pro.gradient};"></div>`;
                else if (pro.type === 'html' && pro.customHtml) html = `<div style="${base}">${pro.customHtml}</div>`;
                if (pro.overlayColor) html += `<div style="position:absolute;inset:0;background:${pro.overlayColor};pointer-events:none;"></div>`;
                return html;
            },
            refreshPreview() {
                const data = this.getFormData();
                const el = document.getElementById('lp-preview-bg');
                if (el) el.innerHTML = this.buildBgHtml(data.proTeaser);
            },
            
            // ── Save ──
            async save() {
                try {
                    const data = this.getFormData();
                    await firebase.firestore().collection('admin').doc('landing_config').set(data, { merge: true });
                    const toast = document.createElement('div');
                    toast.style.cssText = 'position:fixed;bottom:24px;right:24px;background:#22C55E;color:white;padding:12px 20px;border-radius:10px;font-size:13px;font-weight:600;z-index:9999;';
                    toast.textContent = '✓ Landing Page Config gespeichert';
                    document.body.appendChild(toast);
                    setTimeout(() => toast.remove(), 3000);
                } catch(e) {
                    console.error('LandingAdmin.save error:', e);
                    alert('Fehler beim Speichern: ' + e.message);
                }
            }
        };
        
        // ========================================
        // CAROUSEL ADMIN MODULE
        // ========================================
        const CarouselAdmin = {
            slides: [],
            editingId: null,
            pendingBgImage: null,
            currentCollection: 'hub_slides',
            
            collectionNames: {
                'hub_slides': 'Hub-Startseite',
                'session_slides': 'Sessions-Seite',
                'sheet_slides': 'Charaktere-Seite'
            },
            
            switchCollection(collection, btn) {
                this.currentCollection = collection;
                
                // Update tab styles
                document.querySelectorAll('.carousel-type-tab').forEach(t => t.classList.remove('active'));
                if (btn) btn.classList.add('active');
                
                // Update info text
                const info = document.getElementById('currentCollectionInfo');
                if (info) {
                    info.innerHTML = `📍 Aktive Collection: <strong style="color: var(--text);">${collection}</strong> (${this.collectionNames[collection]})`;
                }
                
                // Reload slides
                this.load();
            },
            
            async load() {
                try {
                    const snapshot = await db.collection(this.currentCollection)
                        .orderBy('order', 'asc')
                        .get();
                    
                    this.slides = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    this.render();
                    this.updateStats();
                } catch (e) {
                    console.error('[Admin] Error loading carousel:', e);
                    showToast('Fehler beim Laden der Slides', 'error');
                }
            },
            
            updateStats() {
                const active = this.slides.filter(s => s.active !== false).length;
                const inactive = this.slides.filter(s => s.active === false).length;
                
                document.getElementById('statActiveSlides').textContent = active;
                document.getElementById('statInactiveSlides').textContent = inactive;
            },
            
            getBadgeEmoji(type) {
                const emojis = {
                    live: '🔴', new: '🟣', event: '🟠', update: '🟢',
                    featured: '🌟', beta: '🔵', soon: '⚪', hot: '🔥', community: '💬'
                };
                return emojis[type] || '🟣';
            },
            
            render() {
                const container = document.getElementById('slidesList');
                
                if (this.slides.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="2" y="3" width="20" height="14" rx="2"/>
                                <path d="M8 21h8M12 17v4"/>
                            </svg>
                            <p>Noch keine Slides vorhanden</p>
                            <button class="btn btn--primary btn--small" onclick="CarouselAdmin.openEditor()">
                                Erste Slide erstellen
                            </button>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = this.slides.map((slide, index) => `
                    <div class="slide-item ${slide.active === false ? 'inactive' : ''}">
                        <div class="slide-item__order">
                            <button onclick="CarouselAdmin.move('${slide.id}', -1)" ${index === 0 ? 'disabled' : ''}>
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>
                            </button>
                            <button onclick="CarouselAdmin.move('${slide.id}', 1)" ${index === this.slides.length - 1 ? 'disabled' : ''}>
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                            </button>
                        </div>
                        <div class="slide-item__preview" style="background: ${slide.bgImageUrl ? `url('${slide.bgImageUrl}') center/cover` : slide.background || 'var(--bg-elevated)'}"></div>
                        <div class="slide-item__content">
                            <div class="slide-item__title">${this.escapeHtml(slide.title || 'Ohne Titel')}</div>
                            <div class="slide-item__meta">
                                <span class="badge badge--${slide.badgeType || 'new'}">${this.getBadgeEmoji(slide.badgeType)} ${this.escapeHtml(slide.badge || 'Badge')}</span>
                                <span>${slide.autoplay || 6}s</span>
                                ${slide.videoUrl ? '<span>🎬 Video</span>' : ''}
                                ${slide.countdownDate ? '<span>⏰ Countdown</span>' : ''}
                                ${slide.active === false ? '<span style="color: var(--yellow);">Inaktiv</span>' : ''}
                            </div>
                        </div>
                        <div class="slide-item__actions">
                            <button class="btn btn--secondary btn--small" onclick="CarouselAdmin.edit('${slide.id}')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                </svg>
                                Bearbeiten
                            </button>
                            <button class="btn btn--danger btn--small" onclick="CarouselAdmin.delete('${slide.id}')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                    <polyline points="3 6 5 6 21 6"/>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                `).join('');
            },
            
            toggleBgType(type) {
                document.getElementById('bgCssGroup').style.display = type === 'css' ? 'block' : 'none';
                document.getElementById('bgImageGroup').style.display = type === 'image' ? 'block' : 'none';
                document.getElementById('bgVideoGroup').style.display = type === 'video' ? 'block' : 'none';
            },
            
            openEditor(slide = null) {
                this.editingId = slide?.id || null;
                this.pendingBgImage = null;
                
                const modal = document.getElementById('carouselModal');
                const title = document.getElementById('carouselEditorTitle');
                
                title.textContent = slide ? 'Slide bearbeiten' : 'Neue Slide';
                
                // Basic fields
                document.getElementById('slideId').value = slide?.id || '';
                document.getElementById('slideTitle').value = slide?.title || '';
                document.getElementById('slideDescription').value = slide?.description || '';
                document.getElementById('slideBadge').value = slide?.badge || 'Neu';
                document.getElementById('slideBadgeType').value = slide?.badgeType || 'new';
                document.getElementById('slideCtaText').value = slide?.ctaText || 'Mehr erfahren';
                document.getElementById('slideCtaLink').value = slide?.ctaLink || '';
                document.getElementById('slideTabLabel').value = slide?.tabLabel || '';
                document.getElementById('slideAutoplay').value = slide?.autoplay || 6;
                document.getElementById('slideLiveIndicator').checked = slide?.showLiveIndicator || false;
                document.getElementById('slideActive').checked = slide?.active !== false;
                
                // Background type
                let bgType = 'css';
                if (slide?.bgImageUrl) bgType = 'image';
                if (slide?.videoUrl) bgType = 'video';
                
                document.querySelectorAll('input[name="bgType"]').forEach(r => {
                    r.checked = r.value === bgType;
                });
                this.toggleBgType(bgType);
                
                // Background fields
                document.getElementById('slideBackground').value = slide?.background || "linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(59, 130, 246, 0.2)), #0d0d0d";
                document.getElementById('slideBgImageUrl').value = slide?.bgImageUrl || '';
                document.getElementById('slideVideoUrl').value = slide?.videoUrl || '';
                
                // Image preview
                const preview = document.getElementById('slideBgPreview');
                const upload = document.getElementById('slideBgUpload');
                if (slide?.bgImageUrl) {
                    preview.src = slide.bgImageUrl;
                    upload.classList.add('has-image');
                } else {
                    preview.src = '';
                    upload.classList.remove('has-image');
                }
                
                // Countdown
                document.getElementById('slideCountdownDate').value = slide?.countdownDate || '';
                document.getElementById('slideCountdownLabel').value = slide?.countdownLabel || '';
                
                // Video options
                document.getElementById('slideVideoSpeed').value = slide?.videoSpeed || '1';
                document.getElementById('slideVideoZoom').value = slide?.videoZoom || '120';
                document.getElementById('slideVideoStart').value = slide?.videoStart || 0;
                
                // Image URL direct
                document.getElementById('slideBgImageUrlDirect').value = slide?.bgImageUrl || '';
                
                // Overlay options
                document.getElementById('slideOverlayColor').value = slide?.overlayColor || 'black';
                document.getElementById('slideOverlayOpacity').value = slide?.overlayOpacity ?? 50;
                document.getElementById('overlayOpacityValue').textContent = (slide?.overlayOpacity ?? 50) + '%';
                document.getElementById('slideOverlayCustom').value = slide?.overlayCustomColor || '#000000';
                document.getElementById('slideGradientDirection').value = slide?.gradientDirection || 'to-right';
                
                // Show/hide custom color
                document.getElementById('customOverlayGroup').style.display = 
                    (slide?.overlayColor === 'custom') ? 'block' : 'none';
                
                // UI element visibility
                document.getElementById('slideShowBadge').checked = slide?.showBadge !== false;
                document.getElementById('slideShowTitle').checked = slide?.showTitle !== false;
                document.getElementById('slideShowDescription').checked = slide?.showDescription !== false;
                document.getElementById('slideShowCta').checked = slide?.showCta !== false;
                
                // Global carousel settings (load from separate config if needed)
                document.getElementById('carouselShowArrows').checked = slide?.carouselShowArrows !== false;
                document.getElementById('carouselShowTabs').checked = slide?.carouselShowTabs !== false;
                document.getElementById('carouselShowDots').checked = slide?.carouselShowDots !== false;
                document.getElementById('carouselAutoplay').checked = slide?.carouselAutoplay !== false;
                
                modal.classList.add('active');
                
                // Init event handlers
                this.initBgUpload();
                this.initOverlayColorHandler();
            },
            
            previewImageUrl(url) {
                if (!url) return;
                const preview = document.getElementById('slideBgPreview');
                const upload = document.getElementById('slideBgUpload');
                preview.src = url;
                preview.onload = () => upload.classList.add('has-image');
                preview.onerror = () => upload.classList.remove('has-image');
            },
            
            initBgUpload() {
                const input = document.getElementById('slideBgInput');
                const upload = document.getElementById('slideBgUpload');
                const preview = document.getElementById('slideBgPreview');
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    this.pendingBgImage = file;
                    // Clear URL input when file is selected
                    document.getElementById('slideBgImageUrlDirect').value = '';
                    
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        preview.src = ev.target.result;
                        upload.classList.add('has-image');
                    };
                    reader.readAsDataURL(file);
                };
            },
            
            initOverlayColorHandler() {
                const colorSelect = document.getElementById('slideOverlayColor');
                const customGroup = document.getElementById('customOverlayGroup');
                
                colorSelect.onchange = () => {
                    customGroup.style.display = colorSelect.value === 'custom' ? 'block' : 'none';
                };
            },
            
            closeEditor() {
                document.getElementById('carouselModal').classList.remove('active');
                this.editingId = null;
                this.pendingBgImage = null;
            },
            
            edit(id) {
                const slide = this.slides.find(s => s.id === id);
                if (slide) {
                    this.openEditor(slide);
                }
            },
            
            async save() {
                const id = document.getElementById('slideId').value;
                const bgType = document.querySelector('input[name="bgType"]:checked').value;
                
                const data = {
                    title: document.getElementById('slideTitle').value.trim(),
                    description: document.getElementById('slideDescription').value.trim(),
                    badge: document.getElementById('slideBadge').value.trim(),
                    badgeType: document.getElementById('slideBadgeType').value,
                    ctaText: document.getElementById('slideCtaText').value.trim(),
                    ctaLink: document.getElementById('slideCtaLink').value.trim(),
                    tabLabel: document.getElementById('slideTabLabel').value.trim(),
                    autoplay: parseInt(document.getElementById('slideAutoplay').value) || 6,
                    showLiveIndicator: document.getElementById('slideLiveIndicator').checked,
                    active: document.getElementById('slideActive').checked,
                    countdownDate: document.getElementById('slideCountdownDate').value || null,
                    countdownLabel: document.getElementById('slideCountdownLabel').value.trim() || null,
                    // Overlay options
                    overlayColor: document.getElementById('slideOverlayColor').value,
                    overlayOpacity: parseInt(document.getElementById('slideOverlayOpacity').value) || 50,
                    overlayCustomColor: document.getElementById('slideOverlayCustom').value,
                    gradientDirection: document.getElementById('slideGradientDirection').value,
                    // UI element visibility
                    showBadge: document.getElementById('slideShowBadge').checked,
                    showTitle: document.getElementById('slideShowTitle').checked,
                    showDescription: document.getElementById('slideShowDescription').checked,
                    showCta: document.getElementById('slideShowCta').checked,
                    // Global carousel settings
                    carouselShowArrows: document.getElementById('carouselShowArrows').checked,
                    carouselShowTabs: document.getElementById('carouselShowTabs').checked,
                    carouselShowDots: document.getElementById('carouselShowDots').checked,
                    carouselAutoplay: document.getElementById('carouselAutoplay').checked,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Background based on type
                if (bgType === 'css') {
                    data.background = document.getElementById('slideBackground').value.trim();
                    data.bgImageUrl = null;
                    data.videoUrl = null;
                } else if (bgType === 'image') {
                    // Check for direct URL first
                    const directUrl = document.getElementById('slideBgImageUrlDirect').value.trim();
                    
                    if (directUrl) {
                        // Use direct URL
                        data.bgImageUrl = directUrl;
                    } else if (this.pendingBgImage) {
                        // Upload image if pending
                        try {
                            showToast('Bild wird hochgeladen...');
                            data.bgImageUrl = await this.uploadImage(this.pendingBgImage);
                        } catch (e) {
                            console.error('[Admin] Image upload failed:', e);
                            showToast('Bild-Upload fehlgeschlagen', 'error');
                            return;
                        }
                    } else {
                        data.bgImageUrl = document.getElementById('slideBgImageUrl').value || null;
                    }
                    data.background = null;
                    data.videoUrl = null;
                } else if (bgType === 'video') {
                    data.videoUrl = document.getElementById('slideVideoUrl').value.trim();
                    data.videoSpeed = document.getElementById('slideVideoSpeed').value;
                    data.videoZoom = document.getElementById('slideVideoZoom').value;
                    data.videoStart = parseInt(document.getElementById('slideVideoStart').value) || 0;
                    data.background = null;
                    data.bgImageUrl = null;
                }
                
                if (!data.title) {
                    showToast('Titel ist erforderlich', 'error');
                    return;
                }
                
                try {
                    if (id) {
                        await db.collection(this.currentCollection).doc(id).update(data);
                        showToast('Slide aktualisiert');
                    } else {
                        data.order = this.slides.length;
                        data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                        await db.collection(this.currentCollection).add(data);
                        showToast('Slide erstellt');
                    }
                    
                    this.closeEditor();
                    this.load();
                } catch (e) {
                    console.error('[Admin] Error saving slide:', e);
                    showToast('Fehler beim Speichern', 'error');
                }
            },
            
            async uploadImage(file) {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', 'RIFTapp');
                formData.append('folder', 'carousel');
                
                const response = await fetch('https://api.cloudinary.com/v1_1/dza4jgreq/image/upload', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) throw new Error('Upload failed');
                
                const data = await response.json();
                if (data.secure_url) return data.secure_url;
                throw new Error(data.error?.message || 'Upload failed');
            },
            
            async move(id, direction) {
                const index = this.slides.findIndex(s => s.id === id);
                const newIndex = index + direction;
                
                if (newIndex < 0 || newIndex >= this.slides.length) return;
                
                const slide = this.slides[index];
                const otherSlide = this.slides[newIndex];
                
                try {
                    const batch = db.batch();
                    batch.update(db.collection(this.currentCollection).doc(slide.id), { order: newIndex });
                    batch.update(db.collection(this.currentCollection).doc(otherSlide.id), { order: index });
                    await batch.commit();
                    
                    this.load();
                } catch (e) {
                    console.error('[Admin] Error moving slide:', e);
                    showToast('Fehler beim Verschieben', 'error');
                }
            },
            
            async delete(id) {
                if (!confirm('Slide wirklich löschen?')) return;
                
                try {
                    await db.collection(this.currentCollection).doc(id).delete();
                    showToast('Slide gelöscht');
                    this.load();
                } catch (e) {
                    console.error('[Admin] Error deleting slide:', e);
                    showToast('Fehler beim Löschen', 'error');
                }
            },
            
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        };
        
        // ========================================
        // FEATURES ADMIN
        // ========================================
        const FeaturesAdmin = {
            features: [],
            currentHighlights: [],
            
            async load() {
                try {
                    const snapshot = await db.collection('hub_features').orderBy('order').get();
                    this.features = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    this.render();
                } catch (e) {
                    console.error('[Admin] Error loading features:', e);
                    showToast('Fehler beim Laden der Features', 'error');
                }
            },
            
            render() {
                const container = document.getElementById('featuresList');
                
                if (this.features.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width: 48px; height: 48px; margin-bottom: 16px; opacity: 0.5;">
                                <rect x="3" y="3" width="7" height="7" rx="1"/>
                                <rect x="14" y="3" width="7" height="7" rx="1"/>
                                <rect x="3" y="14" width="7" height="7" rx="1"/>
                                <rect x="14" y="14" width="7" height="7" rx="1"/>
                            </svg>
                            <p>Noch keine Features vorhanden</p>
                            <button class="btn btn--primary" onclick="FeaturesAdmin.openEditor()" style="margin-top: 16px;">Erstes Feature erstellen</button>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = this.features.map((feature, index) => `
                    <div class="slide-item ${feature.active === false ? 'inactive' : ''}">
                        <div class="slide-item__order">
                            <button onclick="FeaturesAdmin.move('${feature.id}', -1)" ${index === 0 ? 'disabled' : ''}>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M18 15l-6-6-6 6"/></svg>
                            </button>
                            <button onclick="FeaturesAdmin.move('${feature.id}', 1)" ${index === this.features.length - 1 ? 'disabled' : ''}>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M6 9l6 6 6-6"/></svg>
                            </button>
                        </div>
                        <div class="slide-item__preview" style="background: ${feature.accentColor || 'var(--accent)'}; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 700; color: white;">
                            ${feature.icon ? this.getIconEmoji(feature.icon) : (feature.tabLabel || 'F')[0].toUpperCase()}
                        </div>
                        <div class="slide-item__info" style="flex: 1;">
                            <div class="slide-item__title" style="display: flex; align-items: center; gap: 8px;">
                                ${this.escapeHtml(feature.tabLabel || 'Unbenannt')}
                                ${feature.badgeText ? `<span style="font-size: 10px; padding: 2px 6px; border-radius: 4px; background: ${this.getBadgeColor(feature.badgeColor)}; color: white; font-weight: 600;">${this.escapeHtml(feature.badgeText)}</span>` : ''}
                                ${feature.highlight ? '<span style="font-size: 10px; padding: 2px 6px; border-radius: 4px; background: var(--yellow); color: #000; font-weight: 600;">★</span>' : ''}
                            </div>
                            <div class="slide-item__subtitle" style="color: var(--text-muted); font-size: 13px;">${this.escapeHtml(feature.title || '')}</div>
                            <div style="display: flex; gap: 8px; margin-top: 4px; font-size: 11px; color: var(--text-muted);">
                                ${feature.imageUrl ? '<span>🖼️ Bild</span>' : ''}
                                ${feature.icon ? '<span>🎨 Icon</span>' : ''}
                                ${feature.highlights?.length ? `<span>✓ ${feature.highlights.length} Highlights</span>` : ''}
                                ${feature.layout === 'image-right' ? '<span>→ Rechts</span>' : ''}
                            </div>
                        </div>
                        <div class="slide-item__status">
                            <span class="status-badge ${feature.active !== false ? 'status-badge--green' : 'status-badge--gray'}">
                                ${feature.active !== false ? 'Aktiv' : 'Inaktiv'}
                            </span>
                        </div>
                        <div class="slide-item__actions">
                            <button class="btn btn--secondary" onclick="FeaturesAdmin.duplicate('${feature.id}')" title="Duplizieren">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                            </button>
                            <button class="btn btn--secondary" onclick="FeaturesAdmin.openEditor('${feature.id}')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                Bearbeiten
                            </button>
                            <button class="btn btn--danger" onclick="FeaturesAdmin.delete('${feature.id}')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                            </button>
                        </div>
                    </div>
                `).join('');
            },
            
            openEditor(id = null) {
                const modal = document.getElementById('featuresModal');
                const title = document.getElementById('featureEditorTitle');
                
                // Reset form
                document.getElementById('featureId').value = '';
                document.getElementById('featureIdInput').value = '';
                document.getElementById('featureTabLabel').value = '';
                document.getElementById('featureTitle').value = '';
                document.getElementById('featureDescription').value = '';
                document.getElementById('featureCtaText').value = '';
                document.getElementById('featureCtaLink').value = '';
                document.getElementById('featureImageUrl').value = '';
                document.getElementById('featureBadgeText').value = '';
                document.getElementById('featureBadgeColor').value = '';
                document.getElementById('featureAccentColor').value = '';
                document.getElementById('featureLayout').value = 'image-left';
                document.getElementById('featureIcon').value = '';
                document.getElementById('featureIconBg').value = '';
                document.getElementById('featureActive').checked = true;
                document.getElementById('featureHighlight').checked = false;
                this.currentHighlights = [];
                
                if (id) {
                    // Edit mode
                    const feature = this.features.find(f => f.id === id);
                    if (feature) {
                        title.textContent = 'Feature bearbeiten';
                        document.getElementById('featureId').value = id;
                        document.getElementById('featureIdInput').value = feature.id || '';
                        document.getElementById('featureTabLabel').value = feature.tabLabel || '';
                        document.getElementById('featureTitle').value = feature.title || '';
                        document.getElementById('featureDescription').value = feature.description || '';
                        document.getElementById('featureCtaText').value = feature.ctaText || '';
                        document.getElementById('featureCtaLink').value = feature.ctaLink || '';
                        document.getElementById('featureImageUrl').value = feature.imageUrl || '';
                        document.getElementById('featureBadgeText').value = feature.badgeText || '';
                        document.getElementById('featureBadgeColor').value = feature.badgeColor || '';
                        document.getElementById('featureAccentColor').value = feature.accentColor || '';
                        document.getElementById('featureLayout').value = feature.layout || 'image-left';
                        document.getElementById('featureIcon').value = feature.icon || '';
                        document.getElementById('featureIconBg').value = feature.iconBg || '';
                        document.getElementById('featureActive').checked = feature.active !== false;
                        document.getElementById('featureHighlight').checked = feature.highlight === true;
                        this.currentHighlights = feature.highlights ? [...feature.highlights] : [];
                    }
                } else {
                    title.textContent = 'Neues Feature';
                    this.currentHighlights = [''];
                }
                
                this.renderHighlights();
                modal.classList.add('active');
            },
            
            closeEditor() {
                document.getElementById('featuresModal').classList.remove('active');
            },
            
            renderHighlights() {
                const container = document.getElementById('featureHighlightsList');
                container.innerHTML = this.currentHighlights.map((h, i) => `
                    <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                        <input type="text" class="form-input" value="${this.escapeHtml(h)}" 
                               onchange="FeaturesAdmin.updateHighlight(${i}, this.value)"
                               placeholder="Highlight ${i + 1}">
                        <button type="button" class="btn btn--ghost" onclick="FeaturesAdmin.removeHighlight(${i})" style="padding: 8px;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </button>
                    </div>
                `).join('');
            },
            
            addHighlight() {
                this.currentHighlights.push('');
                this.renderHighlights();
            },
            
            updateHighlight(index, value) {
                this.currentHighlights[index] = value;
            },
            
            removeHighlight(index) {
                this.currentHighlights.splice(index, 1);
                this.renderHighlights();
            },
            
            async save() {
                const id = document.getElementById('featureId').value;
                const newId = document.getElementById('featureIdInput').value.trim().toLowerCase().replace(/\s+/g, '-');
                
                const data = {
                    tabLabel: document.getElementById('featureTabLabel').value.trim(),
                    title: document.getElementById('featureTitle').value.trim(),
                    description: document.getElementById('featureDescription').value.trim(),
                    ctaText: document.getElementById('featureCtaText').value.trim(),
                    ctaLink: document.getElementById('featureCtaLink').value.trim(),
                    imageUrl: document.getElementById('featureImageUrl').value.trim(),
                    highlights: this.currentHighlights.filter(h => h.trim() !== ''),
                    // New fields
                    badgeText: document.getElementById('featureBadgeText').value.trim(),
                    badgeColor: document.getElementById('featureBadgeColor').value,
                    accentColor: document.getElementById('featureAccentColor').value,
                    layout: document.getElementById('featureLayout').value,
                    icon: document.getElementById('featureIcon').value,
                    iconBg: document.getElementById('featureIconBg').value,
                    active: document.getElementById('featureActive').checked,
                    highlight: document.getElementById('featureHighlight').checked,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                if (!data.tabLabel || !data.title) {
                    showToast('Tab Label und Titel sind erforderlich', 'error');
                    return;
                }
                
                try {
                    if (id) {
                        // Update existing
                        await db.collection('hub_features').doc(id).update(data);
                        showToast('Feature aktualisiert');
                    } else {
                        // Create new
                        if (!newId) {
                            showToast('Feature ID ist erforderlich', 'error');
                            return;
                        }
                        data.order = this.features.length;
                        data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                        await db.collection('hub_features').doc(newId).set(data);
                        showToast('Feature erstellt');
                    }
                    
                    this.closeEditor();
                    this.load();
                } catch (e) {
                    console.error('[Admin] Error saving feature:', e);
                    showToast('Fehler beim Speichern', 'error');
                }
            },
            
            async move(id, direction) {
                const index = this.features.findIndex(f => f.id === id);
                const newIndex = index + direction;
                
                if (newIndex < 0 || newIndex >= this.features.length) return;
                
                const feature = this.features[index];
                const otherFeature = this.features[newIndex];
                
                try {
                    const batch = db.batch();
                    batch.update(db.collection('hub_features').doc(feature.id), { order: newIndex });
                    batch.update(db.collection('hub_features').doc(otherFeature.id), { order: index });
                    await batch.commit();
                    
                    this.load();
                } catch (e) {
                    console.error('[Admin] Error moving feature:', e);
                    showToast('Fehler beim Verschieben', 'error');
                }
            },
            
            async delete(id) {
                if (!confirm('Feature wirklich löschen?')) return;
                
                try {
                    await db.collection('hub_features').doc(id).delete();
                    showToast('Feature gelöscht');
                    this.load();
                } catch (e) {
                    console.error('[Admin] Error deleting feature:', e);
                    showToast('Fehler beim Löschen', 'error');
                }
            },
            
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text || '';
                return div.innerHTML;
            },
            
            getIconEmoji(icon) {
                const icons = {
                    'user': '👤',
                    'dice': '🎲',
                    'map': '🗺️',
                    'chat': '💬',
                    'book': '📖',
                    'sword': '⚔️',
                    'magic': '✨',
                    'shield': '🛡️',
                    'scroll': '📜',
                    'crown': '👑'
                };
                return icons[icon] || '📦';
            },
            
            getBadgeColor(color) {
                const colors = {
                    'red': '#EF4444',
                    'green': '#22C55E',
                    'purple': '#8B5CF6',
                    'orange': '#F59E0B',
                    'blue': '#3B82F6'
                };
                return colors[color] || '#6B7280';
            },
            
            async duplicate(id) {
                const feature = this.features.find(f => f.id === id);
                if (!feature) return;
                
                const newId = feature.id + '-copy-' + Date.now().toString(36);
                const data = {
                    ...feature,
                    tabLabel: feature.tabLabel + ' (Kopie)',
                    order: this.features.length,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                delete data.id;
                
                try {
                    await db.collection('hub_features').doc(newId).set(data);
                    showToast('Feature dupliziert');
                    this.load();
                } catch (e) {
                    console.error('[Admin] Error duplicating feature:', e);
                    showToast('Fehler beim Duplizieren', 'error');
                }
            }
        };
        
        // ========================================
        // IMAGE UPLOAD HANDLING
        // ========================================
        function initImageUpload() {
            const input = document.getElementById('imageInput');
            const preview = document.getElementById('imagePreview');
            const upload = document.getElementById('imageUpload');
            const hint = document.getElementById('imageHint');
            
            input.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                // Validate file type
                if (!['image/jpeg', 'image/png', 'image/webp'].includes(file.type)) {
                    showToast('Nur JPG, PNG oder WebP erlaubt', 'error');
                    return;
                }
                
                // Validate file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showToast('Bild darf max. 5MB groß sein', 'error');
                    return;
                }
                
                // Preview
                const reader = new FileReader();
                reader.onload = (e) => {
                    preview.src = e.target.result;
                    upload.classList.add('has-image');
                    
                    // Check dimensions
                    const img = new Image();
                    img.onload = () => {
                        const ratio = img.width / img.height;
                        const expectedRatio = 16 / 9;
                        
                        if (img.width < 1200 || img.height < 675) {
                            hint.textContent = `⚠️ Bild ist ${img.width}×${img.height}px. Empfohlen: min. 1200×675px`;
                            hint.style.color = 'var(--yellow)';
                        } else if (Math.abs(ratio - expectedRatio) > 0.1) {
                            hint.textContent = `⚠️ Seitenverhältnis ist ${ratio.toFixed(2)}:1. Empfohlen: 16:9`;
                            hint.style.color = 'var(--yellow)';
                        } else {
                            hint.textContent = `✓ ${img.width}×${img.height}px`;
                            hint.style.color = 'var(--green)';
                        }
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
                
                NewsAdmin.currentImageFile = file;
            });
        }
        
        // ========================================
        // EXCERPT COUNTER
        // ========================================
        function initExcerptCounter() {
            const textarea = document.getElementById('articleExcerpt');
            const counter = document.getElementById('excerptCount');
            
            textarea.addEventListener('input', () => {
                counter.textContent = textarea.value.length;
            });
        }
        
        // ========================================
        // RIFT PRO ADMIN MODULE
        // ========================================
        const ProAdmin = {
            // Feature Flags
            async saveFeatureFlags() {
                const flags = {};
                document.querySelectorAll('[data-flag]').forEach(input => {
                    flags[input.dataset.flag] = input.checked;
                });
                try {
                    await db.collection('pro_config').doc('feature_flags').set(flags, { merge: true });
                    showToast('Feature Flags gespeichert');
                } catch (e) {
                    showToast('Fehler beim Speichern', 'error');
                }
            },
            
            async loadFeatureFlags() {
                try {
                    const doc = await db.collection('pro_config').doc('feature_flags').get();
                    if (doc.exists) {
                        const flags = doc.data();
                        Object.entries(flags).forEach(([key, val]) => {
                            const input = document.querySelector(`[data-flag="${key}"]`);
                            if (input) input.checked = val;
                        });
                    }
                } catch (e) { console.error('Feature flags load error:', e); }
            },
            
            // Theme Gating
            currentThemeTab: 'dice',
            
            switchThemeTab(tab) {
                this.currentThemeTab = tab;
                document.querySelectorAll('[id^="themeTab"]').forEach(t => t.classList.remove('active'));
                document.getElementById('themeTab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('active');
                const titles = { dice: 'Würfel-Themes', number: 'Zahlen-Themes', arena: 'Arena-Themes' };
                document.getElementById('themeGatingTitle').textContent = titles[tab];
                this.loadThemeGating(tab);
            },
            
            async loadThemeGating(type) {
                const grid = document.getElementById('themeGatingGrid');
                grid.innerHTML = '<div style="text-align:center;padding:40px;color:var(--text-muted);grid-column:1/-1;">Lade Themes...</div>';
                
                try {
                    const collections = { dice: 'dice_themes', number: 'number_themes', arena: 'arena_themes' };
                    const gatingDoc = await db.collection('pro_config').doc('theme_gating').get();
                    const gating = gatingDoc.exists ? (gatingDoc.data()[type] || {}) : {};
                    
                    const snapshot = await db.collection(collections[type]).get();
                    if (snapshot.empty) {
                        grid.innerHTML = '<div style="text-align:center;padding:40px;color:var(--text-muted);grid-column:1/-1;">Keine Themes gefunden</div>';
                        return;
                    }
                    
                    let freeCount = 0, proCount = 0;
                    grid.innerHTML = '';
                    snapshot.docs.forEach(doc => {
                        const data = doc.data();
                        const isPro = gating[doc.id] !== false; // default Pro
                        if (isPro) proCount++; else freeCount++;
                        
                        const item = document.createElement('div');
                        item.className = 'theme-gate-item' + (isPro ? ' is-pro' : '');
                        item.dataset.themeId = doc.id;
                        item.dataset.isPro = isPro;
                        item.innerHTML = `
                            <span class="theme-gate-item__badge ${isPro ? 'theme-gate-item__badge--pro' : 'theme-gate-item__badge--free'}">${isPro ? 'PRO' : 'FREE'}</span>
                            <span style="flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${data.name || doc.id}</span>
                        `;
                        item.onclick = () => {
                            const newState = item.dataset.isPro !== 'true';
                            item.dataset.isPro = newState;
                            item.className = 'theme-gate-item' + (newState ? ' is-pro' : '');
                            const badge = item.querySelector('.theme-gate-item__badge');
                            badge.textContent = newState ? 'PRO' : 'FREE';
                            badge.className = 'theme-gate-item__badge ' + (newState ? 'theme-gate-item__badge--pro' : 'theme-gate-item__badge--free');
                            this.updateThemeCount();
                        };
                        grid.appendChild(item);
                    });
                    
                    document.getElementById('themeGatingCount').textContent = `${freeCount} Free / ${proCount} Pro`;
                } catch (e) {
                    grid.innerHTML = '<div style="text-align:center;padding:40px;color:var(--red);grid-column:1/-1;">Fehler beim Laden</div>';
                    console.error(e);
                }
            },
            
            updateThemeCount() {
                const items = document.querySelectorAll('.theme-gate-item');
                let free = 0, pro = 0;
                items.forEach(i => i.dataset.isPro === 'true' ? pro++ : free++);
                document.getElementById('themeGatingCount').textContent = `${free} Free / ${pro} Pro`;
            },
            
            setAllThemes(tier) {
                document.querySelectorAll('.theme-gate-item').forEach(item => {
                    const isPro = tier === 'pro';
                    item.dataset.isPro = isPro;
                    item.className = 'theme-gate-item' + (isPro ? ' is-pro' : '');
                    const badge = item.querySelector('.theme-gate-item__badge');
                    badge.textContent = isPro ? 'PRO' : 'FREE';
                    badge.className = 'theme-gate-item__badge ' + (isPro ? 'theme-gate-item__badge--pro' : 'theme-gate-item__badge--free');
                });
                this.updateThemeCount();
            },
            
            async saveThemeGating() {
                const type = this.currentThemeTab;
                const gating = {};
                document.querySelectorAll('.theme-gate-item').forEach(item => {
                    gating[item.dataset.themeId] = item.dataset.isPro === 'true';
                });
                try {
                    await db.collection('pro_config').doc('theme_gating').set({ [type]: gating }, { merge: true });
                    showToast('Theme-Gating gespeichert');
                } catch (e) {
                    showToast('Fehler beim Speichern', 'error');
                }
            },
            
            // Limits
            async saveLimits() {
                const limits = {
                    free: {
                        sessionsPerAccount: parseInt(document.getElementById('limitFreeSessionsAccount').value),
                        sessionsPerRoom: parseInt(document.getElementById('limitFreeSessionsRoom').value),
                        participantsPerRoom: parseInt(document.getElementById('limitFreeParticipants').value),
                        participantsPerSession: parseInt(document.getElementById('limitFreeSessionParticipants').value),
                        charsPerRoom: parseInt(document.getElementById('limitFreeCharsRoom').value),
                        diceThemes: parseInt(document.getElementById('limitFreeDiceThemes').value),
                        numberThemes: parseInt(document.getElementById('limitFreeNumberThemes').value),
                        arenaThemes: parseInt(document.getElementById('limitFreeArenaThemes').value),
                    },
                    pro: {
                        sessionsPerAccount: parseInt(document.getElementById('limitProSessionsAccount').value),
                        sessionsPerRoom: parseInt(document.getElementById('limitProSessionsRoom').value),
                        participantsPerRoom: parseInt(document.getElementById('limitProParticipants').value),
                        participantsPerSession: parseInt(document.getElementById('limitProSessionParticipants').value),
                        charsPerRoom: parseInt(document.getElementById('limitProCharsRoom').value),
                        diceThemes: parseInt(document.getElementById('limitProDiceThemes').value),
                        numberThemes: parseInt(document.getElementById('limitProNumberThemes').value),
                        arenaThemes: parseInt(document.getElementById('limitProArenaThemes').value),
                    }
                };
                try {
                    await db.collection('pro_config').doc('limits').set(limits);
                    showToast('Limits gespeichert');
                } catch (e) {
                    showToast('Fehler beim Speichern', 'error');
                }
            },
            
            async loadLimits() {
                try {
                    const doc = await db.collection('pro_config').doc('limits').get();
                    if (doc.exists) {
                        const d = doc.data();
                        if (d.free) {
                            Object.entries(d.free).forEach(([k, v]) => {
                                const map = { sessionsPerAccount: 'limitFreeSessionsAccount', sessionsPerRoom: 'limitFreeSessionsRoom', participantsPerRoom: 'limitFreeParticipants', participantsPerSession: 'limitFreeSessionParticipants', charsPerRoom: 'limitFreeCharsRoom', diceThemes: 'limitFreeDiceThemes', numberThemes: 'limitFreeNumberThemes', arenaThemes: 'limitFreeArenaThemes' };
                                const el = document.getElementById(map[k]);
                                if (el) el.value = v;
                            });
                        }
                        if (d.pro) {
                            Object.entries(d.pro).forEach(([k, v]) => {
                                const map = { sessionsPerAccount: 'limitProSessionsAccount', sessionsPerRoom: 'limitProSessionsRoom', participantsPerRoom: 'limitProParticipants', participantsPerSession: 'limitProSessionParticipants', charsPerRoom: 'limitProCharsRoom', diceThemes: 'limitProDiceThemes', numberThemes: 'limitProNumberThemes', arenaThemes: 'limitProArenaThemes' };
                                const el = document.getElementById(map[k]);
                                if (el) el.value = v;
                            });
                        }
                    }
                } catch (e) { console.error('Limits load error:', e); }
            },
            
            // Promos
            async saveTrialConfig() {
                try {
                    await db.collection('pro_config').doc('trial').set({
                        duration: parseInt(document.getElementById('trialDuration').value),
                        enabled: document.getElementById('trialEnabled').value === 'true'
                    });
                    showToast('Trial-Einstellungen gespeichert');
                } catch (e) {
                    showToast('Fehler beim Speichern', 'error');
                }
            },
            
            openPromoEditor() { showToast('Promo-Editor kommt bald', 'error'); },
            openPipelineEditor() { showToast('Pipeline-Editor kommt bald', 'error'); },
            openLicenseEditor() { showToast('Lizenz-Editor kommt bald', 'error'); },
            
            // ========================================
            // SUBSCRIBER MANAGEMENT
            // ========================================
            _subscribers: [],
            _selectedGrantUid: null,
            
            async loadSubscribers() {
                const tbody = document.getElementById('proSubTableBody');
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:var(--text-muted);">Lade Subscriber...</td></tr>';
                
                try {
                    const snapshot = await db.collection('pro_subscribers').get();
                    this._subscribers = [];
                    
                    let active = 0, monthly = 0, yearly = 0, trial = 0, gift = 0, newThisWeek = 0;
                    const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                    
                    snapshot.forEach(doc => {
                        const data = { id: doc.id, ...doc.data() };
                        this._subscribers.push(data);
                        
                        if (data.active) {
                            active++;
                            if (data.plan === 'monthly') monthly++;
                            else if (data.plan === 'yearly') yearly++;
                            else if (data.plan === 'trial') trial++;
                            else if (data.plan === 'gift') gift++;
                            
                            const since = data.since?.toDate ? data.since.toDate() : (data.grantedAt?.toDate ? data.grantedAt.toDate() : null);
                            if (since && since > weekAgo) newThisWeek++;
                        }
                    });
                    
                    // Update KPI cards
                    document.getElementById('proStatActive').textContent = active;
                    document.getElementById('proStatMonthly').textContent = monthly;
                    document.getElementById('proStatYearly').textContent = yearly;
                    document.getElementById('proStatNewWeek').textContent = newThisWeek;
                    
                    const mrrVal = (monthly * 2.99) + (yearly * (29.99 / 12));
                    document.getElementById('proStatMRR').textContent = mrrVal.toFixed(2) + ' €';
                    
                    this._renderSubscriberTable();
                } catch (e) {
                    console.error('[ProAdmin] Load subscribers error:', e);
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:var(--red);">Fehler beim Laden: ' + e.message + '</td></tr>';
                }
            },
            
            _renderSubscriberTable(filter, search) {
                filter = filter || document.getElementById('proSubFilter').value;
                search = search || document.getElementById('proSubSearch').value.toLowerCase();
                
                const tbody = document.getElementById('proSubTableBody');
                let filtered = this._subscribers;
                
                // Apply filter
                if (filter !== 'all') {
                    filtered = filtered.filter(s => s.plan === filter);
                }
                
                // Apply search
                if (search) {
                    filtered = filtered.filter(s => {
                        return (s.uid || s.id || '').toLowerCase().includes(search) ||
                               (s.email || '').toLowerCase().includes(search) ||
                               (s.displayName || '').toLowerCase().includes(search);
                    });
                }
                
                if (filtered.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:var(--text-muted);">Keine Subscriber gefunden</td></tr>';
                    return;
                }
                
                // Sort: active first, then by date desc
                filtered.sort((a, b) => {
                    if (a.active && !b.active) return -1;
                    if (!a.active && b.active) return 1;
                    const dateA = a.grantedAt?.toDate?.() || a.since?.toDate?.() || new Date(0);
                    const dateB = b.grantedAt?.toDate?.() || b.since?.toDate?.() || new Date(0);
                    return dateB - dateA;
                });
                
                tbody.innerHTML = filtered.map(sub => {
                    const uid = sub.uid || sub.id;
                    const name = sub.displayName || sub.email || uid;
                    const sinceDate = sub.since?.toDate ? sub.since.toDate() : (sub.grantedAt?.toDate ? sub.grantedAt.toDate() : null);
                    const sinceStr = sinceDate ? sinceDate.toLocaleDateString('de-DE') : '–';
                    const expiresDate = sub.expiresAt?.toDate ? sub.expiresAt.toDate() : null;
                    const expiresStr = expiresDate ? expiresDate.toLocaleDateString('de-DE') : 'Unbegrenzt';
                    
                    const planLabels = { monthly: 'Monatlich', yearly: 'Jährlich', trial: 'Trial', gift: 'Geschenk' };
                    const planLabel = planLabels[sub.plan] || sub.plan || '–';
                    
                    const statusBadge = sub.active
                        ? '<span style="display:inline-block;padding:3px 10px;background:rgba(117,171,93,0.15);color:#75ab5d;font-size:11px;font-weight:700;border-radius:100px;">Aktiv</span>'
                        : '<span style="display:inline-block;padding:3px 10px;background:rgba(255,82,82,0.15);color:#ff5252;font-size:11px;font-weight:700;border-radius:100px;">Inaktiv</span>';
                    
                    const actionBtn = sub.active
                        ? `<button class="btn btn--ghost btn--small" style="color:var(--red);font-size:12px;" onclick="ProAdmin.revokePro('${uid}','${name.replace(/'/g, "\\'")}')">Entziehen</button>`
                        : `<button class="btn btn--ghost btn--small" style="color:#bca24c;font-size:12px;" onclick="ProAdmin.reactivatePro('${uid}')">Reaktivieren</button>`;
                    
                    return `<tr>
                        <td>
                            <div style="font-weight:600;color:var(--text);">${this._escHtml(name)}</div>
                            <div style="font-size:11px;color:var(--text-muted);font-family:monospace;">${uid}</div>
                            ${sub.note ? `<div style="font-size:11px;color:var(--text-muted);margin-top:2px;">📝 ${this._escHtml(sub.note)}</div>` : ''}
                        </td>
                        <td>${planLabel}</td>
                        <td>${statusBadge}</td>
                        <td>${sinceStr}</td>
                        <td>${expiresStr}</td>
                        <td>${actionBtn}</td>
                    </tr>`;
                }).join('');
            },
            
            _escHtml(str) {
                const div = document.createElement('div');
                div.textContent = str;
                return div.innerHTML;
            },
            
            // ========================================
            // GRANT PRO
            // ========================================
            openGrantModal() {
                this._selectedGrantUid = null;
                document.getElementById('proGrantSearch').value = '';
                document.getElementById('proGrantUserResult').innerHTML = '';
                document.getElementById('proGrantPlan').value = 'gift';
                document.getElementById('proGrantExpiry').value = '';
                document.getElementById('proGrantNote').value = '';
                document.getElementById('proGrantSubmitBtn').disabled = true;
                document.getElementById('proGrantModal').classList.add('active');
            },
            
            closeGrantModal() {
                document.getElementById('proGrantModal').classList.remove('active');
            },
            
            async lookupUser() {
                const query = document.getElementById('proGrantSearch').value.trim();
                const resultDiv = document.getElementById('proGrantUserResult');
                
                if (!query) {
                    resultDiv.innerHTML = '<p style="color:var(--text-muted);font-size:13px;">Gib eine UID, Email oder einen Namen ein.</p>';
                    return;
                }
                
                resultDiv.innerHTML = '<p style="color:var(--text-muted);font-size:13px;">Suche...</p>';
                
                try {
                    let results = [];
                    
                    // Try exact UID match first
                    const uidDoc = await db.collection('users').doc(query).get();
                    if (uidDoc.exists) {
                        results.push({ uid: query, ...uidDoc.data() });
                    }
                    
                    // Search by email
                    if (results.length === 0) {
                        const emailSnap = await db.collection('users').where('email', '==', query).limit(5).get();
                        emailSnap.forEach(doc => results.push({ uid: doc.id, ...doc.data() }));
                    }
                    
                    // Search by displayName (case-sensitive, Firestore limitation)
                    if (results.length === 0) {
                        const nameSnap = await db.collection('users').where('displayName', '==', query).limit(5).get();
                        nameSnap.forEach(doc => results.push({ uid: doc.id, ...doc.data() }));
                    }
                    
                    // Deduplicate
                    const seen = new Set();
                    results = results.filter(r => {
                        if (seen.has(r.uid)) return false;
                        seen.add(r.uid);
                        return true;
                    });
                    
                    if (results.length === 0) {
                        resultDiv.innerHTML = `
                            <p style="color:var(--text-muted);font-size:13px;">Kein Benutzer gefunden.</p>
                            <p style="color:var(--text-muted);font-size:12px;margin-top:4px;">Tipp: Direkte UID wird immer gefunden. Email-Suche ist exakt (Groß/Kleinschreibung beachten).</p>
                        `;
                        this._selectedGrantUid = null;
                        document.getElementById('proGrantSubmitBtn').disabled = true;
                        return;
                    }
                    
                    resultDiv.innerHTML = results.map(u => {
                        const hasPro = u.pro?.active === true;
                        const proBadge = hasPro ? '<span style="display:inline-block;padding:2px 8px;background:rgba(188,162,76,0.15);color:#bca24c;font-size:10px;font-weight:700;border-radius:100px;margin-left:8px;">PRO</span>' : '';
                        return `
                            <div class="pro-grant-user-result" data-uid="${u.uid}" onclick="ProAdmin.selectGrantUser('${u.uid}')" 
                                 style="display:flex;align-items:center;gap:12px;padding:12px;border:1px solid rgba(255,255,255,0.08);border-radius:10px;cursor:pointer;transition:all 0.2s;margin-bottom:6px;">
                                <div style="width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:center;flex-shrink:0;overflow:hidden;">
                                    ${u.photoURL ? `<img src="${u.photoURL}" style="width:100%;height:100%;object-fit:cover;">` : `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:18px;height:18px;color:var(--text-muted);"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`}
                                </div>
                                <div style="flex:1;min-width:0;">
                                    <div style="font-weight:600;color:var(--text);font-size:14px;">${this._escHtml(u.displayName || u.email || 'Unbekannt')}${proBadge}</div>
                                    <div style="font-size:11px;color:var(--text-muted);font-family:monospace;overflow:hidden;text-overflow:ellipsis;">${u.uid}</div>
                                    ${u.email ? `<div style="font-size:11px;color:var(--text-muted);">${this._escHtml(u.email)}</div>` : ''}
                                </div>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;color:var(--text-muted);flex-shrink:0;"><polyline points="9 18 15 12 9 6"/></svg>
                            </div>
                        `;
                    }).join('');
                    
                    // Auto-select if only one result
                    if (results.length === 1) {
                        this.selectGrantUser(results[0].uid);
                    }
                    
                } catch (e) {
                    console.error('[ProAdmin] User lookup error:', e);
                    resultDiv.innerHTML = '<p style="color:var(--red);font-size:13px;">Fehler bei der Suche: ' + e.message + '</p>';
                }
            },
            
            selectGrantUser(uid) {
                this._selectedGrantUid = uid;
                document.getElementById('proGrantSubmitBtn').disabled = false;
                
                // Highlight selected
                document.querySelectorAll('.pro-grant-user-result').forEach(el => {
                    el.style.borderColor = el.dataset.uid === uid ? '#bca24c' : 'rgba(255,255,255,0.08)';
                    el.style.background = el.dataset.uid === uid ? 'rgba(188,162,76,0.06)' : 'transparent';
                });
            },
            
            async grantPro() {
                const uid = this._selectedGrantUid;
                if (!uid) {
                    showToast('Kein Benutzer ausgewählt', 'error');
                    return;
                }
                
                const plan = document.getElementById('proGrantPlan').value;
                const expiryVal = document.getElementById('proGrantExpiry').value;
                const note = document.getElementById('proGrantNote').value.trim();
                
                const proData = {
                    active: true,
                    plan: plan,
                    since: firebase.firestore.FieldValue.serverTimestamp(),
                    grantedBy: currentUser.uid,
                    grantedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    expiresAt: expiryVal ? firebase.firestore.Timestamp.fromDate(new Date(expiryVal + 'T23:59:59')) : null,
                };
                
                try {
                    // Write to user document
                    await db.collection('users').doc(uid).set({ pro: proData }, { merge: true });
                    
                    // Fetch user info for subscriber record
                    const userDoc = await db.collection('users').doc(uid).get();
                    const userData = userDoc.exists ? userDoc.data() : {};
                    
                    // Write to pro_subscribers
                    await db.collection('pro_subscribers').doc(uid).set({
                        ...proData,
                        uid: uid,
                        email: userData.email || '',
                        displayName: userData.displayName || '',
                        photoURL: userData.photoURL || '',
                        note: note,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    }, { merge: true });
                    
                    showToast(`Pro vergeben an ${userData.displayName || userData.email || uid}`);
                    this.closeGrantModal();
                    this.loadSubscribers();
                    
                } catch (e) {
                    console.error('[ProAdmin] Grant Pro error:', e);
                    showToast('Fehler: ' + e.message, 'error');
                }
            },
            
            // ========================================
            // REVOKE / REACTIVATE PRO
            // ========================================
            async revokePro(uid, displayName) {
                if (!confirm(`Pro-Status von "${displayName}" wirklich entziehen?`)) return;
                
                try {
                    await db.collection('users').doc(uid).set({
                        pro: {
                            active: false,
                            revokedAt: firebase.firestore.FieldValue.serverTimestamp(),
                            revokedBy: currentUser.uid,
                        }
                    }, { merge: true });
                    
                    await db.collection('pro_subscribers').doc(uid).update({
                        active: false,
                        revokedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        revokedBy: currentUser.uid,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    });
                    
                    showToast(`Pro entzogen: ${displayName}`);
                    this.loadSubscribers();
                } catch (e) {
                    console.error('[ProAdmin] Revoke error:', e);
                    showToast('Fehler: ' + e.message, 'error');
                }
            },
            
            async reactivatePro(uid) {
                try {
                    const subDoc = await db.collection('pro_subscribers').doc(uid).get();
                    const subData = subDoc.exists ? subDoc.data() : {};
                    
                    const proData = {
                        active: true,
                        plan: subData.plan || 'gift',
                        since: subData.since || firebase.firestore.FieldValue.serverTimestamp(),
                        grantedBy: currentUser.uid,
                        grantedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        expiresAt: subData.expiresAt || null,
                    };
                    
                    await db.collection('users').doc(uid).set({ pro: proData }, { merge: true });
                    await db.collection('pro_subscribers').doc(uid).update({
                        active: true,
                        revokedAt: firebase.firestore.FieldValue.deleteField(),
                        revokedBy: firebase.firestore.FieldValue.deleteField(),
                        grantedBy: currentUser.uid,
                        grantedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    });
                    
                    showToast(`Pro reaktiviert: ${uid}`);
                    this.loadSubscribers();
                } catch (e) {
                    console.error('[ProAdmin] Reactivate error:', e);
                    showToast('Fehler: ' + e.message, 'error');
                }
            },
        };
        
        // ========================================
        // INITIALIZATION
        // ========================================
        async function init() {
            // Initialize Firebase
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            
            db = firebase.firestore();
            
            // Load admin UIDs from Firebase first
            await loadAdminUIDs();
            
            // Check auth
            firebase.auth().onAuthStateChanged(async (user) => {
                if (!user) {
                    window.location.href = 'login.html';
                    return;
                }
                
                currentUser = user;
                
                // Check if admin
                if (!ADMIN_UIDS.includes(user.uid)) {
                    console.log('[Admin] Access denied for UID:', user.uid);
                    document.querySelector('.access-denied p').innerHTML = `
                        Du benötigst Admin-Rechte um diese Seite zu sehen.<br><br>
                        <small style="color: var(--text-muted); font-family: monospace;">
                        Deine UID: <strong style="color: var(--accent);">${user.uid}</strong><br>
                        <button onclick="navigator.clipboard.writeText('${user.uid}');this.textContent='Kopiert!'" style="margin-top:8px;padding:6px 12px;background:var(--accent);color:black;border:none;border-radius:6px;cursor:pointer;font-size:12px;">UID kopieren</button>
                        </small>
                    `;
                    return;
                }
                
                // Admin verified
                document.body.classList.add('admin-ready');
                
                // Update header
                document.getElementById('adminName').textContent = user.displayName || user.email;
                if (user.photoURL) {
                    document.getElementById('adminAvatar').innerHTML = `<img src="${user.photoURL}" alt="">`;
                }
                
                // Initialize components
                initImageUpload();
                initExcerptCounter();
                
                // Load data
                NewsAdmin.load();
                CarouselAdmin.load();
                FeaturesAdmin.load();
                AnnouncementsAdmin.load();
            });
        }
        
        // Start
        init();
        
        // Close modal on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                NewsAdmin.closeEditor();
                CarouselAdmin.closeEditor();
                FeaturesAdmin.closeEditor();
                AnnouncementsAdmin.closeEditor();
                ProAdmin.closeGrantModal();
            }
        });
        
        // Close modal on backdrop click
        document.getElementById('editorModal').addEventListener('click', (e) => {
            if (e.target.id === 'editorModal') {
                NewsAdmin.closeEditor();
            }
        });
        
        document.getElementById('carouselModal').addEventListener('click', (e) => {
            if (e.target.id === 'carouselModal') {
                CarouselAdmin.closeEditor();
            }
        });
        
        document.getElementById('featuresModal').addEventListener('click', (e) => {
            if (e.target.id === 'featuresModal') {
                FeaturesAdmin.closeEditor();
            }
        });
        
        document.getElementById('quoteModal').addEventListener('click', (e) => {
            if (e.target.id === 'quoteModal') {
                QuotesAdmin.closeEditor();
            }
        });
        
        document.getElementById('importQuotesModal').addEventListener('click', (e) => {
            if (e.target.id === 'importQuotesModal') {
                QuotesAdmin.closeImport();
            }
        });
        
        document.getElementById('announcementModal').addEventListener('click', (e) => {
            if (e.target.id === 'announcementModal') {
                AnnouncementsAdmin.closeEditor();
            }
        });
        
        document.getElementById('proGrantModal').addEventListener('click', (e) => {
            if (e.target.id === 'proGrantModal') {
                ProAdmin.closeGrantModal();
            }
        });
        
        // Pro subscriber filter & search
        document.getElementById('proSubFilter').addEventListener('change', () => ProAdmin._renderSubscriberTable());
        document.getElementById('proSubSearch').addEventListener('input', () => ProAdmin._renderSubscriberTable());
        
        // Enter key in grant search
        document.getElementById('proGrantSearch').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') { e.preventDefault(); ProAdmin.lookupUser(); }
        });
        
        // ========================================
        // QUOTES ADMIN MODULE
        // ========================================
        const QuotesAdmin = {
            quotes: [],
            settings: {},
            editingId: null,
            selectedIds: [],
            categories: [
                { id: 'wisdom', name: 'Weisheit', color: '#8B5CF6' },
                { id: 'motivation', name: 'Motivation', color: '#22C55E' },
                { id: 'humor', name: 'Humor', color: '#F59E0B' },
                { id: 'rpg', name: 'Rollenspiel', color: '#EF4444' },
                { id: 'fantasy', name: 'Fantasy', color: '#3B82F6' },
                { id: 'scifi', name: 'Sci-Fi', color: '#06B6D4' },
                { id: 'philosophy', name: 'Philosophie', color: '#A855F7' },
                { id: 'gaming', name: 'Gaming', color: '#EC4899' },
                { id: 'life', name: 'Leben', color: '#10B981' },
                { id: 'friendship', name: 'Freundschaft', color: '#F97316' },
                { id: 'adventure', name: 'Abenteuer', color: '#EAB308' }
            ],
            
            async load() {
                try {
                    // Load quotes
                    const quotesSnapshot = await db.collection('hub_quotes')
                        .orderBy('createdAt', 'desc')
                        .get();
                    
                    this.quotes = quotesSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    // Load settings
                    const settingsDoc = await db.collection('hub_settings').doc('quotes').get();
                    this.settings = settingsDoc.exists ? settingsDoc.data() : this.getDefaultSettings();
                    
                    this.render();
                    this.renderSettings();
                    this.updateStats();
                    this.updateCategoryFilter();
                    this.updateFixedQuoteSelect();
                    
                } catch (error) {
                    console.error('Error loading quotes:', error);
                    showToast('Fehler beim Laden der Zitate', 'error');
                }
            },
            
            getDefaultSettings() {
                return {
                    displayMode: 'daily',
                    changeTime: '00:00',
                    fixedQuoteId: null,
                    animation: 'fade',
                    fontStyle: 'normal',
                    fontSize: 'medium',
                    alignment: 'center',
                    quoteMarks: 'german',
                    showAuthor: true,
                    showSource: true,
                    showCategory: false,
                    enabled: true
                };
            },
            
            render() {
                const container = document.getElementById('quotesTableBody');
                
                if (this.quotes.length === 0) {
                    container.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 60px;">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width: 48px; height: 48px; color: var(--text-muted); margin-bottom: 16px;">
                                    <path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V21z"/>
                                    <path d="M15 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V21z"/>
                                </svg>
                                <p style="color: var(--text-muted);">Noch keine Zitate vorhanden</p>
                                <button class="btn btn--primary" style="margin-top: 16px;" onclick="QuotesAdmin.openEditor()">Erstes Zitat erstellen</button>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                container.innerHTML = this.quotes.map(quote => {
                    const category = this.categories.find(c => c.id === quote.category) || { name: quote.category, color: '#666' };
                    const isSelected = this.selectedIds.includes(quote.id);
                    
                    return `
                        <tr class="${isSelected ? 'selected' : ''}">
                            <td>
                                <input type="checkbox" ${isSelected ? 'checked' : ''} onchange="QuotesAdmin.toggleSelect('${quote.id}')">
                            </td>
                            <td>
                                <div class="news-table__title" style="font-style: italic; max-width: 400px;">
                                    „${this.truncate(quote.text, 100)}"
                                </div>
                            </td>
                            <td style="color: var(--text-muted);">${quote.author || '—'}</td>
                            <td>
                                <span style="display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; background: ${category.color}20; color: ${category.color}; border-radius: 12px; font-size: 12px; font-weight: 500;">
                                    ${category.name}
                                </span>
                            </td>
                            <td>
                                <span class="status-badge status-badge--${quote.active !== false ? 'published' : 'draft'}">
                                    ${quote.active !== false ? 'Aktiv' : 'Inaktiv'}
                                </span>
                            </td>
                            <td>
                                <div class="news-table__actions">
                                    <button class="btn btn--ghost btn--small" onclick="QuotesAdmin.edit('${quote.id}')" title="Bearbeiten">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                    </button>
                                    <button class="btn btn--ghost btn--small" onclick="QuotesAdmin.duplicate('${quote.id}')" title="Duplizieren">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                    </button>
                                    <button class="btn btn--ghost btn--small" onclick="QuotesAdmin.delete('${quote.id}')" title="Löschen" style="color: var(--red);">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
            },
            
            renderSettings() {
                // Apply settings to form
                document.getElementById('quoteDisplayMode').value = this.settings.displayMode || 'daily';
                document.getElementById('quoteChangeTime').value = this.settings.changeTime || '00:00';
                document.getElementById('quoteAnimation').value = this.settings.animation || 'fade';
                document.getElementById('quoteFontStyle').value = this.settings.fontStyle || 'normal';
                document.getElementById('quoteFontSize').value = this.settings.fontSize || 'medium';
                document.getElementById('quoteAlignment').value = this.settings.alignment || 'center';
                document.getElementById('quoteMarks').value = this.settings.quoteMarks || 'german';
                document.getElementById('quoteShowAuthor').checked = this.settings.showAuthor !== false;
                document.getElementById('quoteShowSource').checked = this.settings.showSource !== false;
                document.getElementById('quoteShowCategory').checked = this.settings.showCategory === true;
                document.getElementById('quoteEnabled').checked = this.settings.enabled !== false;
                
                // Toggle visibility of mode-specific options
                this.toggleModeOptions();
                
                // Update preview
                this.updatePreview();
            },
            
            toggleModeOptions() {
                const mode = document.getElementById('quoteDisplayMode').value;
                document.getElementById('quoteChangeTimeGroup').style.display = mode === 'daily' ? 'block' : 'none';
                document.getElementById('quoteFixedGroup').style.display = mode === 'fixed' ? 'block' : 'none';
            },
            
            async updateSettings() {
                this.toggleModeOptions();
                
                const settings = {
                    displayMode: document.getElementById('quoteDisplayMode').value,
                    changeTime: document.getElementById('quoteChangeTime').value,
                    fixedQuoteId: document.getElementById('quoteFixedId').value || null,
                    animation: document.getElementById('quoteAnimation').value,
                    fontStyle: document.getElementById('quoteFontStyle').value,
                    fontSize: document.getElementById('quoteFontSize').value,
                    alignment: document.getElementById('quoteAlignment').value,
                    quoteMarks: document.getElementById('quoteMarks').value,
                    showAuthor: document.getElementById('quoteShowAuthor').checked,
                    showSource: document.getElementById('quoteShowSource').checked,
                    showCategory: document.getElementById('quoteShowCategory').checked,
                    enabled: document.getElementById('quoteEnabled').checked,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                try {
                    await db.collection('hub_settings').doc('quotes').set(settings, { merge: true });
                    this.settings = settings;
                    this.updatePreview();
                    showToast('Einstellungen gespeichert');
                } catch (error) {
                    console.error('Error saving settings:', error);
                    showToast('Fehler beim Speichern', 'error');
                }
            },
            
            updatePreview() {
                const preview = document.getElementById('quotePreviewContent');
                const quote = this.quotes[0] || { text: 'Das Würfeln ist des Spielers Lust.', author: 'Unbekannter Roleplayer', source: 'Irgendwo im Keller' };
                
                const fontStyles = {
                    normal: '',
                    italic: 'font-style: italic;',
                    serif: 'font-family: Georgia, serif;',
                    handwritten: 'font-family: "Brush Script MT", cursive;'
                };
                
                const fontSizes = {
                    small: '16px',
                    medium: '18px',
                    large: '22px',
                    xlarge: '26px'
                };
                
                const quoteMarks = {
                    german: ['„', '"'],
                    english: ['"', '"'],
                    guillemets: ['«', '»'],
                    none: ['', '']
                };
                
                const marks = quoteMarks[this.settings.quoteMarks] || quoteMarks.german;
                const fontSize = fontSizes[this.settings.fontSize] || '18px';
                const fontStyle = fontStyles[this.settings.fontStyle] || '';
                const alignment = this.settings.alignment || 'center';
                
                let authorHtml = '';
                if (this.settings.showAuthor && quote.author) {
                    authorHtml = `— ${quote.author}`;
                    if (this.settings.showSource && quote.source) {
                        authorHtml += `, <em>${quote.source}</em>`;
                    }
                }
                
                preview.innerHTML = `
                    <p style="font-size: ${fontSize}; ${fontStyle} color: var(--text); margin-bottom: 12px; text-align: ${alignment};">
                        ${marks[0]}${quote.text}${marks[1]}
                    </p>
                    ${authorHtml ? `<p style="font-size: 14px; color: var(--text-muted); text-align: ${alignment};">${authorHtml}</p>` : ''}
                `;
            },
            
            updateStats() {
                const total = this.quotes.length;
                const active = this.quotes.filter(q => q.active !== false).length;
                const categories = [...new Set(this.quotes.map(q => q.category))].length;
                
                document.getElementById('statQuotesTotal').textContent = total;
                document.getElementById('statQuotesActive').textContent = active;
                document.getElementById('statQuotesCategories').textContent = categories;
                
                // Calculate today's quote
                const todayIndex = this.getTodayQuoteIndex();
                document.getElementById('statQuotesToday').textContent = total > 0 ? `#${todayIndex + 1}` : '—';
            },
            
            getTodayQuoteIndex() {
                if (this.quotes.length === 0) return 0;
                const activeQuotes = this.quotes.filter(q => q.active !== false);
                if (activeQuotes.length === 0) return 0;
                
                const today = new Date();
                const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
                return dayOfYear % activeQuotes.length;
            },
            
            updateCategoryFilter() {
                const select = document.getElementById('quoteCategoryFilter');
                const existingCategories = [...new Set(this.quotes.map(q => q.category))];
                
                select.innerHTML = '<option value="">Alle Kategorien</option>' +
                    existingCategories.map(catId => {
                        const cat = this.categories.find(c => c.id === catId) || { name: catId };
                        return `<option value="${catId}">${cat.name}</option>`;
                    }).join('');
            },
            
            updateFixedQuoteSelect() {
                const select = document.getElementById('quoteFixedId');
                select.innerHTML = '<option value="">Zitat auswählen...</option>' +
                    this.quotes.map(q => `<option value="${q.id}" ${this.settings.fixedQuoteId === q.id ? 'selected' : ''}>${this.truncate(q.text, 50)} — ${q.author}</option>`).join('');
            },
            
            filter() {
                const search = document.getElementById('quoteSearch').value.toLowerCase();
                const category = document.getElementById('quoteCategoryFilter').value;
                const status = document.getElementById('quoteStatusFilter').value;
                
                const rows = document.querySelectorAll('#quotesTableBody tr');
                
                this.quotes.forEach((quote, index) => {
                    const row = rows[index];
                    if (!row) return;
                    
                    const matchesSearch = !search || 
                        quote.text.toLowerCase().includes(search) || 
                        (quote.author && quote.author.toLowerCase().includes(search));
                    const matchesCategory = !category || quote.category === category;
                    const matchesStatus = !status || 
                        (status === 'active' && quote.active !== false) ||
                        (status === 'inactive' && quote.active === false);
                    
                    row.style.display = matchesSearch && matchesCategory && matchesStatus ? '' : 'none';
                });
            },
            
            openEditor(id = null) {
                this.editingId = id;
                const modal = document.getElementById('quoteModal');
                
                // Reset form
                document.getElementById('quoteId').value = '';
                document.getElementById('quoteText').value = '';
                document.getElementById('quoteAuthor').value = '';
                document.getElementById('quoteSource').value = '';
                document.getElementById('quoteYear').value = '';
                document.getElementById('quoteLanguage').value = 'de';
                document.getElementById('quoteCategory').value = 'wisdom';
                document.getElementById('quoteTags').value = '';
                document.getElementById('quoteLink').value = '';
                document.getElementById('quoteImageUrl').value = '';
                document.getElementById('quoteValidFrom').value = '';
                document.getElementById('quoteValidUntil').value = '';
                document.getElementById('quotePriority').value = '1';
                document.getElementById('quoteActive').checked = true;
                document.getElementById('quoteFeatured').checked = false;
                document.getElementById('quoteNewYear').checked = false;
                document.getElementById('quoteChristmas').checked = false;
                document.getElementById('quoteHalloween').checked = false;
                document.getElementById('quoteEaster').checked = false;
                document.getElementById('quoteValentine').checked = false;
                document.getElementById('customCategoryGroup').style.display = 'none';
                
                if (id) {
                    const quote = this.quotes.find(q => q.id === id);
                    if (quote) {
                        document.getElementById('quoteEditorTitle').textContent = 'Zitat bearbeiten';
                        document.getElementById('quoteId').value = quote.id;
                        document.getElementById('quoteText').value = quote.text || '';
                        document.getElementById('quoteAuthor').value = quote.author || '';
                        document.getElementById('quoteSource').value = quote.source || '';
                        document.getElementById('quoteYear').value = quote.year || '';
                        document.getElementById('quoteLanguage').value = quote.language || 'de';
                        document.getElementById('quoteCategory').value = quote.category || 'wisdom';
                        document.getElementById('quoteTags').value = (quote.tags || []).join(', ');
                        document.getElementById('quoteLink').value = quote.link || '';
                        document.getElementById('quoteImageUrl').value = quote.imageUrl || '';
                        document.getElementById('quoteValidFrom').value = quote.validFrom || '';
                        document.getElementById('quoteValidUntil').value = quote.validUntil || '';
                        document.getElementById('quotePriority').value = quote.priority || '1';
                        document.getElementById('quoteActive').checked = quote.active !== false;
                        document.getElementById('quoteFeatured').checked = quote.featured === true;
                        
                        // Special days
                        const specialDays = quote.specialDays || [];
                        document.getElementById('quoteNewYear').checked = specialDays.includes('newyear');
                        document.getElementById('quoteChristmas').checked = specialDays.includes('christmas');
                        document.getElementById('quoteHalloween').checked = specialDays.includes('halloween');
                        document.getElementById('quoteEaster').checked = specialDays.includes('easter');
                        document.getElementById('quoteValentine').checked = specialDays.includes('valentine');
                    }
                } else {
                    document.getElementById('quoteEditorTitle').textContent = 'Neues Zitat';
                }
                
                // Update char count
                this.updateCharCount();
                
                modal.classList.add('active');
            },
            
            closeEditor() {
                document.getElementById('quoteModal').classList.remove('active');
                this.editingId = null;
            },
            
            updateCharCount() {
                const text = document.getElementById('quoteText').value;
                document.getElementById('quoteCharCount').textContent = text.length;
            },
            
            async save() {
                const text = document.getElementById('quoteText').value.trim();
                const author = document.getElementById('quoteAuthor').value.trim();
                
                if (!text) {
                    showToast('Bitte gib ein Zitat ein', 'error');
                    return;
                }
                
                if (!author) {
                    showToast('Bitte gib einen Autor an', 'error');
                    return;
                }
                
                // Collect special days
                const specialDays = [];
                if (document.getElementById('quoteNewYear').checked) specialDays.push('newyear');
                if (document.getElementById('quoteChristmas').checked) specialDays.push('christmas');
                if (document.getElementById('quoteHalloween').checked) specialDays.push('halloween');
                if (document.getElementById('quoteEaster').checked) specialDays.push('easter');
                if (document.getElementById('quoteValentine').checked) specialDays.push('valentine');
                
                const data = {
                    text,
                    author,
                    source: document.getElementById('quoteSource').value.trim() || null,
                    year: document.getElementById('quoteYear').value.trim() || null,
                    language: document.getElementById('quoteLanguage').value,
                    category: document.getElementById('quoteCategory').value,
                    tags: document.getElementById('quoteTags').value.split(',').map(t => t.trim()).filter(t => t),
                    link: document.getElementById('quoteLink').value.trim() || null,
                    imageUrl: document.getElementById('quoteImageUrl').value.trim() || null,
                    validFrom: document.getElementById('quoteValidFrom').value || null,
                    validUntil: document.getElementById('quoteValidUntil').value || null,
                    priority: parseInt(document.getElementById('quotePriority').value),
                    active: document.getElementById('quoteActive').checked,
                    featured: document.getElementById('quoteFeatured').checked,
                    specialDays,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                try {
                    const id = document.getElementById('quoteId').value;
                    
                    if (id) {
                        await db.collection('hub_quotes').doc(id).update(data);
                        showToast('Zitat aktualisiert');
                    } else {
                        data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                        await db.collection('hub_quotes').add(data);
                        showToast('Zitat erstellt');
                    }
                    
                    this.closeEditor();
                    this.load();
                    
                } catch (error) {
                    console.error('Error saving quote:', error);
                    showToast('Fehler beim Speichern', 'error');
                }
            },
            
            async edit(id) {
                this.openEditor(id);
            },
            
            async duplicate(id) {
                const quote = this.quotes.find(q => q.id === id);
                if (!quote) return;
                
                try {
                    const newData = { ...quote };
                    delete newData.id;
                    newData.text = quote.text + ' (Kopie)';
                    newData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    newData.updatedAt = firebase.firestore.FieldValue.serverTimestamp();
                    
                    await db.collection('hub_quotes').add(newData);
                    showToast('Zitat dupliziert');
                    this.load();
                    
                } catch (error) {
                    console.error('Error duplicating quote:', error);
                    showToast('Fehler beim Duplizieren', 'error');
                }
            },
            
            async delete(id) {
                if (!confirm('Zitat wirklich löschen?')) return;
                
                try {
                    await db.collection('hub_quotes').doc(id).delete();
                    showToast('Zitat gelöscht');
                    this.load();
                    
                } catch (error) {
                    console.error('Error deleting quote:', error);
                    showToast('Fehler beim Löschen', 'error');
                }
            },
            
            toggleSelect(id) {
                const index = this.selectedIds.indexOf(id);
                if (index === -1) {
                    this.selectedIds.push(id);
                } else {
                    this.selectedIds.splice(index, 1);
                }
                this.updateSelectionUI();
            },
            
            toggleSelectAll() {
                const checkbox = document.getElementById('selectAllQuotes');
                if (checkbox.checked) {
                    this.selectedIds = this.quotes.map(q => q.id);
                } else {
                    this.selectedIds = [];
                }
                this.render();
                this.updateSelectionUI();
            },
            
            selectAll() {
                this.selectedIds = this.quotes.map(q => q.id);
                document.getElementById('selectAllQuotes').checked = true;
                this.render();
                this.updateSelectionUI();
            },
            
            updateSelectionUI() {
                const deleteBtn = document.getElementById('deleteSelectedBtn');
                deleteBtn.style.display = this.selectedIds.length > 0 ? 'inline-flex' : 'none';
                deleteBtn.textContent = `${this.selectedIds.length} löschen`;
            },
            
            async deleteSelected() {
                if (this.selectedIds.length === 0) return;
                if (!confirm(`${this.selectedIds.length} Zitate wirklich löschen?`)) return;
                
                try {
                    const batch = db.batch();
                    this.selectedIds.forEach(id => {
                        batch.delete(db.collection('hub_quotes').doc(id));
                    });
                    await batch.commit();
                    
                    showToast(`${this.selectedIds.length} Zitate gelöscht`);
                    this.selectedIds = [];
                    this.load();
                    
                } catch (error) {
                    console.error('Error deleting quotes:', error);
                    showToast('Fehler beim Löschen', 'error');
                }
            },
            
            importQuotes() {
                document.getElementById('importQuotesModal').classList.add('active');
                document.getElementById('importData').value = '';
                document.getElementById('importPreview').style.display = 'none';
            },
            
            closeImport() {
                document.getElementById('importQuotesModal').classList.remove('active');
            },
            
            previewImport() {
                const format = document.getElementById('importFormat').value;
                const data = document.getElementById('importData').value.trim();
                
                if (!data) {
                    showToast('Bitte Daten eingeben', 'error');
                    return;
                }
                
                let quotes = [];
                
                try {
                    if (format === 'json') {
                        quotes = JSON.parse(data);
                        if (!Array.isArray(quotes)) quotes = [quotes];
                    } else if (format === 'csv') {
                        const lines = data.split('\n');
                        const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
                        quotes = lines.slice(1).map(line => {
                            const values = line.split(',');
                            const quote = {};
                            headers.forEach((h, i) => {
                                quote[h] = values[i]?.trim() || '';
                            });
                            return quote;
                        });
                    } else {
                        const separator = document.getElementById('importSeparator').value || ' — ';
                        quotes = data.split('\n').filter(l => l.trim()).map(line => {
                            const parts = line.split(separator);
                            return {
                                text: parts[0]?.trim() || line,
                                author: parts[1]?.trim() || 'Unbekannt'
                            };
                        });
                    }
                    
                    document.getElementById('importCount').textContent = quotes.length;
                    document.getElementById('importPreviewList').innerHTML = quotes.slice(0, 5).map(q => `
                        <div style="padding: 8px 0; border-bottom: 1px solid var(--border);">
                            <div style="font-style: italic;">"${this.truncate(q.text, 60)}"</div>
                            <div style="font-size: 12px; color: var(--text-muted);">— ${q.author || 'Unbekannt'}</div>
                        </div>
                    `).join('') + (quotes.length > 5 ? `<p style="color: var(--text-muted); margin-top: 8px;">... und ${quotes.length - 5} weitere</p>` : '');
                    
                    document.getElementById('importPreview').style.display = 'block';
                    this.pendingImport = quotes;
                    
                } catch (error) {
                    console.error('Parse error:', error);
                    showToast('Fehler beim Parsen der Daten', 'error');
                }
            },
            
            async confirmImport() {
                if (!this.pendingImport || this.pendingImport.length === 0) {
                    showToast('Bitte erst Vorschau anzeigen', 'error');
                    return;
                }
                
                try {
                    const batch = db.batch();
                    
                    this.pendingImport.forEach(quote => {
                        const ref = db.collection('hub_quotes').doc();
                        batch.set(ref, {
                            text: quote.text || '',
                            author: quote.author || 'Unbekannt',
                            source: quote.source || null,
                            category: quote.category || 'wisdom',
                            active: true,
                            priority: 1,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    });
                    
                    await batch.commit();
                    
                    showToast(`${this.pendingImport.length} Zitate importiert`);
                    this.pendingImport = null;
                    this.closeImport();
                    this.load();
                    
                } catch (error) {
                    console.error('Import error:', error);
                    showToast('Fehler beim Import', 'error');
                }
            },
            
            exportQuotes() {
                const data = this.quotes.map(q => ({
                    text: q.text,
                    author: q.author,
                    source: q.source,
                    category: q.category,
                    tags: q.tags,
                    year: q.year
                }));
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'rift-quotes-export.json';
                a.click();
                URL.revokeObjectURL(url);
                
                showToast('Export gestartet');
            },
            
            truncate(text, length) {
                if (!text) return '';
                return text.length > length ? text.substring(0, length) + '...' : text;
            }
        };
        
        // ========================================
        // TOKEN LIBRARY ADMIN MODULE
        // ========================================
        const TokenLibraryAdmin = {
            tokens: [],
            editingKey: null,
            _pendingColor: '#ef4444',
            _pendingBorder: '#ef4444',
            _pendingImg: null,
            _colors: ['#ef4444', '#f97316', '#eab308', '#22c55e', '#3b82f6', '#8b5cf6', '#ec4899', '#6b7280', '#f59e0b'],
            
            async load() {
                const grid = document.getElementById('tokenLibAdminGrid');
                const empty = document.getElementById('tokenLibAdminEmpty');
                if (!grid) return;
                
                try {
                    const doc = await firebase.firestore().collection('admin').doc('token_library').get();
                    const data = doc.exists ? (doc.data().tokens || {}) : {};
                    this.tokens = Object.keys(data).map(k => ({ ...data[k], _key: k }));
                    
                    if (this.tokens.length === 0) {
                        grid.innerHTML = '';
                        empty.textContent = 'Noch keine Tokens in der Library. Klicke "Token hinzufügen" um zu starten.';
                        empty.style.display = 'block';
                        return;
                    }
                    empty.style.display = 'none';
                    
                    const typeColors = { player: 'var(--accent)', npc: 'var(--blue)', monster: 'var(--red)', hidden: 'var(--text-muted)' };
                    const sizeLabels = { '44': 'S', '70': 'M', '140': 'L', '210': 'XL', '280': 'XXL' };
                    
                    grid.innerHTML = this.tokens.map((t, i) => {
                        const tc = typeColors[t.type || 'monster'] || 'var(--red)';
                        return `<div style="display:flex;align-items:center;gap:12px;padding:12px;background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius);transition:all 0.15s" onmouseenter="this.style.borderColor='var(--border-accent)'" onmouseleave="this.style.borderColor='var(--border)'">
                            <div style="width:40px;height:40px;border-radius:50%;background:${t.img ? 'transparent' : (t.color || tc)};border:2px solid ${t.borderColor || tc};display:flex;align-items:center;justify-content:center;font-weight:700;font-size:15px;color:white;overflow:hidden;flex-shrink:0">
                                ${t.img ? `<img src="${t.img}" style="width:100%;height:100%;object-fit:cover">` : (t.name || '?').charAt(0).toUpperCase()}
                            </div>
                            <div style="flex:1;min-width:0">
                                <div style="font-weight:600;font-size:14px">${t.name || 'Token'}</div>
                                <div style="font-size:12px;color:var(--text-muted);display:flex;gap:8px;flex-wrap:wrap;margin-top:2px">
                                    <span>${(t.type || 'monster').toUpperCase()}</span>
                                    ${t.maxHp ? `<span>HP ${t.hp || 0}/${t.maxHp}</span>` : ''}
                                    ${t.ac ? `<span>AC ${t.ac}</span>` : ''}
                                    ${t.speed ? `<span>Speed ${t.speed}</span>` : ''}
                                    <span>${sizeLabels[String(t.size)] || 'M'}</span>
                                </div>
                            </div>
                            <div style="display:flex;gap:6px">
                                <button class="btn btn--secondary" style="padding:6px 10px;font-size:12px" onclick="TokenLibraryAdmin.edit(${i})">Bearbeiten</button>
                                <button class="btn btn--secondary" style="padding:6px 10px;font-size:12px;color:var(--red)" onclick="TokenLibraryAdmin.remove(${i})">Löschen</button>
                            </div>
                        </div>`;
                    }).join('');
                } catch(err) {
                    empty.textContent = 'Fehler beim Laden: ' + err.message;
                    empty.style.display = 'block';
                }
            },
            
            _initModal() {
                const typeStyles = { player: {bg:'rgba(139,92,246,0.2)',bc:'rgba(139,92,246,0.5)'}, npc: {bg:'rgba(59,130,246,0.15)',bc:'rgba(59,130,246,0.4)'}, monster: {bg:'rgba(239,68,68,0.15)',bc:'rgba(239,68,68,0.4)'}, hidden: {bg:'rgba(107,114,128,0.2)',bc:'rgba(107,114,128,0.4)'} };
                const inactiveStyle = 'background:rgba(255,255,255,0.03);border-color:rgba(255,255,255,0.1);color:rgba(255,255,255,0.5)';
                
                // Type buttons
                document.querySelectorAll('#tlTypeButtons .tl-type-btn').forEach(btn => {
                    btn.onclick = () => {
                        document.querySelectorAll('#tlTypeButtons .tl-type-btn').forEach(b => {
                            b.classList.remove('active');
                            b.style.cssText = b.style.cssText.replace(/background:[^;]+;border-color:[^;]+;color:[^;]+/, '') + ';' + inactiveStyle;
                        });
                        btn.classList.add('active');
                        const s = typeStyles[btn.dataset.type] || typeStyles.monster;
                        btn.style.background = s.bg;
                        btn.style.borderColor = s.bc;
                        btn.style.color = 'white';
                    };
                });
                
                // Color pickers
                this._buildColorPicker('tlColorPicker', '_pendingColor');
                this._buildColorPicker('tlBorderPicker', '_pendingBorder');
                
                // Portrait upload
                this._pendingImg = null;
                const preview = document.getElementById('tlPortraitPreview');
                preview.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.4)" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>';
                preview.style.borderColor = this._pendingBorder;
                preview.style.background = 'rgba(255,255,255,0.1)';
                
                document.getElementById('tlPortraitInput').onchange = e => {
                    const file = e.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = ev => {
                        this._pendingImg = ev.target.result;
                        preview.innerHTML = `<img src="${ev.target.result}" style="width:100%;height:100%;object-fit:cover">`;
                    };
                    reader.readAsDataURL(file);
                    e.target.value = '';
                };
                
                // Size preset buttons
                document.querySelectorAll('#tlSizePresets .tl-size-btn').forEach(btn => {
                    btn.onclick = () => {
                        document.querySelectorAll('#tlSizePresets .tl-size-btn').forEach(b => {
                            b.classList.remove('active');
                            b.style.background = 'rgba(255,255,255,0.03)';
                            b.style.borderColor = 'rgba(255,255,255,0.1)';
                            b.style.color = 'rgba(255,255,255,0.5)';
                        });
                        btn.classList.add('active');
                        btn.style.background = 'rgba(139,92,246,0.2)';
                        btn.style.borderColor = 'rgba(139,92,246,0.5)';
                        btn.style.color = 'white';
                    };
                });
                
                // Visibility toggles
                ['tlAffVis', 'tlItemsVis'].forEach(id => {
                    const el = document.getElementById(id);
                    el.onclick = e => {
                        e.preventDefault();
                        e.stopPropagation();
                        el.classList.toggle('visible');
                        el.style.color = el.classList.contains('visible') ? '#22c55e' : 'rgba(255,255,255,0.3)';
                    };
                });
                
                // Img URL change updates preview
                document.getElementById('tlImg').addEventListener('input', e => {
                    const url = e.target.value.trim();
                    if (url && !this._pendingImg) {
                        preview.innerHTML = `<img src="${url}" style="width:100%;height:100%;object-fit:cover" onerror="this.style.display='none'">`;
                    }
                });
            },
            
            _buildColorPicker(containerId, propName) {
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                this._colors.forEach(c => {
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.style.cssText = `width:28px;height:28px;border-radius:50%;border:3px solid ${c === this[propName] ? 'white' : 'transparent'};background:${c};cursor:pointer;padding:0`;
                    btn.onclick = () => {
                        this[propName] = c;
                        container.querySelectorAll('button').forEach(b => b.style.borderColor = 'transparent');
                        btn.style.borderColor = 'white';
                        if (propName === '_pendingBorder') {
                            document.getElementById('tlPortraitPreview').style.borderColor = c;
                        }
                    };
                    container.appendChild(btn);
                });
            },
            
            _setType(type) {
                const typeStyles = { player: {bg:'rgba(139,92,246,0.2)',bc:'rgba(139,92,246,0.5)'}, npc: {bg:'rgba(59,130,246,0.15)',bc:'rgba(59,130,246,0.4)'}, monster: {bg:'rgba(239,68,68,0.15)',bc:'rgba(239,68,68,0.4)'}, hidden: {bg:'rgba(107,114,128,0.2)',bc:'rgba(107,114,128,0.4)'} };
                document.querySelectorAll('#tlTypeButtons .tl-type-btn').forEach(b => {
                    const isActive = b.dataset.type === type;
                    b.classList.toggle('active', isActive);
                    if (isActive) {
                        const s = typeStyles[type] || typeStyles.monster;
                        b.style.background = s.bg; b.style.borderColor = s.bc; b.style.color = 'white';
                    } else {
                        b.style.background = 'rgba(255,255,255,0.03)'; b.style.borderColor = 'rgba(255,255,255,0.1)'; b.style.color = 'rgba(255,255,255,0.5)';
                    }
                });
            },
            
            _setSize(size) {
                document.querySelectorAll('#tlSizePresets .tl-size-btn').forEach(b => {
                    const isActive = parseInt(b.dataset.size) === size;
                    b.classList.toggle('active', isActive);
                    b.style.background = isActive ? 'rgba(139,92,246,0.2)' : 'rgba(255,255,255,0.03)';
                    b.style.borderColor = isActive ? 'rgba(139,92,246,0.5)' : 'rgba(255,255,255,0.1)';
                    b.style.color = isActive ? 'white' : 'rgba(255,255,255,0.5)';
                });
            },
            
            showCreate() {
                this.editingKey = null;
                this._pendingColor = '#ef4444';
                this._pendingBorder = '#ef4444';
                this._pendingImg = null;
                document.getElementById('tokenLibModalTitle').textContent = 'Token erstellen';
                ['tlName','tlHp','tlMaxHp','tlAc','tlSpeed','tlRange','tlInit','tlImg','tlNotes','tlAffiliation','tlItems'].forEach(id => {
                    const el = document.getElementById(id); if (el) el.value = '';
                });
                this._initModal();
                this._setType('monster');
                this._setSize(70);
                // Reset vis toggles to visible
                ['tlAffVis','tlItemsVis'].forEach(id => { const el = document.getElementById(id); el.classList.add('visible'); el.style.color = '#22c55e'; });
                const modal = document.getElementById('tokenLibModal');
                modal.style.display = 'flex';
                modal.onclick = e => { if (e.target === modal) this.hideModal(); };
            },
            
            edit(idx) {
                const t = this.tokens[idx];
                if (!t) return;
                this.editingKey = t._key;
                this._pendingColor = t.color || '#ef4444';
                this._pendingBorder = t.borderColor || '#ef4444';
                this._pendingImg = t.img || null;
                document.getElementById('tokenLibModalTitle').textContent = 'Token bearbeiten: ' + (t.name || '');
                document.getElementById('tlName').value = t.name || '';
                document.getElementById('tlHp').value = t.hp || '';
                document.getElementById('tlMaxHp').value = t.maxHp || '';
                document.getElementById('tlAc').value = t.ac || '';
                document.getElementById('tlSpeed').value = t.speed || '';
                document.getElementById('tlRange').value = t.range || '';
                document.getElementById('tlInit').value = t.initiative ?? '';
                document.getElementById('tlImg').value = (t.img && !t.img.startsWith('data:')) ? t.img : '';
                document.getElementById('tlNotes').value = t.notes || '';
                document.getElementById('tlAffiliation').value = t.affiliation || '';
                document.getElementById('tlItems').value = t.items || '';
                
                this._initModal();
                this._setType(t.type || 'monster');
                this._setSize(t.size || 70);
                
                // Update color picker highlights
                document.querySelectorAll('#tlColorPicker button').forEach(b => {
                    b.style.borderColor = b.style.backgroundColor === this._pendingColor ? 'white' : 'transparent';
                });
                document.querySelectorAll('#tlBorderPicker button').forEach(b => {
                    b.style.borderColor = b.style.backgroundColor === this._pendingBorder ? 'white' : 'transparent';
                });
                
                // Update portrait preview
                const preview = document.getElementById('tlPortraitPreview');
                preview.style.borderColor = this._pendingBorder;
                if (t.img) {
                    preview.innerHTML = `<img src="${t.img}" style="width:100%;height:100%;object-fit:cover">`;
                    preview.style.background = 'transparent';
                } else {
                    preview.style.background = t.color || '#ef4444';
                    preview.innerHTML = '';
                }
                
                // Vis toggles
                const affVis = document.getElementById('tlAffVis');
                affVis.classList.toggle('visible', t.affVisible !== false);
                affVis.style.color = t.affVisible !== false ? '#22c55e' : 'rgba(255,255,255,0.3)';
                const itemsVis = document.getElementById('tlItemsVis');
                itemsVis.classList.toggle('visible', t.itemsVisible !== false);
                itemsVis.style.color = t.itemsVisible !== false ? '#22c55e' : 'rgba(255,255,255,0.3)';
                
                document.getElementById('tokenLibModal').style.display = 'flex';
            },
            
            hideModal() {
                document.getElementById('tokenLibModal').style.display = 'none';
            },
            
            async save() {
                const activeType = document.querySelector('#tlTypeButtons .tl-type-btn.active');
                const activeSize = document.querySelector('#tlSizePresets .tl-size-btn.active');
                const imgUrl = document.getElementById('tlImg').value.trim();
                
                const token = {
                    name: document.getElementById('tlName').value.trim(),
                    type: activeType?.dataset.type || 'monster',
                    size: activeSize ? parseInt(activeSize.dataset.size) : 70,
                    hp: parseInt(document.getElementById('tlHp').value) || 0,
                    maxHp: parseInt(document.getElementById('tlMaxHp').value) || 0,
                    ac: parseInt(document.getElementById('tlAc').value) || 0,
                    speed: parseInt(document.getElementById('tlSpeed').value) || 6,
                    range: parseInt(document.getElementById('tlRange').value) || 1,
                    initiative: document.getElementById('tlInit').value ? parseInt(document.getElementById('tlInit').value) : null,
                    color: this._pendingColor || '#ef4444',
                    borderColor: this._pendingBorder || '#ef4444',
                    img: this._pendingImg || imgUrl || null,
                    notes: document.getElementById('tlNotes').value.trim(),
                    affiliation: document.getElementById('tlAffiliation').value.trim(),
                    items: document.getElementById('tlItems').value.trim(),
                    affVisible: document.getElementById('tlAffVis').classList.contains('visible'),
                    itemsVisible: document.getElementById('tlItemsVis').classList.contains('visible'),
                    updatedAt: Date.now()
                };
                
                if (!token.name) { alert('Name ist erforderlich'); return; }
                
                try {
                    if (this.editingKey) {
                        await firebase.firestore().collection('admin').doc('token_library').set({
                            tokens: { [this.editingKey]: token }
                        }, { merge: true });
                    } else {
                        const key = 'tok_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);
                        await firebase.firestore().collection('admin').doc('token_library').set({
                            tokens: { [key]: token }
                        }, { merge: true });
                    }
                    this.hideModal();
                    this.load();
                } catch(err) {
                    alert('Fehler beim Speichern: ' + err.message);
                }
            },
            
            async remove(idx) {
                const t = this.tokens[idx];
                if (!t || !confirm('Token "' + (t.name || '') + '" aus der Library löschen?')) return;
                try {
                    await firebase.firestore().collection('admin').doc('token_library').update({
                        ['tokens.' + t._key]: firebase.firestore.FieldValue.delete()
                    });
                    this.load();
                } catch(err) {
                    alert('Fehler: ' + err.message);
                }
            }
        };
        
        // ═══════════════════════════════════════════════════
        // FOKUS-KATALOG ADMIN
        // ═══════════════════════════════════════════════════
        const FokusAdmin = {
            data: {},          // { fire: { meta: {...}, attacks: [...], defenses: [...] }, ... }
            currentCategory: 'element',
            currentStyle: null,
            editingAbility: null, // { type: 'attacks'|'defenses', index: number }
            dirty: false,
            
            CATEGORIES: {
                element: ['fire','lightning','water','wind','shadow','earth','poison','space','time','illusion','sound'],
                weapon: [],
                support: []
            },
            
            async load() {
                // Try loading from Firestore first
                try {
                    const snap = await firebase.firestore().collection('config').doc('fokusKatalog').get();
                    if (snap.exists && snap.data()?.fire) {
                        this.data = snap.data();
                        console.log('[FokusAdmin] Loaded from Firestore');
                    }
                } catch(e) {
                    console.warn('[FokusAdmin] Firestore load failed:', e);
                }
                
                // Load seed data (ability definitions from sheet)
                let seedData = {};
                try {
                    const res = await fetch('/assets/js/fokus-data.json');
                    if (res.ok) seedData = await res.json();
                } catch(e) { console.warn('[FokusAdmin] fokus-data.json load failed'); }
                
                // Load description overlays
                let descData = {};
                try {
                    const res = await fetch('/assets/js/fokus-descriptions.json');
                    if (res.ok) descData = await res.json();
                } catch(e) { /* optional */ }
                
                this.ensureDefaults(seedData, descData);
                this.updateCounts();
                this.switchCategory('element');
            },
            
            ensureDefaults(seedData, descData) {
                const ELEMENT_DEFAULTS = {
                    fire: { name: 'Feuer', icon: 'icon_focus_fire.png', color: '#ff6b35', mainAttr: 'KRF' },
                    lightning: { name: 'Blitz', icon: 'icon_focus_lightning.png', color: '#ffd93d', mainAttr: 'KRF' },
                    water: { name: 'Wasser', icon: 'icon_focus_water.png', color: '#4dabf7', mainAttr: 'GES' },
                    wind: { name: 'Wind', icon: 'icon_focus_wind.png', color: '#69db7c', mainAttr: 'GES' },
                    shadow: { name: 'Schatten', icon: 'icon_focus_shadow.png', color: '#4a4a6a', mainAttr: 'GES' },
                    earth: { name: 'Erde', icon: 'icon_focus_earth.png', color: '#a9845b', mainAttr: 'ZÄH' },
                    poison: { name: 'Gift', icon: 'icon_focus_poison.png', color: '#7cb342', mainAttr: 'ZÄH' },
                    space: { name: 'Raum', icon: 'icon_focus_room.png', color: '#9775fa', mainAttr: 'VER' },
                    time: { name: 'Zeit', icon: 'icon_focus_time.png', color: '#d4a574', mainAttr: 'VER' },
                    illusion: { name: 'Illusion', icon: 'icon_focus_illusion.png', color: '#f06595', mainAttr: 'PRÄ' },
                    sound: { name: 'Schall', icon: 'icon_focus_sound.png', color: '#26c6da', mainAttr: 'PRÄ' }
                };
                
                const mapAbility = (a, fallbackAttr) => ({
                    name: a.name || '', attr: a.attr || fallbackAttr, dice: a.dice || 'd8',
                    range: parseInt(a.range) || 1, status: a.status || '', desc: a.desc || '',
                    detail: '', battlemap: '', gm: '', pictogram: ''
                });
                
                for (const [key, meta] of Object.entries(ELEMENT_DEFAULTS)) {
                    if (!this.data[key]) {
                        const seed = seedData?.[key];
                        this.data[key] = {
                            meta: seed ? { name: seed.name || meta.name, icon: seed.icon || meta.icon, color: seed.color || meta.color, mainAttr: seed.mainAttr || meta.mainAttr } : meta,
                            category: 'element',
                            attacks: seed?.attacks?.length ? seed.attacks.map(a => mapAbility(a, meta.mainAttr)) : this.createEmptyAbilities(10),
                            defenses: seed?.defenses?.length ? seed.defenses.map(a => mapAbility(a, meta.mainAttr)) : this.createEmptyAbilities(10)
                        };
                    }
                    // Merge description overlays
                    if (descData?.[key]) {
                        for (const arr of ['attacks', 'defenses']) {
                            (this.data[key]?.[arr] || []).forEach(ab => {
                                const d = descData[key]?.[ab.name];
                                if (d) {
                                    if (d.detail) ab.detail = d.detail;
                                    if (d.battlemap) ab.battlemap = d.battlemap;
                                    if (d.gm) ab.gm = d.gm;
                                }
                            });
                        }
                    }
                }
                console.log('[FokusAdmin] Defaults ensured:', Object.keys(this.data).length, 'styles');
            },
            
            createEmptyAbilities(n) {
                return Array.from({length: n}, () => ({
                    name: '', attr: 'KRF', dice: 'd8', range: 1, status: '', desc: '',
                    detail: '', battlemap: '', gm: '', pictogram: ''
                }));
            },
            
            updateCounts() {
                for (const [cat, keys] of Object.entries(this.CATEGORIES)) {
                    const el = document.getElementById(`fk-count-${cat}`);
                    if (el) el.textContent = keys.filter(k => this.data[k]).length;
                }
            },
            
            switchCategory(cat) {
                this.currentCategory = cat;
                this.currentStyle = null;
                
                // Update tab styles
                document.querySelectorAll('.fk-cat-tab').forEach(t => {
                    const isCat = t.dataset.cat === cat;
                    t.style.color = isCat ? 'var(--text)' : 'var(--text-muted)';
                    t.style.borderBottomColor = isCat ? 'var(--accent)' : 'transparent';
                    if (isCat) t.classList.add('active'); else t.classList.remove('active');
                });
                
                this.renderStyleList();
                document.getElementById('fk-style-header').style.display = 'none';
                document.getElementById('fk-abilities-area').innerHTML = '<div style="text-align:center;padding:40px;color:var(--text-muted)">Stil auswählen</div>';
            },
            
            renderStyleList() {
                const keys = this.CATEGORIES[this.currentCategory] || [];
                const list = document.getElementById('fk-style-list');
                if (!list) return;
                
                let html = '';
                for (const key of keys) {
                    const d = this.data[key];
                    if (!d) continue;
                    const meta = d.meta || {};
                    const isActive = this.currentStyle === key;
                    const filledCount = [...(d.attacks||[]), ...(d.defenses||[])].filter(a => a.name).length;
                    const c = meta.color || '#888';
                    const borderCol = isActive ? c + '40' : 'rgba(255,255,255,0.06)';
                    const bgCol = isActive ? c + '12' : 'transparent';
                    const textCol = isActive ? c : '#e5e5e5';
                    const fw = isActive ? '600' : '400';
                    
                    html += '<button onclick="FokusAdmin.selectStyle(\'' + key + '\')" style="display:flex;align-items:center;gap:10px;padding:8px 10px;border-radius:8px;border:1px solid ' + borderCol + ';background:' + bgCol + ';color:' + textCol + ';cursor:pointer;text-align:left;width:100%;font-size:13px;">' +
                        '<img src="/assets/icons/' + (meta.icon || '') + '" alt="" style="width:20px;height:20px" onerror="this.style.display=\'none\'">' +
                        '<span style="flex:1;font-weight:' + fw + '">' + (meta.name || key) + '</span>' +
                        '<span style="font-size:10px;opacity:0.5">' + filledCount + '/20</span>' +
                        '</button>';
                }
                list.innerHTML = html;
            },
            
            selectStyle(key) {
                this.currentStyle = key;
                this.renderStyleList();
                this.renderStyleHeader();
                this.renderAbilities();
            },
            
            renderStyleHeader() {
                const d = this.data[this.currentStyle];
                if (!d) return;
                const m = d.meta || {};
                
                document.getElementById('fk-style-header').style.display = 'block';
                document.getElementById('fk-style-name').value = m.name || '';
                document.getElementById('fk-style-mainAttr').value = m.mainAttr || '';
                document.getElementById('fk-style-icon').value = m.icon || '';
                document.getElementById('fk-style-color').value = m.color || '#ff6b35';
                
                const iconPreview = document.getElementById('fk-style-icon-preview');
                if (m.icon) {
                    iconPreview.innerHTML = `<img src="/assets/icons/${m.icon}" style="width:28px;height:28px">`;
                    iconPreview.style.background = (m.color || '#fff') + '15';
                }
                
                // Bind meta changes
                ['fk-style-name','fk-style-mainAttr','fk-style-icon','fk-style-color'].forEach(id => {
                    const el = document.getElementById(id);
                    el.onchange = () => {
                        const d = this.data[this.currentStyle];
                        if (!d) return;
                        d.meta.name = document.getElementById('fk-style-name').value;
                        d.meta.mainAttr = document.getElementById('fk-style-mainAttr').value;
                        d.meta.icon = document.getElementById('fk-style-icon').value;
                        d.meta.color = document.getElementById('fk-style-color').value;
                        this.dirty = true;
                        this.renderStyleList();
                    };
                });
            },
            
            renderAbilities() {
                const d = this.data[this.currentStyle];
                if (!d) return;
                const c = d.meta?.color || '#888';
                const area = document.getElementById('fk-abilities-area');
                
                const renderTable = (abilities, type) => {
                    return abilities.map((ab, i) => {
                        const filled = ab.name ? '' : 'opacity:0.3;';
                        const hasDesc = (ab.detail || ab.battlemap || ab.gm) ? `<span style="width:6px;height:6px;border-radius:50%;background:var(--green);display:inline-block;margin-left:4px" title="Beschreibungen vorhanden"></span>` : '';
                        const hasPicto = ab.pictogram ? `<img src="${ab.pictogram}" style="width:18px;height:18px;border-radius:3px">` : `<span style="width:18px;height:18px;border-radius:3px;background:var(--bg-input);display:inline-flex;align-items:center;justify-content:center;font-size:8px;color:var(--text-muted)">${i+1}</span>`;
                        
                        return `<tr style="${filled}cursor:pointer;transition:background 0.15s" onclick="FokusAdmin.editAbility('${type}', ${i})" onmouseover="this.style.background='rgba(255,255,255,0.03)'" onmouseout="this.style.background=''">
                            <td style="padding:6px 8px;width:30px;text-align:center">${hasPicto}</td>
                            <td style="padding:6px 8px;font-weight:600;color:${c}">${ab.name || '(leer)'}${hasDesc}</td>
                            <td style="padding:6px 8px;font-size:12px;color:var(--text-muted)">${ab.attr}</td>
                            <td style="padding:6px 8px;font-size:12px;font-family:monospace">${ab.dice}</td>
                            <td style="padding:6px 8px;font-size:12px;color:var(--text-muted)">RW ${ab.range}</td>
                            <td style="padding:6px 8px;font-size:11px;color:var(--text-muted)">${ab.status || '—'}</td>
                            <td style="padding:6px 8px;font-size:11px;color:var(--text-muted);max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${ab.desc || ''}</td>
                        </tr>`;
                    }).join('');
                };
                
                const tableStyle = 'width:100%;border-collapse:collapse;font-size:13px';
                const thStyle = 'padding:6px 8px;text-align:left;font-size:10px;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-muted);border-bottom:1px solid var(--border);font-weight:600';
                
                area.innerHTML = `
                    <div style="font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:${c};margin-bottom:8px;display:flex;align-items:center;gap:8px">
                        <span>Angriffe</span><span style="flex:1;height:1px;background:var(--border)"></span>
                        <button class="btn btn--outline" style="padding:4px 10px;font-size:11px" onclick="FokusAdmin.addAbility('attacks')">+ Hinzuf&uuml;gen</button>
                    </div>
                    <table style="${tableStyle}">
                        <thead><tr><th style="${thStyle}"></th><th style="${thStyle}">Name</th><th style="${thStyle}">Attr</th><th style="${thStyle}">W&uuml;rfel</th><th style="${thStyle}">RW</th><th style="${thStyle}">Status</th><th style="${thStyle}">Beschreibung</th></tr></thead>
                        <tbody>${renderTable(d.attacks || [], 'attacks')}</tbody>
                    </table>
                    
                    <div style="font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:${c};margin:20px 0 8px;display:flex;align-items:center;gap:8px">
                        <span>Verteidigung</span><span style="flex:1;height:1px;background:var(--border)"></span>
                        <button class="btn btn--outline" style="padding:4px 10px;font-size:11px" onclick="FokusAdmin.addAbility('defenses')">+ Hinzuf&uuml;gen</button>
                    </div>
                    <table style="${tableStyle}">
                        <thead><tr><th style="${thStyle}"></th><th style="${thStyle}">Name</th><th style="${thStyle}">Attr</th><th style="${thStyle}">W&uuml;rfel</th><th style="${thStyle}">RW</th><th style="${thStyle}">Status</th><th style="${thStyle}">Beschreibung</th></tr></thead>
                        <tbody>${renderTable(d.defenses || [], 'defenses')}</tbody>
                    </table>
                `;
            },
            
            editAbility(type, index) {
                const d = this.data[this.currentStyle];
                if (!d) return;
                const ab = d[type]?.[index];
                if (!ab) return;
                
                this.editingAbility = { type, index };
                
                document.getElementById('fk-ab-name').value = ab.name || '';
                document.getElementById('fk-ab-attr').value = ab.attr || 'KRF';
                document.getElementById('fk-ab-dice').value = ab.dice || 'd8';
                document.getElementById('fk-ab-range').value = ab.range || 1;
                document.getElementById('fk-ab-status').value = ab.status || '';
                document.getElementById('fk-ab-pictogram').value = ab.pictogram || '';
                document.getElementById('fk-ab-desc').value = ab.desc || '';
                document.getElementById('fk-ab-detail').value = ab.detail || '';
                document.getElementById('fk-ab-battlemap').value = ab.battlemap || '';
                document.getElementById('fk-ab-gm').value = ab.gm || '';
                
                // Pictogram preview
                const picto = document.getElementById('fk-ab-picto-preview');
                if (ab.pictogram) picto.innerHTML = `<img src="${ab.pictogram}" style="width:24px;height:24px">`;
                else picto.innerHTML = '<span style="font-size:9px;color:var(--text-muted)">24</span>';
                
                document.getElementById('fk-ab-pictogram').oninput = (e) => {
                    const v = e.target.value;
                    picto.innerHTML = v ? `<img src="${v}" style="width:24px;height:24px" onerror="this.style.display='none'">` : '<span style="font-size:9px;color:var(--text-muted)">24</span>';
                };
                
                document.getElementById('fk-modal-title').textContent = ab.name ? `${ab.name} bearbeiten` : 'Neue Fähigkeit';
                const modal = document.getElementById('fk-ability-modal');
                modal.style.display = 'flex';
            },
            
            closeModal() {
                document.getElementById('fk-ability-modal').style.display = 'none';
                this.editingAbility = null;
            },
            
            saveAbility() {
                if (!this.editingAbility || !this.currentStyle) return;
                const { type, index } = this.editingAbility;
                const d = this.data[this.currentStyle];
                if (!d || !d[type]) return;
                
                d[type][index] = {
                    name: document.getElementById('fk-ab-name').value.trim(),
                    attr: document.getElementById('fk-ab-attr').value,
                    dice: document.getElementById('fk-ab-dice').value,
                    range: parseInt(document.getElementById('fk-ab-range').value) || 1,
                    status: document.getElementById('fk-ab-status').value.trim(),
                    pictogram: document.getElementById('fk-ab-pictogram').value.trim(),
                    desc: document.getElementById('fk-ab-desc').value.trim(),
                    detail: document.getElementById('fk-ab-detail').value.trim(),
                    battlemap: document.getElementById('fk-ab-battlemap').value.trim(),
                    gm: document.getElementById('fk-ab-gm').value.trim()
                };
                
                this.dirty = true;
                this.closeModal();
                this.renderAbilities();
                this.renderStyleList();
            },
            
            addAbility(type) {
                const d = this.data[this.currentStyle];
                if (!d) return;
                if (!d[type]) d[type] = [];
                const newIndex = d[type].length;
                d[type].push({ name: '', attr: 'KRF', dice: 'd8', range: 1, status: '', desc: '', detail: '', battlemap: '', gm: '', pictogram: '' });
                this.editAbility(type, newIndex);
            },
            
            addStyle() {
                const key = prompt('Style-Key (z.B. "sword", "healer"):');
                if (!key || this.data[key]) return;
                const name = prompt('Anzeigename (z.B. "Schwert", "Heiler"):');
                if (!name) return;
                
                this.data[key] = {
                    meta: { name, icon: '', color: '#888888', mainAttr: 'KRF' },
                    category: this.currentCategory,
                    attacks: [],
                    defenses: []
                };
                
                if (!this.CATEGORIES[this.currentCategory].includes(key)) {
                    this.CATEGORIES[this.currentCategory].push(key);
                }
                
                this.dirty = true;
                this.updateCounts();
                this.renderStyleList();
                this.selectStyle(key);
            },
            
            async saveAll() {
                try {
                    await firebase.firestore().collection('config').doc('fokusKatalog').set(this.data);
                    this.dirty = false;
                    alert('Fokus-Katalog gespeichert!');
                } catch(e) {
                    alert('Fehler beim Speichern: ' + e.message);
                }
            },
            
            exportJSON() {
                // Export description-only JSON (for fokus-descriptions.json)
                const out = {};
                for (const [key, styleData] of Object.entries(this.data)) {
                    if (key.startsWith('_')) continue;
                    const styleDescs = {};
                    for (const arr of ['attacks', 'defenses']) {
                        (styleData[arr] || []).forEach(ab => {
                            if (ab.name && (ab.detail || ab.battlemap || ab.gm)) {
                                styleDescs[ab.name] = {};
                                if (ab.detail) styleDescs[ab.name].detail = ab.detail;
                                if (ab.battlemap) styleDescs[ab.name].battlemap = ab.battlemap;
                                if (ab.gm) styleDescs[ab.name].gm = ab.gm;
                            }
                        });
                    }
                    if (Object.keys(styleDescs).length) out[key] = styleDescs;
                }
                
                const blob = new Blob([JSON.stringify(out, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = 'fokus-descriptions.json'; a.click();
                URL.revokeObjectURL(url);
            }
        };
        
        // Quote text character counter
        document.getElementById('quoteText')?.addEventListener('input', () => QuotesAdmin.updateCharCount());
        
        // Category custom option
        document.getElementById('quoteCategory')?.addEventListener('change', (e) => {
            document.getElementById('customCategoryGroup').style.display = e.target.value === 'custom' ? 'block' : 'none';
        });
        
        // Import format change
        document.getElementById('importFormat')?.addEventListener('change', (e) => {
            document.getElementById('importTextOptions').style.display = e.target.value === 'text' ? 'block' : 'none';
        });
    </script>
    
    <!-- Admin Extended Modules -->
    <script src="/assets/js/admin-extended.js"></script>
</body>
</html>
