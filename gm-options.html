<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GM Optionen - RIFT</title>
    <script>(function(){var t=localStorage.getItem('pnp_theme')||'dark';document.documentElement.setAttribute('data-theme',t)})();</script>
    <link rel="icon" type="image/png" href="assets/images/logo_rift_emblem_white.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/global.css">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background: var(--md-background);
            color: var(--md-on-background);
            min-height: 100vh;
        }

        .gm-container {
            max-width: 800px;
            margin: 0 auto;
            padding: var(--space-lg);
            padding-top: 80px;
        }

        .gm-logo-link {
            display: block;
            text-align: center;
            margin-bottom: var(--space-lg);
        }

        .gm-logo {
            width: 120px;
            height: auto;
            opacity: 0.8;
            transition: opacity 200ms ease;
        }

        .gm-logo-link:hover .gm-logo {
            opacity: 1;
        }

        .logo-white { display: block; margin: 0 auto; }
        .logo-black { display: none; }
        [data-theme="light"] .logo-white { display: none; }
        [data-theme="light"] .logo-black { display: block; margin: 0 auto; }

        .gm-header {
            text-align: center;
            margin-bottom: var(--space-xl);
        }

        .gm-title {
            font-size: var(--headline-medium);
            font-weight: 600;
            color: var(--md-on-surface);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
        }

        .gm-title svg {
            width: 32px;
            height: 32px;
            color: #4CAF50;
        }

        .gm-subtitle {
            color: var(--md-on-surface-variant);
            margin-top: var(--space-xs);
        }

        /* Section Styling */
        .gm-section {
            background: var(--md-surface-container);
            border-radius: var(--shape-lg);
            margin-bottom: var(--space-lg);
            overflow: hidden;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md) var(--space-lg);
            background: var(--md-surface-container-high);
            border-bottom: 1px solid var(--md-outline-variant);
            cursor: pointer;
            transition: background 200ms ease;
        }

        .section-header:hover {
            background: var(--md-surface-container-highest);
        }

        .section-header svg {
            width: 20px;
            height: 20px;
            color: var(--md-primary);
            flex-shrink: 0;
        }

        .section-title {
            font-size: var(--title-small);
            font-weight: 600;
            color: var(--md-on-surface);
            flex: 1;
        }

        .section-arrow {
            width: 20px;
            height: 20px;
            color: var(--md-on-surface-variant);
            transition: transform 200ms ease;
        }

        .gm-section.collapsed .section-arrow {
            transform: rotate(-90deg);
        }

        .gm-section.collapsed .section-content {
            display: none;
        }

        .section-content {
            padding: var(--space-lg);
        }

        /* Player List */
        .player-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .player-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--md-surface-container-high);
            border-radius: var(--shape-md);
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            font-size: 16px;
            flex-shrink: 0;
            cursor: pointer;
            transition: transform 150ms ease;
        }

        .player-avatar:hover {
            transform: scale(1.1);
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-weight: 500;
            color: var(--md-on-surface);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .player-badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }

        .player-badge.gm {
            background: #4CAF50;
            color: white;
        }

        .player-badge.creator {
            background: var(--md-primary);
            color: white;
        }

        .player-status {
            font-size: var(--body-small);
            color: var(--md-on-surface-variant);
        }

        .player-actions {
            display: flex;
            gap: var(--space-xs);
        }

        .player-action-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: var(--md-surface-container);
            color: var(--md-on-surface-variant);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 200ms ease;
        }

        .player-action-btn:hover {
            background: var(--md-surface-container-highest);
            color: var(--md-on-surface);
        }

        .player-action-btn.danger:hover {
            background: var(--md-error-container);
            color: var(--md-error);
        }

        .player-action-btn svg {
            width: 18px;
            height: 18px;
        }

        /* Character List */
        .character-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .character-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--md-surface-container-high);
            border-radius: var(--shape-md);
        }

        .character-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            font-size: 16px;
            flex-shrink: 0;
        }

        .character-info {
            flex: 1;
        }

        .character-name {
            font-weight: 500;
            color: var(--md-on-surface);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .character-owner {
            font-size: var(--body-small);
            color: var(--md-on-surface-variant);
        }

        .character-owner-name {
            font-size: var(--body-small);
            color: var(--md-on-surface-variant);
            margin-bottom: 2px;
        }

        .character-actions {
            display: flex;
            gap: var(--space-xs);
        }

        /* Room Info */
        .room-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
        }

        .room-info-item {
            background: var(--md-surface-container-high);
            padding: var(--space-md);
            border-radius: var(--shape-md);
        }

        .room-info-label {
            font-size: var(--body-small);
            color: var(--md-on-surface-variant);
            margin-bottom: 4px;
        }

        .room-info-value {
            font-size: var(--title-medium);
            font-weight: 600;
            color: var(--md-on-surface);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .room-code-box {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--md-surface-container-high);
            border-radius: var(--shape-md);
            margin-bottom: var(--space-md);
        }

        .room-code {
            font-family: 'Roboto Mono', monospace;
            font-size: var(--headline-small);
            font-weight: 600;
            color: var(--md-primary);
            letter-spacing: 2px;
            flex: 1;
        }

        .copy-btn {
            padding: var(--space-sm) var(--space-md);
            background: var(--md-primary);
            color: var(--md-on-primary);
            border: none;
            border-radius: var(--shape-sm);
            font-weight: 500;
            cursor: pointer;
            transition: all 200ms ease;
        }

        .copy-btn:hover {
            filter: brightness(1.1);
        }

        /* QR Code */
        .qr-container {
            text-align: center;
            padding: var(--space-md);
            background: white;
            border-radius: var(--shape-md);
            display: inline-block;
        }

        .qr-container canvas {
            display: block;
        }

        /* Action Buttons */
        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: var(--space-md);
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md);
            background: var(--md-surface-container-high);
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--shape-md);
            color: var(--md-on-surface);
            cursor: pointer;
            transition: all 200ms ease;
            font-size: var(--body-medium);
            font-weight: 500;
        }

        .action-btn:hover {
            background: var(--md-surface-container-highest);
            border-color: var(--md-outline);
        }

        .action-btn svg {
            width: 20px;
            height: 20px;
            color: var(--md-primary);
            flex-shrink: 0;
        }

        .action-btn.danger {
            border-color: var(--md-error);
        }

        .action-btn.danger:hover {
            background: var(--md-error-container);
        }

        .action-btn.danger svg {
            color: var(--md-error);
        }

        /* Catalog Selector */
        .catalog-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .catalog-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--md-surface-container-high);
            border: 2px solid transparent;
            border-radius: var(--shape-md);
            cursor: pointer;
            transition: all 200ms ease;
        }

        .catalog-item:hover {
            background: var(--md-surface-container-highest);
        }

        .catalog-item.active {
            border-color: var(--md-primary);
            background: color-mix(in srgb, var(--md-primary) 10%, var(--md-surface-container-high));
        }

        .catalog-item img {
            width: 24px;
            height: 24px;
        }

        .catalog-item span {
            flex: 1;
            font-weight: 500;
        }

        .catalog-item .check {
            width: 20px;
            height: 20px;
            color: var(--md-primary);
            opacity: 0;
        }

        .catalog-item.active .check {
            opacity: 1;
        }

        /* Export Buttons */
        .export-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
        }

        .export-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-lg);
            background: var(--md-surface-container-high);
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--shape-md);
            cursor: pointer;
            transition: all 200ms ease;
        }

        .export-btn:hover {
            background: var(--md-surface-container-highest);
            border-color: var(--md-primary);
        }

        .export-btn svg {
            width: 32px;
            height: 32px;
            color: var(--md-primary);
        }

        .export-btn span {
            font-weight: 500;
            color: var(--md-on-surface);
        }

        /* Import Zone */
        .import-zone {
            margin-top: var(--space-sm);
        }

        .import-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-xl);
            background: var(--md-surface-container-high);
            border: 2px dashed var(--md-outline-variant);
            border-radius: var(--shape-md);
            cursor: pointer;
            transition: all 200ms ease;
            text-align: center;
        }

        .import-label:hover {
            border-color: var(--md-primary);
            background: var(--md-surface-container-highest);
        }

        .import-label svg {
            width: 32px;
            height: 32px;
            color: var(--md-primary);
        }

        .import-label span {
            font-weight: 500;
            color: var(--md-on-surface);
        }

        .import-label small {
            font-size: 12px;
            color: var(--md-on-surface-variant);
        }

        /* Danger Zone */
        .danger-zone {
            border: 1px solid var(--md-error);
            border-radius: var(--shape-md);
            padding: var(--space-lg);
            background: color-mix(in srgb, var(--md-error) 5%, var(--md-surface-container));
        }

        .danger-title {
            color: var(--md-error);
            font-weight: 600;
            margin-bottom: var(--space-sm);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .danger-title svg {
            width: 20px;
            height: 20px;
        }

        .danger-desc {
            color: var(--md-on-surface-variant);
            font-size: var(--body-small);
            margin-bottom: var(--space-md);
        }

        .danger-btn {
            background: var(--md-error);
            color: white;
            border: none;
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--shape-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 200ms ease;
        }

        .danger-btn:hover {
            filter: brightness(1.1);
        }

        /* Confirmation Dialog */
        .confirm-dialog-backdrop {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .confirm-dialog-backdrop.active {
            display: flex;
        }

        .confirm-dialog {
            background: var(--md-surface-container);
            border-radius: var(--shape-lg);
            padding: var(--space-xl);
            max-width: 400px;
            width: calc(100% - 32px);
            text-align: center;
        }

        .confirm-dialog h3 {
            margin-bottom: var(--space-md);
            color: var(--md-on-surface);
        }

        .confirm-dialog p {
            color: var(--md-on-surface-variant);
            margin-bottom: var(--space-lg);
        }

        .confirm-dialog-actions {
            display: flex;
            gap: var(--space-sm);
            justify-content: center;
        }

        .confirm-dialog-btn {
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--shape-sm);
            border: none;
            font-weight: 500;
            cursor: pointer;
        }

        .confirm-dialog-btn.cancel {
            background: var(--md-surface-container-high);
            color: var(--md-on-surface);
        }

        .confirm-dialog-btn.confirm {
            background: var(--md-error);
            color: white;
        }

        /* Edit Input */
        .edit-input {
            width: 100%;
            padding: var(--space-md);
            border: 1px solid var(--md-outline);
            border-radius: var(--shape-sm);
            background: var(--md-surface-container-high);
            color: var(--md-on-surface);
            font-size: var(--body-large);
            margin-bottom: var(--space-md);
        }

        .edit-input:focus {
            outline: none;
            border-color: var(--md-primary);
        }

        /* Color Picker Grid */
        .color-picker-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: var(--space-sm);
            margin-bottom: var(--space-md);
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 150ms ease;
        }

        .color-option:hover {
            transform: scale(1.15);
        }

        .color-option.selected {
            border-color: var(--md-on-surface);
        }

        /* Active Button State */
        .player-action-btn.active {
            background: #4CAF50;
            color: white;
        }

        .player-action-btn.active:hover {
            background: #43A047;
        }

        /* Back to Hub Button */
        .back-to-hub-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            width: 100%;
            padding: var(--space-md) var(--space-lg);
            margin-top: var(--space-xl);
            margin-bottom: var(--space-lg);
            background: var(--md-surface-container-high);
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--shape-md);
            color: var(--md-on-surface);
            text-decoration: none;
            font-weight: 500;
            transition: all 200ms ease;
        }

        .back-to-hub-btn:hover {
            background: var(--md-surface-container-highest);
            border-color: var(--md-primary);
            color: var(--md-primary);
        }

        .back-to-hub-btn svg {
            width: 20px;
            height: 20px;
        }

        /* No Access Message */
        .no-access {
            text-align: center;
            padding: var(--space-2xl);
        }

        .no-access svg {
            width: 64px;
            height: 64px;
            color: var(--md-error);
            margin-bottom: var(--space-md);
        }

        .no-access h2 {
            color: var(--md-on-surface);
            margin-bottom: var(--space-sm);
        }

        .no-access p {
            color: var(--md-on-surface-variant);
            margin-bottom: var(--space-lg);
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-lg);
            background: var(--md-primary);
            color: white;
            border: none;
            border-radius: var(--shape-sm);
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
        }

        /* Timer Controls */
        .timer-controls {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .timer-display-gm {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--space-lg);
            background: var(--md-surface-container-high);
            border-radius: var(--shape-md);
        }

        .timer-display-gm .timer-value {
            font-size: 48px;
            font-weight: 600;
            font-family: 'Roboto Mono', monospace;
            color: var(--md-primary);
        }

        .timer-display-gm .timer-status {
            font-size: 14px;
            color: var(--md-on-surface-variant);
            margin-top: var(--space-xs);
        }

        .timer-display-gm.running .timer-value {
            color: #4CAF50;
        }

        .timer-display-gm.paused .timer-value {
            color: #FF9800;
        }

        .timer-display-gm.expired .timer-value {
            color: #f44336;
            animation: timerBlink 0.5s ease infinite;
        }

        @keyframes timerBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .timer-input-row {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: var(--space-sm);
        }

        .timer-input-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .timer-input-group label {
            font-size: 12px;
            color: var(--md-on-surface-variant);
            text-align: center;
        }

        .timer-input-group input {
            width: 80px;
            padding: var(--space-sm) var(--space-md);
            font-size: 24px;
            font-weight: 500;
            text-align: center;
            background: var(--md-surface-container-high);
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--shape-sm);
            color: var(--md-on-surface);
        }

        .timer-input-group input:focus {
            outline: none;
            border-color: var(--md-primary);
        }

        .timer-separator {
            font-size: 32px;
            font-weight: 600;
            color: var(--md-on-surface-variant);
            padding-bottom: 8px;
        }

        .timer-presets {
            display: flex;
            justify-content: center;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }

        .timer-preset {
            padding: var(--space-xs) var(--space-md);
            background: var(--md-surface-container-high);
            border: 1px solid var(--md-outline-variant);
            border-radius: 20px;
            color: var(--md-on-surface);
            font-size: 14px;
            cursor: pointer;
            transition: all 200ms ease;
        }

        .timer-preset:hover {
            background: var(--md-primary);
            color: var(--md-on-primary);
            border-color: var(--md-primary);
        }

        .timer-actions {
            display: flex;
            justify-content: center;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }

        .timer-btn {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-sm) var(--space-lg);
            border: none;
            border-radius: var(--shape-sm);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 200ms ease;
        }

        .timer-btn svg {
            width: 18px;
            height: 18px;
        }

        .timer-btn-start {
            background: #4CAF50;
            color: white;
        }

        .timer-btn-start:hover {
            background: #43A047;
        }

        .timer-btn-pause {
            background: #FF9800;
            color: white;
        }

        .timer-btn-pause:hover {
            background: #F57C00;
        }

        .timer-btn-resume {
            background: #4CAF50;
            color: white;
        }

        .timer-btn-resume:hover {
            background: #43A047;
        }

        .timer-btn-stop {
            background: #f44336;
            color: white;
        }

        .timer-btn-stop:hover {
            background: #E53935;
        }

        /* Mobile */
        @media (max-width: 600px) {
            .gm-container {
                padding: var(--space-md);
                padding-top: 70px;
            }

            .section-content {
                padding: var(--space-md);
            }

            .player-item {
                flex-wrap: wrap;
            }

            .player-actions {
                width: 100%;
                justify-content: flex-end;
                margin-top: var(--space-sm);
            }

            .action-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="nav-placeholder"></div>

    <div class="gm-container" id="gmContainer">
        <!-- RIFT Logo - Back to Hub -->
        <a href="index.html" class="gm-logo-link">
            <img src="assets/images/logo_rift_white_400px.png" alt="RIFT" class="gm-logo logo-white">
            <img src="assets/images/logo_rift_black_400px.png" alt="RIFT" class="gm-logo logo-black">
        </a>

        <!-- Header -->
        <div class="gm-header">
            <h1 class="gm-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z"/>
                </svg>
                GM Optionen
            </h1>
            <p class="gm-subtitle">Raum- und Spielerverwaltung</p>
        </div>

        <!-- Room Info Section -->
        <div class="gm-section" id="sectionRoomInfo">
            <div class="section-header" onclick="toggleSection('sectionRoomInfo')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9 22 9 12 15 12 15 22"/>
                </svg>
                <span class="section-title">Raum-Info</span>
                <svg class="section-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"/>
                </svg>
            </div>
            <div class="section-content">
                <div class="room-code-box">
                    <div>
                        <div style="font-size: 12px; color: var(--md-on-surface-variant); margin-bottom: 4px;">Raum-Code</div>
                        <div class="room-code" id="roomCodeDisplay">-----</div>
                    </div>
                    <button class="copy-btn" onclick="copyRoomCode()">Kopieren</button>
                </div>
                
                <div class="room-info-grid">
                    <div class="room-info-item">
                        <div class="room-info-label">Erstellt am</div>
                        <div class="room-info-value" id="roomCreatedAt">-</div>
                    </div>
                    <div class="room-info-item">
                        <div class="room-info-label">Läuft ab in</div>
                        <div class="room-info-value" id="roomExpiresIn">-</div>
                    </div>
                    <div class="room-info-item">
                        <div class="room-info-label">Letzte Aktivität</div>
                        <div class="room-info-value" id="roomLastActivity">-</div>
                    </div>
                    <div class="room-info-item">
                        <div class="room-info-label">Spieler online</div>
                        <div class="room-info-value" id="roomPlayersOnline">0</div>
                    </div>
                    <div class="room-info-item">
                        <div class="room-info-label">Chat-Nachrichten</div>
                        <div class="room-info-value" id="roomChatCount">0</div>
                    </div>
                    <div class="room-info-item">
                        <div class="room-info-label">Würfelwürfe</div>
                        <div class="room-info-value" id="roomDiceCount">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Players Section -->
        <div class="gm-section" id="sectionPlayers">
            <div class="section-header" onclick="toggleSection('sectionPlayers')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                <span class="section-title">Spieler-Verwaltung</span>
                <svg class="section-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"/>
                </svg>
            </div>
            <div class="section-content">
                <div class="player-list" id="playerList">
                    <div style="text-align: center; color: var(--md-on-surface-variant); padding: var(--space-lg);">
                        Lade Spieler...
                    </div>
                </div>
            </div>
        </div>

        <!-- Characters Section -->
        <div class="gm-section" id="sectionCharacters">
            <div class="section-header" onclick="toggleSection('sectionCharacters')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="8.5" cy="7" r="4"/>
                    <path d="M20 8v6"/>
                    <path d="M23 11h-6"/>
                </svg>
                <span class="section-title">Charakterbögen</span>
                <svg class="section-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"/>
                </svg>
            </div>
            <div class="section-content">
                <div class="character-list" id="characterList">
                    <div style="text-align: center; color: var(--md-on-surface-variant); padding: var(--space-lg);">
                        Lade Charaktere...
                    </div>
                </div>
            </div>
        </div>

        <!-- Timer Section -->
        <div class="gm-section" id="sectionTimer">
            <div class="section-header" onclick="toggleSection('sectionTimer')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                </svg>
                <span class="section-title">Timer</span>
                <svg class="section-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"/>
                </svg>
            </div>
            <div class="section-content">
                <div class="timer-controls">
                    <div class="timer-display-gm" id="timerDisplayGM">
                        <span class="timer-value">00:00</span>
                        <span class="timer-status" id="timerStatusText">Kein Timer aktiv</span>
                    </div>
                    
                    <div class="timer-input-row">
                        <div class="timer-input-group">
                            <label>Minuten</label>
                            <input type="number" id="timerMinutes" value="5" min="0" max="60">
                        </div>
                        <span class="timer-separator">:</span>
                        <div class="timer-input-group">
                            <label>Sekunden</label>
                            <input type="number" id="timerSeconds" value="0" min="0" max="59">
                        </div>
                    </div>
                    
                    <div class="timer-presets">
                        <button class="timer-preset" onclick="setTimerPreset(1)">1 min</button>
                        <button class="timer-preset" onclick="setTimerPreset(3)">3 min</button>
                        <button class="timer-preset" onclick="setTimerPreset(5)">5 min</button>
                        <button class="timer-preset" onclick="setTimerPreset(10)">10 min</button>
                    </div>
                    
                    <div class="timer-actions">
                        <button class="timer-btn timer-btn-start" id="timerStartBtn" onclick="startTimer()">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <polygon points="5 3 19 12 5 21 5 3"/>
                            </svg>
                            Starten
                        </button>
                        <button class="timer-btn timer-btn-pause" id="timerPauseBtn" onclick="pauseTimer()" style="display: none;">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <rect x="6" y="4" width="4" height="16"/>
                                <rect x="14" y="4" width="4" height="16"/>
                            </svg>
                            Pause
                        </button>
                        <button class="timer-btn timer-btn-resume" id="timerResumeBtn" onclick="resumeTimer()" style="display: none;">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <polygon points="5 3 19 12 5 21 5 3"/>
                            </svg>
                            Fortsetzen
                        </button>
                        <button class="timer-btn timer-btn-stop" id="timerStopBtn" onclick="stopTimer()" style="display: none;">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <rect x="4" y="4" width="16" height="16" rx="2"/>
                            </svg>
                            Stoppen
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Catalog Section -->
        <div class="gm-section" id="sectionCatalog">
            <div class="section-header" onclick="toggleSection('sectionCatalog')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                </svg>
                <span class="section-title">Abenteuer-Katalog</span>
                <svg class="section-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"/>
                </svg>
            </div>
            <div class="section-content">
                <div class="catalog-list" id="catalogList">
                    <!-- Filled by JS -->
                </div>
            </div>
        </div>

        <!-- Clear Data Section -->
        <div class="gm-section" id="sectionClearData">
            <div class="section-header" onclick="toggleSection('sectionClearData')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
                <span class="section-title">Daten löschen</span>
                <svg class="section-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"/>
                </svg>
            </div>
            <div class="section-content">
                <div class="action-grid">
                    <button class="action-btn" onclick="confirmAction('clearChat', 'Chat leeren', 'Alle Chat-Nachrichten werden unwiderruflich gelöscht.')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                        Chat leeren
                    </button>
                    <button class="action-btn" onclick="confirmAction('clearDice', 'Würfelhistorie löschen', 'Alle Würfelergebnisse werden gelöscht.')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="2" width="20" height="20" rx="2"/>
                            <circle cx="8" cy="8" r="1.5" fill="currentColor"/>
                            <circle cx="16" cy="8" r="1.5" fill="currentColor"/>
                            <circle cx="8" cy="16" r="1.5" fill="currentColor"/>
                            <circle cx="16" cy="16" r="1.5" fill="currentColor"/>
                            <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
                        </svg>
                        Würfelhistorie
                    </button>
                    <button class="action-btn" onclick="confirmAction('clearWhiteboard', 'Whiteboard zurücksetzen', 'Das Whiteboard wird geleert.')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <path d="M3 9h18"/>
                        </svg>
                        Whiteboard
                    </button>
                    <button class="action-btn" onclick="confirmAction('clearMarkers', 'Karten-Marker löschen', 'Alle Marker auf der Karte werden entfernt.')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                            <circle cx="12" cy="10" r="3"/>
                        </svg>
                        Karten-Marker
                    </button>
                    <button class="action-btn" onclick="confirmAction('clearCharacters', 'Charakterbögen löschen', 'Alle Spieler-Charakterbögen werden gelöscht. Die Spieler müssen ihre Charaktere neu erstellen.')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="8.5" cy="7" r="4"/>
                            <path d="M20 8v6"/>
                            <path d="M23 11h-6"/>
                        </svg>
                        Charakterbögen
                    </button>
                    <button class="action-btn" onclick="confirmAction('clearNotes', 'Notizen löschen', 'Alle Session-Notizen werden gelöscht.')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <line x1="10" y1="9" x2="8" y2="9"/>
                        </svg>
                        Notizen
                    </button>
                </div>
            </div>
        </div>

        <!-- Export/Import Section -->
        <div class="gm-section" id="sectionExport">
            <div class="section-header" onclick="toggleSection('sectionExport')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                <span class="section-title">Export / Import</span>
                <svg class="section-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"/>
                </svg>
            </div>
            <div class="section-content">
                <h4 style="margin-bottom: var(--space-md); color: var(--md-on-surface-variant);">Export</h4>
                <div class="export-grid" style="margin-bottom: var(--space-lg);">
                    <button class="export-btn" onclick="exportChat()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                        <span>Chat exportieren</span>
                    </button>
                    <button class="export-btn" onclick="exportSession()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        <span>Session-Backup</span>
                    </button>
                </div>
                
                <h4 style="margin-bottom: var(--space-md); color: var(--md-on-surface-variant);">Import</h4>
                <div class="import-zone" id="importZone">
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImportFile(event)">
                    <label for="importFile" class="import-label">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        <span>Session-Backup importieren</span>
                        <small>JSON-Datei auswählen oder hier ablegen</small>
                    </label>
                </div>
            </div>
        </div>

        <!-- Danger Zone -->
        <div class="gm-section" id="sectionDanger">
            <div class="section-header" onclick="toggleSection('sectionDanger')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--md-error);">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                    <line x1="12" y1="9" x2="12" y2="13"/>
                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
                <span class="section-title" style="color: var(--md-error);">Gefahrenzone</span>
                <svg class="section-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"/>
                </svg>
            </div>
            <div class="section-content">
                <div class="danger-zone">
                    <div class="danger-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            <line x1="10" y1="11" x2="10" y2="17"/>
                            <line x1="14" y1="11" x2="14" y2="17"/>
                        </svg>
                        Raum löschen
                    </div>
                    <p class="danger-desc">
                        Der Raum und alle Daten (Chat, Würfel, Whiteboard, Marker) werden unwiderruflich gelöscht. Alle Spieler werden ausgeloggt.
                    </p>
                    <button class="danger-btn" onclick="confirmAction('deleteRoom', 'Raum löschen', 'Der Raum und ALLE Daten werden unwiderruflich gelöscht. Diese Aktion kann nicht rückgängig gemacht werden!')">
                        Raum endgültig löschen
                    </button>
                </div>
            </div>
        </div>

        <!-- Back to Hub Button -->
        <a href="index.html" class="back-to-hub-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
            Zurück zum Hub
        </a>
    </div>

    <!-- No Access View -->
    <div class="gm-container no-access" id="noAccessView" style="display: none;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>
        </svg>
        <h2>Kein Zugriff</h2>
        <p>Diese Seite ist nur für den Spielleiter (GM) zugänglich.</p>
        <a href="index.html" class="back-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
            Zurück zum Hub
        </a>
    </div>

    <!-- Confirmation Dialog -->
    <div class="confirm-dialog-backdrop" id="confirmDialog">
        <div class="confirm-dialog">
            <h3 id="confirmTitle">Bestätigung</h3>
            <p id="confirmMessage">Bist du sicher?</p>
            <div class="confirm-dialog-actions">
                <button class="confirm-dialog-btn cancel" onclick="closeConfirmDialog()">Abbrechen</button>
                <button class="confirm-dialog-btn confirm" id="confirmBtn" onclick="executeAction()">Bestätigen</button>
            </div>
        </div>
    </div>

    <!-- Name Edit Dialog -->
    <div class="confirm-dialog-backdrop" id="nameEditDialog">
        <div class="confirm-dialog">
            <h3>Name ändern</h3>
            <input type="text" id="nameEditInput" class="edit-input" placeholder="Neuer Name">
            <input type="hidden" id="nameEditOldUsername">
            <div class="confirm-dialog-actions">
                <button class="confirm-dialog-btn cancel" onclick="closeNameEditDialog()">Abbrechen</button>
                <button class="confirm-dialog-btn confirm" onclick="savePlayerName()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Color Picker Dialog -->
    <div class="confirm-dialog-backdrop" id="colorPickerDialog">
        <div class="confirm-dialog">
            <h3>Farbe ändern</h3>
            <div class="color-picker-grid" id="colorPickerGrid"></div>
            <input type="hidden" id="colorPickerUsername">
            <div class="confirm-dialog-actions">
                <button class="confirm-dialog-btn cancel" onclick="closeColorPickerDialog()">Abbrechen</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/firebase-sync.js"></script>
    <script src="assets/js/nav.js"></script>
    <script>
        // Global variables
        let user = null;
        let isGM = false;
        
        // Catalogs
        const CATALOGS = [
            { id: 'rum-und-rache', name: 'Rum & Rache', icon: 'assets/icons/icon_ruleset_rumundrache.svg' },
            { id: 'fantasy-classic', name: 'Fantasy Classic', icon: 'assets/icons/icon_ruleset_fantasy.svg' },
            { id: 'neon-abyss', name: 'Neon Abyss', icon: 'assets/icons/icon_ruleset_neon.svg' },
            { id: 'basis', name: 'Basis', icon: 'assets/icons/icon_ruleset_basis.svg' }
        ];

        let selectedCatalogId = localStorage.getItem('rift_active_catalog') || 'rum-und-rache';
        let pendingAction = null;

        // Check auth and GM status on DOM ready
        document.addEventListener('DOMContentLoaded', () => {
            // Direct localStorage check (avoid session timeout issues)
            const storedUser = localStorage.getItem('pnp_companion_user');
            console.log('[GM Options] Stored user:', storedUser);
            
            if (!storedUser) {
                console.log('[GM Options] No user in localStorage, redirecting');
                window.location.href = 'login.html';
                return;
            }
            
            try {
                user = JSON.parse(storedUser);
            } catch (e) {
                console.error('[GM Options] Failed to parse user:', e);
                window.location.href = 'login.html';
                return;
            }
            
            console.log('[GM Options] User check:', user);
            console.log('[GM Options] isGM value:', user?.isGM, 'type:', typeof user?.isGM);
            
            // Accept both boolean true and string "true"
            isGM = user?.isGM === true || user?.isGM === 'true';
            
            if (!user || !isGM) {
                console.log('[GM Options] Access denied - not GM');
                document.getElementById('gmContainer').style.display = 'none';
                document.getElementById('noAccessView').style.display = 'block';
                return;
            }
            
            console.log('[GM Options] Access granted - user is GM');
            
            // Initialize the page
            initGMOptions();
        });
        
        async function initGMOptions() {
            // Room code
            const room = getRoom();
            console.log('[GM Options] Room:', room);
            
            if (room && room.id) {
                document.getElementById('roomCodeDisplay').textContent = room.id;
            } else {
                console.warn('[GM Options] No room found!');
                document.getElementById('roomCodeDisplay').textContent = 'Kein Raum';
            }

            // Init Firebase
            try {
                const success = await initFirebase();
                console.log('[GM Options] Firebase init:', success);
                
                if (success) {
                    // Load data
                    loadRoomStats();
                    loadPlayers();
                    loadCharacters();
                    loadTimerState();
                }
            } catch (error) {
                console.error('[GM Options] Firebase init error:', error);
            }
            
            renderCatalogList();
        }

        // ===== TIMER FUNCTIONS =====
        let timerInterval = null;
        let currentTimerState = null;

        function setTimerPreset(minutes) {
            document.getElementById('timerMinutes').value = minutes;
            document.getElementById('timerSeconds').value = 0;
        }

        function loadTimerState() {
            if (!isFirebaseOnline()) return;
            
            getRef('timer').on('value', (snapshot) => {
                const timer = snapshot.val();
                currentTimerState = timer;
                updateTimerDisplay(timer);
            });
        }

        function updateTimerDisplay(timer) {
            const display = document.getElementById('timerDisplayGM');
            const valueEl = display.querySelector('.timer-value');
            const statusEl = document.getElementById('timerStatusText');
            const startBtn = document.getElementById('timerStartBtn');
            const pauseBtn = document.getElementById('timerPauseBtn');
            const resumeBtn = document.getElementById('timerResumeBtn');
            const stopBtn = document.getElementById('timerStopBtn');

            // Clear any existing interval
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }

            display.classList.remove('running', 'paused', 'expired');

            if (!timer || !timer.active) {
                valueEl.textContent = '00:00';
                statusEl.textContent = 'Kein Timer aktiv';
                startBtn.style.display = 'flex';
                pauseBtn.style.display = 'none';
                resumeBtn.style.display = 'none';
                stopBtn.style.display = 'none';
                return;
            }

            if (timer.paused) {
                display.classList.add('paused');
                const remaining = timer.remainingMs || 0;
                valueEl.textContent = formatTime(remaining);
                statusEl.textContent = 'Timer pausiert';
                startBtn.style.display = 'none';
                pauseBtn.style.display = 'none';
                resumeBtn.style.display = 'flex';
                stopBtn.style.display = 'flex';
                return;
            }

            // Timer is running
            display.classList.add('running');
            startBtn.style.display = 'none';
            pauseBtn.style.display = 'flex';
            resumeBtn.style.display = 'none';
            stopBtn.style.display = 'flex';
            statusEl.textContent = 'Timer läuft';

            // Update countdown
            const updateCountdown = () => {
                const now = Date.now();
                const remaining = timer.endTime - now;

                if (remaining <= 0) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    valueEl.textContent = '00:00';
                    statusEl.textContent = 'Zeit abgelaufen!';
                    display.classList.remove('running');
                    display.classList.add('expired');
                    return;
                }

                valueEl.textContent = formatTime(remaining);
            };

            updateCountdown();
            timerInterval = setInterval(updateCountdown, 100);
        }

        function formatTime(ms) {
            const totalSeconds = Math.ceil(ms / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        async function startTimer() {
            if (!isFirebaseOnline()) {
                alert('Firebase nicht verbunden!');
                return;
            }

            const minutes = parseInt(document.getElementById('timerMinutes').value) || 0;
            const seconds = parseInt(document.getElementById('timerSeconds').value) || 0;
            const totalMs = (minutes * 60 + seconds) * 1000;

            if (totalMs <= 0) {
                alert('Bitte gib eine Zeit ein!');
                return;
            }

            const endTime = Date.now() + totalMs;

            await getRef('timer').set({
                active: true,
                paused: false,
                endTime: endTime,
                totalMs: totalMs,
                startedBy: user.username,
                startedAt: firebase.database.ServerValue.TIMESTAMP
            });

            console.log('[Timer] Started for', minutes, 'min', seconds, 'sec');
        }

        async function pauseTimer() {
            if (!isFirebaseOnline() || !currentTimerState) return;

            const now = Date.now();
            const remaining = currentTimerState.endTime - now;

            await getRef('timer').update({
                paused: true,
                remainingMs: Math.max(0, remaining),
                pausedAt: firebase.database.ServerValue.TIMESTAMP
            });

            console.log('[Timer] Paused with', remaining, 'ms remaining');
        }

        async function resumeTimer() {
            if (!isFirebaseOnline() || !currentTimerState) return;

            const newEndTime = Date.now() + (currentTimerState.remainingMs || 0);

            await getRef('timer').update({
                paused: false,
                endTime: newEndTime,
                remainingMs: null,
                resumedAt: firebase.database.ServerValue.TIMESTAMP
            });

            console.log('[Timer] Resumed');
        }

        async function stopTimer() {
            if (!isFirebaseOnline()) return;

            await getRef('timer').remove();
            console.log('[Timer] Stopped');
        }

        // Toggle section
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            section.classList.toggle('collapsed');
        }

        // Copy room code
        function copyRoomCode() {
            const code = document.getElementById('roomCodeDisplay').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const btn = event.target;
                btn.textContent = 'Kopiert!';
                setTimeout(() => btn.textContent = 'Kopieren', 2000);
            });
        }

        // Load room stats
        async function loadRoomStats() {
            console.log('[GM Options] loadRoomStats called');
            try {
                // Meta info
                const metaSnap = await getRef('meta').once('value');
                const meta = metaSnap.val() || {};
                console.log('[GM Options] Meta:', meta);

                if (meta.createdAt) {
                    document.getElementById('roomCreatedAt').textContent = formatDate(meta.createdAt);
                }
                if (meta.lastActivity) {
                    document.getElementById('roomLastActivity').textContent = formatTimeAgo(meta.lastActivity);
                    
                    // Calculate expiry (7 days from last activity)
                    const expiryTime = meta.lastActivity + (168 * 60 * 60 * 1000);
                    const timeLeft = expiryTime - Date.now();
                    if (timeLeft > 0) {
                        const daysLeft = Math.floor(timeLeft / (24 * 60 * 60 * 1000));
                        const hoursLeft = Math.floor((timeLeft % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000));
                        if (daysLeft > 0) {
                            document.getElementById('roomExpiresIn').textContent = `${daysLeft} Tag${daysLeft > 1 ? 'e' : ''}`;
                        } else {
                            document.getElementById('roomExpiresIn').textContent = `${hoursLeft} Std.`;
                        }
                    } else {
                        document.getElementById('roomExpiresIn').textContent = 'Abgelaufen';
                    }
                }

                // Players count
                const playersSnap = await getRef('players').once('value');
                const players = playersSnap.val() || {};
                document.getElementById('roomPlayersOnline').textContent = Object.keys(players).length;

                // Chat count
                const chatSnap = await getRef('chat').once('value');
                const chat = chatSnap.val() || {};
                document.getElementById('roomChatCount').textContent = Object.keys(chat).length;

                // Dice count
                const diceSnap = await getRef('dice').once('value');
                const dice = diceSnap.val() || {};
                document.getElementById('roomDiceCount').textContent = Object.keys(dice).length;

            } catch (error) {
                console.error('Error loading room stats:', error);
            }
        }

        // Load players
        function loadPlayers() {
            console.log('[GM Options] loadPlayers called');
            
            // Try to load directly first
            getRef('players').once('value').then(snapshot => {
                const players = snapshot.val();
                console.log('[GM Options] Players loaded directly:', players);
                updatePlayerList(players);
            }).catch(err => {
                console.error('[GM Options] Error loading players:', err);
            });
            
            // Also listen for changes
            onPlayersChange((players) => {
                console.log('[GM Options] Players changed:', players);
                updatePlayerList(players);
            });
        }
        
        function updatePlayerList(players) {
            const list = document.getElementById('playerList');
            
            if (!players || Object.keys(players).length === 0) {
                list.innerHTML = '<div style="text-align: center; color: var(--md-on-surface-variant); padding: var(--space-lg);">Keine Spieler online</div>';
                return;
            }

            const currentUser = getCurrentUser();
            const sortedPlayers = Object.values(players).sort((a, b) => {
                if (a.isGM && !b.isGM) return -1;
                if (!a.isGM && b.isGM) return 1;
                return a.username.localeCompare(b.username);
            });

            list.innerHTML = sortedPlayers.map(player => {
                const isCurrentUser = player.username === currentUser?.username;
                const initial = player.username.charAt(0).toUpperCase();
                const escapedUsername = player.username.replace(/'/g, "\\'");
                    
                return `
                    <div class="player-item">
                        <div class="player-avatar" style="background: ${player.color}" onclick="openColorPicker('${escapedUsername}', '${player.color}')" title="Farbe ändern">${initial}</div>
                        <div class="player-info">
                            <div class="player-name">
                                <span>${player.username}</span>
                                ${player.isGM ? '<span class="player-badge gm">GM</span>' : ''}
                                ${player.isRoomCreator ? '<span class="player-badge creator">Ersteller</span>' : ''}
                            </div>
                            <div class="player-status">${isCurrentUser ? 'Du' : 'Online'}</div>
                        </div>
                        ${!isCurrentUser && !player.isRoomCreator ? `
                            <div class="player-actions">
                                <button class="player-action-btn" onclick="openColorPicker('${escapedUsername}', '${player.color}')" title="Farbe ändern">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="13.5" cy="6.5" r="2.5"/>
                                        <circle cx="17.5" cy="10.5" r="2.5"/>
                                        <circle cx="8.5" cy="7.5" r="2.5"/>
                                        <circle cx="6.5" cy="12.5" r="2.5"/>
                                        <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z"/>
                                    </svg>
                                </button>
                                <button class="player-action-btn ${player.isGM ? 'active' : ''}" onclick="togglePlayerGM('${escapedUsername}', ${player.isGM})" title="${player.isGM ? 'GM entziehen' : 'Zum GM machen'}">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
                                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1Z"/>
                                    </svg>
                                </button>
                                <button class="player-action-btn danger" onclick="confirmAction('kickPlayer', 'Spieler kicken', 'Möchtest du ${escapedUsername} aus dem Raum entfernen?', '${escapedUsername}')" title="Spieler entfernen">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                        <circle cx="8.5" cy="7" r="4"/>
                                        <line x1="18" y1="8" x2="23" y2="13"/>
                                        <line x1="23" y1="8" x2="18" y2="13"/>
                                    </svg>
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // Load characters
        // Load characters
        async function loadCharacters() {
            const list = document.getElementById('characterList');
            console.log('[GM Options] loadCharacters called');
            
            try {
                // Get characters and players
                const [charSnapshot, playersSnapshot] = await Promise.all([
                    getRef('characters').once('value'),
                    getRef('players').once('value')
                ]);
                
                const characters = charSnapshot.val() || {};
                const players = playersSnapshot.val() || {};
                console.log('[GM Options] Characters:', characters);
                console.log('[GM Options] Players:', players);
                
                if (Object.keys(characters).length === 0) {
                    list.innerHTML = '<div style="text-align: center; color: var(--md-on-surface-variant); padding: var(--space-lg);">Keine Charaktere vorhanden</div>';
                    return;
                }

                list.innerHTML = Object.entries(characters).map(([key, char]) => {
                    const charName = char.name || char.charakterName || 'Unbenannt';
                    // Der Key IST der Spielername (sanitized)
                    // Hole Spielerdaten direkt mit dem Key
                    const player = players[key] || {};
                    const ownerName = player.username || key; // Echter Name aus players, sonst key
                    const playerColor = player.color || '#6750a4';
                    const playerInitial = ownerName.charAt(0).toUpperCase();
                    
                    return `
                        <div class="character-item">
                            <div class="character-avatar" style="background: ${playerColor}">${playerInitial}</div>
                            <div class="character-info">
                                <div class="character-owner-name">${ownerName}</div>
                                <div class="character-name">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px; opacity: 0.6;">
                                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                        <circle cx="8.5" cy="7" r="4"/>
                                    </svg>
                                    ${charName}
                                </div>
                            </div>
                            <div class="character-actions">
                                <button class="player-action-btn" onclick="viewCharacter('${key}')" title="Zum Charakterbogen">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                        <circle cx="12" cy="12" r="3"/>
                                    </svg>
                                </button>
                                <button class="player-action-btn" onclick="downloadCharacterJSON('${key}', '${charName.replace(/'/g, "\\'")}')" title="JSON herunterladen">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="7 10 12 15 17 10"/>
                                        <line x1="12" y1="15" x2="12" y2="3"/>
                                    </svg>
                                </button>
                                <button class="player-action-btn danger" onclick="confirmAction('deleteCharacter', 'Charakter löschen', 'Möchtest du den Charakter ${charName.replace(/'/g, "\\'")} löschen?', '${key}')" title="Charakter löschen">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Error loading characters:', error);
                list.innerHTML = '<div style="text-align: center; color: var(--md-on-surface-variant); padding: var(--space-lg);">Fehler beim Laden</div>';
            }
        }

        // View character in Charakterbogen module
        function viewCharacter(characterKey) {
            // Store the character key for GM view
            sessionStorage.setItem('gm_view_character', characterKey);
            window.location.href = 'charakterbogen.html?view=' + characterKey;
        }

        // Download character as JSON
        async function downloadCharacterJSON(characterKey, characterName) {
            try {
                const snapshot = await getRef(`characters/${characterKey}`).once('value');
                const charData = snapshot.val();
                
                if (charData) {
                    const json = JSON.stringify(charData, null, 2);
                    const blob = new Blob([json], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${characterName.replace(/[^a-zA-Z0-9äöüÄÖÜß]/g, '_')}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                }
            } catch (error) {
                console.error('Error downloading character:', error);
            }
        }

        // Toggle player GM status
        async function togglePlayerGM(username, currentStatus) {
            console.log('[GM Options] togglePlayerGM called:', username, currentStatus);
            
            if (!isFirebaseOnline()) {
                alert('Firebase nicht verbunden!');
                return;
            }
            
            try {
                const sanitizedKey = username.replace(/[.#$\/\[\]]/g, '_');
                const newStatus = !currentStatus;
                console.log('[GM Options] Setting GM status:', sanitizedKey, newStatus);
                
                await getRef(`players/${sanitizedKey}/isGM`).set(newStatus);
                const action = newStatus ? 'zum GM gemacht' : 'GM-Status entzogen';
                console.log(`[GM] ${username} wurde ${action}`);
                loadPlayers(); // Reload player list
            } catch (error) {
                console.error('Error toggling GM status:', error);
                alert('Fehler: ' + error.message);
            }
        }

        // Color options for picker
        const GM_COLOR_OPTIONS = [
            '#e57373', '#f06292', '#ba68c8', '#9575cd', '#7986cb', '#64b5f6',
            '#4fc3f7', '#4dd0e1', '#4db6ac', '#81c784', '#aed581', '#dce775',
            '#fff176', '#ffd54f', '#ffb74d', '#ff8a65', '#a1887f', '#90a4ae'
        ];

        // Open Name Edit Dialog
        function openNameEdit(username) {
            document.getElementById('nameEditInput').value = username;
            document.getElementById('nameEditOldUsername').value = username;
            document.getElementById('nameEditDialog').classList.add('active');
            document.getElementById('nameEditInput').focus();
        }

        function closeNameEditDialog() {
            document.getElementById('nameEditDialog').classList.remove('active');
        }

        // Save Player Name
        async function savePlayerName() {
            const oldUsername = document.getElementById('nameEditOldUsername').value;
            const newUsername = document.getElementById('nameEditInput').value.trim();
            
            if (!newUsername || newUsername === oldUsername) {
                closeNameEditDialog();
                return;
            }

            try {
                const sanitizedOldKey = oldUsername.replace(/[.#$\/\[\]]/g, '_');
                const sanitizedNewKey = newUsername.replace(/[.#$\/\[\]]/g, '_');
                
                // Get old player data
                const snapshot = await getRef(`players/${sanitizedOldKey}`).once('value');
                const playerData = snapshot.val();
                
                if (playerData) {
                    // Update username
                    playerData.username = newUsername;
                    
                    // Save with new key
                    await getRef(`players/${sanitizedNewKey}`).set(playerData);
                    
                    // Delete old entry
                    await getRef(`players/${sanitizedOldKey}`).remove();
                    
                    console.log(`[GM] Renamed ${oldUsername} to ${newUsername}`);
                }
                
                closeNameEditDialog();
            } catch (error) {
                console.error('Error renaming player:', error);
                alert('Fehler beim Umbenennen: ' + error.message);
            }
        }

        // Open Color Picker Dialog
        function openColorPicker(username, currentColor) {
            document.getElementById('colorPickerUsername').value = username;
            
            const grid = document.getElementById('colorPickerGrid');
            grid.innerHTML = GM_COLOR_OPTIONS.map(color => `
                <div class="color-option ${color === currentColor ? 'selected' : ''}" 
                     style="background: ${color}" 
                     onclick="selectPlayerColor('${color}')"></div>
            `).join('');
            
            document.getElementById('colorPickerDialog').classList.add('active');
        }

        function closeColorPickerDialog() {
            document.getElementById('colorPickerDialog').classList.remove('active');
        }

        // Select Player Color
        async function selectPlayerColor(color) {
            const username = document.getElementById('colorPickerUsername').value;
            console.log('[GM Options] selectPlayerColor called:', username, color);
            
            if (!isFirebaseOnline()) {
                alert('Firebase nicht verbunden!');
                console.error('[GM Options] Firebase not online!');
                return;
            }
            
            try {
                const sanitizedKey = username.replace(/[.#$\/\[\]]/g, '_');
                console.log('[GM Options] Sanitized key:', sanitizedKey);
                
                const ref = getRef(`players/${sanitizedKey}/color`);
                console.log('[GM Options] Setting color via ref');
                
                await ref.set(color);
                console.log(`[GM] Changed ${username} color to ${color}`);
                closeColorPickerDialog();
                loadPlayers(); // Reload player list
            } catch (error) {
                console.error('Error changing color:', error);
                alert('Fehler: ' + error.message);
            }
        }

        // Render catalog list
        function renderCatalogList() {
            const list = document.getElementById('catalogList');
            list.innerHTML = CATALOGS.map(catalog => `
                <div class="catalog-item ${catalog.id === selectedCatalogId ? 'active' : ''}" onclick="selectCatalog('${catalog.id}')">
                    <img src="${catalog.icon}" alt="${catalog.name}" onerror="this.style.display='none'">
                    <span>${catalog.name}</span>
                    <svg class="check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <polyline points="20 6 9 17 4 12"/>
                    </svg>
                </div>
            `).join('');
        }

        // Select catalog
        async function selectCatalog(catalogId) {
            selectedCatalogId = catalogId;
            localStorage.setItem('rift_active_catalog', catalogId);
            
            // Save to Firebase
            try {
                await getRef('settings/catalog').set(catalogId);
            } catch (error) {
                console.error('Error saving catalog:', error);
            }
            
            renderCatalogList();
        }

        // Confirm action dialog
        function confirmAction(action, title, message, data = null) {
            pendingAction = { action, data };
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmDialog').classList.add('active');
        }

        function closeConfirmDialog() {
            document.getElementById('confirmDialog').classList.remove('active');
            pendingAction = null;
        }

        // Execute confirmed action
        async function executeAction() {
            if (!pendingAction) return;
            
            if (!isFirebaseOnline()) {
                alert('Firebase nicht verbunden!');
                closeConfirmDialog();
                return;
            }
            
            const { action, data } = pendingAction;
            console.log('[GM Options] Executing action:', action, 'data:', data);
            closeConfirmDialog();

            try {
                switch (action) {
                    case 'clearChat':
                        console.log('[GM Options] Clearing chat...');
                        await getRef('chat').remove();
                        loadRoomStats();
                        break;
                    case 'clearDice':
                        console.log('[GM Options] Clearing dice...');
                        await getRef('dice').remove();
                        // Also clear local dice history
                        localStorage.removeItem('rumRacheHistory');
                        loadRoomStats();
                        console.log('[GM Options] Dice cleared!');
                        break;
                    case 'clearWhiteboard':
                        console.log('[GM Options] Clearing whiteboard...');
                        await getRef('whiteboard').remove();
                        // Also clear local whiteboard data
                        if (typeof clearSharedData === 'function') {
                            clearSharedData('whiteboard');
                        }
                        console.log('[GM Options] Whiteboard cleared!');
                        break;
                    case 'clearMarkers':
                        await getRef('markers').remove();
                        break;
                    case 'clearCharacters':
                        await getRef('characters').remove();
                        loadCharacters();
                        break;
                    case 'deleteCharacter':
                        await getRef(`characters/${data}`).remove();
                        loadCharacters();
                        break;
                    case 'clearNotes':
                        await getRef('notes').remove();
                        // Also clear local notes
                        if (typeof clearSharedData === 'function') {
                            clearSharedData('notes');
                        }
                        break;
                    case 'kickPlayer':
                        const sanitizedKey = data.replace(/[.#$\/\[\]]/g, '_');
                        console.log('[GM Options] Kicking player:', sanitizedKey);
                        // Set kicked flag instead of just removing
                        await getRef(`players/${sanitizedKey}`).update({
                            kicked: true,
                            kickedAt: firebase.database.ServerValue.TIMESTAMP
                        });
                        // Then remove after a short delay
                        setTimeout(async () => {
                            await getRef(`players/${sanitizedKey}`).remove();
                            loadPlayers();
                        }, 500);
                        break;
                    case 'deleteRoom':
                        await deleteRoom();
                        break;
                }
                console.log(`[GM] Action executed: ${action}`);
            } catch (error) {
                console.error(`Error executing ${action}:`, error);
                alert('Fehler: ' + error.message);
            }
        }

        // Delete room
        async function deleteRoom() {
            const room = getRoom();
            if (!room) return;

            // Delete all room data
            await getRef('').remove();

            // Clear local storage and redirect
            localStorage.removeItem('pnp_room');
            localStorage.removeItem('pnp_user');
            window.location.href = 'login.html';
        }

        // Export chat
        async function exportChat() {
            try {
                const snapshot = await getRef('chat').orderByChild('timestamp').once('value');
                const messages = [];
                
                snapshot.forEach(child => {
                    const msg = child.val();
                    messages.push({
                        time: new Date(msg.timestamp).toLocaleString('de-DE'),
                        user: msg.username,
                        message: msg.message
                    });
                });

                const text = messages.map(m => `[${m.time}] ${m.user}: ${m.message}`).join('\n');
                downloadFile('chat-export.txt', text);
            } catch (error) {
                console.error('Error exporting chat:', error);
            }
        }

        // Export session
        async function exportSession() {
            try {
                const snapshot = await getRef('').once('value');
                const data = snapshot.val() || {};
                
                const json = JSON.stringify(data, null, 2);
                downloadFile('session-backup.json', json);
            } catch (error) {
                console.error('Error exporting session:', error);
            }
        }

        // Download helper
        function downloadFile(filename, content) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Import session
        function handleImportFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Validate it looks like session data
                    if (typeof data !== 'object') {
                        throw new Error('Ungültiges Format');
                    }

                    // Confirm import
                    if (!confirm('Session-Backup importieren?\n\nAchtung: Bestehende Daten werden überschrieben!')) {
                        return;
                    }

                    // Import data
                    await getRef('').set(data);
                    
                    alert('Import erfolgreich!');
                    loadRoomStats();
                    loadPlayers();
                    
                } catch (error) {
                    console.error('Import error:', error);
                    alert('Import fehlgeschlagen: ' + error.message);
                }
            };
            reader.readAsText(file);
            
            // Reset input
            event.target.value = '';
        }

        // Format helpers
        function formatDate(timestamp) {
            return new Date(timestamp).toLocaleDateString('de-DE', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatTimeAgo(timestamp) {
            const diff = Date.now() - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (days > 0) return `vor ${days} Tag${days > 1 ? 'en' : ''}`;
            if (hours > 0) return `vor ${hours} Stunde${hours > 1 ? 'n' : ''}`;
            if (minutes > 0) return `vor ${minutes} Minute${minutes > 1 ? 'n' : ''}`;
            return 'gerade eben';
        }

        // Footer
        createFooter();
    </script>
</body>
</html>
